(window.webpackJsonp=window.webpackJsonp||[]).push([[249],{F9yf:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/job-specification/service",function(){return t("isHh")}])},isHh:function(e,a,t){"use strict";t.r(a),t.d(a,"default",(function(){return j}));var n,c=t("wx14"),s=t("Ff2n"),b=t("q1tI"),p=t.n(b),o=t("7ljp"),r=t("j1un"),i=(p.a.createElement,n="Placement",function(e){return console.warn("Component "+n+" was not imported, exported, or provided by MDXProvider as global scope"),Object(o.b)("div",e)}),m={},l=Object(r.a)({layout:"docs",page_title:"service Stanza - Job Specification",sidebar_title:"service",description:'The "service" stanza instructs Nomad to register the task as a service using\nthe service discovery integration.',__resourcePath:"docs/job-specification/service.mdx",__scans:{}});function j(e){var{components:a}=e,t=Object(s.a)(e,["components"]);return Object(o.b)(l,Object(c.a)({},m,t,{components:a,mdxType:"MDXLayout"}),Object(o.b)("h1",{className:"g-type-display-2"},Object(o.b)("a",Object(c.a)({parentName:"h1"},{className:"__permalink-h",href:"#service-stanza","aria-label":"service stanza permalink"}),"\xbb"),Object(o.b)("a",Object(c.a)({parentName:"h1"},{className:"__target-h",id:"service-stanza","aria-hidden":""})),Object(o.b)("inlineCode",{parentName:"h1"},"service")," Stanza"),Object(o.b)(i,{groups:[["job","group","service"],["job","group","task","service"]],mdxType:"Placement"}),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"service")," stanza instructs Nomad to register a service with Consul. This\nsection of the documentation will discuss the configuration, but please also\nread the ",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/integrations/consul-integration#service-discovery",title:"Nomad Service Discovery"}),"Nomad service discovery documentation")," for more\ndetailed information about the integration."),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),"job ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"docs"')," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  group ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"example"')," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    task ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"server"')," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"service")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"tags")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"leader"'),", ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"mysql"'),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"port")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"db"'),"\n\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"meta")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"meta")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"for your service"'),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"check")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"type"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"tcp"'),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"port"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"db"'),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"interval")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"10s"'),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"timeout"),"  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"2s"'),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"check")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"type"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"script"'),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"name"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"check_table"'),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"command"),"  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"/usr/local/bin/check_mysql_table_status"'),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"args"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"--verbose"'),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"interval")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"60s"'),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"timeout"),"  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"5s"'),"\n\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"check_restart")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n            ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"limit")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"3"),"\n            ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"grace")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"90s"'),"\n            ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"ignore_warnings")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token boolean"}),"false"),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("p",null,"This section of the documentation only cover the job file fields and stanzas\nfor service discovery. For more details on using Nomad with Consul please see\nthe ",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/integrations/consul-integration#service-discovery",title:"Nomad Service Discovery"}),"Consul integration documentation"),"."),Object(o.b)("p",null,"Nomad 0.10 also allows specifying the ",Object(o.b)("inlineCode",{parentName:"p"},"service")," stanza at the task group level.\nThis enables services in the same task group to opt into ",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/job-specification/connect",title:"Nomad Consul Connect Integration"}),"Consul\nConnect")," integration."),Object(o.b)("h2",{className:"g-type-display-3"},Object(o.b)("a",Object(c.a)({parentName:"h2"},{className:"__permalink-h",href:"#service-parameters","aria-label":"service parameters permalink"}),"\xbb"),Object(o.b)("a",Object(c.a)({parentName:"h2"},{className:"__target-h",id:"service-parameters","aria-hidden":""})),Object(o.b)("inlineCode",{parentName:"h2"},"service")," Parameters"),Object(o.b)("ul",null,Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"check",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#check","aria-label":"check permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"check"))," ",Object(o.b)("code",null,"(",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#check-parameters"}),"Check"),": nil)")," - Specifies a health\ncheck associated with the service. This can be specified multiple times to\ndefine multiple checks for the service. At this time, Nomad supports the\n",Object(o.b)("inlineCode",{parentName:"p"},"grpc"),", ",Object(o.b)("inlineCode",{parentName:"p"},"http"),", ",Object(o.b)("inlineCode",{parentName:"p"},"script"),Object(o.b)("sup",null,Object(o.b)("small",null,"1")),", and ",Object(o.b)("inlineCode",{parentName:"p"},"tcp")," checks.")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"connect",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#connect","aria-label":"connect permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"connect"))," - Configures the ",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/job-specification/connect",title:"Nomad Consul Connect Integration"}),"Consul Connect")," integration. Only\navailable on group services.")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"name",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#name","aria-label":"name permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"name"))," ",Object(o.b)("inlineCode",{parentName:"p"},'(string: "<job>-<group>-<task>")')," - Specifies the name this service\nwill be advertised as in Consul. If not supplied, this will default to the\nname of the job, group, and task concatenated together with a dash, like\n",Object(o.b)("inlineCode",{parentName:"p"},'"docs-example-server"'),". Each service must have a unique name within the\ncluster. Names must adhere to ",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"https://tools.ietf.org/html/rfc1123#section-2"}),"RFC-1123\n\xa72.1")," and are limited to\nalphanumeric and hyphen characters (i.e. ",Object(o.b)("inlineCode",{parentName:"p"},"[a-z0-9\\-]"),"), and be less than 64\ncharacters in length."),Object(o.b)("p",{parentName:"li"},"In addition to the standard ",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/runtime/interpolation",title:"Nomad Runtime Interpolation"}),"Nomad interpolation"),", the\nfollowing keys are also available:"),Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"job",className:"__target-lic","aria-hidden":""})),Object(o.b)("a",Object(c.a)({parentName:"li"},{href:"#job","aria-label":"job permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"${JOB}"))," - the name of the job"),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"group",className:"__target-lic","aria-hidden":""})),Object(o.b)("a",Object(c.a)({parentName:"li"},{href:"#group","aria-label":"group permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"${GROUP}"))," - the name of the group"),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"task",className:"__target-lic","aria-hidden":""})),Object(o.b)("a",Object(c.a)({parentName:"li"},{href:"#task","aria-label":"task permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"${TASK}"))," - the name of the task"),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"base",className:"__target-lic","aria-hidden":""})),Object(o.b)("a",Object(c.a)({parentName:"li"},{href:"#base","aria-label":"base permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"${BASE}"))," - shorthand for ",Object(o.b)("inlineCode",{parentName:"li"},"${JOB}-${GROUP}-${TASK}"))),Object(o.b)("p",{parentName:"li"},"Validation of the name occurs in two parts. When the job is registered, an initial validation pass checks that\nthe service name adheres to RFC-1123 \xa72.1 and the length limit, excluding any variables requiring interpolation.\nOnce the client receives the service and all interpretable values are available, the service name will be\ninterpolated and revalidated. This can cause certain service names to pass validation at submit time but fail\nat runtime.")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"port",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#port","aria-label":"port permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"port"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(string: <optional>)")," - Specifies the port to advertise for this\nservice. The value of ",Object(o.b)("inlineCode",{parentName:"p"},"port")," depends on which ",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#address_mode"}),Object(o.b)("inlineCode",{parentName:"a"},"address_mode")),"\nis being used:"),Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"driver",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#driver","aria-label":"driver permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"driver"))," - Advertise the port determined by the driver (eg Docker or rkt).\nThe ",Object(o.b)("inlineCode",{parentName:"p"},"port")," may be a numeric port or a port label specified in the driver's\n",Object(o.b)("inlineCode",{parentName:"p"},"port_map"),".")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"host",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#host","aria-label":"host permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"host"))," - Advertise the host port for this service. ",Object(o.b)("inlineCode",{parentName:"p"},"port")," must match a port\n",Object(o.b)("em",{parentName:"p"},"label")," specified in the ",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/job-specification/network",title:"Nomad network Job Specification"}),Object(o.b)("inlineCode",{parentName:"a"},"network"))," stanza.")))),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"tags",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#tags","aria-label":"tags permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"tags"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(array<string>: [])")," - Specifies the list of tags to associate with\nthis service. If this is not supplied, no tags will be assigned to the service\nwhen it is registered.")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"canary_tags",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#canary_tags","aria-label":"canary_tags permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"canary_tags"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(array<string>: [])")," - Specifies the list of tags to associate with\nthis service when the service is part of an allocation that is currently a\ncanary. Once the canary is promoted, the registered tags will be updated to\nthose specified in the ",Object(o.b)("inlineCode",{parentName:"p"},"tags")," parameter. If this is not supplied, the\nregistered tags will be equal to that of the ",Object(o.b)("inlineCode",{parentName:"p"},"tags")," parameter.")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"enable_tag_override",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#enable_tag_override","aria-label":"enable_tag_override permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"enable_tag_override"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(bool: false)")," - Enables users of Consul's Catalog API\nto make changes to the tags of a service without having those changes be\noverwritten by Consul's anti-entropy mechanism. See Consul\n",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"https://www.consul.io/docs/internals/anti-entropy.html#enable-tag-override"}),"documentation"),"\nfor more information.")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"address_mode",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#address_mode","aria-label":"address_mode permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"address_mode"))," ",Object(o.b)("inlineCode",{parentName:"p"},'(string: "auto")')," - Specifies what address (host or\ndriver-specific) this service should advertise. This setting is supported in\nDocker since Nomad 0.6 and rkt since Nomad 0.7. See ",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#using-driver-address-mode"}),"below for\nexamples.")," Valid options are:"),Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"auto",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#auto","aria-label":"auto permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"auto"))," - Allows the driver to determine whether the host or driver address\nshould be used. Defaults to ",Object(o.b)("inlineCode",{parentName:"p"},"host")," and only implemented by Docker. If you\nuse a Docker network plugin such as weave, Docker will automatically use\nits address.")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"driver-1",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#driver-1","aria-label":"driver permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"driver"))," - Use the IP specified by the driver, and the port specified in a\nport map. A numeric port may be specified since port maps aren't required\nby all network plugins. Useful for advertising SDN and overlay network\naddresses. Task will fail if driver network cannot be determined. Only\nimplemented for Docker and rkt.")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"host-1",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#host-1","aria-label":"host permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"host"))," - Use the host IP and port.")))),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"task-1",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#task-1","aria-label":"task permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"task"))," ",Object(o.b)("inlineCode",{parentName:"p"},'(string: "")')," - Specifies the name of the Nomad Task associated with\nthis service definition. Only available on group services. Must be set if this\nservice definition represents a Consul Connect Native service and there is more\nthan one task in the task group.")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"meta",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#meta","aria-label":"meta permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"meta"))," ",Object(o.b)("code",null,"(","[Meta][]",": nil)")," - Specifies a key-value map that annotates\nthe Consul service with user-defined metadata.")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"canary_meta",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#canary_meta","aria-label":"canary_meta permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"canary_meta"))," ",Object(o.b)("code",null,"(","[Meta][]",": nil)")," - Specifies a key-value map that\nannotates the Consul service with user-defined metadata when the service is\npart of an allocation that is currently a canary. Once the canary is\npromoted, the registered meta will be updated to those specified in the\n",Object(o.b)("inlineCode",{parentName:"p"},"meta")," parameter. If this is not supplied, the registered meta will be set to\nthat of the ",Object(o.b)("inlineCode",{parentName:"p"},"meta")," parameter."))),Object(o.b)("h3",{className:"g-type-display-4"},Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#check-parameters","aria-label":"check parameters permalink"}),"\xbb"),Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"check-parameters","aria-hidden":""})),Object(o.b)("inlineCode",{parentName:"h3"},"check")," Parameters"),Object(o.b)("p",null,"Note that health checks run inside the task. If your task is a Docker container,\nthe script will run inside the Docker container. If your task is running in a\nchroot, it will run in the chroot. Please keep this in mind when authoring check\nscripts."),Object(o.b)("ul",null,Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"address_mode-1",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#address_mode-1","aria-label":"address_mode permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"address_mode"))," ",Object(o.b)("inlineCode",{parentName:"p"},'(string: "host")')," - Same as ",Object(o.b)("inlineCode",{parentName:"p"},"address_mode")," on ",Object(o.b)("inlineCode",{parentName:"p"},"service"),".\nUnlike services, checks do not have an ",Object(o.b)("inlineCode",{parentName:"p"},"auto")," address mode as there's no way\nfor Nomad to know which is the best address to use for checks. Consul needs\naccess to the address for any HTTP or TCP checks. Added in Nomad 0.7.1. See\n",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#using-driver-address-mode"}),"below for details.")," Unlike ",Object(o.b)("inlineCode",{parentName:"p"},"port"),", this setting\nis ",Object(o.b)("em",{parentName:"p"},"not")," inherited from the ",Object(o.b)("inlineCode",{parentName:"p"},"service"),".")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"args",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#args","aria-label":"args permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"args"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(array<string>: [])")," - Specifies additional arguments to the\n",Object(o.b)("inlineCode",{parentName:"p"},"command"),". This only applies to script-based health checks.")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"check_restart",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#check_restart","aria-label":"check_restart permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"check_restart"))," - See ",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/job-specification/check_restart",title:"check_restart stanza"}),Object(o.b)("inlineCode",{parentName:"a"},"check_restart")," stanza"),".")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"command",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#command","aria-label":"command permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"command"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(string: <varies>)")," - Specifies the command to run for performing\nthe health check. The script must exit: 0 for passing, 1 for warning, or any\nother value for a failing health check. This is required for script-based\nhealth checks."),Object(o.b)("div",Object(c.a)({parentName:"li"},{className:"alert alert-warning g-type-body",role:"alert"}),Object(o.b)("p",{parentName:"div"},"",Object(o.b)("strong",{parentName:"p"},"Caveat:")," The command must be the path to the command on disk, and no\nshell exists by default. That means operators like ",Object(o.b)("inlineCode",{parentName:"p"},"||")," or ",Object(o.b)("inlineCode",{parentName:"p"},"&&")," are not\navailable. Additionally, all arguments must be supplied via the ",Object(o.b)("inlineCode",{parentName:"p"},"args"),"\nparameter. To achieve the behavior of shell operators, specify the command\nas a shell, like ",Object(o.b)("inlineCode",{parentName:"p"},"/bin/bash")," and then use ",Object(o.b)("inlineCode",{parentName:"p"},"args")," to run the check."))),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"grpc_service",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#grpc_service","aria-label":"grpc_service permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"grpc_service"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(string: <optional>)")," - What service, if any, to specify in\nthe gRPC health check. gRPC health checks require Consul 1.0.5 or later.")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"grpc_use_tls",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#grpc_use_tls","aria-label":"grpc_use_tls permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"grpc_use_tls"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(bool: false)")," - Use TLS to perform a gRPC health check. May\nbe used with ",Object(o.b)("inlineCode",{parentName:"p"},"tls_skip_verify")," to use TLS but skip certificate verification.")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"initial_status",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#initial_status","aria-label":"initial_status permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"initial_status"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(string: <enum>)")," - Specifies the originating status of the\nservice. Valid options are the empty string, ",Object(o.b)("inlineCode",{parentName:"p"},"passing"),", ",Object(o.b)("inlineCode",{parentName:"p"},"warning"),", and\n",Object(o.b)("inlineCode",{parentName:"p"},"critical"),".")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"success_before_passing",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#success_before_passing","aria-label":"success_before_passing permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"success_before_passing"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(int:0)")," - The number of consecutive successful checks\nrequired before Consul will transition the service status to ",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"https://www.consul.io/docs/agent/checks#success-failures-before-passing-critical"}),Object(o.b)("inlineCode",{parentName:"a"},"passing")),".")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"failures_before_critical",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#failures_before_critical","aria-label":"failures_before_critical permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"failures_before_critical"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(int:0)")," - The number of consecutive failing checks\nrequired before Consul will transition the service status to ",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"https://www.consul.io/docs/agent/checks#success-failures-before-passing-critical"}),Object(o.b)("inlineCode",{parentName:"a"},"critical")),".")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"interval",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#interval","aria-label":"interval permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"interval"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(string: <required>)"),' - Specifies the frequency of the health checks\nthat Consul will perform. This is specified using a label suffix like "30s"\nor "1h". This must be greater than or equal to "1s"')),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"method",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#method","aria-label":"method permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"method"))," ",Object(o.b)("inlineCode",{parentName:"p"},'(string: "GET")')," - Specifies the HTTP method to use for HTTP\nchecks.")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"name-1",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#name-1","aria-label":"name permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"name"))," ",Object(o.b)("inlineCode",{parentName:"p"},'(string: "service: <name> check")')," - Specifies the name of the health\ncheck. If the name is not specified Nomad generates one based on the service name.\nIf you have more than one check you must specify the name.")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"path",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#path","aria-label":"path permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"path"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(string: <varies>)")," - Specifies the path of the HTTP endpoint which\nConsul will query to query the health of a service. Nomad will automatically\nadd the IP of the service and the port, so this is just the relative URL to\nthe health check endpoint. This is required for http-based health checks.")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"expose",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#expose","aria-label":"expose permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"expose"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(bool: false)")," - Specifies whether an ",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/job-specification/expose#path-parameters"}),"Expose Path"),"\nshould be automatically generated for this check. Only compatible with\nConnect-enabled task-group services using the default Connect proxy. Check\nmust be of ",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/job-specification/service#type"}),Object(o.b)("inlineCode",{parentName:"a"},"type"))," ",Object(o.b)("inlineCode",{parentName:"p"},"http")," or ",Object(o.b)("inlineCode",{parentName:"p"},"grpc"),".")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"port-1",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#port-1","aria-label":"port permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"port"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(string: <varies>)")," - Specifies the label of the port on which the\ncheck will be performed. Note this is the ",Object(o.b)("em",{parentName:"p"},"label")," of the port and not the port\nnumber unless ",Object(o.b)("inlineCode",{parentName:"p"},"address_mode = driver"),". The port label must match one defined\nin the ",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/job-specification/network",title:"Nomad network Job Specification"}),Object(o.b)("inlineCode",{parentName:"a"},"network"))," stanza. If a port value was declared on the\n",Object(o.b)("inlineCode",{parentName:"p"},"service"),", this will inherit from that value if not supplied. If supplied,\nthis value takes precedence over the ",Object(o.b)("inlineCode",{parentName:"p"},"service.port")," value. This is useful for\nservices which operate on multiple ports. ",Object(o.b)("inlineCode",{parentName:"p"},"grpc"),", ",Object(o.b)("inlineCode",{parentName:"p"},"http"),", and ",Object(o.b)("inlineCode",{parentName:"p"},"tcp")," checks\nrequire a port while ",Object(o.b)("inlineCode",{parentName:"p"},"script")," checks do not. Checks will use the host IP and\nports by default. In Nomad 0.7.1 or later numeric ports may be used if\n",Object(o.b)("inlineCode",{parentName:"p"},'address_mode="driver"')," is set on the check.")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"protocol",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#protocol","aria-label":"protocol permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"protocol"))," ",Object(o.b)("inlineCode",{parentName:"p"},'(string: "http")')," - Specifies the protocol for the http-based\nhealth checks. Valid options are ",Object(o.b)("inlineCode",{parentName:"p"},"http")," and ",Object(o.b)("inlineCode",{parentName:"p"},"https"),".")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"task-2",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#task-2","aria-label":"task permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"task"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(string: <required>)")," - Specifies the task associated with this\ncheck. Scripts are executed within the task's environment, and\n",Object(o.b)("inlineCode",{parentName:"p"},"check_restart")," stanzas will apply to the specified task. For ",Object(o.b)("inlineCode",{parentName:"p"},"checks")," on group\nlevel ",Object(o.b)("inlineCode",{parentName:"p"},"services")," only.")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"timeout",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#timeout","aria-label":"timeout permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"timeout"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(string: <required>)"),' - Specifies how long Consul will wait for a\nhealth check query to succeed. This is specified using a label suffix like\n"30s" or "1h". This must be greater than or equal to "1s"'),Object(o.b)("div",Object(c.a)({parentName:"li"},{className:"alert alert-warning g-type-body",role:"alert"}),Object(o.b)("p",{parentName:"div"},"",Object(o.b)("strong",{parentName:"p"},"Caveat:")," Script checks use the task driver to execute in the task's\nenvironment. For task drivers with namespace isolation such as ",Object(o.b)("inlineCode",{parentName:"p"},"docker")," or\n",Object(o.b)("inlineCode",{parentName:"p"},"exec"),", setting up the context for the script check may take an unexpectedly\nlong amount of time (a full second or two), especially on busy hosts. The\ntimeout configuration must allow for both this setup and the execution of\nthe script. Operators should use long timeouts (5 or more seconds) for script\nchecks, and monitor telemetry for\n",Object(o.b)("inlineCode",{parentName:"p"},"client.allocrunner.taskrunner.tasklet_timeout"),"."))),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"type",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#type","aria-label":"type permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"type"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(string: <required>)")," - This indicates the check types supported by\nNomad. Valid options are ",Object(o.b)("inlineCode",{parentName:"p"},"grpc"),", ",Object(o.b)("inlineCode",{parentName:"p"},"http"),", ",Object(o.b)("inlineCode",{parentName:"p"},"script"),", and ",Object(o.b)("inlineCode",{parentName:"p"},"tcp"),". gRPC health\nchecks require Consul 1.0.5 or later.")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"tls_skip_verify",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#tls_skip_verify","aria-label":"tls_skip_verify permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"tls_skip_verify"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(bool: false)")," - Skip verifying TLS certificates for HTTPS\nchecks. Requires Consul >= 0.7.2."))),Object(o.b)("h4",{className:"g-type-display-5"},Object(o.b)("a",Object(c.a)({parentName:"h4"},{className:"__permalink-h",href:"#header-stanza","aria-label":"header stanza permalink"}),"\xbb"),Object(o.b)("a",Object(c.a)({parentName:"h4"},{className:"__target-h",id:"header-stanza","aria-hidden":""})),Object(o.b)("inlineCode",{parentName:"h4"},"header")," Stanza"),Object(o.b)("p",null,"HTTP checks may include a ",Object(o.b)("inlineCode",{parentName:"p"},"header")," stanza to set HTTP headers. The ",Object(o.b)("inlineCode",{parentName:"p"},"header"),"\nstanza parameters have lists of strings as values. Multiple values will cause\nthe header to be set multiple times, once for each value."),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"service")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token comment"}),"# ..."),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"check")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"type"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"http"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"port"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"lb"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"path"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"/_healthz"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"interval")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"5s"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"timeout"),"  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"2s"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"header")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"Authorization")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"Basic ZWxhc3RpYzpjaGFuZ2VtZQ=="'),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("h2",{className:"g-type-display-3"},Object(o.b)("a",Object(c.a)({parentName:"h2"},{className:"__permalink-h",href:"#service-lifecycle","aria-label":"service lifecycle permalink"}),"\xbb"),Object(o.b)("a",Object(c.a)({parentName:"h2"},{className:"__target-h",id:"service-lifecycle","aria-hidden":""})),Object(o.b)("inlineCode",{parentName:"h2"},"service")," Lifecycle"),Object(o.b)("p",null,"Nomad manages registering, updating, and deregistering services with Consul. It\nis important to understand when each of these steps happens and how they can be\ncustomized."),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Registration"),": Nomad will register ",Object(o.b)("inlineCode",{parentName:"p"},"group")," services and checks ",Object(o.b)("em",{parentName:"p"},"before"),"\nstarting any tasks. Services and checks for a specific ",Object(o.b)("inlineCode",{parentName:"p"},"task")," are registered\n",Object(o.b)("em",{parentName:"p"},"after")," the task has started."),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Updating"),": If a service or check definition is updated, Nomad will update\nthe service in Consul as well. Consul is updated without restarting a task."),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Deregistering"),": If a running task with a service stanza exits, the services\nand checks are immediately deregistered from Consul without delay. If however\nNomad needs to kill a running task, the task is killed in the following order:"),Object(o.b)("ol",null,Object(o.b)("li",Object(c.a)({parentName:"ol"},{className:"g-type-long-body"}),"Immediately remove the services and checks from Consul. This stops new\ntraffic from being routed to the task that is being killed."),Object(o.b)("li",Object(c.a)({parentName:"ol"},{className:"g-type-long-body"}),"If ",Object(o.b)("a",Object(c.a)({parentName:"li"},{href:"/docs/job-specification/task#shutdown_delay"}),Object(o.b)("inlineCode",{parentName:"a"},"shutdown_delay"))," is set, wait the configured duration\nbefore proceeding to step 3. Setting a ",Object(o.b)("a",Object(c.a)({parentName:"li"},{href:"/docs/job-specification/task#shutdown_delay"}),Object(o.b)("inlineCode",{parentName:"a"},"shutdown_delay"))," can\nbe useful if the application itself doesn't handle graceful shutdowns based\non the ",Object(o.b)("a",Object(c.a)({parentName:"li"},{href:"/docs/job-specification/task#kill_signal"}),Object(o.b)("inlineCode",{parentName:"a"},"kill_signal")),". The configured delay will provide a\nperiod of time in which the service is no longer registered in Consul, and\nthus is not receiving additional requests, but hasn't been signalled to\nshutdown. This allows the application time to complete the requests and\nbecome idle."),Object(o.b)("li",Object(c.a)({parentName:"ol"},{className:"g-type-long-body"}),"Send the ",Object(o.b)("a",Object(c.a)({parentName:"li"},{href:"/docs/job-specification/task#kill_signal"}),Object(o.b)("inlineCode",{parentName:"a"},"kill_signal"))," to the task and wait for the task to\nexit. The task should use this time to gracefully drain and finish any\nexisting requests."),Object(o.b)("li",Object(c.a)({parentName:"ol"},{className:"g-type-long-body"}),"If the task has not exited after the ",Object(o.b)("a",Object(c.a)({parentName:"li"},{href:"/docs/job-specification/task#kill_timeout"}),Object(o.b)("inlineCode",{parentName:"a"},"kill_timeout")),", Nomad\nwill force kill the application.")),Object(o.b)("h2",{className:"g-type-display-3"},Object(o.b)("a",Object(c.a)({parentName:"h2"},{className:"__permalink-h",href:"#service-examples","aria-label":"service examples permalink"}),"\xbb"),Object(o.b)("a",Object(c.a)({parentName:"h2"},{className:"__target-h",id:"service-examples","aria-hidden":""})),Object(o.b)("inlineCode",{parentName:"h2"},"service")," Examples"),Object(o.b)("p",null,"The following examples only show the ",Object(o.b)("inlineCode",{parentName:"p"},"service")," stanzas. Remember that the\n",Object(o.b)("inlineCode",{parentName:"p"},"service")," stanza is only valid in the placements listed above."),Object(o.b)("h3",{className:"g-type-display-4"},Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#basic-service","aria-label":"basic service permalink"}),"\xbb"),Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"basic-service","aria-hidden":""})),"Basic Service"),Object(o.b)("p",null,'This example registers a service named "load-balancer" with no health checks.'),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"service")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"name")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"load-balancer"'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"port")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"lb"'),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("p",null,"This example must be accompanied by a ",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/job-specification/network",title:"Nomad network Job Specification"}),Object(o.b)("inlineCode",{parentName:"a"},"network")),' stanza which defines\na static or dynamic port labeled "lb". For example:'),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"resources")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"network")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"mbits")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"10"),"\n    port ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"lb"')," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("h3",{className:"g-type-display-4"},Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#script-checks-with-shells","aria-label":"script checks with shells permalink"}),"\xbb"),Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"script-checks-with-shells","aria-hidden":""})),"Script Checks with Shells"),Object(o.b)("p",null,"This example shows a service with a script check that is evaluated and interpolated in a shell; it\ntests whether a file is present at ",Object(o.b)("inlineCode",{parentName:"p"},"${HEALTH_CHECK_FILE}")," environment variable:"),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"service")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"check")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"type"),"    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"script"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"command")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"/bin/bash"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"args"),"    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"-c"'),", ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"test -f ',Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token interpolation"}),Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"$"),Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"{"),"HEALTH_CHECK_FILE",Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"}")),'"'),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("p",null,"Using ",Object(o.b)("inlineCode",{parentName:"p"},"/bin/bash")," (or another shell) is required here to interpolate the ",Object(o.b)("inlineCode",{parentName:"p"},"${HEALTH_CHECK_FILE}")," value."),Object(o.b)("p",null,"The following examples of ",Object(o.b)("inlineCode",{parentName:"p"},"command")," fields ",Object(o.b)("strong",{parentName:"p"},"will not work"),":"),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token comment"}),"# invalid because command is not a path"),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"check")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"type"),"    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"script"'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"command")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"test -f /tmp/file.txt"'),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token comment"}),"# invalid because path will not be interpolated"),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"check")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"type"),"    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"script"'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"command")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"/bin/test"'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"args"),"    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"-f"'),", ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"',Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token interpolation"}),Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"$"),Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"{"),"HEALTH_CHECK_FILE",Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"}")),'"'),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("h3",{className:"g-type-display-4"},Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#http-health-check","aria-label":"http health check permalink"}),"\xbb"),Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"http-health-check","aria-hidden":""})),"HTTP Health Check"),Object(o.b)("p",null,"This example shows a service with an HTTP health check. This will query the\nservice on the IP and port registered with Nomad at ",Object(o.b)("inlineCode",{parentName:"p"},"/_healthz")," every 5 seconds,\ngiving the service a maximum of 2 seconds to return a response, and include an\nAuthorization header. Any non-2xx code is considered a failure."),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"service")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"check")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"type"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"http"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"port"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"lb"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"path"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"/_healthz"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"interval")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"5s"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"timeout"),"  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"2s"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"header")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"Authorization")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"Basic ZWxhc3RpYzpjaGFuZ2VtZQ=="'),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("h3",{className:"g-type-display-4"},Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#multiple-health-checks","aria-label":"multiple health checks permalink"}),"\xbb"),Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"multiple-health-checks","aria-hidden":""})),"Multiple Health Checks"),Object(o.b)("p",null,"This example shows a service with multiple health checks defined. All health\nchecks must be passing in order for the service to register as healthy."),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"service")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"check")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"name"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"HTTP Check"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"type"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"http"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"port"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"lb"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"path"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"/_healthz"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"interval")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"5s"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"timeout"),"  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"2s"'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"check")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"name"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"HTTPS Check"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"type"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"http"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"protocol")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"https"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"port"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"lb"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"path"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"/_healthz"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"interval")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"5s"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"timeout"),"  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"2s"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"method"),"   ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"POST"'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"check")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"name"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"Postgres Check"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"type"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"script"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"command"),"  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"/usr/local/bin/pg-tools"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"args"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"verify"'),", ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"database"'),", ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"prod"'),", ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"up"'),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"interval")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"5s"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"timeout"),"  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"2s"'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("h3",{className:"g-type-display-4"},Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#grpc-health-check","aria-label":"grpc health check permalink"}),"\xbb"),Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"grpc-health-check","aria-hidden":""})),"gRPC Health Check"),Object(o.b)("p",null,"gRPC health checks use the same host and port behavior as ",Object(o.b)("inlineCode",{parentName:"p"},"http")," and ",Object(o.b)("inlineCode",{parentName:"p"},"tcp"),"\nchecks, but gRPC checks also have an optional gRPC service to health check. Not\nall gRPC applications require a service to health check. gRPC health checks\nrequire Consul 1.0.5 or later."),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"service")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"check")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"type"),"            ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"grpc"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"port"),"            ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"rpc"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"interval"),"        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"5s"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"timeout"),"         ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"2s"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"grpc_service"),"    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"example.Service"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"grpc_use_tls"),"    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token boolean"}),"true"),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"tls_skip_verify")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token boolean"}),"true"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("p",null,"In this example Consul would health check the ",Object(o.b)("inlineCode",{parentName:"p"},"example.Service")," service on the\n",Object(o.b)("inlineCode",{parentName:"p"},"rpc")," port defined in the task's ",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/job-specification/network",title:"Nomad network Job Specification"}),"network resources")," stanza. See\n",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#using-driver-address-mode"}),"Using Driver Address Mode")," for details on address\nselection."),Object(o.b)("h3",{className:"g-type-display-4"},Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#using-driver-address-mode","aria-label":"using driver address mode permalink"}),"\xbb"),Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"using-driver-address-mode","aria-hidden":""})),"Using Driver Address Mode"),Object(o.b)("p",null,"The ",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/drivers/docker#network_mode"}),"Docker")," and\n",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/drivers/rkt#net"}),"rkt")," drivers support the ",Object(o.b)("inlineCode",{parentName:"p"},"driver")," setting for the\n",Object(o.b)("inlineCode",{parentName:"p"},"address_mode")," parameter in both ",Object(o.b)("inlineCode",{parentName:"p"},"service")," and ",Object(o.b)("inlineCode",{parentName:"p"},"check")," stanzas. The driver\naddress mode allows advertising and health checking the IP and port assigned to\na task by the driver. This way if you're using a network plugin like Weave with\nDocker, you can advertise the Weave address in Consul instead of the host's\naddress."),Object(o.b)("p",null,"For example if you were running the example Redis job in an environment with\nWeave but Consul was running on the host you could use the following\nconfiguration:"),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),"job ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"example"')," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"datacenters")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"dc1"'),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n  group ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"cache"')," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n\n    task ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"redis"')," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"driver")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"docker"'),"\n\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"config")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"image")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"redis:3.2"'),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"network_mode")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"weave"'),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"port_map")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"db")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"6379"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"resources")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"cpu"),"    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"500")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token comment"}),"# 500 MHz"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"memory")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"256")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token comment"}),"# 256MB"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"network")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"mbits")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"10"),"\n          port ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"db"')," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"service")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"name")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"weave-redis"'),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"port")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"db"'),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"check")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"name"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"host-redis-check"'),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"type"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"tcp"'),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"interval")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"10s"'),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"timeout"),"  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"2s"'),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("p",null,"No explicit ",Object(o.b)("inlineCode",{parentName:"p"},"address_mode")," required!"),Object(o.b)("p",null,"Services default to the ",Object(o.b)("inlineCode",{parentName:"p"},"auto"),' address mode. When a Docker network mode other\nthan "host" or "bridge" is used, services will automatically advertise the\ndriver\'s address (in this case Weave\'s). The service will advertise the\ncontainer\'s port: 6379.'),Object(o.b)("p",null,"However since Consul is often run on the host without access to the Weave\nnetwork, ",Object(o.b)("inlineCode",{parentName:"p"},"check")," stanzas default to ",Object(o.b)("inlineCode",{parentName:"p"},"host")," address mode. The TCP check will run\nagainst the host's IP and the dynamic host port assigned by Nomad."),Object(o.b)("p",null,"Note that the ",Object(o.b)("inlineCode",{parentName:"p"},"check")," still inherits the ",Object(o.b)("inlineCode",{parentName:"p"},"service")," stanza's ",Object(o.b)("inlineCode",{parentName:"p"},"db")," port label,\nbut each will resolve the port label according to their address mode."),Object(o.b)("p",null,"If Consul has access to the Weave network the job could be configured like\nthis:"),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),"job ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"example"')," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"datacenters")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"dc1"'),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n  group ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"cache"')," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n\n    task ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"redis"')," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"driver")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"docker"'),"\n\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"config")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"image")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"redis:3.2"'),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"network_mode")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"weave"'),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token comment"}),"# No port map required!"),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"resources")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"cpu"),"    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"500")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token comment"}),"# 500 MHz"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"memory")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"256")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token comment"}),"# 256MB"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"network")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"mbits")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"10"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"service")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"name")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"weave-redis"'),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"port")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"6379"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"address_mode")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"driver"'),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"check")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"name"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"host-redis-check"'),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"type"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"tcp"'),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"interval")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"10s"'),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"timeout"),"  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"2s"'),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"port"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"6379"),"\n\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"address_mode")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"driver"'),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("p",null,"In this case Nomad doesn't need to assign Redis any host ports. The ",Object(o.b)("inlineCode",{parentName:"p"},"service"),"\nand ",Object(o.b)("inlineCode",{parentName:"p"},"check")," stanzas can both specify the port number to advertise and check\ndirectly since Nomad isn't managing any port assignments."),Object(o.b)("h3",{className:"g-type-display-4"},Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#ipv6-docker-containers","aria-label":"ipv6 docker containers permalink"}),"\xbb"),Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"ipv6-docker-containers","aria-hidden":""})),"IPv6 Docker containers"),Object(o.b)("p",null,"The ",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/drivers/docker#advertise_ipv6_address"}),"Docker")," driver supports the\n",Object(o.b)("inlineCode",{parentName:"p"},"advertise_ipv6_address")," parameter in its configuration."),Object(o.b)("p",null,"Services will automatically advertise the IPv6 address when ",Object(o.b)("inlineCode",{parentName:"p"},"advertise_ipv6_address"),"\nis used."),Object(o.b)("p",null,"Unlike services, checks do not have an ",Object(o.b)("inlineCode",{parentName:"p"},"auto")," address mode as there's no way\nfor Nomad to know which is the best address to use for checks. Consul needs\naccess to the address for any HTTP or TCP checks."),Object(o.b)("p",null,"So you have to set ",Object(o.b)("inlineCode",{parentName:"p"},"address_mode")," parameter in the ",Object(o.b)("inlineCode",{parentName:"p"},"check")," stanza to ",Object(o.b)("inlineCode",{parentName:"p"},"driver"),"."),Object(o.b)("p",null,"For example using ",Object(o.b)("inlineCode",{parentName:"p"},"auto")," address mode:"),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),"job ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"example"')," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"datacenters")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"dc1"'),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n  group ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"cache"')," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n\n    task ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"redis"')," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"driver")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"docker"'),"\n\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"config")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"image")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"redis:3.2"'),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"advertise_ipv6_address")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token boolean"}),"true"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"port_map")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"db")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"6379"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"resources")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"cpu"),"    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"500")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token comment"}),"# 500 MHz"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"memory")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"256")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token comment"}),"# 256MB"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"network")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"mbits")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"10"),"\n          port ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"db"')," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"service")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"name")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"ipv6-redis"'),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"port")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"db"'),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"check")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"name"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"ipv6-redis-check"'),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"type"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"tcp"'),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"interval")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"10s"'),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"timeout"),"  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"2s"'),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"port"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"db"'),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"address_mode")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"driver"'),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("p",null,"Or using ",Object(o.b)("inlineCode",{parentName:"p"},"address_mode=driver")," for ",Object(o.b)("inlineCode",{parentName:"p"},"service")," and ",Object(o.b)("inlineCode",{parentName:"p"},"check")," with numeric ports:"),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),"job ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"example"')," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"datacenters")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"dc1"'),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n  group ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"cache"')," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n\n    task ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"redis"')," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"driver")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"docker"'),"\n\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"config")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"image")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"redis:3.2"'),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"advertise_ipv6_address")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token boolean"}),"true"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token comment"}),"# No port map required!"),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"resources")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"cpu"),"    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"500")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token comment"}),"# 500 MHz"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"memory")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"256")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token comment"}),"# 256MB"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"network")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"mbits")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"10"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"service")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"name")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"ipv6-redis"'),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"port")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"6379"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"address_mode")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"driver"'),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"check")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"name"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"ipv6-redis-check"'),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"type"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"tcp"'),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"interval")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"10s"'),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"timeout"),"  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"2s"'),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"port"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"6379"),"\n          ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"address_mode")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"driver"'),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"service")," and ",Object(o.b)("inlineCode",{parentName:"p"},"check")," stanzas can both specify the port number to\nadvertise and check directly since Nomad isn't managing any port assignments."),Object(o.b)("hr",null),Object(o.b)("sup",null,Object(o.b)("small",null,"1")),Object(o.b)("small",null," ","Script checks are not supported for the [qemu driver][qemu] since the Nomad client does not have access to the file system of a task for that driver."))}j.isMDXComponent=!0}},[["F9yf",0,1,2,4,3,5,6]]]);