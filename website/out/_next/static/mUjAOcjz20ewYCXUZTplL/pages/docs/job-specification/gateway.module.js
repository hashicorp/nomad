(window.webpackJsonp=window.webpackJsonp||[]).push([[233],{TNHy:function(e,a,t){"use strict";t.r(a),t.d(a,"default",(function(){return d}));var n,c=t("wx14"),s=t("Ff2n"),r=t("q1tI"),i=t.n(r),b=t("7ljp"),o=t("j1un"),l=(i.a.createElement,n="Placement",function(e){return console.warn("Component "+n+" was not imported, exported, or provided by MDXProvider as global scope"),Object(b.b)("div",e)}),p={},m=Object(o.a)({layout:"docs",page_title:"gateway Stanza - Job Specification",sidebar_title:"gateway",description:'The "gateway" stanza allows specifying options for configuring Consul Gateways\nused in the Consul Connect integration',__resourcePath:"docs/job-specification/gateway.mdx",__scans:{}});function d(e){var{components:a}=e,t=Object(s.a)(e,["components"]);return Object(b.b)(m,Object(c.a)({},p,t,{components:a,mdxType:"MDXLayout"}),Object(b.b)("h1",{className:"g-type-display-2"},Object(b.b)("a",Object(c.a)({parentName:"h1"},{className:"__permalink-h",href:"#gateway-stanza","aria-label":"gateway stanza permalink"}),"\xbb"),Object(b.b)("a",Object(c.a)({parentName:"h1"},{className:"__target-h",id:"gateway-stanza","aria-hidden":""})),Object(b.b)("inlineCode",{parentName:"h1"},"gateway")," Stanza"),Object(b.b)(l,{groups:["job","group","service","connect","gateway"],mdxType:"Placement"}),Object(b.b)("p",null,"The ",Object(b.b)("inlineCode",{parentName:"p"},"gateway")," stanza allows configuration of ",Object(b.b)("a",Object(c.a)({parentName:"p"},{href:"https://www.consul.io/docs/connect/gateways"}),"Consul Connect Gateways"),". Nomad will\nautomatically create the necessary Gateway ",Object(b.b)("a",Object(c.a)({parentName:"p"},{href:"https://www.consul.io/docs/agent/config-entries"}),"Configuration Entry"),"\nas well as inject an Envoy proxy task into the Nomad job to serve as the Gateway."),Object(b.b)("p",null,"The ",Object(b.b)("inlineCode",{parentName:"p"},"gateway")," configuration is valid within the context of a ",Object(b.b)("inlineCode",{parentName:"p"},"connect")," stanza.\nAdditional information about Gateway configurations can be found in Consul's\n",Object(b.b)("a",Object(c.a)({parentName:"p"},{href:"https://www.consul.io/docs/connect/gateways"}),"Connect Gateways")," documentation."),Object(b.b)("div",{className:"alert alert-warning g-type-body",role:"alert"},Object(b.b)("p",{parentName:"div"},"",Object(b.b)("strong",{parentName:"p"},"Note:")," ",Object(b.b)("a",Object(c.a)({parentName:"p"},{href:"https://www.consul.io/docs/connect/gateways/ingress-gateway"}),"Ingress Gateways"),"\nare generally intended for enabling access into a Consul service mesh from within the\nsame network. For public ingress products like ",Object(b.b)("a",Object(c.a)({parentName:"p"},{href:"https://learn.hashicorp.com/tutorials/nomad/load-balancing-nginx?in=nomad/load-balancing"}),"NGINX"),"\nprovide more suitable features.")),Object(b.b)("pre",{className:"language-hcl"},Object(b.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),"job ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"ingress-example"')," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n\n  ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"datacenters")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"dc1"'),Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n\n  group ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"ingress-group"')," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"network")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"mode")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"bridge"'),"\n\n      port ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"inbound"')," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"static")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"8080"),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"service")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"name")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"ingress-service"'),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"port")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"8080"'),"\n\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"connect")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"gateway")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n          ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"proxy")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n            ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token comment"}),"// Consul Gateway Proxy configuration options"),"\n            ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"connect_timeout")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"500ms"'),"\n          ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n          ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"ingress")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n            ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token comment"}),"// Consul Ingress Gateway Configuration Entry"),"\n\n            ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"tls")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n              ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"enabled")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token boolean"}),"false"),"\n            ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n            ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"listener")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n              ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"port"),"     ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"8080"),"\n              ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"protocol")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"http"'),"\n              ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"service")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n                ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"name"),"  ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"web"'),"\n                ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"hosts")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"example.com"'),", ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"example.com:8080"'),Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n              ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n            ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n            ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"listener")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n              ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"port")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"3306"),"\n              ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"protocol")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"tcp"'),"\n              ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"service")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n                ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"name")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"database"'),"\n              ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n            ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n          ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(b.b)("h2",{className:"g-type-display-3"},Object(b.b)("a",Object(c.a)({parentName:"h2"},{className:"__permalink-h",href:"#gateway-parameters","aria-label":"gateway parameters permalink"}),"\xbb"),Object(b.b)("a",Object(c.a)({parentName:"h2"},{className:"__target-h",id:"gateway-parameters","aria-hidden":""})),Object(b.b)("inlineCode",{parentName:"h2"},"gateway")," Parameters"),Object(b.b)("ul",null,Object(b.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(b.b)("a",Object(c.a)({parentName:"li"},{id:"proxy",className:"__target-lic","aria-hidden":""})),Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"#proxy","aria-label":"proxy permalink",className:"__permalink-lic"}),Object(b.b)("inlineCode",{parentName:"a"},"proxy"))," ",Object(b.b)("code",null,"(",Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"/docs/job-specification/gateway#proxy-parameters"}),"proxy"),": nil)")," - Configuration of the Envoy proxy that will\nbe injected into the task group."),Object(b.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(b.b)("a",Object(c.a)({parentName:"li"},{id:"ingress",className:"__target-lic","aria-hidden":""})),Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"#ingress","aria-label":"ingress permalink",className:"__permalink-lic"}),Object(b.b)("inlineCode",{parentName:"a"},"ingress"))," ",Object(b.b)("code",null,"(",Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"/docs/job-specification/gateway#ingress-parameters"}),"ingress"),": nil)")," - Configuration Entry of type ",Object(b.b)("inlineCode",{parentName:"li"},"ingress-gateway"),"\nthat will be associated with the service.")),Object(b.b)("h3",{className:"g-type-display-4"},Object(b.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#proxy-parameters","aria-label":"proxy parameters permalink"}),"\xbb"),Object(b.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"proxy-parameters","aria-hidden":""})),Object(b.b)("inlineCode",{parentName:"h3"},"proxy")," Parameters"),Object(b.b)("ul",null,Object(b.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(b.b)("a",Object(c.a)({parentName:"li"},{id:"connect_timeout",className:"__target-lic","aria-hidden":""})),Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"#connect_timeout","aria-label":"connect_timeout permalink",className:"__permalink-lic"}),Object(b.b)("inlineCode",{parentName:"a"},"connect_timeout"))," ",Object(b.b)("inlineCode",{parentName:"li"},'(string: "5s")')," - The amount of time to allow when making upstream\nconnections before timing out. Defaults to 5 seconds. If the upstream service has\nthe configuration option ",Object(b.b)("code",null,Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"https://www.consul.io/docs/agent/config-entries/service-resolver#connecttimeout"}),"connect_timeout_ms"))," set for the ",Object(b.b)("inlineCode",{parentName:"li"},"service-resolver"),", that\ntimeout value will take precedence over this gateway proxy option."),Object(b.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(b.b)("a",Object(c.a)({parentName:"li"},{id:"envoy_gateway_bind_tagged_addresses",className:"__target-lic","aria-hidden":""})),Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"#envoy_gateway_bind_tagged_addresses","aria-label":"envoy_gateway_bind_tagged_addresses permalink",className:"__permalink-lic"}),Object(b.b)("inlineCode",{parentName:"a"},"envoy_gateway_bind_tagged_addresses"))," ",Object(b.b)("inlineCode",{parentName:"li"},"(bool: false)")," - Indicates that the gateway\nservices tagged addresses should be bound to listeners in addition to the default\nlistener address."),Object(b.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(b.b)("a",Object(c.a)({parentName:"li"},{id:"envoy_gateway_bind_addresses",className:"__target-lic","aria-hidden":""})),Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"#envoy_gateway_bind_addresses","aria-label":"envoy_gateway_bind_addresses permalink",className:"__permalink-lic"}),Object(b.b)("inlineCode",{parentName:"a"},"envoy_gateway_bind_addresses"))," ",Object(b.b)("code",null,"(map<string|",Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"/docs/job-specification/gateway#address-parameters"}),"address"),">: nil)")," - A map of additional addresses to be bound.\nThe keys to this map are the same of the listeners to be created and the values are\na map with two keys - address and port, that combined make the address to bind the\nlistener to. These are bound in addition to the default address.\nIf ",Object(b.b)("inlineCode",{parentName:"li"},"bridge")," networking is in use, this map is automatically populated with additional\nlisteners enabling the Envoy proxy to work from inside the network namespace.")),Object(b.b)("pre",null,Object(b.b)("code",Object(c.a)({parentName:"pre"},{}),'envoy_gateway_bind_addresses "<service>" {\n  address = "0.0.0.0"\n  port    = <port>\n}\n')),Object(b.b)("ul",null,Object(b.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(b.b)("a",Object(c.a)({parentName:"li"},{id:"envoy_gateway_no_default_bind",className:"__target-lic","aria-hidden":""})),Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"#envoy_gateway_no_default_bind","aria-label":"envoy_gateway_no_default_bind permalink",className:"__permalink-lic"}),Object(b.b)("inlineCode",{parentName:"a"},"envoy_gateway_no_default_bind"))," ",Object(b.b)("inlineCode",{parentName:"li"},"(bool: false)")," - Prevents binding to the default\naddress of the gateway service. This should be used with one of the other options\nto configure the gateway's bind addresses. If ",Object(b.b)("inlineCode",{parentName:"li"},"bridge")," networking is in use, this\nvalue will default to ",Object(b.b)("inlineCode",{parentName:"li"},"true")," since the Envoy proxy does not need to bind to the\nservice address from inside the network namespace."),Object(b.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(b.b)("a",Object(c.a)({parentName:"li"},{id:"config",className:"__target-lic","aria-hidden":""})),Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"#config","aria-label":"config permalink",className:"__permalink-lic"}),Object(b.b)("inlineCode",{parentName:"a"},"config"))," ",Object(b.b)("inlineCode",{parentName:"li"},"(map: nil)")," - Escape hatch for ",Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"https://www.consul.io/docs/connect/proxies/envoy#advanced-configuration"}),"Advanced Configuration")," of Envoy.")),Object(b.b)("h4",{className:"g-type-display-5"},Object(b.b)("a",Object(c.a)({parentName:"h4"},{className:"__permalink-h",href:"#address-parameters","aria-label":"address parameters permalink"}),"\xbb"),Object(b.b)("a",Object(c.a)({parentName:"h4"},{className:"__target-h",id:"address-parameters","aria-hidden":""})),Object(b.b)("inlineCode",{parentName:"h4"},"address")," Parameters"),Object(b.b)("ul",null,Object(b.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(b.b)("a",Object(c.a)({parentName:"li"},{id:"address",className:"__target-lic","aria-hidden":""})),Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"#address","aria-label":"address permalink",className:"__permalink-lic"}),Object(b.b)("inlineCode",{parentName:"a"},"address"))," ",Object(b.b)("inlineCode",{parentName:"li"},"(string: required)")," - The address to bind to when combined with ",Object(b.b)("inlineCode",{parentName:"li"},"port"),"."),Object(b.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(b.b)("a",Object(c.a)({parentName:"li"},{id:"port",className:"__target-lic","aria-hidden":""})),Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"#port","aria-label":"port permalink",className:"__permalink-lic"}),Object(b.b)("inlineCode",{parentName:"a"},"port"))," ",Object(b.b)("inlineCode",{parentName:"li"},"(int: required)")," - The port to listen to.")),Object(b.b)("h3",{className:"g-type-display-4"},Object(b.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#ingress-parameters","aria-label":"ingress parameters permalink"}),"\xbb"),Object(b.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"ingress-parameters","aria-hidden":""})),Object(b.b)("inlineCode",{parentName:"h3"},"ingress")," Parameters"),Object(b.b)("ul",null,Object(b.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(b.b)("a",Object(c.a)({parentName:"li"},{id:"tls",className:"__target-lic","aria-hidden":""})),Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"#tls","aria-label":"tls permalink",className:"__permalink-lic"}),Object(b.b)("inlineCode",{parentName:"a"},"tls"))," ",Object(b.b)("code",null,"(",Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"/docs/job-specification/gateway#tlsconfig-parameters"}),"tls"),": nil)")," - TLS configuration for this gateway."),Object(b.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(b.b)("a",Object(c.a)({parentName:"li"},{id:"listener",className:"__target-lic","aria-hidden":""})),Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"#listener","aria-label":"listener permalink",className:"__permalink-lic"}),Object(b.b)("inlineCode",{parentName:"a"},"listener"))," ",Object(b.b)("code",null,"(array<",Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"/docs/job-specification/gateway#listener-parameters"}),"listener"),"> : required)")," - One or more listeners that the\ningress gateway should setup, uniquely identified by their port number.")),Object(b.b)("h4",{className:"g-type-display-5"},Object(b.b)("a",Object(c.a)({parentName:"h4"},{className:"__permalink-h",href:"#tls-parameters","aria-label":"tls parameters permalink"}),"\xbb"),Object(b.b)("a",Object(c.a)({parentName:"h4"},{className:"__target-h",id:"tls-parameters","aria-hidden":""})),Object(b.b)("inlineCode",{parentName:"h4"},"tls")," Parameters"),Object(b.b)("ul",null,Object(b.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(b.b)("a",Object(c.a)({parentName:"li"},{id:"enabled",className:"__target-lic","aria-hidden":""})),Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"#enabled","aria-label":"enabled permalink",className:"__permalink-lic"}),Object(b.b)("inlineCode",{parentName:"a"},"enabled"))," ",Object(b.b)("inlineCode",{parentName:"li"},"(bool: false)")," - Set this configuration to enable TLS for every listener\non the gateway. If TLS is enabled, then each host defined in the ",Object(b.b)("inlineCode",{parentName:"li"},"host")," field will\nbe added as a DNSSAN to the gateway's x509 certificate.")),Object(b.b)("h4",{className:"g-type-display-5"},Object(b.b)("a",Object(c.a)({parentName:"h4"},{className:"__permalink-h",href:"#listener-parameters","aria-label":"listener parameters permalink"}),"\xbb"),Object(b.b)("a",Object(c.a)({parentName:"h4"},{className:"__target-h",id:"listener-parameters","aria-hidden":""})),Object(b.b)("inlineCode",{parentName:"h4"},"listener")," Parameters"),Object(b.b)("ul",null,Object(b.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(b.b)("a",Object(c.a)({parentName:"li"},{id:"port-1",className:"__target-lic","aria-hidden":""})),Object(b.b)("p",{parentName:"li"},Object(b.b)("a",Object(c.a)({parentName:"p"},{href:"#port-1","aria-label":"port permalink",className:"__permalink-lic"}),Object(b.b)("inlineCode",{parentName:"a"},"port"))," ",Object(b.b)("inlineCode",{parentName:"p"},"(int: required)")," - The port that the listener should receive traffic on.")),Object(b.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(b.b)("a",Object(c.a)({parentName:"li"},{id:"protocol",className:"__target-lic","aria-hidden":""})),Object(b.b)("p",{parentName:"li"},Object(b.b)("a",Object(c.a)({parentName:"p"},{href:"#protocol","aria-label":"protocol permalink",className:"__permalink-lic"}),Object(b.b)("inlineCode",{parentName:"a"},"protocol"))," ",Object(b.b)("inlineCode",{parentName:"p"},'(string: "tcp")')," - The protocol associated with the listener. Either\n",Object(b.b)("inlineCode",{parentName:"p"},"tcp")," or ",Object(b.b)("inlineCode",{parentName:"p"},"http"),"."),Object(b.b)("div",Object(c.a)({parentName:"li"},{className:"alert alert-warning g-type-body",role:"alert"}),Object(b.b)("p",{parentName:"div"},"",Object(b.b)("strong",{parentName:"p"},"Note:")," If using ",Object(b.b)("inlineCode",{parentName:"p"},"http"),", preconfiguring a ",Object(b.b)("a",Object(c.a)({parentName:"p"},{href:"https://www.consul.io/docs/agent/config-entries/service-defaults"}),"service-default")," in Consul to\nset the ",Object(b.b)("a",Object(c.a)({parentName:"p"},{href:"https://www.consul.io/docs/agent/config-entries/service-defaults#protocol"}),"Protocol"),"\nof the service to ",Object(b.b)("inlineCode",{parentName:"p"},"http")," is recommended."))),Object(b.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(b.b)("a",Object(c.a)({parentName:"li"},{id:"service",className:"__target-lic","aria-hidden":""})),Object(b.b)("p",{parentName:"li"},Object(b.b)("a",Object(c.a)({parentName:"p"},{href:"#service","aria-label":"service permalink",className:"__permalink-lic"}),Object(b.b)("inlineCode",{parentName:"a"},"service"))," ",Object(b.b)("code",null,"(array<",Object(b.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/job-specification/gateway#service-parameters"}),"service"),">: required)")," - One or more services to be\nexposed via this listener. For ",Object(b.b)("inlineCode",{parentName:"p"},"tcp")," listeners, only a single service is allowed."))),Object(b.b)("h4",{className:"g-type-display-5"},Object(b.b)("a",Object(c.a)({parentName:"h4"},{className:"__permalink-h",href:"#service-parameters","aria-label":"service parameters permalink"}),"\xbb"),Object(b.b)("a",Object(c.a)({parentName:"h4"},{className:"__target-h",id:"service-parameters","aria-hidden":""})),Object(b.b)("inlineCode",{parentName:"h4"},"service")," Parameters"),Object(b.b)("ul",null,Object(b.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(b.b)("a",Object(c.a)({parentName:"li"},{id:"name",className:"__target-lic","aria-hidden":""})),Object(b.b)("p",{parentName:"li"},Object(b.b)("a",Object(c.a)({parentName:"p"},{href:"#name","aria-label":"name permalink",className:"__permalink-lic"}),Object(b.b)("inlineCode",{parentName:"a"},"name"))," ",Object(b.b)("inlineCode",{parentName:"p"},"(string: required)")," - The name of the service that should be exposed through\nthis listener. This can be either a service registered in the catalog, or a\nservice defined by other config entries, or a service that is going to be configured\nby Nomad. If the wildcard specifier ",Object(b.b)("inlineCode",{parentName:"p"},"*")," is provided, then ALL services will be\nexposed through this listener. This is not supported for a listener with protocol ",Object(b.b)("inlineCode",{parentName:"p"},"tcp"),".")),Object(b.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(b.b)("a",Object(c.a)({parentName:"li"},{id:"hosts",className:"__target-lic","aria-hidden":""})),Object(b.b)("p",{parentName:"li"},Object(b.b)("a",Object(c.a)({parentName:"p"},{href:"#hosts","aria-label":"hosts permalink",className:"__permalink-lic"}),Object(b.b)("inlineCode",{parentName:"a"},"hosts"))," ",Object(b.b)("inlineCode",{parentName:"p"},"(array<string>: nil)")," - A list of hosts that specify what requests will\nmatch this service. This cannot be used with a ",Object(b.b)("inlineCode",{parentName:"p"},"tcp")," listener, and cannot be\nspecified alongside a wildcard (",Object(b.b)("inlineCode",{parentName:"p"},"*"),") service name. If not specified, the default\ndomain ",Object(b.b)("inlineCode",{parentName:"p"},"<service-name>.ingress.*")," will be used to match services. Requests ",Object(b.b)("em",{parentName:"p"},"must"),"\nsend the correct host to be routed to the defined service."),Object(b.b)("p",{parentName:"li"},"The wildcard specifier ",Object(b.b)("inlineCode",{parentName:"p"},"*")," can be used by itself to match all traffic coming to\nthe ingress gateway, if TLS is not enabled. This allows a user to route all traffic\nto a single service without specifying a host, allowing simpler tests and demos.\nOtherwise, the wildcard specifier can be used as part of the host to match\nmultiple hosts, but only in the leftmost DNS label. This ensures that all defined\nhosts are valid DNS records. For example, ",Object(b.b)("inlineCode",{parentName:"p"},"*.example.com")," is valid while ",Object(b.b)("inlineCode",{parentName:"p"},"example.*"),"\nand ",Object(b.b)("inlineCode",{parentName:"p"},"*-suffix.example.com")," are not."),Object(b.b)("div",Object(c.a)({parentName:"li"},{className:"alert alert-warning g-type-body",role:"alert"}),Object(b.b)("p",{parentName:"div"},"",Object(b.b)("strong",{parentName:"p"},"Note:")," If a well-known port is not used, i.e. a port other than 80 (http) or 443 (https),\nthen the port must be appended to the host to correctly match traffic. This is\ndefined in the ",Object(b.b)("a",Object(c.a)({parentName:"p"},{href:"https://tools.ietf.org/html/rfc2616#section-14.23"}),"HTTP/1.1 RFC"),".\nIf TLS is enabled, then the host ",Object(b.b)("strong",{parentName:"p"},"without")," the port must be added to the ",Object(b.b)("inlineCode",{parentName:"p"},"hosts"),"\nfield as well. TLS verification only matches against the hostname of the incoming\nconnection, and does not take into account the port.")))),Object(b.b)("h3",{className:"g-type-display-4"},Object(b.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#gateway-with-host-networking","aria-label":"gateway with host networking permalink"}),"\xbb"),Object(b.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"gateway-with-host-networking","aria-hidden":""})),"Gateway with host networking"),Object(b.b)("p",null,"Nomad supports running gateways using host networking. A static port must be allocated\nfor use by the ",Object(b.b)("a",Object(c.a)({parentName:"p"},{href:"https://www.envoyproxy.io/docs/envoy/latest/operations/admin"}),"Envoy admin interface"),"\nand assigned to the proxy service definition."),Object(b.b)("div",{className:"alert alert-danger g-type-body",role:"alert"},Object(b.b)("p",{parentName:"div"},"",Object(b.b)("strong",{parentName:"p"},"Warning:")," There is no way to disable the Envoy admin interface, which will be\naccessible to any workload running on the same Nomad client. The admin interface exposes\ninformation about the proxy, including a Consul Service Identity token if Consul ACLs\nare enabled.")))}d.isMDXComponent=!0},dbhM:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/job-specification/gateway",function(){return t("TNHy")}])}},[["dbhM",0,1,2,4,3,5,6]]]);