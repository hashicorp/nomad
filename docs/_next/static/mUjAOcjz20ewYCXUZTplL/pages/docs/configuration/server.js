(window.webpackJsonp=window.webpackJsonp||[]).push([[170],{oKM8:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/configuration/server",function(){return t("pRWi")}])},pRWi:function(e,a,t){"use strict";t.r(a),t.d(a,"default",(function(){return d}));var n,r=t("wx14"),i=t("Ff2n"),c=t("q1tI"),s=t.n(c),o=t("7ljp"),l=t("j1un"),b=(s.a.createElement,n="Placement",function(e){return console.warn("Component "+n+" was not imported, exported, or provided by MDXProvider as global scope"),Object(o.b)("div",e)}),p={},m=Object(l.a)({layout:"docs",page_title:"server Stanza - Agent Configuration",sidebar_title:"server",description:'The "server" stanza configures the Nomad agent to operate in server mode to\nparticipate in scheduling decisions, register with service discovery, handle\njoin failures, and more.',__resourcePath:"docs/configuration/server.mdx",__scans:{}});function d(e){var a=e.components,t=Object(i.a)(e,["components"]);return Object(o.b)(m,Object(r.a)({},p,t,{components:a,mdxType:"MDXLayout"}),Object(o.b)("h1",{className:"g-type-display-2"},Object(o.b)("a",Object(r.a)({parentName:"h1"},{className:"__permalink-h",href:"#server-stanza","aria-label":"server stanza permalink"}),"\xbb"),Object(o.b)("a",Object(r.a)({parentName:"h1"},{className:"__target-h",id:"server-stanza","aria-hidden":""})),Object(o.b)("inlineCode",{parentName:"h1"},"server")," Stanza"),Object(o.b)(b,{groups:["server"],mdxType:"Placement"}),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"server")," stanza configures the Nomad agent to operate in server mode to\nparticipate in scheduling decisions, register with service discovery, handle\njoin failures, and more."),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-hcl"}),Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token keyword"}),"server")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token property"}),"enabled"),"          ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token boolean"}),"true"),"\n  ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token property"}),"bootstrap_expect")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token number"}),"3"),"\n  ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token keyword"}),"server_join")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token property"}),"retry_join")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"[")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token string"}),'"1.1.1.1"'),", ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token string"}),'"2.2.2.2"')," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n    ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token property"}),"retry_max")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token number"}),"3"),"\n    ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token property"}),"retry_interval")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token string"}),'"15s"'),"\n  ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("h2",{className:"g-type-display-3"},Object(o.b)("a",Object(r.a)({parentName:"h2"},{className:"__permalink-h",href:"#server-parameters","aria-label":"server parameters permalink"}),"\xbb"),Object(o.b)("a",Object(r.a)({parentName:"h2"},{className:"__target-h",id:"server-parameters","aria-hidden":""})),Object(o.b)("inlineCode",{parentName:"h2"},"server")," Parameters"),Object(o.b)("ul",null,Object(o.b)("li",Object(r.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(r.a)({parentName:"li"},{id:"authoritative_region",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#authoritative_region","aria-label":"authoritative_region permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"authoritative_region"))," ",Object(o.b)("inlineCode",{parentName:"p"},'(string: "")')," - Specifies the authoritative region, which\nprovides a single source of truth for global configurations such as ACL Policies and\nglobal ACL tokens. Non-authoritative regions will replicate from the authoritative\nto act as a mirror. By default, the local region is assumed to be authoritative.")),Object(o.b)("li",Object(r.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(r.a)({parentName:"li"},{id:"bootstrap_expect",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#bootstrap_expect","aria-label":"bootstrap_expect permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"bootstrap_expect"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(int: required)")," - Specifies the number of server nodes to\nwait for before bootstrapping. It is most common to use the odd-numbered\nintegers ",Object(o.b)("inlineCode",{parentName:"p"},"3")," or ",Object(o.b)("inlineCode",{parentName:"p"},"5")," for this value, depending on the cluster size. A value of\n",Object(o.b)("inlineCode",{parentName:"p"},"1")," does not provide any fault tolerance and is not recommended for production\nuse cases.")),Object(o.b)("li",Object(r.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(r.a)({parentName:"li"},{id:"data_dir",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#data_dir","aria-label":"data_dir permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"data_dir"))," ",Object(o.b)("inlineCode",{parentName:"p"},'(string: "[data_dir]/server")')," - Specifies the directory to use -\nfor server-specific data, including the replicated log. By default, this is -\nthe top-level ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/configuration#data_dir"}),"data_dir"),'\nsuffixed with "server", like ',Object(o.b)("inlineCode",{parentName:"p"},'"/opt/nomad/server"'),". This must be an absolute\npath.")),Object(o.b)("li",Object(r.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(r.a)({parentName:"li"},{id:"enabled",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#enabled","aria-label":"enabled permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"enabled"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(bool: false)")," - Specifies if this agent should run in server mode.\nAll other server options depend on this value being set.")),Object(o.b)("li",Object(r.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(r.a)({parentName:"li"},{id:"enabled_schedulers",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#enabled_schedulers","aria-label":"enabled_schedulers permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"enabled_schedulers"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(array<string>: [all])")," - Specifies which sub-schedulers\nthis server will handle. This can be used to restrict the evaluations that\nworker threads will dequeue for processing.")),Object(o.b)("li",Object(r.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(r.a)({parentName:"li"},{id:"encrypt",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#encrypt","aria-label":"encrypt permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"encrypt"))," ",Object(o.b)("inlineCode",{parentName:"p"},'(string: "")')," - Specifies the secret key to use for encryption of\nNomad server's gossip network traffic. This key must be 16 bytes that are\nbase64-encoded. The provided key is automatically persisted to the data\ndirectory and loaded automatically whenever the agent is restarted. This means\nthat to encrypt Nomad server's gossip protocol, this option only needs to be\nprovided once on each agent's initial startup sequence. If it is provided\nafter Nomad has been initialized with an encryption key, then the provided key\nis ignored and a warning will be displayed. See the\n",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://learn.hashicorp.com/nomad/transport-security/gossip-encryption",title:"Nomad Encryption Overview"}),"encryption documentation")," for more details on this option\nand its impact on the cluster.")),Object(o.b)("li",Object(r.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(r.a)({parentName:"li"},{id:"node_gc_threshold",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#node_gc_threshold","aria-label":"node_gc_threshold permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"node_gc_threshold"))," ",Object(o.b)("inlineCode",{parentName:"p"},'(string: "24h")'),' - Specifies how long a node must be in a\nterminal state before it is garbage collected and purged from the system. This\nis specified using a label suffix like "30s" or "1h".')),Object(o.b)("li",Object(r.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(r.a)({parentName:"li"},{id:"job_gc_interval",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#job_gc_interval","aria-label":"job_gc_interval permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"job_gc_interval"))," ",Object(o.b)("inlineCode",{parentName:"p"},'(string: "5m")')," - Specifies the interval between the job\ngarbage collections. Only jobs who have been terminal for at least\n",Object(o.b)("inlineCode",{parentName:"p"},"job_gc_threshold"),' will be collected. Lowering the interval will perform more\nfrequent but smaller collections. Raising the interval will perform collections\nless frequently but collect more jobs at a time. Reducing this interval is\nuseful if there is a large throughput of tasks, leading to a large set of\ndead jobs. This is specified using a label suffix like "30s" or "3m". ',Object(o.b)("inlineCode",{parentName:"p"},"job_gc_interval"),"\nwas introduced in Nomad 0.10.0.")),Object(o.b)("li",Object(r.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(r.a)({parentName:"li"},{id:"job_gc_threshold",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#job_gc_threshold","aria-label":"job_gc_threshold permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"job_gc_threshold"))," ",Object(o.b)("inlineCode",{parentName:"p"},'(string: "4h")'),' - Specifies the minimum time a job must be\nin the terminal state before it is eligible for garbage collection. This is\nspecified using a label suffix like "30s" or "1h".')),Object(o.b)("li",Object(r.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(r.a)({parentName:"li"},{id:"eval_gc_threshold",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#eval_gc_threshold","aria-label":"eval_gc_threshold permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"eval_gc_threshold"))," ",Object(o.b)("inlineCode",{parentName:"p"},'(string: "1h")'),' - Specifies the minimum time an\nevaluation must be in the terminal state before it is eligible for garbage\ncollection. This is specified using a label suffix like "30s" or "1h".')),Object(o.b)("li",Object(r.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(r.a)({parentName:"li"},{id:"deployment_gc_threshold",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#deployment_gc_threshold","aria-label":"deployment_gc_threshold permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"deployment_gc_threshold"))," ",Object(o.b)("inlineCode",{parentName:"p"},'(string: "1h")'),' - Specifies the minimum time a\ndeployment must be in the terminal state before it is eligible for garbage\ncollection. This is specified using a label suffix like "30s" or "1h".')),Object(o.b)("li",Object(r.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(r.a)({parentName:"li"},{id:"csi_volume_claim_gc_threshold",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#csi_volume_claim_gc_threshold","aria-label":"csi_volume_claim_gc_threshold permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"csi_volume_claim_gc_threshold"))," ",Object(o.b)("inlineCode",{parentName:"p"},'(string: "1h")'),' - Specifies the minimum age of\na CSI volume before it is eligible to have its claims garbage collected.\nThis is specified using a label suffix like "30s" or "1h".')),Object(o.b)("li",Object(r.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(r.a)({parentName:"li"},{id:"csi_plugin_gc_threshold",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#csi_plugin_gc_threshold","aria-label":"csi_plugin_gc_threshold permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"csi_plugin_gc_threshold"))," ",Object(o.b)("inlineCode",{parentName:"p"},'(string: "1h")'),' - Specifies the minimum age of a\nCSI plugin before it is eligible for garbage collection if not in use.\nThis is specified using a label suffix like "30s" or "1h".')),Object(o.b)("li",Object(r.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(r.a)({parentName:"li"},{id:"default_scheduler_config",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#default_scheduler_config","aria-label":"default_scheduler_config permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"default_scheduler_config"))," ",Object(o.b)("code",null,"(",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/api-docs/operator#update-scheduler-configuration",title:"Scheduler Config"}),"scheduler_configuration"),":\nnil)")," - Specifies the initial default scheduler config when\nbootstrapping cluster. The parameter is ignored once the cluster is bootstrapped or\nvalue is updated through the ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/api-docs/operator#update-scheduler-configuration",title:"Scheduler Config"}),"API endpoint"),". See ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#configuring-scheduler-config"}),"the\nexample section")," for more details\n",Object(o.b)("inlineCode",{parentName:"p"},"default_scheduler_config")," was introduced in Nomad 0.10.4.")),Object(o.b)("li",Object(r.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(r.a)({parentName:"li"},{id:"heartbeat_grace",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#heartbeat_grace","aria-label":"heartbeat_grace permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"heartbeat_grace"))," ",Object(o.b)("inlineCode",{parentName:"p"},'(string: "10s")'),' - Specifies the additional time given as a\ngrace period beyond the heartbeat TTL of nodes to account for network and\nprocessing delays as well as clock skew. This is specified using a label\nsuffix like "30s" or "1h".')),Object(o.b)("li",Object(r.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(r.a)({parentName:"li"},{id:"min_heartbeat_ttl",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#min_heartbeat_ttl","aria-label":"min_heartbeat_ttl permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"min_heartbeat_ttl"))," ",Object(o.b)("inlineCode",{parentName:"p"},'(string: "10s")'),' - Specifies the minimum time between\nnode heartbeats. This is used as a floor to prevent excessive updates. This is\nspecified using a label suffix like "30s" or "1h". Lowering the minimum TTL is\na tradeoff as it lowers failure detection time of nodes at the tradeoff of\nfalse positives and increased load on the leader.')),Object(o.b)("li",Object(r.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(r.a)({parentName:"li"},{id:"max_heartbeats_per_second",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#max_heartbeats_per_second","aria-label":"max_heartbeats_per_second permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"max_heartbeats_per_second"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(float: 50.0)")," - Specifies the maximum target\nrate of heartbeats being processed per second. This allows the TTL to be\nincreased to meet the target rate. Increasing the maximum heartbeats per\nsecond is a tradeoff as it lowers failure detection time of nodes at the\ntradeoff of false positives and increased load on the leader.")),Object(o.b)("li",Object(r.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(r.a)({parentName:"li"},{id:"non_voting_server",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#non_voting_server","aria-label":"non_voting_server permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"non_voting_server"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(bool: false)")," - (Enterprise-only) Specifies whether\nthis server will act as a non-voting member of the cluster to help provide\nread scalability.")),Object(o.b)("li",Object(r.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(r.a)({parentName:"li"},{id:"num_schedulers",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#num_schedulers","aria-label":"num_schedulers permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"num_schedulers"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(int: [num-cores])")," - Specifies the number of parallel\nscheduler threads to run. This can be as many as one per core, or ",Object(o.b)("inlineCode",{parentName:"p"},"0")," to\ndisallow this server from making any scheduling decisions. This defaults to\nthe number of CPU cores.")),Object(o.b)("li",Object(r.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(r.a)({parentName:"li"},{id:"protocol_version",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#protocol_version","aria-label":"protocol_version permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"protocol_version"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(int: 1)")," - Specifies the Nomad protocol version to use\nwhen communicating with other Nomad servers. This value is typically not\nrequired as the agent internally knows the latest version, but may be useful\nin some upgrade scenarios.")),Object(o.b)("li",Object(r.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(r.a)({parentName:"li"},{id:"raft_protocol",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#raft_protocol","aria-label":"raft_protocol permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"raft_protocol"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(int: 2)")," - Specifies the Raft protocol version to use when\ncommunicating with other Nomad servers. This affects available Autopilot\nfeatures and is typically not required as the agent internally knows the\nlatest version, but may be useful in some upgrade scenarios.")),Object(o.b)("li",Object(r.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(r.a)({parentName:"li"},{id:"raft_multiplier",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#raft_multiplier","aria-label":"raft_multiplier permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"raft_multiplier"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(int: 1)")," - An integer multiplier used by Nomad servers to\nscale key Raft timing parameters. Omitting this value or setting it to 0 uses\ndefault timing described below. Lower values are used to tighten timing and\nincrease sensitivity while higher values relax timings and reduce sensitivity.\nTuning this affects the time it takes Nomad to detect leader failures and to\nperform leader elections, at the expense of requiring more network and CPU\nresources for better performance. The maximum allowed value is 10."),Object(o.b)("p",{parentName:"li"},"By default, Nomad will use the highest-performance timing, currently equivalent\nto setting this to a value of 1. Increasing the timings makes leader election\nless likely during periods of networking issues or resource starvation. Since\nleader elections pause Nomad's normal work, it may be beneficial for slow or\nunreliable networks to wait longer before electing a new leader. The tradeoff\nwhen raising this value is that during network partitions or other events\n(server crash) where a leader is lost, Nomad will not elect a new leader for\na longer period of time than the default. The ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/telemetry/metrics"}),Object(o.b)("inlineCode",{parentName:"a"},"nomad.nomad.leader.barrier")," and\n",Object(o.b)("inlineCode",{parentName:"a"},"nomad.raft.leader.lastContact")," metrics")," are a good\nindicator of how often leader elections occur and raft latency.")),Object(o.b)("li",Object(r.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(r.a)({parentName:"li"},{id:"redundancy_zone",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#redundancy_zone","aria-label":"redundancy_zone permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"redundancy_zone"))," ",Object(o.b)("inlineCode",{parentName:"p"},'(string: "")')," - (Enterprise-only) Specifies the redundancy\nzone that this server will be a part of for Autopilot management. For more\ninformation, see the ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://learn.hashicorp.com/nomad/operating-nomad/autopilot"}),"Autopilot Guide"),".")),Object(o.b)("li",Object(r.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(r.a)({parentName:"li"},{id:"rejoin_after_leave",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#rejoin_after_leave","aria-label":"rejoin_after_leave permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"rejoin_after_leave"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(bool: false)")," - Specifies if Nomad will ignore a\nprevious leave and attempt to rejoin the cluster when starting. By default,\nNomad treats leave as a permanent intent and does not attempt to join the\ncluster again when starting. This flag allows the previous state to be used to\nrejoin the cluster.")),Object(o.b)("li",Object(r.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(r.a)({parentName:"li"},{id:"server_join",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#server_join","aria-label":"server_join permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"server_join"))," ",Object(o.b)("code",null,"(",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/configuration/server_join",title:"Server Join"}),"server_join"),": nil)")," - Specifies\nhow the Nomad server will connect to other Nomad servers. The ",Object(o.b)("inlineCode",{parentName:"p"},"retry_join"),"\nfields may directly specify the server address or use go-discover syntax for\nauto-discovery. See the ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/configuration/server_join",title:"Server Join"}),"server_join documentation")," for more detail.")),Object(o.b)("li",Object(r.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(r.a)({parentName:"li"},{id:"upgrade_version",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#upgrade_version","aria-label":"upgrade_version permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"upgrade_version"))," ",Object(o.b)("inlineCode",{parentName:"p"},'(string: "")')," - A custom version of the format X.Y.Z to use\nin place of the Nomad version when custom upgrades are enabled in Autopilot.\nFor more information, see the ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://learn.hashicorp.com/nomad/operating-nomad/autopilot"}),"Autopilot Guide"),"."))),Object(o.b)("h3",{className:"g-type-display-4"},Object(o.b)("a",Object(r.a)({parentName:"h3"},{className:"__permalink-h",href:"#deprecated-parameters","aria-label":"deprecated parameters permalink"}),"\xbb"),Object(o.b)("a",Object(r.a)({parentName:"h3"},{className:"__target-h",id:"deprecated-parameters","aria-hidden":""})),"Deprecated Parameters"),Object(o.b)("ul",null,Object(o.b)("li",Object(r.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(r.a)({parentName:"li"},{id:"retry_join",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#retry_join","aria-label":"retry_join permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"retry_join"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(array<string>: [])")," - Specifies a list of server addresses to\nretry joining if the first attempt fails. This is similar to\n",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#start_join"}),Object(o.b)("inlineCode",{parentName:"a"},"start_join")),", but only invokes if the initial join attempt\nfails. The list of addresses will be tried in the order specified, until one\nsucceeds. After one succeeds, no further addresses will be contacted. This is\nuseful for cases where we know the address will become available eventually.\nUse ",Object(o.b)("inlineCode",{parentName:"p"},"retry_join")," with an array as a replacement for ",Object(o.b)("inlineCode",{parentName:"p"},"start_join"),", ",Object(o.b)("strong",{parentName:"p"},"do not use\nboth options"),". See the ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/configuration/server_join",title:"Server Join"}),"server_join"),"\nsection for more information on the format of the string. This field is\ndeprecated in favor of the ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/configuration/server_join",title:"Server Join"}),"server_join stanza"),".")),Object(o.b)("li",Object(r.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(r.a)({parentName:"li"},{id:"retry_interval",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#retry_interval","aria-label":"retry_interval permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"retry_interval"))," ",Object(o.b)("inlineCode",{parentName:"p"},'(string: "30s")')," - Specifies the time to wait between retry\njoin attempts. This field is deprecated in favor of the ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/configuration/server_join",title:"Server Join"}),"server_join\nstanza"),".")),Object(o.b)("li",Object(r.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(r.a)({parentName:"li"},{id:"retry_max",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#retry_max","aria-label":"retry_max permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"retry_max"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(int: 0)")," - Specifies the maximum number of join attempts to be\nmade before exiting with a return code of 1. By default, this is set to 0\nwhich is interpreted as infinite retries. This field is deprecated in favor of\nthe ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/configuration/server_join",title:"Server Join"}),"server_join stanza"),".")),Object(o.b)("li",Object(r.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(r.a)({parentName:"li"},{id:"start_join",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"#start_join","aria-label":"start_join permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"start_join"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(array<string>: [])")," - Specifies a list of server addresses to\njoin on startup. If Nomad is unable to join with any of the specified\naddresses, agent startup will fail. See the ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/configuration/server_join#server-address-format"}),"server address\nformat"),"\nsection for more information on the format of the string. This field is\ndeprecated in favor of the ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/configuration/server_join",title:"Server Join"}),"server_join stanza"),"."))),Object(o.b)("h2",{className:"g-type-display-3"},Object(o.b)("a",Object(r.a)({parentName:"h2"},{className:"__permalink-h",href:"#server-examples","aria-label":"server examples permalink"}),"\xbb"),Object(o.b)("a",Object(r.a)({parentName:"h2"},{className:"__target-h",id:"server-examples","aria-hidden":""})),Object(o.b)("inlineCode",{parentName:"h2"},"server")," Examples"),Object(o.b)("h3",{className:"g-type-display-4"},Object(o.b)("a",Object(r.a)({parentName:"h3"},{className:"__permalink-h",href:"#common-setup","aria-label":"common setup permalink"}),"\xbb"),Object(o.b)("a",Object(r.a)({parentName:"h3"},{className:"__target-h",id:"common-setup","aria-hidden":""})),"Common Setup"),Object(o.b)("p",null,"This example shows a common Nomad agent ",Object(o.b)("inlineCode",{parentName:"p"},"server")," configuration stanza. The two\nIP addresses could also be DNS, and should point to the other Nomad servers in\nthe cluster"),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-hcl"}),Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token keyword"}),"server")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token property"}),"enabled"),"          ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token boolean"}),"true"),"\n  ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token property"}),"bootstrap_expect")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token number"}),"3"),"\n\n  ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token keyword"}),"server_join")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token property"}),"retry_join"),"     ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"[")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token string"}),'"1.1.1.1"'),", ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token string"}),'"2.2.2.2"')," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n    ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token property"}),"retry_max"),"      ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token number"}),"3"),"\n    ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token property"}),"retry_interval")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token string"}),'"15s"'),"\n  ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("h3",{className:"g-type-display-4"},Object(o.b)("a",Object(r.a)({parentName:"h3"},{className:"__permalink-h",href:"#configuring-data-directory","aria-label":"configuring data directory permalink"}),"\xbb"),Object(o.b)("a",Object(r.a)({parentName:"h3"},{className:"__target-h",id:"configuring-data-directory","aria-hidden":""})),"Configuring Data Directory"),Object(o.b)("p",null,"This example shows configuring a custom data directory for the server data."),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-hcl"}),Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token keyword"}),"server")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token property"}),"data_dir")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token string"}),'"/opt/nomad/server"'),"\n",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("h3",{className:"g-type-display-4"},Object(o.b)("a",Object(r.a)({parentName:"h3"},{className:"__permalink-h",href:"#automatic-bootstrapping","aria-label":"automatic bootstrapping permalink"}),"\xbb"),Object(o.b)("a",Object(r.a)({parentName:"h3"},{className:"__target-h",id:"automatic-bootstrapping","aria-hidden":""})),"Automatic Bootstrapping"),Object(o.b)("p",null,"The Nomad servers can automatically bootstrap if Consul is configured. For a\nmore detailed explanation, please see the\n",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://learn.hashicorp.com/nomad/operating-nomad/clustering"}),"automatic Nomad bootstrapping documentation"),"."),Object(o.b)("h3",{className:"g-type-display-4"},Object(o.b)("a",Object(r.a)({parentName:"h3"},{className:"__permalink-h",href:"#restricting-schedulers","aria-label":"restricting schedulers permalink"}),"\xbb"),Object(o.b)("a",Object(r.a)({parentName:"h3"},{className:"__target-h",id:"restricting-schedulers","aria-hidden":""})),"Restricting Schedulers"),Object(o.b)("p",null,"This example shows restricting the schedulers that are enabled as well as the\nmaximum number of cores to utilize when participating in scheduling decisions:"),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-hcl"}),Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token keyword"}),"server")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token property"}),"enabled"),"            ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token boolean"}),"true"),"\n  ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token property"}),"enabled_schedulers")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token string"}),'"batch"'),", ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token string"}),'"service"'),Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n  ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token property"}),"num_schedulers"),"     ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token number"}),"7"),"\n",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("h3",{className:"g-type-display-4"},Object(o.b)("a",Object(r.a)({parentName:"h3"},{className:"__permalink-h",href:"#configuring-scheduler-config","aria-label":"bootstrapping with a custom scheduler config permalink"}),"\xbb"),Object(o.b)("a",Object(r.a)({parentName:"h3"},{className:"__target-h __compat",id:"configuring-scheduler-config","aria-hidden":""})),Object(o.b)("a",Object(r.a)({parentName:"h3"},{className:"__target-h",id:"bootstrapping-with-a-custom-scheduler-config","aria-hidden":""})),"Bootstrapping with a Custom Scheduler Config"),Object(o.b)("p",null,"While ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/faq#bootstrapping"}),"bootstrapping a cluster"),", you can use the ",Object(o.b)("inlineCode",{parentName:"p"},"default_scheduler_config")," stanza\nto prime the cluster with a ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/api-docs/operator#update-scheduler-configuration",title:"Scheduler Config"}),Object(o.b)("inlineCode",{parentName:"a"},"SchedulerConfig")),". The\nscheduler configuration determines which scheduling algorithm is configured\u2014\nspread scheduling or binpacking\u2014and which job types are eligible for preemption."),Object(o.b)("div",{className:"alert alert-warning g-type-body",role:"alert"},Object(o.b)("p",{parentName:"div"},"",Object(o.b)("strong",{parentName:"p"},"Warning:")," Once the cluster is bootstrapped, you must configure this using\nthe ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/api-docs/operator#update-scheduler-configuration",title:"Scheduler Config"}),"update scheduler configuration")," API. This\noption is only consulted during bootstrap.")),Object(o.b)("p",null,"The structure matches the ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/api-docs/operator#update-scheduler-configuration",title:"Scheduler Config"}),"Update Scheduler Config")," API\nendpoint, which you should consult for canonical documentation. However, the\nattributes names must be adapted to HCL syntax by using snake case\nrepresentations rather than camel case."),Object(o.b)("p",null,"This example shows configuring spread scheduling and enabling preemption for all\njob-type schedulers."),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-hcl"}),Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token keyword"}),"server")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token keyword"}),"default_scheduler_config")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token property"}),"scheduler_algorithm")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token string"}),'"spread"'),"\n\n    ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token keyword"}),"preemption_config")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token property"}),"batch_scheduler_enabled"),"   ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token boolean"}),"true"),"\n      ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token property"}),"system_scheduler_enabled"),"  ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token boolean"}),"true"),"\n      ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token property"}),"service_scheduler_enabled")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token boolean"}),"true"),"\n    ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.b)("span",Object(r.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")))}d.isMDXComponent=!0}},[["oKM8",0,1,2,4,3,5,6]]]);