(window.webpackJsonp=window.webpackJsonp||[]).push([[268],{R4pV:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/upgrade/upgrade-specific",function(){return t("pyQR")}])},pyQR:function(e,a,t){"use strict";t.r(a),t.d(a,"default",(function(){return p}));var n=t("wx14"),c=t("Ff2n"),o=t("q1tI"),s=t.n(o),i=t("7ljp"),r=t("j1un"),b=(s.a.createElement,{}),l=Object(r.a)({layout:"docs",page_title:"Upgrade Guides",sidebar_title:"Specific Version Details",description:"Specific versions of Nomad may have additional information about the upgrade\nprocess beyond the standard flow.",__resourcePath:"docs/upgrade/upgrade-specific.mdx",__scans:{}});function p(e){var a=e.components,t=Object(c.a)(e,["components"]);return Object(i.b)(l,Object(n.a)({},b,t,{components:a,mdxType:"MDXLayout"}),Object(i.b)("h1",{className:"g-type-display-2"},Object(i.b)("a",Object(n.a)({parentName:"h1"},{className:"__permalink-h",href:"#upgrade-guides","aria-label":"upgrade guides permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h1"},{className:"__target-h",id:"upgrade-guides","aria-hidden":""})),"Upgrade Guides"),Object(i.b)("p",null,"The ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/upgrade"}),"upgrading page")," covers the details of doing\na standard upgrade. However, specific versions of Nomad may have more\ndetails provided for their upgrades as a result of new features or changed\nbehavior. This page is used to document those details separately from the\nstandard upgrade flow."),Object(i.b)("h2",{className:"g-type-display-3"},Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#nomad-0-12-8","aria-label":"nomad 0 12 8 permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"nomad-0-12-8","aria-hidden":""})),"Nomad 0.12.8"),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#docker-volume-mounts","aria-label":"docker volume mounts permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"docker-volume-mounts","aria-hidden":""})),"Docker volume mounts"),Object(i.b)("p",null,"Nomad 0.12.8 includes security fixes for the handling of Docker volume mounts:"),Object(i.b)("ul",null,Object(i.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),"The ",Object(i.b)("inlineCode",{parentName:"li"},"docker.volumes.enabled")," flag now defaults to ",Object(i.b)("inlineCode",{parentName:"li"},"false")," as documented."),Object(i.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),'Docker driver mounts of type "volume" (but not "bind") were not sandboxed\nand could mount arbitrary locations from the client host. The\n',Object(i.b)("inlineCode",{parentName:"li"},"docker.volumes.enabled"),' configuration will now disable Docker mounts with\ntype "volume" when set to ',Object(i.b)("inlineCode",{parentName:"li"},"false")," (the default).")),Object(i.b)("p",null,"This change Docker impacts jobs that use a ",Object(i.b)("inlineCode",{parentName:"p"},"mounts"),' with type "volume", as\nshown below. This job will fail when placed unless ',Object(i.b)("inlineCode",{parentName:"p"},"docker.volumes.enabled =\ntrue"),"."),Object(i.b)("pre",{className:"language-hcl"},Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-hcl"}),Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"mounts")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"["),"\n  ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"type"),"     ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"volume"'),"\n    ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"target"),"   ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"/path/in/container"'),"\n    ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"source"),"   ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"docker_volume"'),"\n    ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"volume_options")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"driver_config")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"name")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"local"'),"\n        ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"options")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"["),"\n          ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n            ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"device")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"/"'),"\n            ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"o"),"      ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"ro,bind"'),"\n            ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"type"),"   ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"ext4"'),"\n          ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n        ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n      ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n")),Object(i.b)("h2",{className:"g-type-display-3"},Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#nomad-0-12-6","aria-label":"nomad 0 12 6 permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"nomad-0-12-6","aria-hidden":""})),"Nomad 0.12.6"),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#artifact-and-template-paths","aria-label":"artifact and template paths permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"artifact-and-template-paths","aria-hidden":""})),"Artifact and Template Paths"),Object(i.b)("p",null,"Nomad 0.12.6 includes security fixes for privilege escalation vulnerabilities\nin handling of job ",Object(i.b)("inlineCode",{parentName:"p"},"template")," and ",Object(i.b)("inlineCode",{parentName:"p"},"artifact")," stanzas:"),Object(i.b)("ul",null,Object(i.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),"The ",Object(i.b)("inlineCode",{parentName:"li"},"template.source")," and ",Object(i.b)("inlineCode",{parentName:"li"},"template.destination")," fields are now protected by\nthe file sandbox introduced in 0.9.6. These paths are now restricted to fall\ninside the task directory by default. An operator can opt-out of this\nprotection with the\n",Object(i.b)("a",Object(n.a)({parentName:"li"},{href:"/docs/configuration/client#template-parameters"}),Object(i.b)("inlineCode",{parentName:"a"},"template.disable_file_sandbox")),"\nfield in the client configuration."),Object(i.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),"The paths for ",Object(i.b)("inlineCode",{parentName:"li"},"template.source"),", ",Object(i.b)("inlineCode",{parentName:"li"},"template.destination"),", and\n",Object(i.b)("inlineCode",{parentName:"li"},"artifact.destination")," are validated on job submission to ensure the paths\ndo not escape the file sandbox. It was possible to use interpolation to\nbypass this validation. The client now interpolates the paths before\nchecking if they are in the file sandbox.")),Object(i.b)("div",{className:"alert alert-warning g-type-body",role:"alert"},Object(i.b)("p",{parentName:"div"},"",Object(i.b)("strong",{parentName:"p"},"Warning:")," Due to a ","[bug][gh-9148]"," in Nomad v0.12.6, the\n",Object(i.b)("inlineCode",{parentName:"p"},"template.destination")," and ",Object(i.b)("inlineCode",{parentName:"p"},"artifact.destination")," paths do not support\nabsolute paths, including the interpolated ",Object(i.b)("inlineCode",{parentName:"p"},"NOMAD_SECRETS_DIR"),",\n",Object(i.b)("inlineCode",{parentName:"p"},"NOMAD_TASK_DIR"),", and ",Object(i.b)("inlineCode",{parentName:"p"},"NOMAD_ALLOC_DIR")," variables. This bug is fixed in\nv0.12.7. To work around the bug, use a relative path.")),Object(i.b)("h2",{className:"g-type-display-3"},Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#nomad-0-12-0","aria-label":"nomad 0 12 0 permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"nomad-0-12-0","aria-hidden":""})),"Nomad 0.12.0"),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#mbits-and-task-network-resource-deprecation","aria-label":"mbits and task network resource deprecation permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"mbits-and-task-network-resource-deprecation","aria-hidden":""})),Object(i.b)("inlineCode",{parentName:"h3"},"mbits")," and Task Network Resource deprecation"),Object(i.b)("p",null,"Starting in Nomad 0.12.0 the ",Object(i.b)("inlineCode",{parentName:"p"},"mbits")," field of the network resource block has\nbeen deprecated.  This is in part because we felt that ",Object(i.b)("inlineCode",{parentName:"p"},"mbits")," didn't\naccurately account network bandwidth as a resource."),Object(i.b)("p",null,"Additionally the use of the ",Object(i.b)("inlineCode",{parentName:"p"},"network")," block inside of a task's ",Object(i.b)("inlineCode",{parentName:"p"},"resource")," block is\nalso deprecated. Users are advised to move their ",Object(i.b)("inlineCode",{parentName:"p"},"network")," block to the ",Object(i.b)("inlineCode",{parentName:"p"},"group"),"\nblock. Recent networking features have only been added to group based network\nconfiguration. If any usecase or feature which was available with task network\nresource is not fulfilled with group network configuration, please open an issue\ndetailing the missing capability."),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#enterprise-licensing","aria-label":"enterprise licensing permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"enterprise-licensing","aria-hidden":""})),"Enterprise Licensing"),Object(i.b)("p",null,"Enterprise binaries for Nomad are now publicly available via\n",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://releases.hashicorp.com/nomad/"}),"releases.hashicorp.com"),". By default all\nenterprise features are enabled for 6 hours. During that time enterprise users\nshould apply their license with the ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.nomadproject.io/docs/commands/license/put"}),Object(i.b)("inlineCode",{parentName:"a"},"nomad license put\n..."))," command."),Object(i.b)("p",null,"Once the 6 hour demonstration period expires, Nomad will shutdown. If restarted\nNomad will shutdown in a very short amount of time unless a valid license is\napplied."),Object(i.b)("div",{className:"alert alert-warning g-type-body",role:"alert"},Object(i.b)("p",{parentName:"div"},"",Object(i.b)("strong",{parentName:"p"},"Warning:")," Due to a ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/hashicorp/nomad/issues/8457"}),"bug")," in Nomad v0.12.0, existing clusters\nthat are upgraded will ",Object(i.b)("strong",{parentName:"p"},"not")," have 6 hours to apply a license. The minimal\ngrace period should be sufficient to apply a valid license, but enterprise\nusers are encouraged to delay upgrading until Nomad v0.12.1 is released and\nfixes the issue.")),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#docker-access-host-filesystem","aria-label":"docker access host filesystem permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"docker-access-host-filesystem","aria-hidden":""})),"Docker access host filesystem"),Object(i.b)("p",null,"Nomad 0.12.0 disables Docker tasks access to the host filesystem, by default.\nPrior to Nomad 0.12, Docker tasks may mount and then manipulate any host file\nand may pose a security risk."),Object(i.b)("p",null,"Operators now must explicitly allow tasks to access host filesystem. ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/configuration/client#host_volume-stanza"}),"Host\nVolumes")," provide a fine tune\naccess to individual paths."),Object(i.b)("p",null,"To restore pre-0.12.0 behavior, you can enable ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/drivers/docker#enabled-1"}),"Docker\n",Object(i.b)("inlineCode",{parentName:"a"},"volume"))," to allow binding host paths, by adding\nthe following to the nomad client config file:"),Object(i.b)("pre",{className:"language-hcl"},Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-hcl"}),"plugin ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"docker"')," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"config")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"volumes")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"enabled")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token boolean"}),"true"),"\n    ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#qemu-images","aria-label":"qemu images permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"qemu-images","aria-hidden":""})),"Qemu images"),Object(i.b)("p",null,"Nomad 0.12.0 restricts the paths the Qemu tasks can load an image from. A Qemu\ntask may download an image to the allocation directory to load. But images\noutside the allocation directories must be explicitly allowed by operators in\nthe client agent configuration file."),Object(i.b)("p",null,"For example, you may allow loading Qemu images from ",Object(i.b)("inlineCode",{parentName:"p"},"/mnt/qemu-images")," by\nadding the following to the agent configuration file:"),Object(i.b)("pre",{className:"language-hcl"},Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-hcl"}),"plugin ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"qemu"')," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"config")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"image_paths")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"/mnt/qemu-images"'),Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n  ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(i.b)("h2",{className:"g-type-display-3"},Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#nomad-0-11-7","aria-label":"nomad 0 11 7 permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"nomad-0-11-7","aria-hidden":""})),"Nomad 0.11.7"),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#docker-volume-mounts-1","aria-label":"docker volume mounts permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"docker-volume-mounts-1","aria-hidden":""})),"Docker volume mounts"),Object(i.b)("p",null,'Nomad 0.11.7 includes a security fixes for the handling of Docker volume\nmounts. Docker driver mounts of type "volume" (but not "bind") were not\nsandboxed and could mount arbitrary locations from the client host. The\n',Object(i.b)("inlineCode",{parentName:"p"},"docker.volumes.enabled"),' configuration will now disable Docker mounts with\ntype "volume" when set to ',Object(i.b)("inlineCode",{parentName:"p"},"false"),"."),Object(i.b)("p",null,"This change Docker impacts jobs that use a ",Object(i.b)("inlineCode",{parentName:"p"},"mounts"),' with type "volume", as\nshown below. This job will fail when placed unless ',Object(i.b)("inlineCode",{parentName:"p"},"docker.volumes.enabled =\ntrue"),"."),Object(i.b)("pre",{className:"language-hcl"},Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-hcl"}),Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"mounts")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"["),"\n  ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"type"),"     ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"volume"'),"\n    ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"target"),"   ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"/path/in/container"'),"\n    ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"source"),"   ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"docker_volume"'),"\n    ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"volume_options")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"driver_config")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"name")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"local"'),"\n        ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"options")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"["),"\n          ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n            ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"device")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"/"'),"\n            ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"o"),"      ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"ro,bind"'),"\n            ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"type"),"   ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"ext4"'),"\n          ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n        ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n      ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n")),Object(i.b)("h2",{className:"g-type-display-3"},Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#nomad-0-11-5","aria-label":"nomad 0 11 5 permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"nomad-0-11-5","aria-hidden":""})),"Nomad 0.11.5"),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#artifact-and-template-paths-1","aria-label":"artifact and template paths permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"artifact-and-template-paths-1","aria-hidden":""})),"Artifact and Template Paths"),Object(i.b)("p",null,"Nomad 0.11.5 includes backported security fixes for privilege escalation\nvulnerabilities in handling of job ",Object(i.b)("inlineCode",{parentName:"p"},"template")," and ",Object(i.b)("inlineCode",{parentName:"p"},"artifact")," stanzas:"),Object(i.b)("ul",null,Object(i.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),"The ",Object(i.b)("inlineCode",{parentName:"li"},"template.source")," and ",Object(i.b)("inlineCode",{parentName:"li"},"template.destination")," fields are now protected by\nthe file sandbox introduced in 0.9.6. These paths are now restricted to fall\ninside the task directory by default. An operator can opt-out of this\nprotection with the\n",Object(i.b)("a",Object(n.a)({parentName:"li"},{href:"/docs/configuration/client#template-parameters"}),Object(i.b)("inlineCode",{parentName:"a"},"template.disable_file_sandbox")),"\nfield in the client configuration."),Object(i.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),"The paths for ",Object(i.b)("inlineCode",{parentName:"li"},"template.source"),", ",Object(i.b)("inlineCode",{parentName:"li"},"template.destination"),", and\n",Object(i.b)("inlineCode",{parentName:"li"},"artifact.destination")," are validated on job submission to ensure the paths\ndo not escape the file sandbox. It was possible to use interpolation to\nbypass this validation. The client now interpolates the paths before\nchecking if they are in the file sandbox.")),Object(i.b)("div",{className:"alert alert-warning g-type-body",role:"alert"},Object(i.b)("p",{parentName:"div"},"",Object(i.b)("strong",{parentName:"p"},"Warning:")," Due to a ","[bug][gh-9148]"," in Nomad v0.11.5, the\n",Object(i.b)("inlineCode",{parentName:"p"},"template.destination")," and ",Object(i.b)("inlineCode",{parentName:"p"},"artifact.destination")," paths do not support\nabsolute paths, including the interpolated ",Object(i.b)("inlineCode",{parentName:"p"},"NOMAD_SECRETS_DIR"),",\n",Object(i.b)("inlineCode",{parentName:"p"},"NOMAD_TASK_DIR"),", and ",Object(i.b)("inlineCode",{parentName:"p"},"NOMAD_ALLOC_DIR")," variables. This bug is fixed in\nv0.11.6. To work around the bug, use a relative path.")),Object(i.b)("h2",{className:"g-type-display-3"},Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#nomad-0-11-3","aria-label":"nomad 0 11 3 permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"nomad-0-11-3","aria-hidden":""})),"Nomad 0.11.3"),Object(i.b)("p",null,"Nomad 0.11.3 fixes a critical bug causing the nomad agent to become\nunresponsive. The issue is due to a ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/golang/go/issues/38023"}),"Go 1.14.1 runtime\nbug")," and affects Nomad 0.11.1 and\n0.11.2."),Object(i.b)("h2",{className:"g-type-display-3"},Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#nomad-0-11-2","aria-label":"nomad 0 11 2 permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"nomad-0-11-2","aria-hidden":""})),"Nomad 0.11.2"),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#scheduler-scoring-changes","aria-label":"scheduler scoring changes permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"scheduler-scoring-changes","aria-hidden":""})),"Scheduler Scoring Changes"),Object(i.b)("p",null,"Prior to Nomad 0.11.2 the scheduler algorithm used a ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/configuration/client#reserved-parameters"}),"node's reserved\nresources"),"\nincorrectly during scoring. The result of this bug was that scoring biased in\nfavor of nodes with reserved resources vs nodes without reserved resources."),Object(i.b)("p",null,"Placements will be more correct but slightly different in v0.11.2 vs earlier\nversions of Nomad. Operators do ",Object(i.b)("em",{parentName:"p"},"not")," need to take any actions as the impact of\nthe bug fix will only minimally affect scoring."),Object(i.b)("p",null,"Feasability (whether a node is capable of running a job at all) is ",Object(i.b)("em",{parentName:"p"},"not"),"\naffected."),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#periodic-jobs-and-daylight-saving-time","aria-label":"periodic jobs and daylight saving time permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"periodic-jobs-and-daylight-saving-time","aria-hidden":""})),"Periodic Jobs and Daylight Saving Time"),Object(i.b)("p",null,"Nomad 0.11.2 fixed a long outstanding bug affecting periodic jobs that are\nscheduled to run during Daylight Saving Time transitions."),Object(i.b)("p",null,"Nomad 0.11.2 provides a more defined behavior: Nomad evaluates the cron\nexpression with respect to specified time zone during transition. A 2:30am\nnightly job with ",Object(i.b)("inlineCode",{parentName:"p"},"America/New_York")," time zone will not run on the day daylight\nsaving time starts; similarly, a 1:30am nightly job will run twice on the day\ndaylight saving time ends. See the ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/job-specification/periodic#daylight-saving-time"}),"Daylight Saving Time")," documentation\nfor details."),Object(i.b)("h2",{className:"g-type-display-3"},Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#nomad-0-11-0","aria-label":"nomad 0 11 0 permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"nomad-0-11-0","aria-hidden":""})),"Nomad 0.11.0"),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#client-template-vault_grace-deprecation","aria-label":"client template vault_grace deprecation permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"client-template-vault_grace-deprecation","aria-hidden":""})),"client.template: ",Object(i.b)("inlineCode",{parentName:"h3"},"vault_grace")," deprecation"),Object(i.b)("p",null,"Nomad 0.11.0 updates\n",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/hashicorp/consul-template"}),"consul-template")," to v0.24.1.\nThis library deprecates the ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/job-specification/template"}),Object(i.b)("inlineCode",{parentName:"a"},"vault_grace"))," option for templating\nincluded in Nomad. The feature has been ignored since Vault 0.5 and as long as\nyou are running a more recent version of Vault, you can safely remove\n",Object(i.b)("inlineCode",{parentName:"p"},"vault_grace")," from your Nomad jobs."),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#rkt-task-driver-removed","aria-label":"rkt task driver removed permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"rkt-task-driver-removed","aria-hidden":""})),"Rkt Task Driver Removed"),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"rkt")," task driver has been deprecated and removed from Nomad. While the\ncode is available in an external repository,\n",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/hashicorp/nomad-driver-rkt"}),"https://github.com/hashicorp/nomad-driver-rkt"),",\nit will not be maintained as ",Object(i.b)("inlineCode",{parentName:"p"},"rkt")," is ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/rkt/rkt"}),"no longer being developed\nupstream"),". We encourage all ",Object(i.b)("inlineCode",{parentName:"p"},"rkt")," users to find a\nnew task driver as soon as possible."),Object(i.b)("h2",{className:"g-type-display-3"},Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#nomad-0-10-8","aria-label":"nomad 0 10 8 permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"nomad-0-10-8","aria-hidden":""})),"Nomad 0.10.8"),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#docker-volume-mounts-2","aria-label":"docker volume mounts permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"docker-volume-mounts-2","aria-hidden":""})),"Docker volume mounts"),Object(i.b)("p",null,'Nomad 0.10.8 includes a security fixes for the handling of Docker volume\nmounts. Docker driver mounts of type "volume" (but not "bind") were not\nsandboxed and could mount arbitrary locations from the client host. The\n',Object(i.b)("inlineCode",{parentName:"p"},"docker.volumes.enabled"),' configuration will now disable Docker mounts with\ntype "volume" when set to ',Object(i.b)("inlineCode",{parentName:"p"},"false"),"."),Object(i.b)("p",null,"This change Docker impacts jobs that use a ",Object(i.b)("inlineCode",{parentName:"p"},"mounts"),' with type "volume", as\nshown below. This job will fail when placed unless ',Object(i.b)("inlineCode",{parentName:"p"},"docker.volumes.enabled =\ntrue"),"."),Object(i.b)("pre",{className:"language-hcl"},Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-hcl"}),Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"mounts")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"["),"\n  ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"type"),"     ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"volume"'),"\n    ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"target"),"   ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"/path/in/container"'),"\n    ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"source"),"   ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"docker_volume"'),"\n    ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"volume_options")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"driver_config")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"name")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"local"'),"\n        ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"options")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"["),"\n          ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n            ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"device")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"/"'),"\n            ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"o"),"      ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"ro,bind"'),"\n            ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"type"),"   ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"ext4"'),"\n          ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n        ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n      ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n")),Object(i.b)("h2",{className:"g-type-display-3"},Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#nomad-0-10-6","aria-label":"nomad 0 10 6 permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"nomad-0-10-6","aria-hidden":""})),"Nomad 0.10.6"),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#artifact-and-template-paths-2","aria-label":"artifact and template paths permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"artifact-and-template-paths-2","aria-hidden":""})),"Artifact and Template Paths"),Object(i.b)("p",null,"Nomad 0.10.6 includes backported security fixes for privilege escalation\nvulnerabilities in handling of job ",Object(i.b)("inlineCode",{parentName:"p"},"template")," and ",Object(i.b)("inlineCode",{parentName:"p"},"artifact")," stanzas:"),Object(i.b)("ul",null,Object(i.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),"The ",Object(i.b)("inlineCode",{parentName:"li"},"template.source")," and ",Object(i.b)("inlineCode",{parentName:"li"},"template.destination")," fields are now protected by\nthe file sandbox introduced in 0.9.6. These paths are now restricted to fall\ninside the task directory by default. An operator can opt-out of this\nprotection with the\n",Object(i.b)("a",Object(n.a)({parentName:"li"},{href:"/docs/configuration/client#template-parameters"}),Object(i.b)("inlineCode",{parentName:"a"},"template.disable_file_sandbox")),"\nfield in the client configuration."),Object(i.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),"The paths for ",Object(i.b)("inlineCode",{parentName:"li"},"template.source"),", ",Object(i.b)("inlineCode",{parentName:"li"},"template.destination"),", and\n",Object(i.b)("inlineCode",{parentName:"li"},"artifact.destination")," are validated on job submission to ensure the paths\ndo not escape the file sandbox. It was possible to use interpolation to\nbypass this validation. The client now interpolates the paths before\nchecking if they are in the file sandbox.")),Object(i.b)("div",{className:"alert alert-warning g-type-body",role:"alert"},Object(i.b)("p",{parentName:"div"},"",Object(i.b)("strong",{parentName:"p"},"Warning:")," Due to a ","[bug][gh-9148]"," in Nomad v0.10.6, the\n",Object(i.b)("inlineCode",{parentName:"p"},"template.destination")," and ",Object(i.b)("inlineCode",{parentName:"p"},"artifact.destination")," paths do not support\nabsolute paths, including the interpolated ",Object(i.b)("inlineCode",{parentName:"p"},"NOMAD_SECRETS_DIR"),",\n",Object(i.b)("inlineCode",{parentName:"p"},"NOMAD_TASK_DIR"),", and ",Object(i.b)("inlineCode",{parentName:"p"},"NOMAD_ALLOC_DIR")," variables. This bug is fixed in\nv0.10.7. To work around the bug, use a relative path.")),Object(i.b)("h2",{className:"g-type-display-3"},Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#nomad-0-10-4","aria-label":"nomad 0 10 4 permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"nomad-0-10-4","aria-hidden":""})),"Nomad 0.10.4"),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#same-node-scheduling-penalty-removed","aria-label":"same node scheduling penalty removed permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"same-node-scheduling-penalty-removed","aria-hidden":""})),"Same-Node Scheduling Penalty Removed"),Object(i.b)("p",null,"Nomad 0.10.4 includes a fix to the scheduler that removes the\nsame-node penalty for allocations that have not previously failed. In\nearlier versions of Nomad, the node where an allocation was running\nwas penalized from receiving updated versions of that allocation,\nresulting in a higher chance of the allocation being placed on a new\nnode. This was changed so that the penalty only applies to nodes where\nthe previous allocation has failed or been rescheduled, to reduce the\nrisk of correlated failures on a host. Scheduling weighs a number of\nfactors, but this change should reduce movement of allocations that\nare being updated from a healthy state. You can view the placement\nmetrics for an allocation with ",Object(i.b)("inlineCode",{parentName:"p"},"nomad alloc status -verbose"),"."),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#additional-environment-variable-filtering","aria-label":"additional environment variable filtering permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"additional-environment-variable-filtering","aria-hidden":""})),"Additional Environment Variable Filtering"),Object(i.b)("p",null,"Nomad will by default prevent certain environment variables set in the client\nprocess from being passed along into launched tasks. The ",Object(i.b)("inlineCode",{parentName:"p"},"CONSUL_HTTP_TOKEN"),"\nenvironment variable has been added to the default list. More information can\nbe found in the ",Object(i.b)("inlineCode",{parentName:"p"},"env.blacklist")," ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/configuration/client#env-blacklist"}),"configuration")," ."),Object(i.b)("h2",{className:"g-type-display-3"},Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#nomad-0-10-3","aria-label":"nomad 0 10 3 permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"nomad-0-10-3","aria-hidden":""})),"Nomad 0.10.3"),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#mtls-certificate-validation","aria-label":"mtls certificate validation permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"mtls-certificate-validation","aria-hidden":""})),"mTLS Certificate Validation"),Object(i.b)("p",null,"Nomad 0.10.3 includes a fix for a privilege escalation vulnerability in\nvalidating TLS certificates for RPC with mTLS. Nomad RPC endpoints validated\nthat TLS client certificates had not expired and were signed by the same CA as\nthe Nomad node, but did not correctly check the certificate's name for the role\nand region as described in the ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://learn.hashicorp.com/nomad/transport-security/enable-tls"}),"Securing Nomad with TLS")," guide. This\nallows trusted operators with a client certificate signed by the CA to send RPC\ncalls as a Nomad client or server node, bypassing access control and accessing\nany secrets available to a client."),Object(i.b)("p",null,"Nomad clusters configured for mTLS following the ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://learn.hashicorp.com/nomad/transport-security/enable-tls"}),"Securing Nomad with TLS"),"\nguide or the ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://learn.hashicorp.com/nomad/vault-integration/vault-pki-nomad"}),"Vault PKI Secrets Engine Integration")," guide\nshould already have certificates that will pass validation. Before upgrading to\nNomad 0.10.3, operators using mTLS with ",Object(i.b)("inlineCode",{parentName:"p"},"verify_server_hostname = true")," should\nconfirm that the common name or SAN of all Nomad client node certs is\n",Object(i.b)("inlineCode",{parentName:"p"},"client.<region>.nomad"),", and that the common name or SAN of all Nomad server\nnode certs is ",Object(i.b)("inlineCode",{parentName:"p"},"server.<region>.nomad"),"."),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#connection-limits-added","aria-label":"connection limits added permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"connection-limits-added","aria-hidden":""})),"Connection Limits Added"),Object(i.b)("p",null,"Nomad 0.10.3 introduces the ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/configuration#limits"}),"limits")," agent configuration parameters for\nmitigating denial of service attacks from users who are not authenticated via\nmTLS. The default limits stanza is:"),Object(i.b)("pre",{className:"language-hcl"},Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-hcl"}),Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"limits")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"https_handshake_timeout"),"   ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"5s"'),"\n  ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"http_max_conns_per_client")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token number"}),"100"),"\n  ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"rpc_handshake_timeout"),"     ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"5s"'),"\n  ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"rpc_max_conns_per_client"),"  ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token number"}),"100"),"\n",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(i.b)("p",null,"If your Nomad agent's endpoints are protected from unauthenticated users via\nother mechanisms these limits may be safely disabled by setting them to ",Object(i.b)("inlineCode",{parentName:"p"},"0"),"."),Object(i.b)("p",null,"However the defaults were chosen to be safe for a wide variety of Nomad\ndeployments and may protect against accidental abuses of the Nomad API that\ncould cause unintended resource usage."),Object(i.b)("h2",{className:"g-type-display-3"},Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#nomad-0-10-2","aria-label":"nomad 0 10 2 permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"nomad-0-10-2","aria-hidden":""})),"Nomad 0.10.2"),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#preemption-panic-fixed","aria-label":"preemption panic fixed permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"preemption-panic-fixed","aria-hidden":""})),"Preemption Panic Fixed"),Object(i.b)("p",null,"Nomad 0.9.7 and 0.10.2 fix a ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/hashicorp/nomad/issues/6787"}),"server crashing bug")," present in\nscheduler preemption since 0.9.0. Users unable to immediately upgrade Nomad can\n",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/api-docs/operator#update-scheduler-configuration"}),"disable preemption")," to avoid the panic."),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#dangling-docker-container-cleanup","aria-label":"dangling docker container cleanup permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"dangling-docker-container-cleanup","aria-hidden":""})),"Dangling Docker Container Cleanup"),Object(i.b)("p",null,"Nomad 0.10.2 addresses an issue occurring in heavily loaded clients, where\ncontainers are started without being properly managed by Nomad. Nomad 0.10.2\nintroduced a reaper that detects and kills such containers."),Object(i.b)("p",null,"Operators may opt to run reaper in a dry-mode or disabling it through a client config."),Object(i.b)("p",null,"For more information, see ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/drivers/docker#dangling-containers"}),"Docker Dangling containers"),"."),Object(i.b)("h2",{className:"g-type-display-3"},Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#nomad-0-10-0","aria-label":"nomad 0 10 0 permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"nomad-0-10-0","aria-hidden":""})),"Nomad 0.10.0"),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#deployments","aria-label":"deployments permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"deployments","aria-hidden":""})),"Deployments"),Object(i.b)("p",null,"Nomad 0.10 enables rolling deployments for service jobs by default\nand adds a default update stanza when a service job is created or updated.\nThis does not affect jobs with an update stanza."),Object(i.b)("p",null,"In pre-0.10 releases, when updating a service job without an update stanza,\nall existing allocations are stopped while new allocations start up,\nand this may cause a service degradation or an outage.\nYou can regain this behavior and disable deployments by setting ",Object(i.b)("inlineCode",{parentName:"p"},"max_parallel")," to 0."),Object(i.b)("p",null,"For more information, see ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/job-specification/update"}),Object(i.b)("inlineCode",{parentName:"a"},"update")," stanza"),"."),Object(i.b)("h2",{className:"g-type-display-3"},Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#nomad-0-9-5","aria-label":"nomad 0 9 5 permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"nomad-0-9-5","aria-hidden":""})),"Nomad 0.9.5"),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#template-rendering","aria-label":"template rendering permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"template-rendering","aria-hidden":""})),"Template Rendering"),Object(i.b)("p",null,"Nomad 0.9.5 includes security fixes for privilege escalation vulnerabilities in handling of job ",Object(i.b)("inlineCode",{parentName:"p"},"template")," stanzas:"),Object(i.b)("ul",null,Object(i.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),"The client host's environment variables are now cleaned before rendering the template. If a template includes the ",Object(i.b)("inlineCode",{parentName:"li"},"env")," function, the job should include an ",Object(i.b)("a",Object(n.a)({parentName:"li"},{href:"/docs/job-specification/env"}),Object(i.b)("inlineCode",{parentName:"a"},"env"))," stanza to allow access to the variable in the template."),Object(i.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),"The ",Object(i.b)("inlineCode",{parentName:"li"},"plugin")," function is no longer permitted by default and will raise an error if used in a template. Operator can opt-in to permitting this function with the new ",Object(i.b)("a",Object(n.a)({parentName:"li"},{href:"/docs/configuration/client#template-parameters"}),Object(i.b)("inlineCode",{parentName:"a"},"template.function_blacklist"))," field in the client configuration."),Object(i.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),"The ",Object(i.b)("inlineCode",{parentName:"li"},"file")," function has been changed to restrict paths to fall inside the task directory by default. Paths that used the ",Object(i.b)("inlineCode",{parentName:"li"},"NOMAD_TASK_DIR")," environment variable to prefix file paths should work unchanged. Relative paths or symlinks that point outside the task directory will raise an error. An operator can opt-out of this protection with the new ",Object(i.b)("a",Object(n.a)({parentName:"li"},{href:"/docs/configuration/client#template-parameters"}),Object(i.b)("inlineCode",{parentName:"a"},"template.disable_file_sandbox"))," field in the client configuration.")),Object(i.b)("h2",{className:"g-type-display-3"},Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#nomad-0-9-0","aria-label":"nomad 0 9 0 permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"nomad-0-9-0","aria-hidden":""})),"Nomad 0.9.0"),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#preemption","aria-label":"preemption permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"preemption","aria-hidden":""})),"Preemption"),Object(i.b)("p",null,"Nomad 0.9 adds preemption support for system jobs. If a system job is submitted\nthat has a higher priority than other running jobs on the node, and the node\ndoes not have capacity remaining, Nomad may preempt those lower priority\nallocations to place the system job. See ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/internals/scheduling/preemption"}),"preemption")," for more\ndetails."),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#task-driver-plugins","aria-label":"task driver plugins permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"task-driver-plugins","aria-hidden":""})),"Task Driver Plugins"),Object(i.b)("p",null,"All task drivers have become ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/drivers/external"}),"plugins")," in Nomad 0.9.0. There are two\nuser visible differences between 0.8 and 0.9 drivers:"),Object(i.b)("ul",null,Object(i.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(i.b)("a",Object(n.a)({parentName:"li"},{href:"/docs/drivers/external/lxc"}),"LXC")," is now community supported and distributed independently."),Object(i.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),"Task driver ",Object(i.b)("a",Object(n.a)({parentName:"li"},{href:"/docs/job-specification/task#config"}),Object(i.b)("inlineCode",{parentName:"a"},"config"))," stanzas are no longer validated by\nthe ",Object(i.b)("a",Object(n.a)({parentName:"li"},{href:"/docs/commands/job/validate"}),Object(i.b)("inlineCode",{parentName:"a"},"nomad job validate"))," command. This is a regression that will\nbe fixed in a future release.")),Object(i.b)("p",null,"There is a new method for client driver configuration options, but existing\n",Object(i.b)("inlineCode",{parentName:"p"},"client.options")," settings are supported in 0.9. See ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/configuration/plugin"}),"plugin\nconfiguration")," for details."),Object(i.b)("h4",{className:"g-type-display-5"},Object(i.b)("a",Object(n.a)({parentName:"h4"},{className:"__permalink-h",href:"#lxc","aria-label":"lxc permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h4"},{className:"__target-h",id:"lxc","aria-hidden":""})),"LXC"),Object(i.b)("p",null,"LXC is now an external plugin and must be installed separately. See ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/drivers/external/lxc"}),"the LXC\ndriver's documentation")," for details."),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#structured-logging","aria-label":"structured logging permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"structured-logging","aria-hidden":""})),"Structured Logging"),Object(i.b)("p",null,"Nomad 0.9.0 switches to structured logging. Any log processing on the pre-0.9\nlog output will need to be updated to match the structured output."),Object(i.b)("p",null,"Structured log lines have the format:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{}),"# <Timestamp> [<Level>] <Component>: <Message>: <KeyN>=<ValueN> ...\n\n2019-01-29T05:52:09.221Z [INFO ] client.plugin: starting plugin manager: plugin-type=device\n")),Object(i.b)("p",null,"Values containing whitespace will be quoted:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{}),'... starting plugin: task=redis args="[/opt/gopath/bin/nomad logmon]"\n')),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#hcl2-transition","aria-label":"hcl2 transition permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"hcl2-transition","aria-hidden":""})),"HCL2 Transition"),Object(i.b)("p",null,"Nomad 0.9.0 begins a transition to ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/hashicorp/hcl2"}),"HCL2"),", the next version of the\nHashiCorp configuration language. While Nomad has begun integrating HCL2,\nusers will need to continue to use HCL1 in Nomad 0.9.0 as the transition is\nincomplete."),Object(i.b)("p",null,"If you interpolate variables in your ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/job-specification/task#config"}),Object(i.b)("inlineCode",{parentName:"a"},"task.config"))," containing\nconsecutive dots in their name, you will need to change your job specification\nto use the ",Object(i.b)("inlineCode",{parentName:"p"},"env")," map. See the following example:"),Object(i.b)("pre",{className:"language-hcl"},Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-hcl"}),Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"env")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"# Note the multiple consecutive dots"),"\n  ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"image...version")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"3.2"'),"\n\n  ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"# Valid in both v0.8 and v0.9"),"\n  ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"image.version")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"3.2"'),"\n",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"# v0.8 task config stanza:"),"\n",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"task")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"driver")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"docker"'),"\n  ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"config")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"image")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"redis:',Object(i.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation"}),Object(i.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"$"),Object(i.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"{"),"image",Object(i.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"."),Object(i.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"."),Object(i.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"."),"version",Object(i.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"}")),'"'),"\n  ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"# v0.9 task config stanza:"),"\n",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"task")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"driver")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"docker"'),"\n  ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"config")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"image")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"redis:',Object(i.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation"}),Object(i.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"$"),Object(i.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"{"),"env",Object(i.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"["),Object(i.b)("span",Object(n.a)({parentName:"span"},{className:"token string"}),'"image...version"'),Object(i.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"]"),Object(i.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"}")),'"'),"\n  ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(i.b)("p",null,"This only affects users who interpolate unusual variables with multiple\nconsecutive dots in their task ",Object(i.b)("inlineCode",{parentName:"p"},"config")," stanza. All other interpolation is\nunchanged."),Object(i.b)("p",null,"Since HCL2 uses dotted object notation for interpolation users should\ntransition away from variable names with multiple consecutive dots."),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#downgrading-clients","aria-label":"downgrading clients permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"downgrading-clients","aria-hidden":""})),"Downgrading clients"),Object(i.b)("p",null,"Due to the large refactor of the Nomad client in 0.9, downgrading to a\nprevious version of the client after upgrading it to Nomad 0.9 is not supported.\nTo downgrade safely, users should erase the Nomad client's data directory."),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#port_map-environment-variable-changes","aria-label":"port_map environment variable changes permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"port_map-environment-variable-changes","aria-hidden":""})),Object(i.b)("inlineCode",{parentName:"h3"},"port_map")," Environment Variable Changes"),Object(i.b)("p",null,"Before Nomad 0.9.0 ports mapped via a task driver's ",Object(i.b)("inlineCode",{parentName:"p"},"port_map")," stanza could be\ninterpolated via the ",Object(i.b)("inlineCode",{parentName:"p"},"NOMAD_PORT_<label>")," environment variables."),Object(i.b)("p",null,"However, in Nomad 0.9.0 no parameters in a driver's ",Object(i.b)("inlineCode",{parentName:"p"},"config")," stanza, including\nits ",Object(i.b)("inlineCode",{parentName:"p"},"port_map"),", are available for interpolation. This means ",Object(i.b)("inlineCode",{parentName:"p"},"{{ env\nNOMAD_PORT_<label> }}")," in a ",Object(i.b)("inlineCode",{parentName:"p"},"template")," stanza or ",Object(i.b)("inlineCode",{parentName:"p"},'HTTP_PORT =\n"${NOMAD_PORT_http}"')," in an ",Object(i.b)("inlineCode",{parentName:"p"},"env")," stanza will now interpolate the ",Object(i.b)("em",{parentName:"p"},"host")," ports,\nnot the container's."),Object(i.b)("p",null,"Nomad 0.10 introduced Task Group Networking which natively supports port\nmapping without relying on task driver specific ",Object(i.b)("inlineCode",{parentName:"p"},"port_map")," fields. The\n",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/job-specification/network/#to"}),Object(i.b)("inlineCode",{parentName:"a"},"to"))," field on group network port stanzas\nwill be interpolated properly. Please see the\n",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/job-specification/network/"}),Object(i.b)("inlineCode",{parentName:"a"},"network"))," stanza documentation for details."),Object(i.b)("h2",{className:"g-type-display-3"},Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#nomad-0-8-0","aria-label":"nomad 0 8 0 permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"nomad-0-8-0","aria-hidden":""})),"Nomad 0.8.0"),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#raft-protocol-version-compatibility","aria-label":"raft protocol version compatibility permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"raft-protocol-version-compatibility","aria-hidden":""})),"Raft Protocol Version Compatibility"),Object(i.b)("p",null,"When upgrading to Nomad 0.8.0 from a version lower than 0.7.0, users will need\nto set the\n",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/configuration/server#raft_protocol"}),Object(i.b)("inlineCode",{parentName:"a"},"raft_protocol"))," option\nin their ",Object(i.b)("inlineCode",{parentName:"p"},"server")," stanza to 1 in order to maintain backwards compatibility with\nthe old servers during the upgrade. After the servers have been migrated to\nversion 0.8.0, ",Object(i.b)("inlineCode",{parentName:"p"},"raft_protocol")," can be moved up to 2 and the servers restarted\nto match the default."),Object(i.b)("p",null,"The Raft protocol must be stepped up in this way; only adjacent version numbers are\ncompatible (for example, version 1 cannot talk to version 3). Here is a table of the\nRaft Protocol versions supported by each Nomad version:"),Object(i.b)("table",null,Object(i.b)("thead",null,Object(i.b)("tr",null,Object(i.b)("th",null,"Version"),Object(i.b)("th",null,"Supported Raft Protocols"))),Object(i.b)("tbody",null,Object(i.b)("tr",null,Object(i.b)("td",null,"0.6 and earlier"),Object(i.b)("td",null,"0")),Object(i.b)("tr",null,Object(i.b)("td",null,"0.7"),Object(i.b)("td",null,"1")),Object(i.b)("tr",null,Object(i.b)("td",null,"0.8 and later"),Object(i.b)("td",null,"1, 2, 3")))),Object(i.b)("p",null,"In order to enable all ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://learn.hashicorp.com/nomad/operating-nomad/autopilot"}),"Autopilot")," features, all servers\nin a Nomad cluster must be running with Raft protocol version 3 or later."),Object(i.b)("h4",{className:"g-type-display-5"},Object(i.b)("a",Object(n.a)({parentName:"h4"},{className:"__permalink-h",href:"#upgrading-to-raft-protocol-3","aria-label":"upgrading to raft protocol 3 permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h4"},{className:"__target-h",id:"upgrading-to-raft-protocol-3","aria-hidden":""})),"Upgrading to Raft Protocol 3"),Object(i.b)("p",null,"This section provides details on upgrading to Raft Protocol 3 in Nomad 0.8 and higher. Raft protocol version 3 requires Nomad running 0.8.0 or newer on all servers in order to work. See ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/upgrade/upgrade-specific#raft-protocol-version-compatibility"}),"Raft Protocol Version Compatibility")," for more details. Also the format of ",Object(i.b)("inlineCode",{parentName:"p"},"peers.json")," used for outage recovery is different when running with the latest Raft protocol. See ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://learn.hashicorp.com/nomad/operating-nomad/outage#manual-recovery-using-peersjson"}),"Manual Recovery Using peers.json")," for a description of the required format."),Object(i.b)("p",null,"Please note that the Raft protocol is different from Nomad's internal protocol as shown in commands like ",Object(i.b)("inlineCode",{parentName:"p"},"nomad server members"),". To see the version of the Raft protocol in use on each server, use the ",Object(i.b)("inlineCode",{parentName:"p"},"nomad operator raft list-peers")," command."),Object(i.b)("p",null,"The easiest way to upgrade servers is to have each server leave the cluster, upgrade its ",Object(i.b)("inlineCode",{parentName:"p"},"raft_protocol")," version in the ",Object(i.b)("inlineCode",{parentName:"p"},"server")," stanza, and then add it back. Make sure the new server joins successfully and that the cluster is stable before rolling the upgrade forward to the next server. It's also possible to stand up a new set of servers, and then slowly stand down each of the older servers in a similar fashion."),Object(i.b)("p",null,"When using Raft protocol version 3, servers are identified by their ",Object(i.b)("inlineCode",{parentName:"p"},"node-id")," instead of their IP address when Nomad makes changes to its internal Raft quorum configuration. This means that once a cluster has been upgraded with servers all running Raft protocol version 3, it will no longer allow servers running any older Raft protocol versions to be added. If running a single Nomad server, restarting it in-place will result in that server not being able to elect itself as a leader. To avoid this, either set the Raft protocol back to 2, or use ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://learn.hashicorp.com/nomad/operating-nomad/outage#manual-recovery-using-peersjson"}),"Manual Recovery Using peers.json")," to map the server to its node ID in the Raft quorum configuration."),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#node-draining-improvements","aria-label":"node draining improvements permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"node-draining-improvements","aria-hidden":""})),"Node Draining Improvements"),Object(i.b)("p",null,"Node draining via the ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/commands/node/drain"}),Object(i.b)("inlineCode",{parentName:"a"},"node drain"))," command or the ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/api-docs/nodes#drain-node"}),"drain\nAPI")," has been substantially changed in Nomad 0.8. In Nomad 0.7.1 and\nearlier draining a node would immediately stop all allocations on the node\nbeing drained. Nomad 0.8 now supports a ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/job-specification/migrate"}),Object(i.b)("inlineCode",{parentName:"a"},"migrate"))," stanza in job\nspecifications to control how many allocations may be migrated at once and the\ndefault will be used for existing jobs."),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"drain")," command now blocks until the drain completes. To get the Nomad\n0.7.1 and earlier drain behavior use the command: ",Object(i.b)("inlineCode",{parentName:"p"},"nomad node drain -enable -force -detach <node-id>")),Object(i.b)("p",null,"See the ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/job-specification/migrate"}),Object(i.b)("inlineCode",{parentName:"a"},"migrate")," stanza documentation")," and ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://learn.hashicorp.com/nomad/operating-nomad/node-draining"}),"Decommissioning Nodes\nguide")," for details."),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#periods-in-environment-variable-names-no-longer-escaped","aria-label":"periods in environment variable names no longer escaped permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"periods-in-environment-variable-names-no-longer-escaped","aria-hidden":""})),"Periods in Environment Variable Names No Longer Escaped"),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Applications which expect periods in environment variable names to be replaced\nwith underscores must be updated.")),Object(i.b)("p",null,"In Nomad 0.7 periods (",Object(i.b)("inlineCode",{parentName:"p"},"."),") in environment variables names were replaced with an\nunderscore in both the ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/job-specification/env"}),Object(i.b)("inlineCode",{parentName:"a"},"env"))," and\n",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/job-specification/template"}),Object(i.b)("inlineCode",{parentName:"a"},"template"))," stanzas."),Object(i.b)("p",null,"In Nomad 0.8 periods are ",Object(i.b)("em",{parentName:"p"},"not")," replaced and will be included in environment\nvariables verbatim."),Object(i.b)("p",null,"For example the following stanza:"),Object(i.b)("pre",{className:"language-text"},Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),'env {\n  registry.consul.addr = "${NOMAD_IP_http}:8500"\n}\n')),Object(i.b)("p",null,"In Nomad 0.7 would be exposed to the task as\n",Object(i.b)("inlineCode",{parentName:"p"},"registry_consul_addr=127.0.0.1:8500"),". In Nomad 0.8 it will now appear exactly\nas specified: ",Object(i.b)("inlineCode",{parentName:"p"},"registry.consul.addr=127.0.0.1:8500"),"."),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#client-apis-unavailable-on-older-nodes","aria-label":"client apis unavailable on older nodes permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"client-apis-unavailable-on-older-nodes","aria-hidden":""})),"Client APIs Unavailable on Older Nodes"),Object(i.b)("p",null,"Because Nomad 0.8 uses a new RPC mechanism to route node-specific APIs like\n",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/commands/alloc/fs"}),Object(i.b)("inlineCode",{parentName:"a"},"nomad alloc fs"))," through servers to the node,\n0.8 CLIs are incompatible using these commands on clients older than 0.8."),Object(i.b)("p",null,"To access these commands on older clients either continue to use a pre-0.8\nversion of the CLI, or upgrade all clients to 0.8."),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#cli-command-changes","aria-label":"cli command changes permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"cli-command-changes","aria-hidden":""})),"CLI Command Changes"),Object(i.b)("p",null,"Nomad 0.8 has changed the organization of CLI commands to be based on\nsubcommands. An example of this change is the change from ",Object(i.b)("inlineCode",{parentName:"p"},"nomad alloc-status"),"\nto ",Object(i.b)("inlineCode",{parentName:"p"},"nomad alloc status"),". All commands have been made to be backwards compatible,\nbut operators should update any usage of the old style commands to the new style\nas the old style will be deprecated in future versions of Nomad."),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#rpc-advertise-address","aria-label":"rpc advertise address permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"rpc-advertise-address","aria-hidden":""})),"RPC Advertise Address"),Object(i.b)("p",null,"The behavior of the ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/configuration#rpc-1"}),"advertised RPC\naddress")," has changed to be only used\nto advertise the RPC address of servers to client nodes. Server to server\ncommunication is done using the advertised Serf address. Existing cluster's\nshould not be effected but the advertised RPC address may need to be updated to\nallow connecting client's over a NAT."),Object(i.b)("h2",{className:"g-type-display-3"},Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#nomad-0-6-0","aria-label":"nomad 0 6 0 permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"nomad-0-6-0","aria-hidden":""})),"Nomad 0.6.0"),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#default-advertise-address-changes","aria-label":"default advertise address changes permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"default-advertise-address-changes","aria-hidden":""})),"Default ",Object(i.b)("inlineCode",{parentName:"h3"},"advertise")," address changes"),Object(i.b)("p",null,"When no ",Object(i.b)("inlineCode",{parentName:"p"},"advertise")," address was specified and Nomad's ",Object(i.b)("inlineCode",{parentName:"p"},"bind_addr")," was loopback\nor ",Object(i.b)("inlineCode",{parentName:"p"},"0.0.0.0"),", Nomad attempted to resolve the local hostname to use as an\nadvertise address."),Object(i.b)("p",null,"Many hosts cannot properly resolve their hostname, so Nomad 0.6 defaults\n",Object(i.b)("inlineCode",{parentName:"p"},"advertise")," to the first private IP on the host (e.g. ",Object(i.b)("inlineCode",{parentName:"p"},"10.1.2.3"),")."),Object(i.b)("p",null,"If you manually configure ",Object(i.b)("inlineCode",{parentName:"p"},"advertise")," addresses no changes are necessary."),Object(i.b)("h2",{className:"g-type-display-3"},Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#nomad-clients","aria-label":"nomad clients permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"nomad-clients","aria-hidden":""})),"Nomad Clients"),Object(i.b)("p",null,"The change to the default, advertised IP also effect clients that do not specify\nwhich network_interface to use. If you have several routable IPs, it is advised\nto configure the client's ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/configuration/client#network_interface"}),"network\ninterface"),"\nsuch that tasks bind to the correct address."),Object(i.b)("h2",{className:"g-type-display-3"},Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#nomad-0-5-5","aria-label":"nomad 0 5 5 permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"nomad-0-5-5","aria-hidden":""})),"Nomad 0.5.5"),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#docker-load-changes","aria-label":"docker load changes permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"docker-load-changes","aria-hidden":""})),"Docker ",Object(i.b)("inlineCode",{parentName:"h3"},"load")," changes"),Object(i.b)("p",null,"Nomad 0.5.5 has a backward incompatible change in the ",Object(i.b)("inlineCode",{parentName:"p"},"docker")," driver's\nconfiguration. Prior to 0.5.5 the ",Object(i.b)("inlineCode",{parentName:"p"},"load")," configuration option accepted a list\nimages to load, in 0.5.5 it has been changed to a single string. No\nfunctionality was changed. Even if more than one item was specified prior to\n0.5.5 only the first item was used."),Object(i.b)("p",null,"To do a zero-downtime deploy with jobs that use the ",Object(i.b)("inlineCode",{parentName:"p"},"load")," option:"),Object(i.b)("ul",null,Object(i.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(i.b)("p",{parentName:"li"},"Upgrade servers to version 0.5.5 or later.")),Object(i.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(i.b)("p",{parentName:"li"},"Deploy new client nodes on the same version as the servers.")),Object(i.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(i.b)("p",{parentName:"li"},"Resubmit jobs with the ",Object(i.b)("inlineCode",{parentName:"p"},"load")," option fixed and a constraint to only run on\nversion 0.5.5 or later:"))),Object(i.b)("pre",{className:"language-hcl"},Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-hcl"}),"    ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"constraint")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"attribute")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"',Object(i.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation"}),Object(i.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"$"),Object(i.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"{"),"attr",Object(i.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"."),"nomad",Object(i.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"."),"version",Object(i.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"}")),'"'),"\n      ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"operator"),"  ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"version"'),"\n      ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"value"),"     ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'">= 0.5.5"'),"\n    ",Object(i.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(i.b)("ul",null,Object(i.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),"Drain and shutdown old client nodes.")),Object(i.b)("h3",{className:"g-type-display-4"},Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#validation-changes","aria-label":"validation changes permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"validation-changes","aria-hidden":""})),"Validation changes"),Object(i.b)("p",null,"Due to internal job serialization and validation changes you may run into\nissues using 0.5.5 command line tools such as ",Object(i.b)("inlineCode",{parentName:"p"},"nomad run")," and ",Object(i.b)("inlineCode",{parentName:"p"},"nomad validate"),"\nwith 0.5.4 or earlier agents."),Object(i.b)("p",null,"It is recommended you upgrade agents before or alongside your command line\ntools."),Object(i.b)("h2",{className:"g-type-display-3"},Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#nomad-0-4-0","aria-label":"nomad 0 4 0 permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"nomad-0-4-0","aria-hidden":""})),"Nomad 0.4.0"),Object(i.b)("p",null,"Nomad 0.4.0 has backward incompatible changes in the logic for Consul\nderegistration. When a Task which was started by Nomad v0.3.x is uncleanly shut\ndown, the Nomad 0.4 Client will no longer clean up any stale services. If an\nin-place upgrade of the Nomad client to 0.4 prevents the Task from gracefully\nshutting down and deregistering its Consul-registered services, the Nomad Client\nwill not clean up the remaining Consul services registered with the 0.3\nExecutor."),Object(i.b)("p",null,"We recommend draining a node before upgrading to 0.4.0 and then re-enabling the\nnode once the upgrade is complete."),Object(i.b)("h2",{className:"g-type-display-3"},Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#nomad-0-3-1","aria-label":"nomad 0 3 1 permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"nomad-0-3-1","aria-hidden":""})),"Nomad 0.3.1"),Object(i.b)("p",null,"Nomad 0.3.1 removes artifact downloading from driver configurations and places them as\na first class element of the task. As such, jobs will have to be rewritten in\nthe proper format and resubmitted to Nomad. Nomad clients will properly\nre-attach to existing tasks but job definitions must be updated before they can\nbe dispatched to clients running 0.3.1."),Object(i.b)("h2",{className:"g-type-display-3"},Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#nomad-0-3-0","aria-label":"nomad 0 3 0 permalink"}),"\xbb"),Object(i.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"nomad-0-3-0","aria-hidden":""})),"Nomad 0.3.0"),Object(i.b)("p",null,"Nomad 0.3.0 has made several substantial changes to job files included a new\n",Object(i.b)("inlineCode",{parentName:"p"},"log")," block and variable interpretation syntax (",Object(i.b)("inlineCode",{parentName:"p"},"${var}"),"), a modified ",Object(i.b)("inlineCode",{parentName:"p"},"restart"),"\npolicy syntax, and minimum resources for tasks as well as validation. These\nchanges require a slight change to the default upgrade flow."),Object(i.b)("p",null,"After upgrading the version of the servers, all previously submitted jobs must\nbe resubmitted with the updated job syntax using a Nomad 0.3.0 binary."),Object(i.b)("ul",null,Object(i.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(i.b)("p",{parentName:"li"},"All instances of ",Object(i.b)("inlineCode",{parentName:"p"},"$var")," must be converted to the new syntax of ",Object(i.b)("inlineCode",{parentName:"p"},"${var}"))),Object(i.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(i.b)("p",{parentName:"li"},"All tasks must provide their required resources for CPU, memory and disk as\nwell as required network usage if ports are required by the task.")),Object(i.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(i.b)("p",{parentName:"li"},"Restart policies must be updated to indicate whether it is desired for the\ntask to restart on failure or to fail using ",Object(i.b)("inlineCode",{parentName:"p"},'mode = "delay"')," or ",Object(i.b)("inlineCode",{parentName:"p"},'mode = "fail"')," respectively.")),Object(i.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(i.b)("p",{parentName:"li"},"Service names that include periods will fail validation. To fix, remove any\nperiods from the service name before running the job."))),Object(i.b)("p",null,"After updating the Servers and job files, Nomad Clients can be upgraded by first\ndraining the node so no tasks are running on it. This can be verified by running\n",Object(i.b)("inlineCode",{parentName:"p"},"nomad node status <node-id>")," and verify there are no tasks in the ",Object(i.b)("inlineCode",{parentName:"p"},"running"),"\nstate. Once that is done the client can be killed, the ",Object(i.b)("inlineCode",{parentName:"p"},"data_dir")," should be\ndeleted and then Nomad 0.3.0 can be launched."))}p.isMDXComponent=!0}},[["R4pV",0,1,2,4,3,5,6]]]);