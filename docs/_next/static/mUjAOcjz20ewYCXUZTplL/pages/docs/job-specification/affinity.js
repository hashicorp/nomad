(window.webpackJsonp=window.webpackJsonp||[]).push([[223],{"E+Q3":function(e,a,t){"use strict";t.r(a),t.d(a,"default",(function(){return j}));var n,c=t("wx14"),s=t("Ff2n"),b=t("q1tI"),p=t.n(b),o=t("7ljp"),r=t("j1un"),i=(p.a.createElement,n="Placement",function(e){return console.warn("Component "+n+" was not imported, exported, or provided by MDXProvider as global scope"),Object(o.b)("div",e)}),m={},l=Object(r.a)({layout:"docs",page_title:"affinity Stanza - Job Specification",sidebar_title:"affinity",description:'The "affinity" stanza allows restricting the set of eligible nodes.\nAffinities may filter on attributes or metadata. Additionally affinities may\nbe specified at the job, group, or task levels for ultimate flexibility.',__resourcePath:"docs/job-specification/affinity.mdx",__scans:{}});function j(e){var a=e.components,t=Object(s.a)(e,["components"]);return Object(o.b)(l,Object(c.a)({},m,t,{components:a,mdxType:"MDXLayout"}),Object(o.b)("h1",{className:"g-type-display-2"},Object(o.b)("a",Object(c.a)({parentName:"h1"},{className:"__permalink-h",href:"#affinity-stanza","aria-label":"affinity stanza permalink"}),"\xbb"),Object(o.b)("a",Object(c.a)({parentName:"h1"},{className:"__target-h",id:"affinity-stanza","aria-hidden":""})),Object(o.b)("inlineCode",{parentName:"h1"},"affinity")," Stanza"),Object(o.b)(i,{groups:[["job","affinity"],["job","group","affinity"],["job","group","task","affinity"]],mdxType:"Placement"}),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"affinity")," stanza allows operators to express placement preference for a set of nodes. Affinities may\nbe expressed on ",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/runtime/interpolation",title:"Nomad interpolation"}),"attributes")," or ",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/configuration/client#meta",title:"Nomad meta Job Specification"}),"client metadata"),".\nAdditionally affinities may be specified at the ",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/job-specification/job",title:"Nomad job Job Specification"}),"job"),", ",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/job-specification/group",title:"Nomad group Job Specification"}),"group"),", or\n",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/job-specification/task",title:"Nomad task Job Specification"}),"task")," levels for ultimate flexibility."),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),"job ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"docs"')," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token comment"}),"# Prefer nodes in the us-west1 datacenter"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"affinity")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"attribute")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"',Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token interpolation"}),Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"$"),Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"{"),"node",Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"."),"datacenter",Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"}")),'"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"value"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"us-west1"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"weight"),"    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"100"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n  group ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"example"')," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token comment"}),'# Prefer the "r1" rack'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"affinity")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"attribute"),"  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"',Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token interpolation"}),Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"$"),Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"{"),"meta",Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"."),"rack",Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"}")),'"'),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"value"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"r1"'),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"weight"),"    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"50"),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n    task ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"server"')," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token comment"}),'# Prefer nodes where "my_custom_value" is greater than 5'),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"affinity")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"attribute")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"',Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token interpolation"}),Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"$"),Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"{"),"meta",Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"."),"my_custom_value",Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"}")),'"'),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"operator"),"  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'">"'),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"value"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"3"'),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"weight"),"    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"50"),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("p",null,"Affinities apply to task groups but may be specified within job and task stanzas as well.\nJob affinities apply to all groups within the job. Task affinities apply to the whole task group\nthat the task is a part of."),Object(o.b)("p",null,"Nomad will use affinities when computing scores for placement. Nodes that match affinities will\nhave their scores boosted. Affinity scores are combined with other scoring factors such as bin packing.\nOperators can use weights to express relative preference across multiple affinities. If no nodes match a given affinity,\nplacement is still successful. This is different from ",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/job-specification/constraint",title:"Nomad Constraint job Specification"}),"constraints")," where placement is\nrestricted only to nodes that meet the constraint's criteria."),Object(o.b)("h2",{className:"g-type-display-3"},Object(o.b)("a",Object(c.a)({parentName:"h2"},{className:"__permalink-h",href:"#affinity-parameters","aria-label":"affinity parameters permalink"}),"\xbb"),Object(o.b)("a",Object(c.a)({parentName:"h2"},{className:"__target-h",id:"affinity-parameters","aria-hidden":""})),Object(o.b)("inlineCode",{parentName:"h2"},"affinity")," Parameters"),Object(o.b)("ul",null,Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"attribute",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#attribute","aria-label":"attribute permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"attribute"))," ",Object(o.b)("inlineCode",{parentName:"p"},'(string: "")')," - Specifies the name or reference of the attribute\nto examine for the affinity. This can be any of the ",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/runtime/interpolation#interpreted_node_vars"}),"Nomad interpolated\nvalues"),".")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"operator",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#operator","aria-label":"operator permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"operator"))," ",Object(o.b)("inlineCode",{parentName:"p"},'(string: "=")')," - Specifies the comparison operator. The ordering is\ncompared lexically. Possible values include:"),Object(o.b)("pre",Object(c.a)({parentName:"li"},{className:"language-text"}),Object(o.b)("code",Object(c.a)({parentName:"pre"},{className:"language-text"}),"=\n!=\n>\n>=\n<\n<=\nregexp\nset_contains_all\nset_contains_any\nversion\n")),Object(o.b)("p",{parentName:"li"},"For a detailed explanation of these values and their behavior, please see\nthe ",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#operator-values"}),"operator values section"),".")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"value",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#value","aria-label":"value permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"value"))," ",Object(o.b)("inlineCode",{parentName:"p"},'(string: "")')," - Specifies the value to compare the attribute against\nusing the specified operation. This can be a literal value, another attribute,\nor any ",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/runtime/interpolation#interpreted_node_vars"}),"Nomad interpolated\nvalues"),".")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"weight",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#weight","aria-label":"weight permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"weight"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(integer: 50)")," - Specifies a weight for the affinity. The weight is used\nduring scoring and must be an integer between -100 to 100. Negative weights act as\nanti affinities, causing nodes that match them to be scored lower. Weights can be used\nwhen there is more than one affinity to express relative preference across them."))),Object(o.b)("h3",{className:"g-type-display-4"},Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#operator-values","aria-label":"operator values permalink"}),"\xbb"),Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"operator-values","aria-hidden":""})),Object(o.b)("inlineCode",{parentName:"h3"},"operator")," Values"),Object(o.b)("p",null,'This section details the specific values for the "operator" parameter in the\nNomad job specification for affinities. The operator is always specified as a\nstring, but the string can take on different values which change the behavior of\nthe overall affinity evaluation.'),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"affinity")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"operator")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"..."'),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("ul",null,Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"regexp",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#regexp","aria-label":"regexp permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},'"regexp"'))," - Specifies a regular expression affinity against the attribute.\nThe syntax of the regular expressions accepted is the same general syntax used\nby Perl, Python, and many other languages. More precisely, it is the syntax\naccepted by RE2 and described at in the ",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"https://golang.org/s/re2syntax"}),"Google RE2\nsyntax"),"."),Object(o.b)("pre",Object(c.a)({parentName:"li"},{className:"language-hcl"}),Object(o.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"affinity")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"attribute")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"..."'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"operator"),"  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"regexp"'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"value"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"[a-z0-9]"'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"weight"),"    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"50"),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n"))),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"set_contains_all",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#set_contains_all","aria-label":"set_contains_all permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},'"set_contains_all"'))," - Specifies a contains affinity against the attribute. The\nattribute and the list being checked are split using commas. This will check\nthat the given attribute contains ",Object(o.b)("strong",{parentName:"p"},"all")," of the specified elements."),Object(o.b)("pre",Object(c.a)({parentName:"li"},{className:"language-hcl"}),Object(o.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"affinity")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"attribute")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"..."'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"operator"),"  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"set_contains"'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"value"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"a,b,c"'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"weight"),"    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"50"),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n"))),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"set_contains",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#set_contains","aria-label":"set_contains permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},'"set_contains"'))," - Same as ",Object(o.b)("inlineCode",{parentName:"p"},"set_contains_all"))),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"set_contains_any",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#set_contains_any","aria-label":"set_contains_any permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},'"set_contains_any"'))," - Specifies a contains affinity against the attribute. The\nattribute and the list being checked are split using commas. This will check\nthat the given attribute contains ",Object(o.b)("strong",{parentName:"p"},"any")," of the specified elements."),Object(o.b)("pre",Object(c.a)({parentName:"li"},{className:"language-hcl"}),Object(o.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"affinity")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"attribute")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"..."'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"operator"),"  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"set_contains"'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"value"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"a,b,c"'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"weight"),"    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"50"),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n"))),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"version",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#version","aria-label":"version permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},'"version"'))," - Specifies a version affinity against the attribute. This\nsupports a comma-separated list of values, including the pessimistic\noperator. For more examples please see the ",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"https://github.com/hashicorp/go-version"}),"go-version\nrepository")," for more specific\nexamples."),Object(o.b)("pre",Object(c.a)({parentName:"li"},{className:"language-hcl"}),Object(o.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"affinity")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"attribute")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"..."'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"operator"),"  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"version"'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"value"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'">= 0.1.0, < 0.2"'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"weight"),"    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"50"),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")))),Object(o.b)("h2",{className:"g-type-display-3"},Object(o.b)("a",Object(c.a)({parentName:"h2"},{className:"__permalink-h",href:"#affinity-examples","aria-label":"affinity examples permalink"}),"\xbb"),Object(o.b)("a",Object(c.a)({parentName:"h2"},{className:"__target-h",id:"affinity-examples","aria-hidden":""})),Object(o.b)("inlineCode",{parentName:"h2"},"affinity")," Examples"),Object(o.b)("p",null,"The following examples only show the ",Object(o.b)("inlineCode",{parentName:"p"},"affinity")," stanzas. Remember that the\n",Object(o.b)("inlineCode",{parentName:"p"},"affinity")," stanza is only valid in the placements listed above."),Object(o.b)("h3",{className:"g-type-display-4"},Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#kernel-data","aria-label":"kernel data permalink"}),"\xbb"),Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"kernel-data","aria-hidden":""})),"Kernel Data"),Object(o.b)("p",null,'This example adds a preference for running on nodes which have a kernel version\nhigher than "3.19".'),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"affinity")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"attribute")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"',Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token interpolation"}),Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"$"),Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"{"),"attr",Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"."),"kernel",Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"."),"version",Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"}")),'"'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"operator"),"  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"version"'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"value"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"> 3.19"'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"weight"),"    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"50"),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("h3",{className:"g-type-display-4"},Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#operating-systems","aria-label":"operating systems permalink"}),"\xbb"),Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"operating-systems","aria-hidden":""})),"Operating Systems"),Object(o.b)("p",null,"This example adds a preference to running on nodes that are running Ubuntu\n14.04"),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"affinity")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"attribute")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"',Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token interpolation"}),Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"$"),Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"{"),"attr",Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"."),"os",Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"."),"name",Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"}")),'"'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"value"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"ubuntu"'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"weight"),"    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"50"),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"affinity")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"attribute")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"',Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token interpolation"}),Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"$"),Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"{"),"attr",Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"."),"os",Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"."),"version",Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"}")),'"'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"value"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"14.04"'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"weight"),"    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"100"),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("h3",{className:"g-type-display-4"},Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#meta-data","aria-label":"meta data permalink"}),"\xbb"),Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"meta-data","aria-hidden":""})),"Meta Data"),Object(o.b)("p",null,"The following example adds a preference to running on nodes with specific rack metadata"),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"affinity")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"attribute")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"',Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token interpolation"}),Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"$"),Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"{"),"meta",Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"."),"rack",Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"}")),'"'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"value"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"rack1"'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"weight"),"    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"50"),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("p",null,"The following example adds a preference to running on nodes in a specific datacenter."),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"affinity")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"attribute")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"',Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token interpolation"}),Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"$"),Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"{"),"node",Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"."),"datacenter",Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"}")),'"'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"value"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"us-west1"'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"weight"),"    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"50"),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("h3",{className:"g-type-display-4"},Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#cloud-metadata","aria-label":"cloud metadata permalink"}),"\xbb"),Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"cloud-metadata","aria-hidden":""})),"Cloud Metadata"),Object(o.b)("p",null,"When possible, Nomad populates node attributes from the cloud environment. These\nvalues are accessible as filters in affinities. This example adds a preference to run this\ntask on nodes that are memory-optimized on AWS."),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"affinity")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"attribute")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"',Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token interpolation"}),Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"$"),Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"{"),"attr",Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"."),"platform",Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"."),"aws",Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"."),"instance-type",Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"}")),'"'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"value"),"     ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"m4.xlarge"'),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"weight"),"    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"50"),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("h3",{className:"g-type-display-4"},Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#placement-details","aria-label":"placement details permalink"}),"\xbb"),Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"placement-details","aria-hidden":""})),"Placement Details"),Object(o.b)("p",null,"Operators can run ",Object(o.b)("inlineCode",{parentName:"p"},"nomad alloc status -verbose")," to get more detailed information on various\nfactors, including affinities that affect the final placement."),Object(o.b)("h4",{className:"g-type-display-5"},Object(o.b)("a",Object(c.a)({parentName:"h4"},{className:"__permalink-h",href:"#example-placement-metadata","aria-label":"example placement metadata permalink"}),"\xbb"),Object(o.b)("a",Object(c.a)({parentName:"h4"},{className:"__target-h",id:"example-placement-metadata","aria-hidden":""})),"Example Placement Metadata"),Object(o.b)("p",null,"The following is a snippet from the CLI output of ",Object(o.b)("inlineCode",{parentName:"p"},"nomad alloc status -verbose <alloc-id>")," showing scoring metadata."),Object(o.b)("pre",{className:"language-text"},Object(o.b)("code",Object(c.a)({parentName:"pre"},{className:"language-text"}),"Placement Metrics\nNode                                  binpack  job-anti-affinity  node-reschedule-penalty  node-affinity  final score\n30bd48cc-d760-1096-9bab-13caac424af5  0.225    -0.6               0                        1              0.208\nf2aa8b59-96b8-202f-2258-d98c93e360ab  0.225    -0.6               0                        1              0.208\n86df0f74-15cc-3a0e-23f0-ad7306131e0d  0.0806   0                  0                        0              0.0806\n7d6c2e9e-b080-5995-8b9d-ef1695458b52  0.0806   0                  0                        0              0.0806\n")),Object(o.b)("p",null,"The placement score is affected by the following factors."),Object(o.b)("ul",null,Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"bin-packing",className:"__target-lic","aria-hidden":""})),Object(o.b)("a",Object(c.a)({parentName:"li"},{href:"#bin-packing","aria-label":"bin packing permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"bin-packing"))," - Scores nodes according to how well they fit requirements. Optimizes for using minimal number of nodes."),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"job-anti-affinity",className:"__target-lic","aria-hidden":""})),Object(o.b)("a",Object(c.a)({parentName:"li"},{href:"#job-anti-affinity","aria-label":"job anti affinity permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"job-anti-affinity"))," - A penalty added for additional instances of the same job on a node, used to avoid having too many instances\nof a job on the same node."),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"node-reschedule-penalty",className:"__target-lic","aria-hidden":""})),Object(o.b)("a",Object(c.a)({parentName:"li"},{href:"#node-reschedule-penalty","aria-label":"node reschedule penalty permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"node-reschedule-penalty"))," - Used when the job is being rescheduled. Nomad adds a penalty to avoid placing the job on a node where\nit has failed to run before."),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"node-affinity",className:"__target-lic","aria-hidden":""})),Object(o.b)("a",Object(c.a)({parentName:"li"},{href:"#node-affinity","aria-label":"node affinity permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"node-affinity"))," - Used when the criteria specified in the ",Object(o.b)("inlineCode",{parentName:"li"},"affinity")," stanza matches the node.")))}j.isMDXComponent=!0},HER5:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/job-specification/affinity",function(){return t("E+Q3")}])}},[["HER5",0,1,2,4,3,5,6]]]);