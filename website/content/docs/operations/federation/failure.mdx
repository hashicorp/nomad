---
layout: docs
page_title: Federated Cluster Failure Scenarios
description: Failure scenarios in multi-region federated cluster deployments.
---

# Failure Scenarios

When running Nomad in federated mode, failure situations and impacts are different depending on
whether the authoritative region is the impacted region or not, and what the failure mode is. In
soft failures, the region's servers have lost quorum but the Nomad processes are still up, running,
and reachable. In hard failures, the regional servers are completely unreachable and are akin to
the underlying hardware having been terminated (cloud) or powered-off (on-prem).

The scenarios are based on a Nomad deployment which is running with three federated regions named
`asia-south-1`, `europe-west-1`, and `us-east-1`. The region `europe-west-1` is authoritative.

## Federated Region Failure: Soft
In this situation the region `asia-south-1` has lost leadership but the servers are reachable and
up.

All server logs in the impacted region will have entries such as:
```console
2024-10-30T14:34:50.262Z [ERROR] nomad/worker.go:504: worker: failed to dequeue evaluation: worker_id=d19e6bb5-5ec9-8f75-9caf-47e2513fe28d error="No cluster leader"
```

‚úÖ Request forwarding will continue to work between all federated regions that are running with
  leadership.

üü® API requests, either directly or attempting to use request forwarding to the impacted region,
  will fail unless using the `stale=true` flag.

‚úÖ Creation and deletion of replicated objects, such as namespaces, will be written to the
  authoritative region.

‚úÖ Any federated regions with leadership will be able to continue to replicate all objects detailed
  above.

‚úÖ Creation of local ACL tokens will continue to work for all regions with leadership.

‚úÖ Jobs **without** the [`multiregion`][] block will be deployable to all regions with leadership.

‚ùå Jobs **with** the [`multiregion`][] block defined will fail to deploy.

## Federated Region Failure: Hard
In this situation the region `asia-south-1` has gone down. When this happens, the Nomad server logs
for the other regions will have log entries similar to those below:
```console
2024-10-30T10:22:49.673Z [DEBUG] go-hclog@v1.6.3/stdlog.go:58: nomad: memberlist: Failed UDP ping: asia-south-1-server-1.asia-south-1 (timeout reached)
2024-10-30T10:22:51.673Z [INFO]  go-hclog@v1.6.3/stdlog.go:60: nomad: memberlist: Suspect asia-south-1-server-1.asia-south-1 has failed, no acks received
2024-10-30T10:22:59.618Z [DEBUG] go-hclog@v1.6.3/stdlog.go:58: nomad: memberlist: Initiating push/pull sync with: us-east-1-server-1.us-east-1 192.168.1.193:9002
2024-10-30T10:22:59.674Z [DEBUG] go-hclog@v1.6.3/stdlog.go:58: nomad: memberlist: Failed UDP ping: asia-south-1-server-1.asia-south-1 (timeout reached)
2024-10-30T10:23:01.673Z [INFO]  go-hclog@v1.6.3/stdlog.go:60: nomad: memberlist: Suspect asia-south-1-server-1.asia-south-1 has failed, no acks received
```

‚úÖ Request forwarding will continue to work between all federated regions that are running with
  leadership.

‚ùå API requests, either directly or attempting to use request forwarding to the impacted region,
  will fail.

‚úÖ Creation and deletion of replicated objects, such as namespaces, will be written to the
  authoritative region.

‚úÖ Any federated regions with leadership will be able to continue to replicate all objects detailed
  above.

‚úÖ Creation of local ACL tokens will continue to work for all regions which are running with
  leadership.

‚úÖ Jobs **without** the [`multiregion`][] block will be deployable to all regions with leadership.

‚ùå Jobs **with** the [`multiregion`][] block defined will fail to deploy.

## Authoritative Region Failure: Soft
In this situation the region `europe-west-1` has lost leadership but the servers are reachable and
up.

The server logs in the authoritative region will have entries such as:
```console
2024-10-30T14:42:30.370Z [ERROR] nomad/worker.go:504: worker: failed to dequeue evaluation: worker_id=68b3abe2-5e16-8f04-be5a-f76aebb0e59e error="No cluster leader"
```

‚úÖ Request forwarding will continue to work between all federated regions that are running with
  leadership.

üü® API requests, either directly or attempting to use request forwarding to the impacted region,
  will fail unless using the `stale=true` flag.

‚ùå Creation and deletion of replicated objects, such as namespaces, will fail.

‚ùå Any federated regions will be able to read data to replicate as they use the stale flag, but no
  writes can occur to the authoritative region as described above.

‚úÖ Creation of local ACL tokens will continue to work for all federated regions which are running
  with leadership.

‚úÖ Jobs **without** the [`multiregion`][] block will be deployable to all federated regions which
  are running with leadership.

‚ùå Jobs **with** the [`multiregion`][] block defined will fail to deploy.

## Authoritative Region Failure: Hard
In this situation the region `europe-west-1` has gone down. When this happens, the Nomad server
leader logs for the other regions will have log entries similar to those below:
```console
2024-10-30T10:58:52.019Z [ERROR] nomad/leader.go:544: nomad: failed to fetch namespaces from authoritative region: error="rpc error: EOF"
2024-10-30T10:58:52.019Z [ERROR] nomad/leader.go:1767: nomad: failed to fetch policies from authoritative region: error="rpc error: EOF"
2024-10-30T10:58:52.019Z [ERROR] nomad/leader.go:2498: nomad: failed to fetch ACL binding rules from authoritative region: error="rpc error: EOF"
2024-10-30T10:58:52.019Z [ERROR] nomad/leader_ent.go:226: nomad: failed to fetch quota specifications from authoritative region: error="rpc error: EOF"
2024-10-30T10:58:52.019Z [ERROR] nomad/leader.go:703: nomad: failed to fetch node pools from authoritative region: error="rpc error: EOF"
2024-10-30T10:58:52.019Z [ERROR] nomad/leader.go:1909: nomad: failed to fetch tokens from authoritative region: error="rpc error: EOF"
2024-10-30T10:58:52.019Z [ERROR] nomad/leader.go:2083: nomad: failed to fetch ACL Roles from authoritative region: error="rpc error: EOF"
2024-10-30T10:58:52.019Z [DEBUG] nomad/leader_ent.go:84: nomad: failed to fetch policies from authoritative region: error="rpc error: EOF"
2024-10-30T10:58:52.019Z [ERROR] nomad/leader.go:2292: nomad: failed to fetch ACL auth-methods from authoritative region: error="rpc error: EOF"
2024-10-30T10:58:57.391Z [DEBUG] go-hclog@v1.6.3/stdlog.go:58: nomad: memberlist: Failed UDP ping: europe-west-1-server-1.europe-west-1 (timeout reached)
2024-10-30T10:58:59.390Z [INFO]  go-hclog@v1.6.3/stdlog.go:60: nomad: memberlist: Suspect europe-west-1-server-1.europe-west-1 has failed, no acks received
2024-10-30T10:59:02.391Z [DEBUG] go-hclog@v1.6.3/stdlog.go:58: nomad: memberlist: Failed UDP ping: europe-west-1-server-1.europe-west-1 (timeout reached)
```

‚úÖ Request forwarding will continue to work between all federated regions that are running with
  leadership.

‚ùå API requests, either directly or attempting to use request forwarding to the impacted region,
  will fail.

‚ùå Creation and deletion of replicated objects, such as namespaces, will fail.

‚ùå Any federated regions with leadership will not be able to replicate objects detailed in the logs
  above.

‚úÖ Creation of local ACL tokens will continue to work for all regions with leadership.

‚úÖ Jobs **without** the [`multiregion`][] block will be deployable to regions with leadership.

‚ùå Jobs **with** the [`multiregion`][] block defined will fail to deploy.

[`multiregion`]: /nomad/docs/job-specification/multiregion
