(window.webpackJsonp=window.webpackJsonp||[]).push([[207],{KEyk:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/integrations/consul-integration",function(){return t("M8ZF")}])},M8ZF:function(e,a,t){"use strict";t.r(a),t.d(a,"default",(function(){return u}));var n=t("wx14"),o=t("Ff2n"),i=t("q1tI"),s=t.n(i),c=t("7ljp"),r=t("j1un"),l=(s.a.createElement,{}),b=Object(r.a)({layout:"docs",page_title:"Consul Integration",sidebar_title:"Consul",description:"Learn how to integrate Nomad with Consul and add service discovery to jobs",__resourcePath:"docs/integrations/consul-integration.mdx",__scans:{}});function u(e){var a=e.components,t=Object(o.a)(e,["components"]);return Object(c.b)(b,Object(n.a)({},l,t,{components:a,mdxType:"MDXLayout"}),Object(c.b)("h1",{className:"g-type-display-2"},Object(c.b)("a",Object(n.a)({parentName:"h1"},{className:"__permalink-h",href:"#consul-integration","aria-label":"consul integration permalink"}),"\xbb"),Object(c.b)("a",Object(n.a)({parentName:"h1"},{className:"__target-h",id:"consul-integration","aria-hidden":""})),"Consul Integration"),Object(c.b)("p",null,Object(c.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.consul.io/",title:"Consul by HashiCorp"}),"Consul")," is a tool for discovering and configuring services in your\ninfrastructure. Consul's key features include service discovery, health checking,\na KV store, and robust support for multi-datacenter deployments. Nomad's integration\nwith Consul enables automatic clustering, built-in service registration, and\ndynamic rendering of configuration files and environment variables. The sections\nbelow describe the integration in more detail."),Object(c.b)("h2",{className:"g-type-display-3"},Object(c.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#configuration","aria-label":"configuration permalink"}),"\xbb"),Object(c.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"configuration","aria-hidden":""})),"Configuration"),Object(c.b)("p",null,"In order to use Consul with Nomad, you will need to configure and\ninstall Consul on your nodes alongside Nomad, or schedule it as a system job.\nNomad does not currently run Consul for you."),Object(c.b)("p",null,"To enable Consul integration, please see the\n",Object(c.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/configuration/consul"}),"Nomad agent Consul integration"),"\nconfiguration."),Object(c.b)("h2",{className:"g-type-display-3"},Object(c.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#automatic-clustering-with-consul","aria-label":"automatic clustering with consul permalink"}),"\xbb"),Object(c.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"automatic-clustering-with-consul","aria-hidden":""})),"Automatic Clustering with Consul"),Object(c.b)("p",null,"Nomad servers and clients will be automatically informed of each other's\nexistence when a running Consul cluster already exists and the Consul agent is\ninstalled and configured on each host. Please see the ",Object(c.b)("a",Object(n.a)({parentName:"p"},{href:"https://learn.hashicorp.com/nomad/operating-nomad/clustering"}),"Automatic Clustering with\nConsul")," guide for more information."),Object(c.b)("h2",{className:"g-type-display-3"},Object(c.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#service-discovery","aria-label":"service discovery permalink"}),"\xbb"),Object(c.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"service-discovery","aria-hidden":""})),"Service Discovery"),Object(c.b)("p",null,"Nomad schedules workloads of various types across a cluster of generic hosts.\nBecause of this, placement is not known in advance and you will need to use\nservice discovery to connect tasks to other services deployed across your\ncluster. Nomad integrates with Consul to provide service discovery and\nmonitoring."),Object(c.b)("p",null,"To configure a job to register with service discovery, please see the\n",Object(c.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/job-specification/service",title:"Nomad service Job Specification"}),Object(c.b)("inlineCode",{parentName:"a"},"service")," job specification documentation"),"."),Object(c.b)("h2",{className:"g-type-display-3"},Object(c.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#dynamic-configuration","aria-label":"dynamic configuration permalink"}),"\xbb"),Object(c.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"dynamic-configuration","aria-hidden":""})),"Dynamic Configuration"),Object(c.b)("p",null,"Nomad's job specification includes a ",Object(c.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/job-specification/template"}),Object(c.b)("inlineCode",{parentName:"a"},"template")," stanza"),"\nthat utilizes a Consul ecosystem tool called ",Object(c.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/hashicorp/consul-template"}),"Consul Template"),". This mechanism creates a convenient way to ship configuration files\nthat are populated from environment variables, Consul data, Vault secrets, or just\ngeneral configurations within a Nomad task."),Object(c.b)("p",null,"For more information on Nomad's template stanza and how it leverages Consul Template,\nplease see the ",Object(c.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/job-specification/template"}),Object(c.b)("inlineCode",{parentName:"a"},"template")," job specification documentation"),"."),Object(c.b)("h2",{className:"g-type-display-3"},Object(c.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#assumptions","aria-label":"assumptions permalink"}),"\xbb"),Object(c.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"assumptions","aria-hidden":""})),"Assumptions"),Object(c.b)("ul",null,Object(c.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(c.b)("p",{parentName:"li"},"Consul 0.7.2 or later is needed for ",Object(c.b)("inlineCode",{parentName:"p"},"tls_skip_verify")," in HTTP checks.")),Object(c.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(c.b)("p",{parentName:"li"},"Consul 0.6.4 or later is needed for using the Script checks.")),Object(c.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(c.b)("p",{parentName:"li"},"Consul 0.6.0 or later is needed for using the TCP checks.")),Object(c.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(c.b)("p",{parentName:"li"},"The service discovery feature in Nomad depends on operators making sure that\nthe Nomad client can reach the Consul agent.")),Object(c.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(c.b)("p",{parentName:"li"},"Tasks running inside Nomad also need to reach out to the Consul agent if\nthey want to use any of the Consul APIs. Ex: A task running inside a docker\ncontainer in the bridge mode won't be able to talk to a Consul Agent running\non the loopback interface of the host since the container in the bridge mode\nhas its own network interface and doesn't see interfaces on the global\nnetwork namespace of the host. There are a couple of ways to solve this, one\nway is to run the container in the host networking mode, or make the Consul\nagent listen on an interface in the network namespace of the container."))))}u.isMDXComponent=!0}},[["KEyk",0,1,2,4,3,5,6]]]);