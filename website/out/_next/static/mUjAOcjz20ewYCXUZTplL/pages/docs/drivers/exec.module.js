(window.webpackJsonp=window.webpackJsonp||[]).push([[179],{Bsrt:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/drivers/exec",function(){return t("pjpf")}])},pjpf:function(e,a,t){"use strict";t.r(a),t.d(a,"default",(function(){return p}));var n=t("wx14"),c=t("Ff2n"),r=t("q1tI"),b=t.n(r),s=t("7ljp"),i=t("j1un"),o=(b.a.createElement,{}),l=Object(i.a)({layout:"docs",page_title:"Drivers: Exec",sidebar_title:"Isolated Fork/Exec",description:"The Exec task driver is used to run binaries using OS isolation primitives.",__resourcePath:"docs/drivers/exec.mdx",__scans:{}});function p(e){var{components:a}=e,t=Object(c.a)(e,["components"]);return Object(s.b)(l,Object(n.a)({},o,t,{components:a,mdxType:"MDXLayout"}),Object(s.b)("h1",{className:"g-type-display-2"},Object(s.b)("a",Object(n.a)({parentName:"h1"},{className:"__permalink-h",href:"#isolated-fork-exec-driver","aria-label":"isolated fork exec driver permalink"}),"\xbb"),Object(s.b)("a",Object(n.a)({parentName:"h1"},{className:"__target-h",id:"isolated-fork-exec-driver","aria-hidden":""})),"Isolated Fork/Exec Driver"),Object(s.b)("p",null,"Name: ",Object(s.b)("inlineCode",{parentName:"p"},"exec")),Object(s.b)("p",null,"The ",Object(s.b)("inlineCode",{parentName:"p"},"exec")," driver is used to simply execute a particular command for a task.\nHowever, unlike ",Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/drivers/raw_exec"}),Object(s.b)("inlineCode",{parentName:"a"},"raw_exec"))," it uses the underlying isolation\nprimitives of the operating system to limit the task's access to resources. While\nsimple, since the ",Object(s.b)("inlineCode",{parentName:"p"},"exec")," driver can invoke any command, it can be used to call\nscripts or other wrappers which provide higher level features."),Object(s.b)("h2",{className:"g-type-display-3"},Object(s.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#task-configuration","aria-label":"task configuration permalink"}),"\xbb"),Object(s.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"task-configuration","aria-hidden":""})),"Task Configuration"),Object(s.b)("pre",{className:"language-hcl"},Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-hcl"}),"task ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"webservice"')," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"driver")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"exec"'),"\n\n  ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"config")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"command")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"my-binary"'),"\n    ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"args"),"    ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"-flag"'),", ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"1"'),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n  ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(s.b)("p",null,"The ",Object(s.b)("inlineCode",{parentName:"p"},"exec")," driver supports the following configuration in the job spec:"),Object(s.b)("ul",null,Object(s.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(s.b)("a",Object(n.a)({parentName:"li"},{id:"command",className:"__target-lic","aria-hidden":""})),Object(s.b)("p",{parentName:"li"},Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"#command","aria-label":"command permalink",className:"__permalink-lic"}),Object(s.b)("inlineCode",{parentName:"a"},"command"))," - The command to execute. Must be provided. If executing a binary\nthat exists on the host, the path must be absolute and within the task's\n",Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"#chroot"}),"chroot"),". If executing a binary that is downloaded from\nan ",Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/job-specification/artifact"}),Object(s.b)("inlineCode",{parentName:"a"},"artifact")),", the path can be\nrelative from the allocations's root directory.")),Object(s.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(s.b)("a",Object(n.a)({parentName:"li"},{id:"args",className:"__target-lic","aria-hidden":""})),Object(s.b)("p",{parentName:"li"},Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"#args","aria-label":"args permalink",className:"__permalink-lic"}),Object(s.b)("inlineCode",{parentName:"a"},"args"))," - (Optional) A list of arguments to the ",Object(s.b)("inlineCode",{parentName:"p"},"command"),". References\nto environment variables or any ",Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/runtime/interpolation"}),"interpretable Nomad\nvariables")," will be interpreted before\nlaunching the task."))),Object(s.b)("h2",{className:"g-type-display-3"},Object(s.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#examples","aria-label":"examples permalink"}),"\xbb"),Object(s.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"examples","aria-hidden":""})),"Examples"),Object(s.b)("p",null,"To run a binary present on the Node:"),Object(s.b)("pre",{className:"language-hcl"},Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-hcl"}),"task ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"example"')," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"driver")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"exec"'),"\n\n  ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"config")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"# When running a binary that exists on the host, the path must be absolute."),"\n    ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"command")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"/bin/sleep"'),"\n    ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"args"),"    ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"1"'),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n  ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(s.b)("p",null,"To execute a binary downloaded from an\n",Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/job-specification/artifact"}),Object(s.b)("inlineCode",{parentName:"a"},"artifact")),":"),Object(s.b)("pre",{className:"language-hcl"},Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-hcl"}),"task ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"example"')," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"driver")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"exec"'),"\n\n  ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"config")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"command")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"name-of-my-binary"'),"\n  ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n  ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"artifact")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"source")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"https://internal.file.server/name-of-my-binary"'),"\n    ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"options")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"checksum")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"sha256:abd123445ds4555555555"'),"\n    ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(s.b)("h2",{className:"g-type-display-3"},Object(s.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#capabilities","aria-label":"capabilities permalink"}),"\xbb"),Object(s.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"capabilities","aria-hidden":""})),"Capabilities"),Object(s.b)("p",null,"The ",Object(s.b)("inlineCode",{parentName:"p"},"exec")," driver implements the following ",Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/internals/plugins/task-drivers#capabilities-capabilities-error"}),"capabilities"),"."),Object(s.b)("table",null,Object(s.b)("thead",{parentName:"table"},Object(s.b)("tr",{parentName:"thead"},Object(s.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Feature"),Object(s.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Implementation"))),Object(s.b)("tbody",{parentName:"table"},Object(s.b)("tr",{parentName:"tbody"},Object(s.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(s.b)("inlineCode",{parentName:"td"},"nomad alloc signal")),Object(s.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"true")),Object(s.b)("tr",{parentName:"tbody"},Object(s.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(s.b)("inlineCode",{parentName:"td"},"nomad alloc exec")),Object(s.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"true")),Object(s.b)("tr",{parentName:"tbody"},Object(s.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"filesystem isolation"),Object(s.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"chroot")),Object(s.b)("tr",{parentName:"tbody"},Object(s.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"network isolation"),Object(s.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"host, group")),Object(s.b)("tr",{parentName:"tbody"},Object(s.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"volume mounting"),Object(s.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"all")))),Object(s.b)("h2",{className:"g-type-display-3"},Object(s.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#client-requirements","aria-label":"client requirements permalink"}),"\xbb"),Object(s.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"client-requirements","aria-hidden":""})),"Client Requirements"),Object(s.b)("p",null,"The ",Object(s.b)("inlineCode",{parentName:"p"},"exec")," driver can only be run when on Linux and running Nomad as root.\n",Object(s.b)("inlineCode",{parentName:"p"},"exec")," is limited to this configuration because currently isolation of resources\nis only guaranteed on Linux. Further, the host must have cgroups mounted properly\nin order for the driver to work."),Object(s.b)("p",null,"If you are receiving the error:"),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{}),'* Constraint "missing drivers" filtered <> nodes\n')),Object(s.b)("p",null,"and using the exec driver, check to ensure that you are running Nomad as root.\nThis also applies for running Nomad in -dev mode."),Object(s.b)("h2",{className:"g-type-display-3"},Object(s.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#plugin-options","aria-label":"plugin options permalink"}),"\xbb"),Object(s.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"plugin-options","aria-hidden":""})),"Plugin Options"),Object(s.b)("ul",null,Object(s.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(s.b)("a",Object(n.a)({parentName:"li"},{id:"no_pivot_root",className:"__target-lic","aria-hidden":""})),Object(s.b)("a",Object(n.a)({parentName:"li"},{href:"#no_pivot_root","aria-label":"no_pivot_root permalink",className:"__permalink-lic"}),Object(s.b)("inlineCode",{parentName:"a"},"no_pivot_root"))," - Defaults to ",Object(s.b)("inlineCode",{parentName:"li"},"false"),". When ",Object(s.b)("inlineCode",{parentName:"li"},"true"),", the driver uses ",Object(s.b)("inlineCode",{parentName:"li"},"chroot"),"\nfor file system isolation without ",Object(s.b)("inlineCode",{parentName:"li"},"pivot_root"),". This is useful for systems\nwhere the root is on a ramdisk.")),Object(s.b)("h2",{className:"g-type-display-3"},Object(s.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#client-attributes","aria-label":"client attributes permalink"}),"\xbb"),Object(s.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"client-attributes","aria-hidden":""})),"Client Attributes"),Object(s.b)("p",null,"The ",Object(s.b)("inlineCode",{parentName:"p"},"exec")," driver will set the following client attributes:"),Object(s.b)("ul",null,Object(s.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(s.b)("a",Object(n.a)({parentName:"li"},{id:"driver-exec",className:"__target-lic","aria-hidden":""})),Object(s.b)("a",Object(n.a)({parentName:"li"},{href:"#driver-exec","aria-label":"driver exec permalink",className:"__permalink-lic"}),Object(s.b)("inlineCode",{parentName:"a"},"driver.exec")),' - This will be set to "1", indicating the driver is available.')),Object(s.b)("h2",{className:"g-type-display-3"},Object(s.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#resource-isolation","aria-label":"resource isolation permalink"}),"\xbb"),Object(s.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"resource-isolation","aria-hidden":""})),"Resource Isolation"),Object(s.b)("p",null,"The resource isolation provided varies by the operating system of\nthe client and the configuration."),Object(s.b)("p",null,"On Linux, Nomad will use cgroups, and a chroot to isolate the\nresources of a process and as such the Nomad agent must be run as root."),Object(s.b)("h3",{className:"g-type-display-4"},Object(s.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#chroot","aria-label":"chroot permalink"}),"\xbb"),Object(s.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"chroot","aria-hidden":""})),"Chroot"),Object(s.b)("p",null,"The chroot is populated with data in the following directories from the host\nmachine:"),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{}),'[\n  "/bin",\n  "/etc",\n  "/lib",\n  "/lib32",\n  "/lib64",\n  "/run/resolvconf",\n  "/sbin",\n  "/usr",\n]\n')),Object(s.b)("p",null,"The task's chroot is populated by linking or copying the data from the host into\nthe chroot. Note that this can take considerable disk space. Since Nomad v0.5.3,\nthe client manages garbage collection locally which mitigates any issue this may\ncreate."),Object(s.b)("p",null,"This list is configurable through the agent client\n",Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/configuration/client#chroot_env"}),"configuration file"),"."))}p.isMDXComponent=!0}},[["Bsrt",0,1,2,4,3,5,6]]]);