(window.webpackJsonp=window.webpackJsonp||[]).push([[237],{"2atv":function(e,a,t){"use strict";t.r(a),t.d(a,"default",(function(){return d}));var n,s=t("wx14"),o=t("Ff2n"),c=t("q1tI"),i=t.n(c),l=t("7ljp"),r=t("j1un"),b=(i.a.createElement,n="Placement",function(e){return console.warn("Component "+n+" was not imported, exported, or provided by MDXProvider as global scope"),Object(l.b)("div",e)}),p={},m=Object(r.a)({layout:"docs",page_title:"logs Stanza - Job Specification",sidebar_title:"logs",description:'The "logs" stanza configures the log rotation policy for a task\'s stdout and\nstderr. Logging is enabled by default with sane defaults. The "logs" stanza\nallows for finer-grained control over how Nomad handles log files.',__resourcePath:"docs/job-specification/logs.mdx",__scans:{}});function d(e){var{components:a}=e,t=Object(o.a)(e,["components"]);return Object(l.b)(m,Object(s.a)({},p,t,{components:a,mdxType:"MDXLayout"}),Object(l.b)("h1",{className:"g-type-display-2"},Object(l.b)("a",Object(s.a)({parentName:"h1"},{className:"__permalink-h",href:"#logs-stanza","aria-label":"logs stanza permalink"}),"\xbb"),Object(l.b)("a",Object(s.a)({parentName:"h1"},{className:"__target-h",id:"logs-stanza","aria-hidden":""})),Object(l.b)("inlineCode",{parentName:"h1"},"logs")," Stanza"),Object(l.b)(b,{groups:["job","group","task","logs"],mdxType:"Placement"}),Object(l.b)("p",null,"The ",Object(l.b)("inlineCode",{parentName:"p"},"logs")," stanza configures the log rotation policy for a task's ",Object(l.b)("inlineCode",{parentName:"p"},"stdout")," and\n",Object(l.b)("inlineCode",{parentName:"p"},"stderr"),". Logging is enabled by default with sane defaults (provided in the\nparameters section below), and there is currently no way to disable logging for\ntasks. The ",Object(l.b)("inlineCode",{parentName:"p"},"logs")," stanza allows for finer-grained control over how Nomad handles\nlog files."),Object(l.b)("p",null,"Nomad's log rotation works by writing stdout/stderr output from tasks to a file\ninside the ",Object(l.b)("inlineCode",{parentName:"p"},"alloc/logs/")," directory with the following format:\n",Object(l.b)("inlineCode",{parentName:"p"},"<task-name>.<stdout/stderr>.<index>"),". Output is written to a particular index,\nstarting at zero, till that log file hits the configured ",Object(l.b)("inlineCode",{parentName:"p"},"max_file_size"),". After,\na new file is created at ",Object(l.b)("inlineCode",{parentName:"p"},"index + 1")," and logs will then be written there. A log\nfile is never rolled over, instead Nomad will keep up to ",Object(l.b)("inlineCode",{parentName:"p"},"max_files")," worth of\nlogs and once that is exceeded, the log file with the lowest index is deleted."),Object(l.b)("pre",{className:"language-hcl"},Object(l.b)("code",Object(s.a)({parentName:"pre"},{className:"language-hcl"}),"job ",Object(l.b)("span",Object(s.a)({parentName:"code"},{className:"token string"}),'"docs"')," ",Object(l.b)("span",Object(s.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  group ",Object(l.b)("span",Object(s.a)({parentName:"code"},{className:"token string"}),'"example"')," ",Object(l.b)("span",Object(s.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    task ",Object(l.b)("span",Object(s.a)({parentName:"code"},{className:"token string"}),'"server"')," ",Object(l.b)("span",Object(s.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(l.b)("span",Object(s.a)({parentName:"code"},{className:"token keyword"}),"logs")," ",Object(l.b)("span",Object(s.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(l.b)("span",Object(s.a)({parentName:"code"},{className:"token property"}),"max_files"),"     ",Object(l.b)("span",Object(s.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(s.a)({parentName:"code"},{className:"token number"}),"10"),"\n        ",Object(l.b)("span",Object(s.a)({parentName:"code"},{className:"token property"}),"max_file_size")," ",Object(l.b)("span",Object(s.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(s.a)({parentName:"code"},{className:"token number"}),"10"),"\n      ",Object(l.b)("span",Object(s.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(l.b)("span",Object(s.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(l.b)("span",Object(s.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(l.b)("span",Object(s.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(l.b)("p",null,"For information on how to interact with logs after they have been configured,\nplease see the ",Object(l.b)("a",Object(s.a)({parentName:"p"},{href:"/docs/commands/alloc/logs",title:"Nomad logs command"}),Object(l.b)("inlineCode",{parentName:"a"},"nomad alloc logs"))," command."),Object(l.b)("h2",{className:"g-type-display-3"},Object(l.b)("a",Object(s.a)({parentName:"h2"},{className:"__permalink-h",href:"#logs-parameters","aria-label":"logs parameters permalink"}),"\xbb"),Object(l.b)("a",Object(s.a)({parentName:"h2"},{className:"__target-h",id:"logs-parameters","aria-hidden":""})),Object(l.b)("inlineCode",{parentName:"h2"},"logs")," Parameters"),Object(l.b)("ul",null,Object(l.b)("li",Object(s.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(s.a)({parentName:"li"},{id:"max_files",className:"__target-lic","aria-hidden":""})),Object(l.b)("p",{parentName:"li"},Object(l.b)("a",Object(s.a)({parentName:"p"},{href:"#max_files","aria-label":"max_files permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"max_files"))," ",Object(l.b)("inlineCode",{parentName:"p"},"(int: 10)")," - Specifies the maximum number of rotated files Nomad\nwill retain for ",Object(l.b)("inlineCode",{parentName:"p"},"stdout")," and ",Object(l.b)("inlineCode",{parentName:"p"},"stderr"),". Each stream is tracked individually, so\nspecifying a value of 2 will create 4 files - 2 for stdout and 2 for stderr")),Object(l.b)("li",Object(s.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(s.a)({parentName:"li"},{id:"max_file_size",className:"__target-lic","aria-hidden":""})),Object(l.b)("p",{parentName:"li"},Object(l.b)("a",Object(s.a)({parentName:"p"},{href:"#max_file_size","aria-label":"max_file_size permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"max_file_size"))," ",Object(l.b)("inlineCode",{parentName:"p"},"(int: 10)")," - Specifies the maximum size of each rotated file\nin ",Object(l.b)("inlineCode",{parentName:"p"},"MB"),". If the amount of disk resource requested for the task is less than\nthe total amount of disk space needed to retain the rotated set of files,\nNomad will return a validation error when a job is submitted."))),Object(l.b)("h2",{className:"g-type-display-3"},Object(l.b)("a",Object(s.a)({parentName:"h2"},{className:"__permalink-h",href:"#logs-examples","aria-label":"logs examples permalink"}),"\xbb"),Object(l.b)("a",Object(s.a)({parentName:"h2"},{className:"__target-h",id:"logs-examples","aria-hidden":""})),Object(l.b)("inlineCode",{parentName:"h2"},"logs")," Examples"),Object(l.b)("p",null,"The following examples only show the ",Object(l.b)("inlineCode",{parentName:"p"},"logs")," stanzas. Remember that the\n",Object(l.b)("inlineCode",{parentName:"p"},"logs")," stanza is only valid in the placements listed above."),Object(l.b)("h3",{className:"g-type-display-4"},Object(l.b)("a",Object(s.a)({parentName:"h3"},{className:"__permalink-h",href:"#configure-defaults","aria-label":"configure defaults permalink"}),"\xbb"),Object(l.b)("a",Object(s.a)({parentName:"h3"},{className:"__target-h",id:"configure-defaults","aria-hidden":""})),"Configure Defaults"),Object(l.b)("p",null,"This example shows a default logging configuration. Yes, it is empty on purpose.\nNomad automatically enables logging with sane defaults as described in the\nparameters section above."),Object(l.b)("pre",{className:"language-hcl"},Object(l.b)("code",Object(s.a)({parentName:"pre"},{className:"language-hcl"}))),Object(l.b)("h3",{className:"g-type-display-4"},Object(l.b)("a",Object(s.a)({parentName:"h3"},{className:"__permalink-h",href:"#customization","aria-label":"customization permalink"}),"\xbb"),Object(l.b)("a",Object(s.a)({parentName:"h3"},{className:"__target-h",id:"customization","aria-hidden":""})),"Customization"),Object(l.b)("p",null,"This example asks Nomad to retain 3 rotated files for each of ",Object(l.b)("inlineCode",{parentName:"p"},"stderr")," and\n",Object(l.b)("inlineCode",{parentName:"p"},"stdout"),", each a maximum size of 5 MB per file. The minimum disk space this\nwould require is 30 MB (3 ",Object(l.b)("inlineCode",{parentName:"p"},"stderr")," ","+"," 3 ",Object(l.b)("inlineCode",{parentName:"p"},"stdout")," ","\xd7"," 5 MB ","="," 30 MB)."),Object(l.b)("pre",{className:"language-hcl"},Object(l.b)("code",Object(s.a)({parentName:"pre"},{className:"language-hcl"}),Object(l.b)("span",Object(s.a)({parentName:"code"},{className:"token keyword"}),"logs")," ",Object(l.b)("span",Object(s.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(l.b)("span",Object(s.a)({parentName:"code"},{className:"token property"}),"max_files"),"     ",Object(l.b)("span",Object(s.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(s.a)({parentName:"code"},{className:"token number"}),"3"),"\n  ",Object(l.b)("span",Object(s.a)({parentName:"code"},{className:"token property"}),"max_file_size")," ",Object(l.b)("span",Object(s.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(s.a)({parentName:"code"},{className:"token number"}),"5"),"\n",Object(l.b)("span",Object(s.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")))}d.isMDXComponent=!0},DnaE:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/job-specification/logs",function(){return t("2atv")}])}},[["DnaE",0,1,2,4,3,5,6]]]);