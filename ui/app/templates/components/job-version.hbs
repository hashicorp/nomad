{{!
  Copyright (c) HashiCorp, Inc.
  SPDX-License-Identifier: BUSL-1.1
~}}

<section class="job-version">
  {{#if this.version.taggedVersion}}
    <div class="timeline-tag">
      <span class="tag-name">
        {{!-- {{x-icon "tag" class="tag-icon"}} --}}
        {{this.version.taggedVersion.name}}
      </span>
      <span class="tag-description" title={{this.version.taggedVersion.description}}>
          {{this.version.taggedVersion.description}}
      </span>
    </div>
  {{/if}}

  <div class="boxed-section {{if this.version.taggedVersion "tagged"}}">
    <header class="boxed-section-head is-light inline-definitions">
      Version #{{this.version.number}}
      <span class="bumper-left pair is-faded">
        <span class="term">Stable</span>
        <span class="badge is-light is-faded" data-test-version-stability><code>{{this.version.stable}}</code></span>
      </span>
      <span class="pair is-faded">
        <span class="term">Submitted</span>
        <span data-test-version-submit-time class="submit-date">{{format-ts this.version.submitTime}}</span>
      </span>
      <div class="pull-right">
        {{#if this.version.diff}}
          <Hds::Button
            class="is-light is-small"
            @size="small"
            @text="{{if this.isOpen "Hide" "See"}} {{this.changeCount}} {{pluralize "Change" this.changeCount}}"
            @color="tertiary"
            @icon={{if this.isOpen "chevron-up" "chevron-down"}}
            @iconPosition="trailing"
            {{on "click" (action "toggleDiff")}}
          />
        {{else}}
          <div class="is-fixed-width is-size-7 has-text-centered">No Changes</div>
        {{/if}}
      </div>
    </header>
    {{#if this.isOpen}}
      <div class="boxed-section-body is-dark">
        <JobDiff @diff={{this.version.diff}} @verbose={{this.verbose}} />
      </div>
    {{/if}}
    <footer class="boxed-section-foot">
      <div class="tag-options">
        {{#if this.version.taggedVersion}}
          <Hds::Button @text="Edit Tag" @color="secondary" @size="small" @icon="tag" @iconPosition="leading" @isInline={{true}} />
        {{else}}
          <Hds::Button @text="Tag this version" @color="secondary" @size="small" @icon="tag" @iconPosition="leading" @isInline={{true}} />
        {{/if}}
      </div>
      <div class="version-options">
      {{#unless this.isCurrent}}
        {{#if (can "run job" namespace=this.version.job.namespace)}}
          <TwoStepButton
            data-test-revert-to
            @classes={{hash
              idleButton="is-warning is-outlined"
              confirmButton="is-warning"}}
            {{!-- @alignRight={{true}} --}}
            @idleText="Revert Version"
            @cancelText="Cancel"
            @confirmText="Yes, Revert Version"
            @confirmationMessage="Are you sure you want to revert to this version?"
            @inlineText={{true}}
            @size="small"
            @awaitingConfirmation={{this.revertTo.isRunning}}
            @onConfirm={{perform this.revertTo}} />
        {{else}}
          <Hds::Button
            data-test-revert-to
            class="is-fixed-width"
            disabled
            @size="small"
            @color="secondary"
            @isInline={{true}}
            @text="Revert"
            title="You donâ€™t have permission to revert"
          />
        {{/if}}
      {{/unless}}
      </div>
    </footer>
  </div>
</section>
