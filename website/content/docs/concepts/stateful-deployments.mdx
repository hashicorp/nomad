---
layout: docs
page_title: Stateful Deployments
description: |-
  Learn how Nomad handles Stateful Deployments.
---

# Stateful Deployments

Nomad Stateful Deployments allow users to effectively bind their jobs to host
[volumes]. On a lower level, this means taking Nomad's basic unit of workload
placement—the [allocation]—and making it possible for users to have allocations
that are ["sticky"] to volume IDs.

<Note>
Stateful Deployments support only Host Volumes. For CSI Volumes, we have <a
href="/nomad/docs/job-specification/volume#per_alloc">per_alloc</a> property
that serves a similar purpose.
</Note>

Stateful Deployments work on a per-task-group basis, that is, each task group
can indicate that a host volume it requires must be "sticky." This is done by
setting the parameter in the jobspec:

```hcl
job "app" {
  group "example" {
    # ...
    volume "example" {
      type      = "host"
      source    = "ca-certificates"
      read_only = true
      sticky    = true
    }
    # ...
  }
}
```

If a volume is set to be sticky, during the deployment the scheduler adds its
ID to the allocation that uses it. Stateful deployments require that any
allocation that has the new VolumeID field set will only be (re)scheduled on
nodes that have this Volume ID attached.

Allocations that need to be rescheduled due to a destructive update will only
ever be rescheduled on a node that has the host volume ID they used before.
Scaling jobs with sticky volumes up results in more volume IDs claimed by the
task group, but scaling jobs down does not delete unused volumes, nor does it
touch the data present on them.

If the scheduler cannot find a node that has the right volume ID present
(perhaps because the node is down or disconnected), the allocation will be
stopped and the job will remain in `pending` status until it's either stopped
by the user or a feasible node is found.

## Task group host volume claims

Nomad uses its state store to save associations of host volume IDs and their
task groups, as well as job IDs, volume names, and namespaces. Use the API to
[list] and [delete] these associations. If you delete a task group host volume
claim, Nomad assigns a different volume ID to the task group, assuming the old
volume ID is unavailable and another feasible host volume with matching name is.
However, after placement, Nomad once again records the claim in its state store.
You should only use claim deletions in operational emergency situations or while
debugging problems with nodes. For example, use claim deletions in situations
where you want to drain a node with a stateful deployment on it, but do not want
to stop the job.

[allocation]: /nomad/docs/glossary#allocation
[delete]: /nomad/api-docs/volumes#delete-task-group-host-volume-claims
[list]: /nomad/api-docs/volumes#list-task-group-host-volume-claims
["sticky"]: /nomad/docs/job-specification/volume#sticky
[volumes]: /nomad/docs/other-specifications/volume
