(window.webpackJsonp=window.webpackJsonp||[]).push([[225],{b2Kw:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/job-specification/connect",function(){return t("u9PB")}])},u9PB:function(e,a,t){"use strict";t.r(a),t.d(a,"default",(function(){return i}));var n,c=t("wx14"),s=t("Ff2n"),o=t("q1tI"),b=t.n(o),p=t("7ljp"),r=t("j1un"),m=(b.a.createElement,n="Placement",function(e){return console.warn("Component "+n+" was not imported, exported, or provided by MDXProvider as global scope"),Object(p.b)("div",e)}),j={},O=Object(r.a)({layout:"docs",page_title:"connect Stanza - Job Specification",sidebar_title:"connect",description:'The "connect" stanza allows specifying options for Consul Connect integration',__resourcePath:"docs/job-specification/connect.mdx",__scans:{}});function i(e){var{components:a}=e,t=Object(s.a)(e,["components"]);return Object(p.b)(O,Object(c.a)({},j,t,{components:a,mdxType:"MDXLayout"}),Object(p.b)("h1",{className:"g-type-display-2"},Object(p.b)("a",Object(c.a)({parentName:"h1"},{className:"__permalink-h",href:"#connect-stanza","aria-label":"connect stanza permalink"}),"\xbb"),Object(p.b)("a",Object(c.a)({parentName:"h1"},{className:"__target-h",id:"connect-stanza","aria-hidden":""})),Object(p.b)("inlineCode",{parentName:"h1"},"connect")," Stanza"),Object(p.b)(m,{groups:["job","group","service","connect"],mdxType:"Placement"}),Object(p.b)("p",null,"The ",Object(p.b)("inlineCode",{parentName:"p"},"connect")," stanza allows configuring various options for\n",Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/integrations/consul-connect"}),"Consul Connect"),". It is\nvalid only within the context of a service definition at the task group\nlevel. For using ",Object(p.b)("inlineCode",{parentName:"p"},"connect")," when Consul ACLs are enabled, be sure to read through\nthe ",Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"https://learn.hashicorp.com/nomad/consul-integration/nomad-connect-acl"}),"Secure Nomad Jobs with Consul Connect"),"\nguide."),Object(p.b)("pre",{className:"language-hcl"},Object(p.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),"job ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"countdash"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"datacenters")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"dc1"'),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n\n  group ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"api"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"network")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"mode")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"bridge"'),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"service")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"name")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"count-api"'),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"port")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"9001"'),"\n\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"connect")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"sidecar_service")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n    task ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"web"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"driver")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"docker"'),"\n\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"config")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"image")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"hashicorpnomad/counter-api:v2"'),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(p.b)("h2",{className:"g-type-display-3"},Object(p.b)("a",Object(c.a)({parentName:"h2"},{className:"__permalink-h",href:"#connect-parameters","aria-label":"connect parameters permalink"}),"\xbb"),Object(p.b)("a",Object(c.a)({parentName:"h2"},{className:"__target-h",id:"connect-parameters","aria-hidden":""})),Object(p.b)("inlineCode",{parentName:"h2"},"connect")," Parameters"),Object(p.b)("ul",null,Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"native",className:"__target-lic","aria-hidden":""})),Object(p.b)("p",{parentName:"li"},Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"#native","aria-label":"native permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},"native"))," - ",Object(p.b)("inlineCode",{parentName:"p"},"(bool: false)")," - This is used to configure the service as supporting\n",Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"https://www.consul.io/docs/connect/native"}),"Connect Native")," applications. If set,\nthe service definition must provide the name of the implementing task in the\n",Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/job-specification/service#task-1",title:"Nomad service task"}),"task")," field.\nIncompatible with ",Object(p.b)("inlineCode",{parentName:"p"},"sidecar_service")," and ",Object(p.b)("inlineCode",{parentName:"p"},"sidecar_task"),".")),Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"sidecar_service",className:"__target-lic","aria-hidden":""})),Object(p.b)("p",{parentName:"li"},Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"#sidecar_service","aria-label":"sidecar_service permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},"sidecar_service"))," - ",Object(p.b)("code",null,"(",Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/job-specification/sidecar_service",title:"Nomad sidecar service Specification"}),"sidecar_service"),": nil)")," - This is used to configure the sidecar\nservice injected by Nomad for Consul Connect. Incompatible with ",Object(p.b)("inlineCode",{parentName:"p"},"native"),".")),Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"sidecar_task",className:"__target-lic","aria-hidden":""})),Object(p.b)("p",{parentName:"li"},Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"#sidecar_task","aria-label":"sidecar_task permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},"sidecar_task"))," - ",Object(p.b)("code",null,"(",Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/job-specification/sidecar_task",title:"Nomad sidecar task config Specification"}),"sidecar_task"),":nil)")," - This modifies the configuration of the Envoy\nproxy task. Incompatible with ",Object(p.b)("inlineCode",{parentName:"p"},"native"),"."))),Object(p.b)("h2",{className:"g-type-display-3"},Object(p.b)("a",Object(c.a)({parentName:"h2"},{className:"__permalink-h",href:"#connect-examples","aria-label":"connect examples permalink"}),"\xbb"),Object(p.b)("a",Object(c.a)({parentName:"h2"},{className:"__target-h",id:"connect-examples","aria-hidden":""})),Object(p.b)("inlineCode",{parentName:"h2"},"connect")," Examples"),Object(p.b)("h3",{className:"g-type-display-4"},Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#using-sidecar-service","aria-label":"using sidecar service permalink"}),"\xbb"),Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"using-sidecar-service","aria-hidden":""})),"Using Sidecar Service"),Object(p.b)("p",null,"The following example is a minimal connect stanza with defaults and is\nsufficient to start an Envoy proxy sidecar for allowing incoming connections\nvia Consul Connect."),Object(p.b)("pre",{className:"language-hcl"},Object(p.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),"  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"connect")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"sidecar_service")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(p.b)("p",null,"The following example includes specifying ",Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/job-specification/upstreams",title:"Nomad sidecar service upstreams Specification"}),Object(p.b)("inlineCode",{parentName:"a"},"upstreams")),"."),Object(p.b)("pre",{className:"language-hcl"},Object(p.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),"  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"connect")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n     ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"sidecar_service")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n       ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"proxy")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n         ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"upstreams")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n           ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"destination_name")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"count-api"'),"\n           ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"local_bind_port")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"8080"),"\n         ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n       ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n     ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(p.b)("p",null,"The following is the complete ",Object(p.b)("inlineCode",{parentName:"p"},"countdash")," example. It includes an API service\nand a frontend Dashboard service which connects to the API service as a Connect\nupstream. Once running, the dashboard is accessible at ",Object(p.b)("inlineCode",{parentName:"p"},"localhost:9002"),"."),Object(p.b)("pre",{className:"language-hcl"},Object(p.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),"job ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"countdash"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"datacenters")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"dc1"'),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n\n  group ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"api"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"network")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"mode")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"bridge"'),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"service")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"name")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"count-api"'),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"port")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"9001"'),"\n\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"connect")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"sidecar_service")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"check")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"expose"),"   ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token boolean"}),"true"),"\n        ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"type"),"     ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"http"'),"\n        ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"name"),"     ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"api-health"'),"\n        ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"path"),"     ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"/health"'),"\n        ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"interval")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"10s"'),"\n        ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"timeout"),"  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"3s"'),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n    task ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"web"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"driver")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"docker"'),"\n\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"config")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"image")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"hashicorpnomad/counter-api:v2"'),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n  group ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"dashboard"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"network")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"mode")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"bridge"'),"\n\n      port ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"http"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"static")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"9002"),"\n        ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"to"),"     ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"9002"),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"service")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"name")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"count-dashboard"'),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"port")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"9002"'),"\n\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"connect")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"sidecar_service")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n          ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"proxy")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n            ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"upstreams")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n              ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"destination_name")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"count-api"'),"\n              ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"local_bind_port"),"  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"8080"),"\n            ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n          ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n        ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n    task ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"dashboard"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"driver")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"docker"'),"\n\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"env")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"COUNTING_SERVICE_URL")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"http://',Object(p.b)("span",Object(c.a)({parentName:"span"},{className:"token interpolation"}),Object(p.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"$"),Object(p.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"{"),"NOMAD_UPSTREAM_ADDR_count_api",Object(p.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"}")),'"'),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"config")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"image")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"hashicorpnomad/counter-dashboard:v2"'),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(p.b)("h3",{className:"g-type-display-4"},Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#using-connect-native","aria-label":"using connect native permalink"}),"\xbb"),Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"using-connect-native","aria-hidden":""})),"Using Connect Native"),Object(p.b)("p",null,"The following example is a minimal service stanza for a\n",Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"https://www.consul.io/docs/connect/native"}),"Consul Connect Native"),"\napplication implemented by a task named ",Object(p.b)("inlineCode",{parentName:"p"},"generate"),"."),Object(p.b)("pre",{className:"language-hcl"},Object(p.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"service")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"name")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"uuid-api"'),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"port")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"',Object(p.b)("span",Object(c.a)({parentName:"span"},{className:"token interpolation"}),Object(p.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"$"),Object(p.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"{"),"NOMAD_PORT_api",Object(p.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"}")),'"'),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"task")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"generate"'),"\n\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"connect")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"native")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token boolean"}),"true"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(p.b)("h3",{className:"g-type-display-4"},Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#limitations","aria-label":"limitations permalink"}),"\xbb"),Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"limitations","aria-hidden":""})),"Limitations"),Object(p.b)("p",null,Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/runtime/interpolation",title:"Nomad interpolation"}),"Nomad variable interpolation")," is ",Object(p.b)("em",{parentName:"p"},"not")," yet supported (",Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"https://github.com/hashicorp/nomad/issues/7221"}),"gh-7221"),")."))}i.isMDXComponent=!0}},[["b2Kw",0,1,2,4,3,5,6]]]);