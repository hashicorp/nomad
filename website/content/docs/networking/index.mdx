---
layout: docs
page_title: Networking
description: |-
  Learn about Nomad's runtime environment variables, interpolation, caveats,
  and more.
---

# Networking

Nomad is a workload orchestrator and so it focuses on the scheduling aspects of
a deployment, touching areas such as networking as little as possible.

**Networking in Nomad is usually done via _configuration_ instead of
_infrastructure_**. This means that Nomad provides you ways of accessing the
information you need to connect your workloads instead of running additional
components that are often hidden and hard to debug and troubleshoot.

This can be confusing at first since it is quite a different approach from what
you may find in other tools. This section explains how networking works in
Nomad, some of the different patterns and configuration you are likely to find
and use, and how Nomad differs from other tools.

## Allocation networking

The base unit of scheduling in Nomad is an [allocation], which means that all
tasks run in the same client and share common resources, such as disk and
networking.

Allocations can request access to network resources, such as ports, using the
[`network`][jobspec_network] block. At its simplest configuration, a `network`
block defines something like this:

```hcl
job "..." {
  # ...
  group "..." {
    network {
      port "http" {}
    }
    # ...
  }
}
```

Nomad reserves a random port from the client between [`min_dynamic_port`] and
[`max_dynamic_port`] that is not being used and assigns it to the allocation.
The selected port number can be accessed by tasks using the
[`NOMAD_PORT_<label>`][runtime_environment] environment variable to bind and
expose the workload at the client's IP address and the given port.

The specific configuration process depends on what is being executed, but it is
usually done using a configuration file rendered from a [`template`] or passed
directly via command line arguments:

```hcl
job "..." {
  # ...
  group "..." {
    network {
      port "http" {}
    }

    task "..." {
      # ...
      config {
        args = [
          "--port=${NOMAD_PORT_http}",
        ]
      }
    }
  }
}
```

It is also possible to request a specific port number, instead of a random one,
by setting a [`static`] value for the `port`. **This should only be used by
specialized workloads**, such as load balancers and system jobs, since it can
be hard to manage them to avoid scheduling collisions at scale.

With the task listening at one of the client's ports, other processes can
access it directly using the client's IP and port, but first they need to find
out what these values are. This process is called [service discovery].

## Bridge network mode

Linux clients support a network [`mode`][network_mode] called [`bridge`]. A
bridge network acts like a virtual network switch allowing allocations
connected to the bridge to reach each other while isolating them from processes
not connected to the bridge.

When a Nomad agent starts in a Linux system it creates a bridge network called
`nomad` (or the value set in [`bridge_network_name`]) using the [`bridge` CNI
plugin][cni_bridge]. Allocations that use the `bridge` network mode run in an
isolated network namespace and are connected to this bridge.

This allows Nomad to map random host ports to specific port numbers that are
expected by the task. For example, an HTTP server that listens on port `3000`
by default can be configured with the following `network` block:

```hcl
job "..." {
  # ...
  group "..." {
    network {
      port "http" {
        to = 3000
      }
    }
    # ...
  }
}
```

Nomad still reserves a random port from the client, but this port is mapped to
the value expected by the application, and so no extra configuration is
required.

## Networking with Docker

The Docker daemon manages its own network configuration and creates its own
[bridge network][docker_bridge], network namespaces, and [`iptable`
rules][docker_iptables].

Tasks using the `docker` task driver will connect to the Docker bridge and be
placed in the network namespace managed by Docker


## Comparing with other tools

### Docker and Docker Compose

### Docker Swarm

### Kubernetes

[`bridge_network_name`]: /docs/configuration/client#bridge_network_name
[`bridge`]: /docs/job-specification/network#bridge
[`max_dynamic_port`]: /docs/configuration/client#max_dynamic_port
[`min_dynamic_port`]: /docs/configuration/client#min_dynamic_port
[`static`]: /docs/job-specification/network#static
[`template`]: /docs/job-specification/template#template-examples
[allocation]: /docs/concepts/architecture#allocation
[cni_bridge]: https://www.cni.dev/plugins/current/main/bridge/
[docker_bridge]: https://docs.docker.com/network/bridge/
[docker_iptables]: https://docs.docker.com/network/iptables/
[jobspec_network]: /docs/job-specification/network
[network_mode]: /docs/job-specification/network#mode
[runtime_environment]: /docs/runtime/environment
[service discovery]: /docs/networking/service-discovery
