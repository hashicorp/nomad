(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{"6QIE":function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/autoscaling/policy",function(){return t("UV9Z")}])},UV9Z:function(e,a,t){"use strict";t.r(a),t.d(a,"default",(function(){return p}));var n=t("wx14"),c=t("Ff2n"),i=t("q1tI"),b=t.n(i),l=t("7ljp"),o=t("j1un"),r=(b.a.createElement,{}),s=Object(o.a)({layout:"docs",page_title:"Scaling Policies",sidebar_title:"Policy",description:"Scaling policies describe the target resource desired state and how to perform calculations to ensure the current state reaches the desired.\n",__resourcePath:"docs/autoscaling/policy.mdx",__scans:{}});function p(e){var{components:a}=e,t=Object(c.a)(e,["components"]);return Object(l.b)(s,Object(n.a)({},r,t,{components:a,mdxType:"MDXLayout"}),Object(l.b)("h1",{className:"g-type-display-2"},Object(l.b)("a",Object(n.a)({parentName:"h1"},{className:"__permalink-h",href:"#nomad-autoscaler-scaling-policies","aria-label":"nomad autoscaler scaling policies permalink"}),"\xbb"),Object(l.b)("a",Object(n.a)({parentName:"h1"},{className:"__target-h",id:"nomad-autoscaler-scaling-policies","aria-hidden":""})),"Nomad Autoscaler Scaling Policies"),Object(l.b)("p",null,"Nomad Autoscaler scaling policies can be configured via the\n",Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/job-specification/scaling"}),"task group ",Object(l.b)("inlineCode",{parentName:"a"},"scaling")," stanza")," or by configuration\nfiles stored on disk."),Object(l.b)("h2",{className:"g-type-display-3"},Object(l.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#top-level-options","aria-label":"top level options permalink"}),"\xbb"),Object(l.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"top-level-options","aria-hidden":""})),"Top Level Options"),Object(l.b)("ul",null,Object(l.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(n.a)({parentName:"li"},{id:"enabled",className:"__target-lic","aria-hidden":""})),Object(l.b)("p",{parentName:"li"},Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"#enabled","aria-label":"enabled permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"enabled"))," - A boolean flag that allows operators to administratively disable a\npolicy from active evaluation.")),Object(l.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(n.a)({parentName:"li"},{id:"min",className:"__target-lic","aria-hidden":""})),Object(l.b)("p",{parentName:"li"},Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"#min","aria-label":"min permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"min"))," - The minimum running count of the targeted resource. This can be 0 or any\npositive integer.")),Object(l.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(n.a)({parentName:"li"},{id:"max",className:"__target-lic","aria-hidden":""})),Object(l.b)("p",{parentName:"li"},Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"#max","aria-label":"max permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"max"))," - The maximum running count of the targeted resource. This can be 0 or any\npositive integer."))),Object(l.b)("h2",{className:"g-type-display-3"},Object(l.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#policy-options","aria-label":"policy options permalink"}),"\xbb"),Object(l.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"policy-options","aria-hidden":""})),Object(l.b)("inlineCode",{parentName:"h2"},"policy")," Options"),Object(l.b)("ul",null,Object(l.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(n.a)({parentName:"li"},{id:"cooldown",className:"__target-lic","aria-hidden":""})),Object(l.b)("p",{parentName:"li"},Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"#cooldown","aria-label":"cooldown permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"cooldown"))," - A time interval after a scaling action during which no additional\nscaling will be performed on the resource. It should be provided as a duration\n(e.g.: ",Object(l.b)("inlineCode",{parentName:"p"},'"5s"'),", ",Object(l.b)("inlineCode",{parentName:"p"},'"1m"'),"). If omitted the configuration value\n",Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/autoscaling/agent#default_cooldown"}),"policy_default_cooldown")," from the agent will\nbe used.")),Object(l.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(n.a)({parentName:"li"},{id:"evaluation_interval",className:"__target-lic","aria-hidden":""})),Object(l.b)("p",{parentName:"li"},Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"#evaluation_interval","aria-label":"evaluation_interval permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"evaluation_interval"))," - Defines how often the policy is evaluated by the\nAutoscaler. It should be provided as a duration (e.g.: ",Object(l.b)("inlineCode",{parentName:"p"},'"5s"'),", ",Object(l.b)("inlineCode",{parentName:"p"},'"1m"'),"). If\nomitted the configuration value ",Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/autoscaling/agent#default_evaluation_interval"}),"default_evaluation_interval"),"\nfrom the agent will be used.")),Object(l.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(n.a)({parentName:"li"},{id:"target",className:"__target-lic","aria-hidden":""})),Object(l.b)("p",{parentName:"li"},Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"#target","aria-label":"target permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"target"))," - Defines where the autoscaling target is running. Detailed information\non the configuration options can be found on the ",Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/autoscaling/plugins/target"}),"Target Plugins"),"\npage.")),Object(l.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(n.a)({parentName:"li"},{id:"check",className:"__target-lic","aria-hidden":""})),Object(l.b)("p",{parentName:"li"},Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"#check","aria-label":"check permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"check"))," - Specifies one or more checks to be executed when determining if a\nscaling action is required."))),Object(l.b)("h2",{className:"g-type-display-3"},Object(l.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#check-options","aria-label":"check options permalink"}),"\xbb"),Object(l.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"check-options","aria-hidden":""})),Object(l.b)("inlineCode",{parentName:"h2"},"check")," Options"),Object(l.b)("ul",null,Object(l.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(n.a)({parentName:"li"},{id:"source",className:"__target-lic","aria-hidden":""})),Object(l.b)("p",{parentName:"li"},Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"#source","aria-label":"source permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"source"))," - The APM plugin that should handle the metric query. If omitted,\nthis defaults to using the Nomad APM.")),Object(l.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(n.a)({parentName:"li"},{id:"query",className:"__target-lic","aria-hidden":""})),Object(l.b)("p",{parentName:"li"},Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"#query","aria-label":"query permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"query"))," - The query to run against the specified APM. Currently this query\nshould return a single value. Detailed information on the configuration options\ncan be found on the ",Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/autoscaling/plugins/apm"}),"APM Plugins")," page.")),Object(l.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(n.a)({parentName:"li"},{id:"strategy",className:"__target-lic","aria-hidden":""})),Object(l.b)("p",{parentName:"li"},Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"#strategy","aria-label":"strategy permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"strategy"))," - The strategy to use, and it's configuration when calculating the\ndesired state based on the current count and the metric returned by the APM.\nDetailed information on the configuration options can be found on the\n",Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/autoscaling/plugins/strategy"}),"Strategy Plugins")," page."))),Object(l.b)("h3",{className:"g-type-display-4"},Object(l.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#example","aria-label":"example permalink"}),"\xbb"),Object(l.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"example","aria-hidden":""})),"Example"),Object(l.b)("p",null,"A full example of a policy document that can be written into the Nomad task group\n",Object(l.b)("inlineCode",{parentName:"p"},"scaling")," stanza or via a file within the ",Object(l.b)("inlineCode",{parentName:"p"},"policy_dir")," can be seen below."),Object(l.b)("pre",{className:"language-hcl"},Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-hcl"}),Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"min"),"     ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token number"}),"2"),"\n",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"max"),"     ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token number"}),"10"),"\n",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"enabled")," ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token boolean"}),"true"),"\n\n",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"policy")," ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"evaluation_interval")," ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"5s"'),"\n  ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"cooldown"),"            ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"1m"'),"\n\n  target ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"target"')," ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"Job"),"   ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"example"'),"\n    ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"Group")," ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"example"'),"\n  ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n  check ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"active_connections"')," ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"source")," ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"prometheus"'),"\n    ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"query"),"  ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"scalar(open_connections_example_cache)"'),"\n\n    strategy ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"target_value"')," ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"target")," ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token number"}),"10"),"\n    ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(l.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")))}p.isMDXComponent=!0}},[["6QIE",0,1,2,4,3,5,6]]]);