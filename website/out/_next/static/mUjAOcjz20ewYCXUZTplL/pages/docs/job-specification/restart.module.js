(window.webpackJsonp=window.webpackJsonp||[]).push([[247],{lnGb:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/job-specification/restart",function(){return t("toSs")}])},toSs:function(e,a,t){"use strict";t.r(a),t.d(a,"default",(function(){return j}));var n,c=t("wx14"),s=t("Ff2n"),b=t("q1tI"),r=t.n(b),p=t("7ljp"),o=t("j1un"),l=(r.a.createElement,n="Placement",function(e){return console.warn("Component "+n+" was not imported, exported, or provided by MDXProvider as global scope"),Object(p.b)("div",e)}),m={},i=Object(o.a)({layout:"docs",page_title:"restart Stanza - Job Specification",sidebar_title:"restart",description:'The "restart" stanza configures a group\'s behavior on task failure.',__resourcePath:"docs/job-specification/restart.mdx",__scans:{}});function j(e){var{components:a}=e,t=Object(s.a)(e,["components"]);return Object(p.b)(i,Object(c.a)({},m,t,{components:a,mdxType:"MDXLayout"}),Object(p.b)("h1",{className:"g-type-display-2"},Object(p.b)("a",Object(c.a)({parentName:"h1"},{className:"__permalink-h",href:"#restart-stanza","aria-label":"restart stanza permalink"}),"\xbb"),Object(p.b)("a",Object(c.a)({parentName:"h1"},{className:"__target-h",id:"restart-stanza","aria-hidden":""})),Object(p.b)("inlineCode",{parentName:"h1"},"restart")," Stanza"),Object(p.b)(l,{groups:[["job","group","restart"],["job","group","task","restart"]],mdxType:"Placement"}),Object(p.b)("p",null,"The ",Object(p.b)("inlineCode",{parentName:"p"},"restart")," stanza configures a tasks's behavior on task failure. Restarts\nhappen on the client that is running the task."),Object(p.b)("pre",{className:"language-hcl"},Object(p.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),"job ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"docs"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  group ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"example"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"restart")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"attempts")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"3"),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"delay"),"    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"30s"'),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(p.b)("p",null,"If specified at the group level, the configuration is inherited by all\ntasks in the group. If present on the task, the policy is merged with\nthe restart policy from the encapsulating task group."),Object(p.b)("p",null,"For example, assuming that the task group restart policy is: "),Object(p.b)("pre",{className:"language-hcl"},Object(p.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"restart")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"interval")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"30m"'),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"attempts")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"2"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"delay"),"    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"15s"'),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"mode"),"     ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"fail"'),"\n",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(p.b)("p",null,"and the individual task restart policy is: "),Object(p.b)("pre",{className:"language-hcl"},Object(p.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"restart")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"attempts")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"5"),"\n",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(p.b)("p",null,"then the effective restart policy for the task will be: "),Object(p.b)("pre",{className:"language-hcl"},Object(p.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"restart")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"interval")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"30m"'),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"attempts")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"5"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"delay"),"    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"15s"'),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"mode"),"     ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"fail"'),"\n",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(p.b)("h2",{className:"g-type-display-3"},Object(p.b)("a",Object(c.a)({parentName:"h2"},{className:"__permalink-h",href:"#restart-parameters","aria-label":"restart parameters permalink"}),"\xbb"),Object(p.b)("a",Object(c.a)({parentName:"h2"},{className:"__target-h",id:"restart-parameters","aria-hidden":""})),Object(p.b)("inlineCode",{parentName:"h2"},"restart")," Parameters"),Object(p.b)("ul",null,Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"attempts",className:"__target-lic","aria-hidden":""})),Object(p.b)("p",{parentName:"li"},Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"#attempts","aria-label":"attempts permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},"attempts"))," ",Object(p.b)("inlineCode",{parentName:"p"},"(int: <varies>)")," - Specifies the number of restarts allowed in the\nconfigured interval. Defaults vary by job type, see below for more\ninformation.")),Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"delay",className:"__target-lic","aria-hidden":""})),Object(p.b)("p",{parentName:"li"},Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"#delay","aria-label":"delay permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},"delay"))," ",Object(p.b)("inlineCode",{parentName:"p"},'(string: "15s")'),' - Specifies the duration to wait before restarting a\ntask. This is specified using a label suffix like "30s" or "1h". A random\njitter of up to 25% is added to the delay.')),Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"interval",className:"__target-lic","aria-hidden":""})),Object(p.b)("p",{parentName:"li"},Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"#interval","aria-label":"interval permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},"interval"))," ",Object(p.b)("inlineCode",{parentName:"p"},"(string: <varies>)")," - Specifies the duration which begins when the\nfirst task starts and ensures that only ",Object(p.b)("inlineCode",{parentName:"p"},"attempts")," number of restarts happens\nwithin it. If more than ",Object(p.b)("inlineCode",{parentName:"p"},"attempts")," number of failures happen, behavior is\ncontrolled by ",Object(p.b)("inlineCode",{parentName:"p"},"mode"),'. This is specified using a label suffix like "30s" or\n"1h". Defaults vary by job type, see below for more information.')),Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"mode",className:"__target-lic","aria-hidden":""})),Object(p.b)("p",{parentName:"li"},Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"#mode","aria-label":"mode permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},"mode"))," ",Object(p.b)("inlineCode",{parentName:"p"},'(string: "fail")')," - Controls the behavior when the task fails more\nthan ",Object(p.b)("inlineCode",{parentName:"p"},"attempts")," times in an interval. For a detailed explanation of these\nvalues and their behavior, please see the ",Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"#mode-values"}),"mode values section"),"."))),Object(p.b)("h3",{className:"g-type-display-4"},Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#restart-parameter-defaults","aria-label":"restart parameter defaults permalink"}),"\xbb"),Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"restart-parameter-defaults","aria-hidden":""})),Object(p.b)("inlineCode",{parentName:"h3"},"restart")," Parameter Defaults"),Object(p.b)("p",null,"The values for many of the ",Object(p.b)("inlineCode",{parentName:"p"},"restart")," parameters vary by job type. Here are the\ndefaults by job type:"),Object(p.b)("ul",null,Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("p",{parentName:"li"},"The default batch restart policy is:"),Object(p.b)("pre",Object(c.a)({parentName:"li"},{className:"language-hcl"}),Object(p.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"restart")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"attempts")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"3"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"delay"),"    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"15s"'),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"interval")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"24h"'),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"mode"),"     ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"fail"'),"\n",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n"))),Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("p",{parentName:"li"},"The default service and system job restart policy is:"),Object(p.b)("pre",Object(c.a)({parentName:"li"},{className:"language-hcl"}),Object(p.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"restart")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"interval")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"30m"'),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"attempts")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"2"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"delay"),"    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"15s"'),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"mode"),"     ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"fail"'),"\n",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")))),Object(p.b)("h3",{className:"g-type-display-4"},Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#mode-values","aria-label":"mode values permalink"}),"\xbb"),Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"mode-values","aria-hidden":""})),Object(p.b)("inlineCode",{parentName:"h3"},"mode")," Values"),Object(p.b)("p",null,'This section details the specific values for the "mode" parameter in the Nomad\njob specification for constraints. The mode is always specified as a string'),Object(p.b)("pre",{className:"language-hcl"},Object(p.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"restart")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"mode")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"..."'),"\n",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(p.b)("ul",null,Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"delay-1",className:"__target-lic","aria-hidden":""})),Object(p.b)("p",{parentName:"li"},Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"#delay-1","aria-label":"delay permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},'"delay"'))," - Instructs the scheduler to delay the next restart until the next\n",Object(p.b)("inlineCode",{parentName:"p"},"interval")," is reached.")),Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"fail",className:"__target-lic","aria-hidden":""})),Object(p.b)("p",{parentName:"li"},Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"#fail","aria-label":"fail permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},'"fail"'))," - Instructs the scheduler to not attempt to restart the task on\nfailure. This is the default behavior. This mode is useful for non-idempotent jobs which are unlikely to\nsucceed after a few failures. Failed jobs will be restarted according to\nthe ",Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/job-specification/reschedule"}),Object(p.b)("inlineCode",{parentName:"a"},"reschedule"))," stanza."))))}j.isMDXComponent=!0}},[["lnGb",0,1,2,4,3,5,6]]]);