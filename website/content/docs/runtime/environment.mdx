---
layout: docs
page_title: Environment - Runtime
description: Learn how to configure the Nomad runtime environment.
---

# Runtime Environment

Some settings you specify in your [job specification][jobspec] are passed
to tasks when they start. Other settings are dynamically allocated when your job
is scheduled. Both types of values are made available to your job through
environment variables.

## Summary

@include 'envvars.mdx'

~> Port labels and task names will have any non-alphanumeric or underscore
characters in their names replaced by underscores `_` when they're used in
environment variable names such as `NOMAD_ADDR_<task>_<label>`.

## Task Identifiers

Nomad will pass both the allocation ID and name, the deployment ID that created
the allocation, the job ID and name, the parent job ID as well as
the task and group's names. These are given as `NOMAD_ALLOC_ID`, `NOMAD_ALLOC_NAME`,
`NOMAD_ALLOC_INDEX`, `NOMAD_JOB_NAME`, `NOMAD_JOB_ID`,
`NOMAD_JOB_PARENT_ID`, `NOMAD_GROUP_NAME` and `NOMAD_TASK_NAME`. The allocation ID
and index can be useful when the task being run needs a unique identifier or to
know its instance count.

## Resources

When you request resources for a job, Nomad creates a resource offer. The final
resources for your job are not determined until it is scheduled. Nomad will
tell you which resources have been allocated after evaluation and placement.

### CPU and Memory

Nomad will pass CPU and memory limits to your job as `NOMAD_CPU_LIMIT`,
`NOMAD_MEMORY_LIMIT`, and `NOMAD_MEMORY_MAX_LIMIT`. Your task should use these
values to adapt its behavior to fit inside the resource allocation that nomad
provides. For example, you can use the memory limit to inform how large your
in-process cache should be, or to decide when to flush buffers to disk.

Both CPU and memory are presented as integers. The unit for CPU limit is
`1024 = 1GHz`. The unit for memory is `1 = 1 megabyte`.

Writing your applications to adjust to these values at runtime provides greater
scheduling flexibility since you can adjust the resource allocations in your
job specification without needing to change your code. You can also schedule workloads
that accept dynamic resource allocations so they can scale down/up as your
cluster gets more or less busy.

### Networking

Nomad assigns IPs and ports to your jobs and exposes them via environment
variables. See the [Networking](/docs/job-specification/network) page for more
details.

### Task Directories

Nomad creates a working directory for each allocation on a client. The
allocation working directory contains a task working directory for each task
in the allocation.

Nomad makes the following directories available to tasks, relative to the task
working directory:

- `alloc/`: This directory is shared across all tasks in a task group and can be
  used to store data that needs to be used by multiple tasks, such as a log
  shipper.
- `local/`: This directory is private to each task. It can be used to store
  arbitrary data that should not be shared by tasks in the task group.
- `secrets/`: This directory is private to each task, not accessible via the
  `nomad alloc fs` command or filesystem APIs and where possible backed by an
  in-memory filesystem. It can be used to store secret data that should not be
  visible outside the task.

These directories are persisted until the allocation is removed, which occurs
hours after all the tasks in the task group enter terminal states. This gives
time to view the data produced by tasks.

Depending on the driver and operating system being targeted, the directories
are made available in various ways. For example, on `docker` the directories
are bound to the container, while on `exec` on Linux the chroot is built in
the task working directory, and the directories are mounted into that
chroot. Regardless of how the directories are made available, the path to the
directories can be read through the `NOMAD_ALLOC_DIR`, `NOMAD_TASK_DIR`, and
`NOMAD_SECRETS_DIR` environment variables.

For more details on the task directories, see the [Filesystem internals].

## Meta

The job specification also allows you to specify a `meta` block to supply arbitrary
configuration to a task. This allows you to easily provide job-specific
configuration even if you use the same executable unit in multiple jobs. These
key-value pairs are passed through to the job as `NOMAD_META_<key>=<value>`
environment variables. Prior to Nomad 0.5.5 the key was uppercased and since
then both the original case and an uppercased version are injected. The
uppercased version will be deprecated in a future release.

Currently there is no enforcement that the meta keys be lowercase, but using
multiple keys with the same uppercased representation will lead to undefined
behavior.

## Host environment variables

Nomad passes the environment variables defined in the client host to tasks when
using the `exec`, `raw_exec`, and `java` task drivers. The variables that are
passed to the tasks can be controlled using the client configuration
[`env.denylist`][].

## OpenTelemetry resource attributes

Nomad will automatically include the `OTEL_RESOURCE_ATTRIBUTES` environment
variable according to the [OpenTelemetry resource SDK
specification][otel_resource_spec]. The attributes key use the `nomad.` scope.

| Attribute                | Type     | Description | Examples |
| ------------------------ | -------- | --------------------------- | -------- |
| `nomad.alloc.createTime` | `string` | The time the allocation was created.                            | `1663012858195456000`                  |
| `nomad.alloc.id`         | `string` | The ID of the allocation.                                       | `6cd78c59-b6ec-cc9d-c5df-09aa630bf5d6` |
| `nomad.alloc.name`       | `string` | The name of the allocation.                                     | `otel-demo.demo-client[0]`             |
| `nomad.eval.id`          | `string` | The evaluation ID that generated the allocation.                | `02a24dc2-30ac-eaa9-9330-d2125dc5a3a0` |
| `nomad.group.name`       | `string` | The name of the group that generated this allocation.           | `demo-client`                          |
| `nomad.job.id`           | `string` | The ID of the job that generated this allocation.               | `otel-demo`                            |
| `nomad.job.name`         | `string` | The name of the job that generated this allocation.             | `otel-demo`                            |
| `nomad.job.parentId`     | `string` | The ID of the parent job if applicable.                         | `parent-periodic-job`                  |
| `nomad.job.region`       | `string` | The region of the job that generated this allocation.           | `global`                               |
| `nomad.job.type`         | `string` | The type of the job that generated this allocation.             | `service`                              |
| `nomad.namespace`        | `string` | The namespace where this allocation is running.                 | `default`                              |
| `nomad.node.class`       | `string` | The node class of the node running this allocation, if defined. | `dc1`                                  |
| `nomad.node.datacenter`  | `string` | The datacenter of the node running this allocation.             | `dc1`                                  |
| `nomad.node.id`          | `string` | The ID of the node running this allocation.                     | `8e441a6a-3885-26f0-1017-03e13605cfe7` |
| `nomad.node.name`        | `string` | The name of the node running this allocation.                   | `nomad-1`                              |
| `nomad.task.driver`      | `string` | The driver used by the task.                                    | `exec`                                 |
| `nomad.task.name`        | `string` | The name of the task.                                           | `client`                               |

If a task already defines the `OTEL_RESOURCE_ATTRIBUTES` environment variable
in its [`env`][task_env] configuration, Nomad will merge the default values
above with the values defined by the task, with the task values taking
precedence.

```hcl
job "example" {
  # ...
  group "cache" {
    # ...
    task "redis" {
      # ...
      env {
        OTEL_RESOURCE_ATTRIBUTES = "app.version=1"
      }
    }
  }
}
```

```
OTEL_RESOURCE_ATTRIBUTES=app.version=1,nomad.alloc.id=d3551994-fb78-d73e-db8c-bc050f45fa0a,nomad.alloc.name=....
```

If `OTEL_RESOURCE_ATTRIBUTES` is defined in a [`template`][template_env], it
will overwrite the Nomad default values.

```hcl
job "example" {
  # ...
  group "cache" {
    # ...
    task "redis" {
      # ...
      template {
        data =      <<EOF
OTEL_RESOURCE_ATTRIBUTES="app.version=1"
EOF
        destination = "local/env"
        env         = true
      }
    }
  }
}
```

```
OTEL_RESOURCE_ATTRIBUTES=app.version=1
```

To completely disable the `OTEL_RESOURCE_ATTRIBUTES` environment variable, set
its value to an empty string.

```hcl
job "example" {
  # ...
  group "cache" {
    # ...
    task "redis" {
      # ...
      env {
        OTEL_RESOURCE_ATTRIBUTES = ""
      }
    }
  }
}
```

[jobspec]: /docs/job-specification 'Nomad Job Specification'
[vault]: /docs/vault-integration 'Nomad Vault Integration'
[filesystem internals]: /docs/concepts/filesystem
[`env.denylist`]: /docs/configuration/client#env-denylist
[task_env]: /docs/job-specification/task#env
[template_env]: /docs/job-specification/template#env
[otel_resource_spec]: https://opentelemetry.io/docs/reference/specification/resource/sdk/#specifying-resource-information-via-an-environment-variable
