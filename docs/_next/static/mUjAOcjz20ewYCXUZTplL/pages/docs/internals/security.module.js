(window.webpackJsonp=window.webpackJsonp||[]).push([[220],{"m/Qb":function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/internals/security",function(){return a("mAhV")}])},mAhV:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return p}));var n=a("wx14"),r=a("Ff2n"),s=a("q1tI"),i=a.n(s),o=a("7ljp"),c=a("j1un"),l=(i.a.createElement,{}),b=Object(c.a)({layout:"docs",page_title:"Security Model",sidebar_title:"Security Model",description:"Nomad relies on both a lightweight gossip mechanism and an RPC system to provide various features. Both of the systems have different security mechanisms that stem from their designs. However, the security mechanisms of Nomad have a common goal: to provide confidentiality, integrity, and authentication.",__resourcePath:"docs/internals/security.mdx",__scans:{}});function p(e){var{components:t}=e,a=Object(r.a)(e,["components"]);return Object(o.b)(b,Object(n.a)({},l,a,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h2",{className:"g-type-display-3"},Object(o.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#overview","aria-label":"overview permalink"}),"\xbb"),Object(o.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"overview","aria-hidden":""})),"Overview"),Object(o.b)("p",null,"Nomad is a flexible workload orchestrator to deploy and manage any containerized\nor legacy application using a single, unified workflow. It can run diverse\nworkloads including Docker, non-containerized, microservice, and batch\napplications."),Object(o.b)("p",null,"Nomad utilizes a lightweight gossip and RPC system, ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.consul.io/docs/internals/security.html"}),"similar to\nConsul"),", which provides\nvarious essential features. Both of these systems provide security mechanisms\nwhich should be utilized to help provide ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://en.wikipedia.org/wiki/Information_security"}),"confidentiality, integrity and\nauthentication"),"."),Object(o.b)("p",null,"Using defense in depth is crucial for cluster security, and deployment\nrequirements may differ drastically depending on your use case. Further security\nfeatures for multi-tenant deployments are offered exclusively in the enterprise\nversion. This documentation may need to be adapted to your deployment situation,\nbut the general mechanisms for a secure Nomad deployment revolve around:"),Object(o.b)("ul",null,Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},Object(o.b)("a",Object(n.a)({parentName:"strong"},{href:"https://learn.hashicorp.com/tutorials/nomad/security-enable-tls"}),"mTLS"))," -\nMutual authentication of both the TLS server and client x509 certificates\nprevents internal abuse by preventing unauthenticated access to network\ncomponents within the cluster.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},Object(o.b)("a",Object(n.a)({parentName:"strong"},{href:"https://learn.hashicorp.com/collections/nomad/access-control"}),"ACLs"))," - Enables\nauthorization for authenticated connections by granting capabilities to ACL\ntokens.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},Object(o.b)("a",Object(n.a)({parentName:"strong"},{href:"/docs/enterprise/index.html#namespaces"}),"Namespaces")),"\n(",Object(o.b)("strong",{parentName:"p"},"Enterprise Only"),") - Access to read and write to a Namepsace can be\ncontrolled to allow for granular access to job information managed within a\nmulti-tenant cluster.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},Object(o.b)("a",Object(n.a)({parentName:"strong"},{href:"/docs/enterprise/index.html#sentinel-policies"}),"Sentinel Policies")),"\n(",Object(o.b)("strong",{parentName:"p"},"Enterprise Only"),") - Sentinel policies allow for granular control over\ncomponents such as task drivers within a cluster."))),Object(o.b)("h3",{className:"g-type-display-4"},Object(o.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#personas","aria-label":"personas permalink"}),"\xbb"),Object(o.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"personas","aria-hidden":""})),"Personas"),Object(o.b)("p",null,"When thinking about Nomad, it helps to consider the following types of base\npersonas when managing the security requirements for the cluster deployment. The\ngranularity may change depending on your team's use case where rigorous roles\ncan be accurately defined and managed using the ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.vaultproject.io/docs/secrets/nomad/index.html"}),"Nomad backend secret engine for\nVault"),". This is\ndescribed further with getting started steps using a development server\n",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://learn.hashicorp.com/collections/nomad/access-control"}),"here"),"."),Object(o.b)("p",null,"It's important to note that there's no traditional concept of a user\nwithin Nomad itself."),Object(o.b)("ul",null,Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"System Administrator")," - This is someone who has access to the underlying\ninfrastructure to a Nomad cluster. Often she has access to SSH or RDP\ndirectly into a server within a cluster through a bastion host. Ultimately\nthey have read, write and execute permissions for the actual Nomad binary.\nThis binary is the same for server and client nodes using different\nconfiguration files. These users potentially have something like sudo,\nadministrative, or some other super-user access to the underlying compute\nresource. Users like these are essentially totally trusted by Nomad as they\nhave administrative rights to the system and can start or stop the agent.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"Nomad Administrator")," - This is someone (probably the same ",Object(o.b)("strong",{parentName:"p"},"System\nAdministrator"),") who has access to define the Nomad agent configurations\nfor servers and clients, and/or have a Nomad management ACL token. They also\nhave total rights to all of the parts in the Nomad system including the\nability to start and stop all jobs within a cluster.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"Nomad Operator")," - This is someone who likely has selective access with\nrestricted capabilities to manage jobs applicable to their namespace within\na cluster.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"User")," - This is someone who is a user of an application being run on the\nsystem. In some cases applications may be public facing and exposed to the\ninternet such as a web server. This is someone who shouldn't have any\nnetwork access to the Nomad server API."))),Object(o.b)("h3",{className:"g-type-display-4"},Object(o.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#secure-configuration","aria-label":"secure configuration permalink"}),"\xbb"),Object(o.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"secure-configuration","aria-hidden":""})),"Secure Configuration"),Object(o.b)("p",null,"Nomad's security model is applicable only if all parts of the system are running\nwith a secure configuration; ",Object(o.b)("strong",{parentName:"p"},"Nomad is not secure-by-default.")," Without the following\nmechanisms enabled in Nomad's configuration, it may be possible to abuse access\nto a cluster. Like all security considerations, one must appropriately determine\nwhat concerns they have for their environment and adapt to these security\nrecommendations accordingly."),Object(o.b)("h4",{className:"g-type-display-5"},Object(o.b)("a",Object(n.a)({parentName:"h4"},{className:"__permalink-h",href:"#requirements","aria-label":"requirements permalink"}),"\xbb"),Object(o.b)("a",Object(n.a)({parentName:"h4"},{className:"__target-h",id:"requirements","aria-hidden":""})),"Requirements"),Object(o.b)("ul",null,Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},Object(o.b)("a",Object(n.a)({parentName:"strong"},{href:"https://learn.hashicorp.com/tutorials/nomad/security-enable-tls"}),"mTLS enabled"))),Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),"Mutual TLS (mTLS) enables ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://en.wikipedia.org/wiki/Mutual_authentication"}),"mutual\nauthentication")," with\nsecurity properties to prevent the following problems:")),Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},"Unauthorized access because both server and clients must provide valid TLS\n",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://en.wikipedia.org/wiki/X.509"}),"X.509")," certificates signed by the same\nvalid ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://en.wikipedia.org/wiki/Certificate_authority"}),"CA")," in order to\ncommunicate within the cluster.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},"Observing or tampering communication between nodes is thwarted due to the\ntraffic being encrypted using the well known network security protocol\n",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://en.wikipedia.org/wiki/Transport_Layer_Security"}),"TLS")," version 1.2,\nwith a ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/configuration/tls.html#tls_min_version"}),"configurable minimal\nversion"),".\nBoth server and client agents must be configured to validate each other's\ncertificates to ensure mTLS is actually enabled. This requires appropriate\ncertificates to be distributed to servers, clients, machines, or operators\nfor things like CLI usage. It is recommended to use\n",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://learn.hashicorp.com/tutorials/nomad/vault-pki-nomad"}),"Vault"),"\nto securely manage the certificate creation and rotation for nodes.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},"Agent role misconfiguration is prevented using the X.509\n",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://en.wikipedia.org/wiki/Subject_Alternative_Name"}),"SAN")," extension.\nThis is essentially a domain name that is used to identify and verify a\nnode's region and role name are configured as expected (e.g.\n",Object(o.b)("inlineCode",{parentName:"p"},"client.us-east.nomad"),").")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},"Using the previously mentioned role name prevents maliciously masquerading\nas a server or client node, and allows other services to be signed easily by\nthe same CA. This also avoids any potential pitfalls with certificates using\nthe IP or Hostname of nodes within a cluster.")))),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},Object(o.b)("a",Object(n.a)({parentName:"strong"},{href:"https://learn.hashicorp.com/collections/nomad/access-control"}),"ACLs enabled"))," - The\naccess control list (ACL) system provides a capability-based control\nmechanism for Nomad administrators allowing for custom roles (typically\nwithin Vault) to be tied to an individual human or machine operator\nidentity. This allows for access to capabilities within the cluster to be\nrestricted to specific users.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},Object(o.b)("a",Object(n.a)({parentName:"strong"},{href:"https://learn.hashicorp.com/tutorials/nomad/sentinel"}),"Sentinel Policies")),"\n(",Object(o.b)("strong",{parentName:"p"},"Enterprise Only"),") - ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.hashicorp.com/sentinel/"}),"Sentinel")," is\na feature which enables\n",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://docs.hashicorp.com/sentinel/concepts/policy-as-code/"}),"policy-as-code"),"\nto enforce further restrictions on operators. This is used to augment the\nbuilt-in ACL system for fine-grained control over jobs.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},Object(o.b)("a",Object(n.a)({parentName:"strong"},{href:"https://learn.hashicorp.com/tutorials/nomad/namespaces"}),"Namespaces")),"\n(",Object(o.b)("strong",{parentName:"p"},"Enterprise Only"),") - This feature allows for a cluster to be shared by\nmultiple teams within a company. Using this logical separation is important\nfor multi-tenant clusters to prevent users without access to that namespace\nfrom conflicting with each other. This requires ACLs to be enabled in order\nto be enforced.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},Object(o.b)("a",Object(n.a)({parentName:"strong"},{href:"https://learn.hashicorp.com/tutorials/nomad/quotas"}),"Resource Quotas")),"\n(",Object(o.b)("strong",{parentName:"p"},"Enterprise Only"),") - Can limit a namespace's access to the underlying\ncompute resources in the cluster by setting upper-limits for operators.\nAccess to these resource quotas can be managed via ACLs to ensure read-only\naccess for operators so they can't just change their quotas."))),Object(o.b)("h4",{className:"g-type-display-5"},Object(o.b)("a",Object(n.a)({parentName:"h4"},{className:"__permalink-h",href:"#recommendations","aria-label":"recommendations permalink"}),"\xbb"),Object(o.b)("a",Object(n.a)({parentName:"h4"},{className:"__target-h",id:"recommendations","aria-hidden":""})),"Recommendations"),Object(o.b)("p",null,"The following are security recommendations that can help significantly improve\nthe security of your cluster depending on your use case. We recommend always\npracticing defense in depth when architecting the security mechanisms for your\nenvironment."),Object(o.b)("ul",null,Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"Rotate credentials")," - Using short-lived credentials or rotating them\nfrequently is highly recommended to reduce damage of accidentally leaked\ncredentials."),Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},"Use ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/vault-integration/index.html"}),"Vault")," to create and manage\ndynamic, rotated credentials prevent secrets from being easily exposed\nwithin the ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/job-specification/index.html"}),"job specification")," itself\nwhich may be leaked into version control or otherwise be accidentally stored\non disk on an operator's local machine.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},"Rotate credentials used by the Nomad agent; e.g. ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://learn.hashicorp.com/tutorials/nomad/vault-pki-nomad"}),"integrate with Vault's\nPKI secret engine")," to\nautomatically generate and renew dynamic, unique X.509 certificates for each\nNomad node with a short ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://en.wikipedia.org/wiki/Time_to_live"}),"TTL"),".")))),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},Object(o.b)("a",Object(n.a)({parentName:"strong"},{href:"https://groups.google.com/forum/#!topic/nomad-tool/pSyMwC_FSFA"}),"Running without Root"))," -\nNomad servers can be run as unprivileged users that only require access to\nthe data directory.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"Containers with Sandbox Runtimes")," - In some situations, such as running\nuntrusted code as a service, it may be worth considering using different\ncontainer runtimes such as ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://gvisor.dev/"}),"gVisor")," or ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://katacontainers.io/"}),"Kata\nContainers"),". These types of runtimes provide\nsandboxing features which help prevent raw access to the underlying shared\nkernel for other containers and the Nomad client agent itself. Docker driver\nallows ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/drivers/docker#runtime"}),"customizing runtimes"),".")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},Object(o.b)("a",Object(n.a)({parentName:"strong"},{href:"/docs/configuration/client#driver-blacklist"}),"Disable Unused Drivers"))," -\nEach driver provides different degrees of isolation, and bugs may allow\nunintended privilege escalation. If a task driver is not needed, you can\ndisable it to reduce risk.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"Linux Security Modules")," - Use of security modules that can be directly\nintegrated into operating systems such as AppArmor, SElinux, and Seccomp on\nboth the Nomad hosts and applied to containers for an extra layer of\nsecurity. Seccomp profiles are able to be passed directly to containers\nusing the\n",Object(o.b)("strong",{parentName:"p"},Object(o.b)("a",Object(n.a)({parentName:"strong"},{href:"/docs/drivers/docker.html#security_opt"}),Object(o.b)("inlineCode",{parentName:"a"},"security_opt"))),"\nparameter available in the default ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/drivers/docker.html"}),"Docker\ndriver"),".")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},Object(o.b)("a",Object(n.a)({parentName:"strong"},{href:"https://www.hashicorp.com/resources/service-mesh-microservices-networking"}),"Service Mesh"))," -\nIntegrating service mesh technologies such as\n",Object(o.b)("strong",{parentName:"p"},Object(o.b)("a",Object(n.a)({parentName:"strong"},{href:"https://www.consul.io/"}),"Consul"))," can be extremely useful for limiting\nand efficiently load balancing network connectivity within a cluster.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},Object(o.b)("a",Object(n.a)({parentName:"strong"},{href:"/docs/configuration/tls"}),"TLS Settings"))," -\nTLS settings, such as the available ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/configuration/tls#tls_cipher_suites"}),"cipher suites"),", should be tuned to fit the needs of your environment.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},Object(o.b)("a",Object(n.a)({parentName:"strong"},{href:"/docs/configuration#http_api_response_headers"}),"HTTP Headers"))," -\nAdditional security ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers"}),"headers"),", such as ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-XSS-Protection"}),Object(o.b)("inlineCode",{parentName:"a"},"X-XSS-Protection")),", can be ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/configuration#http_api_response_headers"}),"configured")," for HTTP API responses. "))),Object(o.b)("h3",{className:"g-type-display-4"},Object(o.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#threat-model","aria-label":"threat model permalink"}),"\xbb"),Object(o.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"threat-model","aria-hidden":""})),"Threat Model"),Object(o.b)("p",null,"The following are parts of the Nomad threat model:"),Object(o.b)("ul",null,Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"Nomad agent-to-agent communication")," - Transport encryption for\nagent-to-agent communication is required to prevent eavesdropping. TCP and\nUDP based protocols within Nomad provide different mechanisms for enabling\nencryption including symmetric (shared gossip encryption keys) and\nasymmetric keys (TLS).")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"Tampering of data in transit")," - Any tampering should be detectable via mTLS\nand cause Nomad to avoid processing the request.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"Access to data without authentication or authorization")," - Requests to the\nserver should be authenticated and authorized using mTLS and ACLs\nrespectively.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"State modification or corruption due to malicious messages")," - Improperly\nformatted messages are discarded while properly formatted messages require\nauthentication and authorization.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"Non-server members accessing raw data")," - All servers that join the cluster\nrequire proper authentication and authorization in order to begin\nparticipating in Raft. All data in Raft should be encrypted with TLS.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"Denial of Service against a node")," - DoS attacks against a single node\nshould not compromise the security posture of Nomad."))),Object(o.b)("p",null,"The following are not part of the threat model for server agents:"),Object(o.b)("ul",null,Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"Access (read or write) to the Nomad data directory")," - Information about the\njobs managed by Nomad is persisted to a server's data directory.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"Access (read or write) to the Nomad configuration directory")," - Access to\nNomad's configuration file(s) directory can enable and disable features for\na cluster.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"Memory access to a running Nomad server agent")," - Direct access to the\nmemory of the Nomad server agent process (usually requiring a shell on the\nsystem through various means) results in almost all aspects of the agent\nbeing compromised including access to certificates and other secrets."))),Object(o.b)("p",null,"The following are not part of the threat model for client agents:"),Object(o.b)("ul",null,Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"Access (read or write) to the Nomad data directory")," - Information about the\nallocations scheduled to a Nomad client is persisted to its data directory.\nThis would include any secrets in any of the allocation's file systems.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"Access (read or write) to the Nomad configuration directory")," - Access to a\nclient's configuration file can enable and disable features for a client\nincluding insecure drivers such as\n",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/drivers/raw_exec.html"}),Object(o.b)("inlineCode",{parentName:"a"},"raw_exec")),".")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"Memory access to a running Nomad client agent")," - Direct access to the\nmemory of the Nomad client agent process allows an attack to extract secrets\nfrom clients such as Vault tokens.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"Lax Client Driver Sandbox")," - Drivers may allow some privileged operations,\ne.g. filesystem access to configuration directories, or raw accesses to host\ndevices. Such privileges can be used to facilitate compromise other workloads,\nor cause denial-of-service attacks."))),Object(o.b)("h4",{className:"g-type-display-5"},Object(o.b)("a",Object(n.a)({parentName:"h4"},{className:"__permalink-h",href:"#internal-threats","aria-label":"internal threats permalink"}),"\xbb"),Object(o.b)("a",Object(n.a)({parentName:"h4"},{className:"__target-h",id:"internal-threats","aria-hidden":""})),"Internal Threats"),Object(o.b)("ul",null,Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"Job Operator")," - Someone with a valid mTLS certificate and ACL token may still be a\nthreat to your cluster in certain situations, especially in multi-team\ncluster deployments. They may accidentally or intentionally use a malicious\njob to harm a cluster which can help be protected against using\nQuotas, Namespace, and Sentinel policies.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"Workload")," - Workloads may have host network access within a cluster which\ncan lead to SSRF due to application security issues outside of the scope of\nNomad which may lead to internal access within the cluster. Using mTLS, ACLs\nand Sentinel policies together can add layers of protection against\nmalicious workloads.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"RPC / API Access")," - RPC and HTTP API endpoints without mTLS can expose\nclusters to abuse within the cluster from malicious workloads.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"Client driver")," - Drivers implement various workload types for a cluster,\nand the backend configuration of these drivers should be considered to\nimplement defense in depth. For example, a custom Docker driver that limits\nthe ability to mount the host file system may be subverted by network access\nto an exposed Docker daemon API through other means such as the ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/drivers/raw_exec.html"}),Object(o.b)("inlineCode",{parentName:"a"},"raw_exec")),"\ndriver."))),Object(o.b)("h4",{className:"g-type-display-5"},Object(o.b)("a",Object(n.a)({parentName:"h4"},{className:"__permalink-h",href:"#external-threats","aria-label":"external threats permalink"}),"\xbb"),Object(o.b)("a",Object(n.a)({parentName:"h4"},{className:"__target-h",id:"external-threats","aria-hidden":""})),"External Threats"),Object(o.b)("p",null,"There are two main components to consider to for external threats in a Nomad cluster:"),Object(o.b)("ul",null,Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"Server agent")," - Internal cluster leader elections and replication is\nmanaged via Raft between server agents encrypted in transit. However,\ninformation about the server is stored unencrypted at rest in the agent's\ndata directory. This may contain sensitive information such as ACL tokens\nand TLS certificates.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"Client agent")," - Client-to-server communication within a cluster is\nencrypted and authenticated using mTLS. Information about the allocations on\na client node is unencrypted in the agent's data and configuration\ndirectory."))),Object(o.b)("h3",{className:"g-type-display-4"},Object(o.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#network-ports","aria-label":"network ports permalink"}),"\xbb"),Object(o.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"network-ports","aria-hidden":""})),"Network Ports"),Object(o.b)("table",null,Object(o.b)("thead",{parentName:"table"},Object(o.b)("tr",{parentName:"thead"},Object(o.b)("th",Object(n.a)({parentName:"tr"},{align:null}),Object(o.b)("strong",{parentName:"th"},"Port / Protocol")),Object(o.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Agents"),Object(o.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Description"))),Object(o.b)("tbody",{parentName:"table"},Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(o.b)("strong",{parentName:"td"},"4646")," / TCP"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"All"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(o.b)("a",Object(n.a)({parentName:"td"},{href:"https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol"}),"HTTP")," to provide ",Object(o.b)("a",Object(n.a)({parentName:"td"},{href:"https://learn.hashicorp.com/collections/nomad/web-ui"}),"UI")," and ",Object(o.b)("a",Object(n.a)({parentName:"td"},{href:"/api-docs"}),"API")," access to agents.")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(o.b)("strong",{parentName:"td"},"4647")," / TCP"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Servers"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(o.b)("a",Object(n.a)({parentName:"td"},{href:"https://en.wikipedia.org/wiki/Remote_procedure_call"}),"RPC")," protocol used by agents.")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(o.b)("strong",{parentName:"td"},"4648")," / TCP + UDP"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Servers"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(o.b)("a",Object(n.a)({parentName:"td"},{href:"/docs/internals/gossip.html"}),"gossip")," protocol to manage server membership using ",Object(o.b)("a",Object(n.a)({parentName:"td"},{href:"https://www.serf.io/"}),"Serf"),".")))))}p.isMDXComponent=!0}},[["m/Qb",0,1,2,4,3,5,6]]]);