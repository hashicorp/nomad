(window.webpackJsonp=window.webpackJsonp||[]).push([[263],{En3E:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/runtime/interpolation",function(){return a("qNK2")}])},qNK2:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return O}));var n=a("wx14"),c=a("Ff2n"),b=a("q1tI"),r=a.n(b),o=a("7ljp"),s=a("j1un"),p=(r.a.createElement,{}),l=Object(s.a)({layout:"docs",page_title:"Variable Interpolation",sidebar_title:"Variable Interpolation",description:"Learn about the Nomad's interpolation and interpreted variables.",__resourcePath:"docs/runtime/interpolation.mdx",__scans:{}});function O(e){var t=e.components,a=Object(c.a)(e,["components"]);return Object(o.b)(l,Object(n.a)({},p,a,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h1",{className:"g-type-display-2"},Object(o.b)("a",Object(n.a)({parentName:"h1"},{className:"__permalink-h",href:"#variable-interpolation","aria-label":"variable interpolation permalink"}),"\xbb"),Object(o.b)("a",Object(n.a)({parentName:"h1"},{className:"__target-h",id:"variable-interpolation","aria-hidden":""})),"Variable Interpolation"),Object(o.b)("p",null,"Nomad supports interpreting two classes of variables: node attributes and\nruntime environment variables. Node attributes are interpretable in constraints,\ntask environment variables, and certain driver fields. Runtime environment\nvariables are not interpretable in constraints because they are only defined\nonce the scheduler has placed them on a particular node."),Object(o.b)("p",null,"The syntax for interpreting variables is ",Object(o.b)("inlineCode",{parentName:"p"},"${variable}"),". An example and a\ncomprehensive list of interpretable fields can be seen below:"),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-hcl"}),"task ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"docs"')," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"driver")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"docker"'),"\n\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"# Drivers support interpreting node attributes and runtime environment"),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"# variables"),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"config")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"image")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"my-app"'),"\n\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"# Interpret runtime variables to inject the address to bind to and the"),"\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"# location to write logs to."),"\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"args")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"["),"\n      ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"--bind"'),", ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"',Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation"}),Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"$"),Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"{"),"NOMAD_ADDR_RPC",Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"}")),'"'),",\n      ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"--logs"'),", ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"',Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation"}),Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"$"),Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"{"),"NOMAD_ALLOC_DIR",Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"}")),'/logs"'),",\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"port_map")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"RPC")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token number"}),"6379"),"\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"# Constraints only support node attributes as runtime environment variables"),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"# are only defined after the task is placed on a node."),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"constraint")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"attribute")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"',Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation"}),Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"$"),Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"{"),"attr",Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"."),"kernel",Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"."),"name",Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"}")),'"'),"\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"value"),"     ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"linux"'),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"# Environment variables are interpreted and can contain both runtime and"),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"# node attributes. These environment variables are passed into the task."),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"env")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),'"DC"'),"      ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"Running on datacenter ',Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation"}),Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"$"),Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"{"),"node",Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"."),"datacenter",Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"}")),'"'),"\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),'"VERSION"')," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"Version ',Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation"}),Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"$"),Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"{"),"NOMAD_META_VERSION",Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"}")),'"'),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"# Meta keys are also interpretable."),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"meta")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"VERSION")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"v0.3"'),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("h2",{className:"g-type-display-3"},Object(o.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#interpreted_node_vars","aria-label":"node variables permalink"}),"\xbb"),Object(o.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h __compat",id:"interpreted_node_vars","aria-hidden":""})),Object(o.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h __compat",id:"node-variables-","aria-hidden":""})),Object(o.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"node-variables","aria-hidden":""})),"Node Variables"),Object(o.b)("p",null,"Below is a full listing of node attributes that are interpretable. These\nattributes are interpreted by ",Object(o.b)("strong",{parentName:"p"},"both")," constraints and within the task and\ndriver."),Object(o.b)("table",null,Object(o.b)("thead",null,Object(o.b)("tr",null,Object(o.b)("th",null,"Variable"),Object(o.b)("th",null,"Description"),Object(o.b)("th",null,"Example Value"))),Object(o.b)("tbody",null,Object(o.b)("tr",null,Object(o.b)("td",null,Object(o.b)("code",null,"${node.unique.id}")),Object(o.b)("td",null,"36 character unique client identifier"),Object(o.b)("td",null,Object(o.b)("code",null,"9afa5da1-8f39-25a2-48dc-ba31fd7c0023"))),Object(o.b)("tr",null,Object(o.b)("td",null,Object(o.b)("code",null,"${node.region}")),Object(o.b)("td",null,"Client's region"),Object(o.b)("td",null,Object(o.b)("code",null,"global"))),Object(o.b)("tr",null,Object(o.b)("td",null,Object(o.b)("code",null,"${node.datacenter}")),Object(o.b)("td",null,"Client's datacenter"),Object(o.b)("td",null,Object(o.b)("code",null,"dc1"))),Object(o.b)("tr",null,Object(o.b)("td",null,Object(o.b)("code",null,"${node.unique.name}")),Object(o.b)("td",null,"Client's name"),Object(o.b)("td",null,Object(o.b)("code",null,"nomad-client-10-1-2-4"))),Object(o.b)("tr",null,Object(o.b)("td",null,Object(o.b)("code",null,"${node.class}")),Object(o.b)("td",null,"Client's class"),Object(o.b)("td",null,Object(o.b)("code",null,"linux-64bit"))),Object(o.b)("tr",null,Object(o.b)("td",null,Object(o.b)("code",null,"$","{","attr.<property>","}")),Object(o.b)("td",null,"Property given by ",Object(o.b)("code",null,"property")," on the client"),Object(o.b)("td",null,Object(o.b)("code",null,"${attr.cpu.arch} => amd64"))),Object(o.b)("tr",null,Object(o.b)("td",null,Object(o.b)("code",null,"$","{","meta.<key>","}")),Object(o.b)("td",null,"Metadata value given by ",Object(o.b)("code",null,"key")," on the client"),Object(o.b)("td",null,Object(o.b)("code",null,"${meta.foo} => bar"))))),Object(o.b)("p",null,"Below is a table documenting common node properties:"),Object(o.b)("table",null,Object(o.b)("thead",null,Object(o.b)("tr",null,Object(o.b)("th",null,"Property"),Object(o.b)("th",null,"Description"))),Object(o.b)("tbody",null,Object(o.b)("tr",null,Object(o.b)("td",null,Object(o.b)("code",null,"${attr.cpu.arch}")),Object(o.b)("td",null,"CPU architecture of the client (e.g. ",Object(o.b)("code",null,"amd64"),","," ",Object(o.b)("code",null,"386"),")")),Object(o.b)("tr",null,Object(o.b)("td",null,Object(o.b)("code",null,"${attr.cpu.numcores}")),Object(o.b)("td",null,"Number of CPU cores on the client")),Object(o.b)("tr",null,Object(o.b)("td",null,Object(o.b)("code",null,"${attr.cpu.totalcompute}")),Object(o.b)("td",null,Object(o.b)("code",null,"cpu.frequency \xd7 cpu.numcores")," but may be overridden by"," ",Object(o.b)("code",null,"client.cpu_total_compute"))),Object(o.b)("tr",null,Object(o.b)("td",null,Object(o.b)("code",null,"${attr.consul.datacenter}")),Object(o.b)("td",null,"The Consul datacenter of the client (if Consul is found)")),Object(o.b)("tr",null,Object(o.b)("td",null,Object(o.b)("code",null,"$","{","attr.driver.<property>","}")),Object(o.b)("td",null,"See the ",Object(o.b)("a",{href:"/docs/drivers"},"task drivers")," for property documentation")),Object(o.b)("tr",null,Object(o.b)("td",null,Object(o.b)("code",null,"${attr.unique.hostname}")),Object(o.b)("td",null,"Hostname of the client")),Object(o.b)("tr",null,Object(o.b)("td",null,Object(o.b)("code",null,"${attr.unique.network.ip-address}")),Object(o.b)("td",null,"The IP address fingerprinted by the client and from which task ports are allocated")),Object(o.b)("tr",null,Object(o.b)("td",null,Object(o.b)("code",null,"${attr.kernel.name}")),Object(o.b)("td",null,"Kernel of the client (e.g. ",Object(o.b)("code",null,"linux"),", ",Object(o.b)("code",null,"darwin"),")")),Object(o.b)("tr",null,Object(o.b)("td",null,Object(o.b)("code",null,"${attr.kernel.version}")),Object(o.b)("td",null,"Version of the client kernel (e.g. ",Object(o.b)("code",null,"3.19.0-25-generic"),","," ",Object(o.b)("code",null,"15.0.0"),")")),Object(o.b)("tr",null,Object(o.b)("td",null,Object(o.b)("code",null,"${attr.platform.aws.ami-id}")),Object(o.b)("td",null,"AMI ID of the client (if on AWS EC2)")),Object(o.b)("tr",null,Object(o.b)("td",null,Object(o.b)("code",null,"${attr.platform.aws.instance-type}")),Object(o.b)("td",null,"Instance type of the client (if on AWS EC2)")),Object(o.b)("tr",null,Object(o.b)("td",null,Object(o.b)("code",null,"${attr.platform.aws.placement.availability-zone}")),Object(o.b)("td",null,"Availability Zone of the client (if on AWS EC2)")),Object(o.b)("tr",null,Object(o.b)("td",null,Object(o.b)("code",null,"${attr.os.name}")),Object(o.b)("td",null,"Operating system of the client (e.g. ",Object(o.b)("code",null,"ubuntu"),","," ",Object(o.b)("code",null,"windows"),", ",Object(o.b)("code",null,"darwin"),")")),Object(o.b)("tr",null,Object(o.b)("td",null,Object(o.b)("code",null,"${attr.os.version}")),Object(o.b)("td",null,"Version of the client OS")))),Object(o.b)("p",null,"The full list of node attributes can be obtained by running ",Object(o.b)("inlineCode",{parentName:"p"},"nomad node status -verbose [node]"),"."),Object(o.b)("p",null,"Here are some examples of using node attributes and properties in a job file:"),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-hcl"}),"job ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"docs"')," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"# This will constrain this job to only run on 64-bit clients."),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"constraint")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"attribute")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"',Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation"}),Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"$"),Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"{"),"attr",Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"."),"cpu",Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"."),"arch",Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"}")),'"'),"\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"value"),"     ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"amd64"'),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"# This will restrict the job to only run on clients with 4 or more cores."),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"# Note: you may also declare a resource requirement for CPU for a task."),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"constraint")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"attribute")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"',Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation"}),Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"$"),Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"{"),"cpu",Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"."),"numcores",Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"}")),'"'),"\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"operator"),"  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'">="'),"\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"value"),"     ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"4"'),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"# Only run this job on a memory-optimized AWS EC2 instance."),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"constraint")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"attribute")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"',Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation"}),Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"$"),Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"{"),"attr",Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"."),"platform",Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"."),"aws",Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"."),"instance-type",Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"}")),'"'),"\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"value"),"     ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"m4.xlarge"'),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("h2",{className:"g-type-display-3"},Object(o.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#interpreted_env_vars","aria-label":"environment variables permalink"}),"\xbb"),Object(o.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h __compat",id:"interpreted_env_vars","aria-hidden":""})),Object(o.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"environment-variables","aria-hidden":""})),"Environment Variables"),Object(o.b)("p",null,"The following are runtime environment variables that describe the environment\nthe task is running in. These are only defined once the task has been placed on\na particular node and as such can not be used in constraints."),Object(o.b)("p",null,"Environment variables should be enclosed in brackets ",Object(o.b)("inlineCode",{parentName:"p"},"${...}")," for\ninterpolation."),Object(o.b)("h3",{className:"g-type-display-4"},Object(o.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#dots_in_vars","aria-label":"dots in variables permalink"}),"\xbb"),Object(o.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h __compat",id:"dots_in_vars","aria-hidden":""})),Object(o.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"dots-in-variables","aria-hidden":""})),"Dots in Variables"),Object(o.b)("p",null,"Starting in Nomad 0.9, task configuration interpolation requires variables to\nbe valid identifiers. While this does not affect default variables or common\ncustom variables, it is possible to define a variable that is not a valid\nidentifier:"),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-hcl"}),Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"env")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),'"valid.name"'),"     ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"ok"'),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),'"invalid...name"')," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"not a valid identifier"'),"\n",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("p",null,"The environment variable ",Object(o.b)("inlineCode",{parentName:"p"},"invalid...name")," cannot be interpolated using the\nstandard ",Object(o.b)("inlineCode",{parentName:"p"},'"${invalid...name}"')," syntax. The dots will be interpreted as object\nnotation so multiple consecutive dots are invalid."),Object(o.b)("p",null,"To continue supporting all user environment variables Nomad 0.9 added a new\n",Object(o.b)("inlineCode",{parentName:"p"},"env")," variable which allows accessing any environment variable through index\nsyntax:"),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-hcl"}),"task ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"redis"')," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"driver")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"docker"'),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"config")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"image"),"  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"redis:3.2"'),"\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"labels")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"label1")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"',Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation"}),Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"$"),Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"{"),"env",Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"["),Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token string"}),'"invalid...name"'),Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"]"),Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"}")),'"'),"\n      ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"label2")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"',Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation"}),Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"$"),Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"{"),"env",Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"["),Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token string"}),'"valid.name"'),Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"]"),Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"}")),'"'),"\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("table",null,"\n  ",Object(o.b)("thead",{parentName:"table"},"\n    ",Object(o.b)("tr",{parentName:"thead"},"\n      ",Object(o.b)("th",{parentName:"tr"},"Variable"),"\n      ",Object(o.b)("th",{parentName:"tr"},"Description"),"\n    "),"\n  "),"\n  ",Object(o.b)("tbody",{parentName:"table"},"\n    ",Object(o.b)("tr",{parentName:"tbody"},"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        ",Object(o.b)("code",{parentName:"td"},"NOMAD_ALLOC_DIR"),"\n      "),"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        The path to the shared ",Object(o.b)("code",{parentName:"td"},"alloc/")," directory. See\n        ",Object(o.b)("a",Object(n.a)({parentName:"td"},{href:"/docs/runtime/environment#task-directories"}),"\n          here for more\n        ")," information.\n      "),"\n    "),"\n    ",Object(o.b)("tr",{parentName:"tbody"},"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        ",Object(o.b)("code",{parentName:"td"},"NOMAD_TASK_DIR"),"\n      "),"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        The path to the task ",Object(o.b)("code",{parentName:"td"},"local/")," directory. See\n        ",Object(o.b)("a",Object(n.a)({parentName:"td"},{href:"/docs/runtime/environment#task-directories"}),"here")," for more information.\n      "),"\n    "),"\n    ",Object(o.b)("tr",{parentName:"tbody"},"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        ",Object(o.b)("code",{parentName:"td"},"NOMAD_SECRETS_DIR"),"\n      "),"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        Path to the task\u2018s secrets directory. See\n        ",Object(o.b)("a",Object(n.a)({parentName:"td"},{href:"/docs/runtime/environment#task-directories"}),"here")," for more information.\n      "),"\n    "),"\n    ",Object(o.b)("tr",{parentName:"tbody"},"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        ",Object(o.b)("code",{parentName:"td"},"NOMAD_MEMORY_LIMIT"),"\n      "),"\n      ",Object(o.b)("td",{parentName:"tr"},"Memory limit in MB for the task"),"\n    "),"\n    ",Object(o.b)("tr",{parentName:"tbody"},"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        ",Object(o.b)("code",{parentName:"td"},"NOMAD_CPU_LIMIT"),"\n      "),"\n      ",Object(o.b)("td",{parentName:"tr"},"CPU limit in MHz for the task"),"\n    "),"\n    ",Object(o.b)("tr",{parentName:"tbody"},"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        ",Object(o.b)("code",{parentName:"td"},"NOMAD_ALLOC_ID"),"\n      "),"\n      ",Object(o.b)("td",{parentName:"tr"},"Allocation ID of the task"),"\n    "),"\n    ",Object(o.b)("tr",{parentName:"tbody"},"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        ",Object(o.b)("code",{parentName:"td"},"NOMAD_ALLOC_NAME"),"\n      "),"\n      ",Object(o.b)("td",{parentName:"tr"},"Allocation name of the task"),"\n    "),"\n    ",Object(o.b)("tr",{parentName:"tbody"},"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        ",Object(o.b)("code",{parentName:"td"},"NOMAD_ALLOC_INDEX"),"\n      "),"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        Allocation index; useful to distinguish instances of task groups. From 0\n        to (count - 1). The index is unique within a given version of a job, but\n        canaries or failed tasks in a deployment may reuse the index.\n      "),"\n    "),"\n    ",Object(o.b)("tr",{parentName:"tbody"},"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        ",Object(o.b)("code",{parentName:"td"},"NOMAD_TASK_NAME"),"\n      "),"\n      ",Object(o.b)("td",{parentName:"tr"},"Task\u2018s name"),"\n    "),"\n    ",Object(o.b)("tr",{parentName:"tbody"},"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        ",Object(o.b)("code",{parentName:"td"},"NOMAD_GROUP_NAME"),"\n      "),"\n      ",Object(o.b)("td",{parentName:"tr"},"Group\u2018s name"),"\n    "),"\n    ",Object(o.b)("tr",{parentName:"tbody"},"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        ",Object(o.b)("code",{parentName:"td"},"NOMAD_JOB_NAME"),"\n      "),"\n      ",Object(o.b)("td",{parentName:"tr"},"Job\u2018s name"),"\n    "),"\n    ",Object(o.b)("tr",{parentName:"tbody"},"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        ",Object(o.b)("code",{parentName:"td"},"NOMAD_DC"),"\n      "),"\n      ",Object(o.b)("td",{parentName:"tr"},"Datacenter in which the allocation is running"),"\n    "),"\n    ",Object(o.b)("tr",{parentName:"tbody"},"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        ",Object(o.b)("code",{parentName:"td"},"NOMAD_NAMESPACE"),"\n      "),"\n      ",Object(o.b)("td",{parentName:"tr"},"Namespace in which the allocation is running"),"\n    "),"\n    ",Object(o.b)("tr",{parentName:"tbody"},"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        ",Object(o.b)("code",{parentName:"td"},"NOMAD_REGION"),"\n      "),"\n      ",Object(o.b)("td",{parentName:"tr"},"Region in which the allocation is running"),"\n    "),"\n    ",Object(o.b)("tr",{parentName:"tbody"},"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        ",Object(o.b)("code",{parentName:"td"},"NOMAD_META_<key>"),"\n      "),"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        The metadata value given by ",Object(o.b)("code",{parentName:"td"},"key")," on the task\u2018s\n        metadata. Note that this is different from\n        ",Object(o.b)("a",Object(n.a)({parentName:"td"},{href:"/docs/runtime/interpolation#node-variables-"}),"\n          ",Object(o.b)("code",{parentName:"a"},"${meta.<key>}"),"\n        "),"\n        which are keys in the node\u2018s metadata.\n      "),"\n    "),"\n    ",Object(o.b)("tr",{parentName:"tbody"},"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        ",Object(o.b)("code",{parentName:"td"},"VAULT_TOKEN"),"\n      "),"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        The task\u2018s Vault token. See\n        ",Object(o.b)("a",Object(n.a)({parentName:"td"},{href:"/docs/vault-integration"}),"Vault Integration"),"\n        for more details\n      "),"\n    "),"\n    ",Object(o.b)("tr",{parentName:"tbody"},"\n      ",Object(o.b)("th",Object(n.a)({parentName:"tr"},{colSpan:"2"}),"Network-related Variables"),"\n    "),"\n    ",Object(o.b)("tr",{parentName:"tbody"},"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        ",Object(o.b)("code",{parentName:"td"},"NOMAD_IP_<label>"),"\n      "),"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        Host IP for the given port ",Object(o.b)("code",{parentName:"td"},"label"),". See\n        ",Object(o.b)("a",Object(n.a)({parentName:"td"},{href:"/docs/job-specification/network"}),"here for more")," information.\n      "),"\n    "),"\n    ",Object(o.b)("tr",{parentName:"tbody"},"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        ",Object(o.b)("code",{parentName:"td"},"NOMAD_PORT_<label>"),"\n      "),"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        Port for the given port ",Object(o.b)("code",{parentName:"td"},"label"),". Driver-specified port when a\n        port map is used, otherwise the host\u2018s static or dynamic port\n        allocation. Services should bind to this port. See\n        ",Object(o.b)("a",Object(n.a)({parentName:"td"},{href:"/docs/job-specification/network"}),"here for more")," information.\n      "),"\n    "),"\n    ",Object(o.b)("tr",{parentName:"tbody"},"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        ",Object(o.b)("code",{parentName:"td"},"NOMAD_ADDR_<label>"),"\n      "),"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        Host ",Object(o.b)("code",{parentName:"td"},"IP:Port")," pair for the given port ",Object(o.b)("code",{parentName:"td"},"label"),".\n      "),"\n    "),"\n    ",Object(o.b)("tr",{parentName:"tbody"},"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        ",Object(o.b)("code",{parentName:"td"},"NOMAD_HOST_PORT_<label>"),"\n      "),"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        Port on the host for the port ",Object(o.b)("code",{parentName:"td"},"label"),". See\n        ",Object(o.b)("a",Object(n.a)({parentName:"td"},{href:"/docs/job-specification/network#mapped-ports"}),"here")," for more\n        information.\n      "),"\n    "),"\n    ",Object(o.b)("tr",{parentName:"tbody"},"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        ",Object(o.b)("code",{parentName:"td"},"NOMAD_IP_<task>_<label>"),"\n      "),"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        Host IP for the given port ",Object(o.b)("code",{parentName:"td"},"label")," and ",Object(o.b)("code",{parentName:"td"},"task")," for\n        tasks in the same task group.\n      "),"\n    "),"\n    ",Object(o.b)("tr",{parentName:"tbody"},"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        ",Object(o.b)("code",{parentName:"td"},"NOMAD_PORT_<task>_<label>"),"\n      "),"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        Port for the given port ",Object(o.b)("code",{parentName:"td"},"label")," and ",Object(o.b)("code",{parentName:"td"},"task")," for\n        tasks in the same task group. Driver-specified port when a port map is\n        used, otherwise the host\u2018s static or dynamic port allocation.\n        Services should bind to this port.\n      "),"\n    "),"\n    ",Object(o.b)("tr",{parentName:"tbody"},"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        ",Object(o.b)("code",{parentName:"td"},"NOMAD_ADDR_<task>_<label>"),"\n      "),"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        Host ",Object(o.b)("code",{parentName:"td"},"IP:Port")," pair for the given port ",Object(o.b)("code",{parentName:"td"},"label")," and\n        ",Object(o.b)("code",{parentName:"td"},"task")," for tasks in the same task group.\n      "),"\n    "),"\n    ",Object(o.b)("tr",{parentName:"tbody"},"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        ",Object(o.b)("code",{parentName:"td"},"NOMAD_HOST_PORT_<task>_<label>"),"\n      "),"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        Port on the host for the port ",Object(o.b)("code",{parentName:"td"},"label")," and ",Object(o.b)("code",{parentName:"td"},"task"),"\n        for tasks in the same task group.\n      "),"\n    "),"\n    ",Object(o.b)("tr",{parentName:"tbody"},"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        ",Object(o.b)("code",{parentName:"td"},"NOMAD_UPSTREAM_IP_<service>"),"\n      "),"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        IP for the given ",Object(o.b)("code",{parentName:"td"},"service")," when defined as a Consul Connect\n        ",Object(o.b)("a",Object(n.a)({parentName:"td"},{href:"/docs/job-specification/upstreams"}),"upstream"),".\n      "),"\n    "),"\n    ",Object(o.b)("tr",{parentName:"tbody"},"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        ",Object(o.b)("code",{parentName:"td"},"NOMAD_UPSTREAM_PORT_<service>"),"\n      "),"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        Port for the given ",Object(o.b)("code",{parentName:"td"},"service")," when defined as a Consul Connect\n        ",Object(o.b)("a",Object(n.a)({parentName:"td"},{href:"/docs/job-specification/upstreams"}),"upstream"),".\n      "),"\n    "),"\n    ",Object(o.b)("tr",{parentName:"tbody"},"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        ",Object(o.b)("code",{parentName:"td"},"NOMAD_UPSTREAM_ADDR_<service>"),"\n      "),"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        Host ",Object(o.b)("code",{parentName:"td"},"IP:Port")," for the given ",Object(o.b)("code",{parentName:"td"},"service")," when\n        defined as a Consul Connect\n        ",Object(o.b)("a",Object(n.a)({parentName:"td"},{href:"/docs/job-specification/upstreams"}),"upstream"),".\n      "),"\n    "),"\n    ",Object(o.b)("tr",{parentName:"tbody"},"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        ",Object(o.b)("code",{parentName:"td"},"NOMAD_ENVOY_ADMIN_ADDR_<service>"),"\n      "),"\n      ",Object(o.b)("td",{parentName:"tr"},"\n        Local address ",Object(o.b)("code",{parentName:"td"},"localhost:Port")," for the admin port of the\n        envoy sidecar for the given ",Object(o.b)("code",{parentName:"td"},"service")," when defined as a\n        Consul Connect enabled service.\n      "),"\n    "),"\n  ")))}O.isMDXComponent=!0}},[["En3E",0,1,2,4,3,5,6]]]);