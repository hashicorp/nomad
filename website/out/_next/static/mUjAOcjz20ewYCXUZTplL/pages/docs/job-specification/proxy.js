(window.webpackJsonp=window.webpackJsonp||[]).push([[245],{"/kva":function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/job-specification/proxy",function(){return t("I7JB")}])},I7JB:function(e,a,t){"use strict";t.r(a),t.d(a,"default",(function(){return j}));var n,c=t("wx14"),s=t("Ff2n"),o=t("q1tI"),p=t.n(o),b=t("7ljp"),r=t("j1un"),i=(p.a.createElement,n="Placement",function(e){return console.warn("Component "+n+" was not imported, exported, or provided by MDXProvider as global scope"),Object(b.b)("div",e)}),l={},m=Object(r.a)({layout:"docs",page_title:"proxy Stanza - Job Specification",sidebar_title:"proxy",description:'The "proxy" stanza allows specifying options for configuring\nsidecar proxies used in Consul Connect integration',__resourcePath:"docs/job-specification/proxy.mdx",__scans:{}});function j(e){var a=e.components,t=Object(s.a)(e,["components"]);return Object(b.b)(m,Object(c.a)({},l,t,{components:a,mdxType:"MDXLayout"}),Object(b.b)("h1",{className:"g-type-display-2"},Object(b.b)("a",Object(c.a)({parentName:"h1"},{className:"__permalink-h",href:"#proxy-stanza","aria-label":"proxy stanza permalink"}),"\xbb"),Object(b.b)("a",Object(c.a)({parentName:"h1"},{className:"__target-h",id:"proxy-stanza","aria-hidden":""})),Object(b.b)("inlineCode",{parentName:"h1"},"proxy")," Stanza"),Object(b.b)(i,{groups:["job","group","service","connect","sidecar_service","proxy"],mdxType:"Placement"}),Object(b.b)("p",null,"The ",Object(b.b)("inlineCode",{parentName:"p"},"proxy")," stanza allows configuring various options for the sidecar proxy\nmanaged by Nomad for ",Object(b.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/integrations/consul-connect"}),"Consul\nConnect"),". It is valid only\nwithin the context of a ",Object(b.b)("inlineCode",{parentName:"p"},"sidecar_service")," stanza."),Object(b.b)("pre",{className:"language-hcl"},Object(b.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),"job ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"countdash"')," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"datacenters")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"dc1"'),Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n\n  group ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"api"')," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"network")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"mode")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"bridge"'),"\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"service")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"name")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"count-api"'),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"port")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"9001"'),"\n\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"connect")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"sidecar_service")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n          ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"proxy")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n    task ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"web"')," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"driver")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"docker"'),"\n\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"config")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"image")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"hashicorpnomad/counter-api:v2"'),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(b.b)("h2",{className:"g-type-display-3"},Object(b.b)("a",Object(c.a)({parentName:"h2"},{className:"__permalink-h",href:"#proxy-parameters","aria-label":"proxy parameters permalink"}),"\xbb"),Object(b.b)("a",Object(c.a)({parentName:"h2"},{className:"__target-h",id:"proxy-parameters","aria-hidden":""})),Object(b.b)("inlineCode",{parentName:"h2"},"proxy")," Parameters"),Object(b.b)("ul",null,Object(b.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(b.b)("a",Object(c.a)({parentName:"li"},{id:"local_service_address",className:"__target-lic","aria-hidden":""})),Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"#local_service_address","aria-label":"local_service_address permalink",className:"__permalink-lic"}),Object(b.b)("inlineCode",{parentName:"a"},"local_service_address"))," ",Object(b.b)("inlineCode",{parentName:"li"},'(string: "127.0.0.1")')," - The address the local service binds to. Useful to\ncustomize in clusters with mixed Connect and non-Connect services."),Object(b.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(b.b)("a",Object(c.a)({parentName:"li"},{id:"local_service_port",className:"__target-lic","aria-hidden":""})),Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"#local_service_port","aria-label":"local_service_port permalink",className:"__permalink-lic"}),Object(b.b)("inlineCode",{parentName:"a"},"local_service_port"))," ",Object(b.b)("inlineCode",{parentName:"li"},"(int:[port][])")," - The port the local service binds to.\nUsually the same as the parent service's port, it is useful to customize in clusters with mixed\nConnect and non-Connect services"),Object(b.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(b.b)("a",Object(c.a)({parentName:"li"},{id:"upstreams",className:"__target-lic","aria-hidden":""})),Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"#upstreams","aria-label":"upstreams permalink",className:"__permalink-lic"}),Object(b.b)("inlineCode",{parentName:"a"},"upstreams"))," ",Object(b.b)("code",null,"(",Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"/docs/job-specification/upstreams",title:"Nomad upstream config Specification"}),"upstreams"),": nil)")," - Used to configure details of each upstream service that\nthis sidecar proxy communicates with."),Object(b.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(b.b)("a",Object(c.a)({parentName:"li"},{id:"expose",className:"__target-lic","aria-hidden":""})),Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"#expose","aria-label":"expose permalink",className:"__permalink-lic"}),Object(b.b)("inlineCode",{parentName:"a"},"expose"))," ",Object(b.b)("code",null,"(",Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"/docs/job-specification/expose",title:"Nomad proxy expose configuration"}),"expose"),": nil)")," - Used to configure expose path configuration for Envoy.\nSee Consul's ",Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"https://www.consul.io/docs/connect/registration/service-registration.html#expose-paths-configuration-reference"}),"Expose Paths Configuration Reference"),"\nfor more information."),Object(b.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(b.b)("a",Object(c.a)({parentName:"li"},{id:"config",className:"__target-lic","aria-hidden":""})),Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"#config","aria-label":"config permalink",className:"__permalink-lic"}),Object(b.b)("inlineCode",{parentName:"a"},"config"))," ",Object(b.b)("inlineCode",{parentName:"li"},"(map: nil)")," - Proxy configuration that's opaque to Nomad and\npassed directly to Consul. See ",Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"https://www.consul.io/docs/connect/proxies/envoy.html#dynamic-configuration"}),"Consul Connect's\ndocumentation"),"\nfor details.")),Object(b.b)("h2",{className:"g-type-display-3"},Object(b.b)("a",Object(c.a)({parentName:"h2"},{className:"__permalink-h",href:"#proxy-examples","aria-label":"proxy examples permalink"}),"\xbb"),Object(b.b)("a",Object(c.a)({parentName:"h2"},{className:"__target-h",id:"proxy-examples","aria-hidden":""})),Object(b.b)("inlineCode",{parentName:"h2"},"proxy")," Examples"),Object(b.b)("p",null,"The following example is a proxy specification that includes upstreams configuration."),Object(b.b)("pre",{className:"language-hcl"},Object(b.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"sidecar_service")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"proxy")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"upstreams")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"destination_name")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"count-api"'),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"local_bind_port"),"  ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"8080"),"\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")))}j.isMDXComponent=!0}},[["/kva",0,1,2,4,3,5,6]]]);