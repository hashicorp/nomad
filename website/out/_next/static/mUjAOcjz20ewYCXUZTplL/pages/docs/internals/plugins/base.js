(window.webpackJsonp=window.webpackJsonp||[]).push([[214],{EkmR:function(e,a,t){"use strict";t.r(a),t.d(a,"default",(function(){return m}));var n=t("wx14"),c=t("Ff2n"),s=t("q1tI"),o=t.n(s),p=t("7ljp"),b=t("j1un"),i=(o.a.createElement,{}),r=Object(b.a)({layout:"docs",page_title:"Base Plugin",sidebar_title:"Base",description:"Learn about how to author a Nomad plugin.",__resourcePath:"docs/internals/plugins/base.mdx",__scans:{}});function m(e){var a=e.components,t=Object(c.a)(e,["components"]);return Object(p.b)(r,Object(n.a)({},i,t,{components:a,mdxType:"MDXLayout"}),Object(p.b)("h1",{className:"g-type-display-2"},Object(p.b)("a",Object(n.a)({parentName:"h1"},{className:"__permalink-h",href:"#base-plugin","aria-label":"base plugin permalink"}),"\xbb"),Object(p.b)("a",Object(n.a)({parentName:"h1"},{className:"__target-h",id:"base-plugin","aria-hidden":""})),"Base Plugin"),Object(p.b)("p",null,"The base plugin is a special plugin type implemented by all plugins. It allows\nfor common plugin operations such as defining a configuration schema and\nversion information."),Object(p.b)("h2",{className:"g-type-display-3"},Object(p.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#plugin-api","aria-label":"plugin api permalink"}),"\xbb"),Object(p.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"plugin-api","aria-hidden":""})),"Plugin API"),Object(p.b)("h4",{className:"g-type-display-5"},Object(p.b)("a",Object(n.a)({parentName:"h4"},{className:"__permalink-h",href:"#plugininfo-plugininforesponse-error","aria-label":"plugininfo plugininforesponse error permalink"}),"\xbb"),Object(p.b)("a",Object(n.a)({parentName:"h4"},{className:"__target-h",id:"plugininfo-plugininforesponse-error","aria-hidden":""})),Object(p.b)("inlineCode",{parentName:"h4"},"PluginInfo() (*PluginInfoResponse, error)")),Object(p.b)("p",null,"A ",Object(p.b)("inlineCode",{parentName:"p"},"PluginInfoResponse")," contains meta data about the plugin."),Object(p.b)("pre",{className:"language-go"},Object(p.b)("code",Object(n.a)({parentName:"pre"},{className:"language-go"}),"PluginInfoResponse",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// Type is the plugin type which is implemented"),"\n    Type",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," PluginTypeDriver",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n    ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// Plugin API versions supported by the plugin"),"\n    PluginApiVersions",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"]"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token builtin"}),"string"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"drivers",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),"ApiVersion010",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n    ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// Version of the plugin"),"\n    PluginVersion",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"0.1.0"'),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n    ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// Name of the plugin"),"\n    Name",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"foodriver"'),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(p.b)("h4",{className:"g-type-display-5"},Object(p.b)("a",Object(n.a)({parentName:"h4"},{className:"__permalink-h",href:"#configschema-hclspec-spec-error","aria-label":"configschema hclspec spec error permalink"}),"\xbb"),Object(p.b)("a",Object(n.a)({parentName:"h4"},{className:"__target-h",id:"configschema-hclspec-spec-error","aria-hidden":""})),Object(p.b)("inlineCode",{parentName:"h4"},"ConfigSchema() (*hclspec.Spec, error)")),Object(p.b)("p",null,"The ",Object(p.b)("inlineCode",{parentName:"p"},"ConfigSchema")," function allows a plugin to tell Nomad the schema for its\nconfiguration. This configuration is given in a ",Object(p.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/configuration/plugin"}),"plugin block")," of\nthe client configuration. The schema is defined with the ",Object(p.b)("a",Object(n.a)({parentName:"p"},{href:"https://godoc.org/github.com/hashicorp/nomad/plugins/shared/hclspec"}),"hclspec"),"\npackage."),Object(p.b)("h4",{className:"g-type-display-5"},Object(p.b)("a",Object(n.a)({parentName:"h4"},{className:"__permalink-h",href:"#setconfig-config-config-error","aria-label":"setconfig config config error permalink"}),"\xbb"),Object(p.b)("a",Object(n.a)({parentName:"h4"},{className:"__target-h",id:"setconfig-config-config-error","aria-hidden":""})),Object(p.b)("inlineCode",{parentName:"h4"},"SetConfig(config *Config) error")),Object(p.b)("p",null,"The ",Object(p.b)("inlineCode",{parentName:"p"},"SetConfig")," function is called when starting the plugin for the first\ntime. The ",Object(p.b)("inlineCode",{parentName:"p"},"Config")," given has two different configuration fields. The first\n",Object(p.b)("inlineCode",{parentName:"p"},"PluginConfig"),", is an encoded configuration from the ",Object(p.b)("inlineCode",{parentName:"p"},"plugin")," block of the\nclient config. The second, ",Object(p.b)("inlineCode",{parentName:"p"},"AgentConfig"),", is the Nomad agent's configuration\nwhich is given to all plugins."),Object(p.b)("h2",{className:"g-type-display-3"},Object(p.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#hcl-specifications","aria-label":"hcl specifications permalink"}),"\xbb"),Object(p.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"hcl-specifications","aria-hidden":""})),"HCL Specifications"),Object(p.b)("p",null,Object(p.b)("inlineCode",{parentName:"p"},"*hclspec.Spec")," is a struct that defines the schema to validate an HCL entity\nagainst. The full documentation of the different hcl attribute types can be\nfound on the ",Object(p.b)("a",Object(n.a)({parentName:"p"},{href:"https://godoc.org/github.com/hashicorp/nomad/plugins/shared/hclspec"}),"hclspec godoc"),"."),Object(p.b)("p",null,"For a basic example, lets look at the driver configuration for the raw_exec\ndriver:"),Object(p.b)("pre",{className:"language-hcl"},Object(p.b)("code",Object(n.a)({parentName:"pre"},{className:"language-hcl"}),"job ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"example"')," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n...\n      ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"driver")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"raw_exec"'),"\n      ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"config")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"command")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"/bin/sleep"'),"\n        ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"args")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"100"'),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n      ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(p.b)("p",null,"The ",Object(p.b)("inlineCode",{parentName:"p"},"config")," block is what is validated against the ",Object(p.b)("inlineCode",{parentName:"p"},"hclspec.Spec"),". It has two\nkeys, command which takes a string attribute and args which takes an array\nattribute. The corresponding ",Object(p.b)("inlineCode",{parentName:"p"},"*hclspec.Spec")," would be:"),Object(p.b)("pre",{className:"language-go"},Object(p.b)("code",Object(n.a)({parentName:"pre"},{className:"language-go"}),"    spec ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),":="),"  hclspec",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"NewObject"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"map"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token builtin"}),"string"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"]"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"*"),"hclspec",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),"Spec",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"command"'),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," hclspec",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"NewAttr"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"command"'),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"string"'),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token boolean"}),"true"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n        ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"args"'),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":"),"    hclspec",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"NewAttr"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"args"'),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"list(string)"'),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token boolean"}),"false"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n    ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),"\n")))}m.isMDXComponent=!0},oJ89:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/internals/plugins/base",function(){return t("EkmR")}])}},[["oJ89",0,1,2,4,3,5,6]]]);