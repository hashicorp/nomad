(window.webpackJsonp=window.webpackJsonp||[]).push([[256],{dyGc:function(e,a,t){"use strict";t.r(a),t.d(a,"default",(function(){return l}));var n,c=t("wx14"),s=t("Ff2n"),o=t("q1tI"),p=t.n(o),b=t("7ljp"),r=t("j1un"),m=(p.a.createElement,n="Placement",function(e){return console.warn("Component "+n+" was not imported, exported, or provided by MDXProvider as global scope"),Object(b.b)("div",e)}),i={},j=Object(r.a)({layout:"docs",page_title:"upstreams Stanza - Job Specification",sidebar_title:"upstreams",description:'The "upstreams" stanza allows specifying options for configuring\nupstream services',__resourcePath:"docs/job-specification/upstreams.mdx",__scans:{}});function l(e){var{components:a}=e,t=Object(s.a)(e,["components"]);return Object(b.b)(j,Object(c.a)({},i,t,{components:a,mdxType:"MDXLayout"}),Object(b.b)("h1",{className:"g-type-display-2"},Object(b.b)("a",Object(c.a)({parentName:"h1"},{className:"__permalink-h",href:"#upstreams-stanza","aria-label":"upstreams stanza permalink"}),"\xbb"),Object(b.b)("a",Object(c.a)({parentName:"h1"},{className:"__target-h",id:"upstreams-stanza","aria-hidden":""})),Object(b.b)("inlineCode",{parentName:"h1"},"upstreams")," Stanza"),Object(b.b)(m,{groups:["job","group","service","connect","sidecar_service","proxy","upstreams"],mdxType:"Placement"}),Object(b.b)("p",null,"The ",Object(b.b)("inlineCode",{parentName:"p"},"upstreams")," stanza allows configuring various options for managing upstream\nservices that a ",Object(b.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/integrations/consul-connect"}),"Consul\nConnect")," proxy routes to. It\nis valid only within the context of a ",Object(b.b)("inlineCode",{parentName:"p"},"proxy")," stanza."),Object(b.b)("p",null,"For Consul-specific details see the ",Object(b.b)("a",Object(c.a)({parentName:"p"},{href:"https://learn.hashicorp.com/consul/getting-started/connect#register-a-dependent-service-and-proxy"}),"Consul Connect\nGuide"),"."),Object(b.b)("pre",{className:"language-hcl"},Object(b.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),"job ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"countdash"')," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"datacenters")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"dc1"'),Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n\n  group ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"dashboard"')," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"network")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"mode")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"bridge"'),"\n\n      port ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"http"')," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"static")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"9002"),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"to"),"     ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"9002"),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"service")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"name")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"count-dashboard"'),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"port")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"9002"'),"\n\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"connect")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"sidecar_service")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n          ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"proxy")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n            ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"upstreams")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n              ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"destination_name")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"count-api"'),"\n              ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"local_bind_port"),"  ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"8080"),"\n            ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n          ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n    task ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"dashboard"')," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"driver")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"docker"'),"\n\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"env")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"COUNTING_SERVICE_URL")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"http://',Object(b.b)("span",Object(c.a)({parentName:"span"},{className:"token interpolation"}),Object(b.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"$"),Object(b.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"{"),"NOMAD_UPSTREAM_ADDR_count_api",Object(b.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"}")),'"'),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"config")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"image")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"hashicorpnomad/counter-dashboard:v1"'),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n")),Object(b.b)("h2",{className:"g-type-display-3"},Object(b.b)("a",Object(c.a)({parentName:"h2"},{className:"__permalink-h",href:"#upstreams-parameters","aria-label":"upstreams parameters permalink"}),"\xbb"),Object(b.b)("a",Object(c.a)({parentName:"h2"},{className:"__target-h",id:"upstreams-parameters","aria-hidden":""})),Object(b.b)("inlineCode",{parentName:"h2"},"upstreams")," Parameters"),Object(b.b)("ul",null,Object(b.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(b.b)("a",Object(c.a)({parentName:"li"},{id:"destination_name",className:"__target-lic","aria-hidden":""})),Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"#destination_name","aria-label":"destination_name permalink",className:"__permalink-lic"}),Object(b.b)("inlineCode",{parentName:"a"},"destination_name"))," ",Object(b.b)("inlineCode",{parentName:"li"},"(string: <required>)")," - Name of the upstream service."),Object(b.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(b.b)("a",Object(c.a)({parentName:"li"},{id:"local_bind_port",className:"__target-lic","aria-hidden":""})),Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"#local_bind_port","aria-label":"local_bind_port permalink",className:"__permalink-lic"}),Object(b.b)("inlineCode",{parentName:"a"},"local_bind_port"))," - ",Object(b.b)("inlineCode",{parentName:"li"},"(int: <required>)")," - The port the proxy will receive\nconnections for the upstream on.")),Object(b.b)("p",null,"The ",Object(b.b)("inlineCode",{parentName:"p"},"NOMAD_UPSTREAM_ADDR_<destination_name>")," environment variables may be used\nto interpolate the upstream's ",Object(b.b)("inlineCode",{parentName:"p"},"host:port")," address."),Object(b.b)("p",null,"Applications are encouraged to connect to ",Object(b.b)("inlineCode",{parentName:"p"},"127.0.0.1")," and a well defined port\n(eg 6379 for Redis) by default. Then when using Consul Connect the application\ncan be deployed with the Redis upstream's ",Object(b.b)("inlineCode",{parentName:"p"},"local_bind_port = 6379")," and require\nno explicit configuration."),Object(b.b)("h2",{className:"g-type-display-3"},Object(b.b)("a",Object(c.a)({parentName:"h2"},{className:"__permalink-h",href:"#upstreams-examples","aria-label":"upstreams examples permalink"}),"\xbb"),Object(b.b)("a",Object(c.a)({parentName:"h2"},{className:"__target-h",id:"upstreams-examples","aria-hidden":""})),Object(b.b)("inlineCode",{parentName:"h2"},"upstreams")," Examples"),Object(b.b)("p",null,"The following example is an upstream config with the name of the destination service\nand a local bind port."),Object(b.b)("pre",{className:"language-hcl"},Object(b.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),"    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"upstreams")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"destination_name")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"count-api"'),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"local_bind_port")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"8080"),"\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")))}l.isMDXComponent=!0},rEoV:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/job-specification/upstreams",function(){return t("dyGc")}])}},[["rEoV",0,1,2,4,3,5,6]]]);