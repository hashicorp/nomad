(window.webpackJsonp=window.webpackJsonp||[]).push([[86],{bkky:function(e,a,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/commands/deployment/promote",function(){return n("o3Ww")}])},o3Ww:function(e,a,n){"use strict";n.r(a),n.d(a,"default",(function(){return b}));var t=n("wx14"),c=n("Ff2n"),r=n("q1tI"),i=n.n(r),o=n("7ljp"),s=n("j1un"),l=(i.a.createElement,{}),p=Object(s.a)({layout:"docs",page_title:"Commands: deployment promote",sidebar_title:"promote",description:"The deployment promote command is used to promote canaries in a deployment.\n",__resourcePath:"docs/commands/deployment/promote.mdx",__scans:{}});function b(e){var a=e.components,n=Object(c.a)(e,["components"]);return Object(o.b)(p,Object(t.a)({},l,n,{components:a,mdxType:"MDXLayout"}),Object(o.b)("h1",{className:"g-type-display-2"},Object(o.b)("a",Object(t.a)({parentName:"h1"},{className:"__permalink-h",href:"#command-deployment-promote","aria-label":"command deployment promote permalink"}),"\xbb"),Object(o.b)("a",Object(t.a)({parentName:"h1"},{className:"__target-h",id:"command-deployment-promote","aria-hidden":""})),"Command: deployment promote"),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"deployment promote"),' command is used to promote task groups in a deployment.\nPromotion should occur when the deployment has placed canaries for a task group\nand those canaries have been deemed healthy. When a task group is promoted, the\nrolling upgrade of the remaining allocations is unblocked. If the canaries are\nfound to be unhealthy, the deployment may either be failed using the "nomad\ndeployment fail" command, the job can be failed forward by submitting a new\nversion or failed backwards by reverting to an older version using the\n',Object(o.b)("a",Object(t.a)({parentName:"p"},{href:"/docs/commands/job/revert"}),Object(o.b)("inlineCode",{parentName:"a"},"job revert"))," command."),Object(o.b)("h2",{className:"g-type-display-3"},Object(o.b)("a",Object(t.a)({parentName:"h2"},{className:"__permalink-h",href:"#usage","aria-label":"usage permalink"}),"\xbb"),Object(o.b)("a",Object(t.a)({parentName:"h2"},{className:"__target-h",id:"usage","aria-hidden":""})),"Usage"),Object(o.b)("pre",{className:"language-plaintext"},Object(o.b)("code",Object(t.a)({parentName:"pre"},{className:"language-plaintext"}),"nomad deployment promote [options] <deployment id>\n")),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"deployment promote")," command requires a single argument, a deployment ID or\nprefix. When run without specifying any groups to promote, the promote command\npromotes all task groups. The group flag can be specified multiple times to\nselect particular groups to promote."),Object(o.b)("h2",{className:"g-type-display-3"},Object(o.b)("a",Object(t.a)({parentName:"h2"},{className:"__permalink-h",href:"#general-options","aria-label":"general options permalink"}),"\xbb"),Object(o.b)("a",Object(t.a)({parentName:"h2"},{className:"__target-h",id:"general-options","aria-hidden":""})),"General Options"),Object(o.b)("ul",null,Object(o.b)("li",Object(t.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(t.a)({parentName:"li"},{id:"address",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(t.a)({parentName:"p"},{href:"#address","aria-label":"address permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"-address=<addr>")),": The address of the Nomad server. Overrides the ",Object(o.b)("inlineCode",{parentName:"p"},"NOMAD_ADDR"),"\nenvironment variable if set. Defaults to ",Object(o.b)("inlineCode",{parentName:"p"},"http://127.0.0.1:4646"),".")),Object(o.b)("li",Object(t.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(t.a)({parentName:"li"},{id:"region",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(t.a)({parentName:"p"},{href:"#region","aria-label":"region permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"-region=<region>")),": The region of the Nomad server to forward commands to.\nOverrides the ",Object(o.b)("inlineCode",{parentName:"p"},"NOMAD_REGION")," environment variable if set. Defaults to the\nAgent's local region.")),Object(o.b)("li",Object(t.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(t.a)({parentName:"li"},{id:"namespace",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(t.a)({parentName:"p"},{href:"#namespace","aria-label":"namespace permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"-namespace=<namespace>")),": The target namespace for queries and actions bound\nto a namespace. Overrides the NOMAD_NAMESPACE environment variable if set.\nIf set to '*', job and alloc subcommands query all namespacecs authorized to\nuser. Defaults to the \"default\" namespace.")),Object(o.b)("li",Object(t.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(t.a)({parentName:"li"},{id:"no-color",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(t.a)({parentName:"p"},{href:"#no-color","aria-label":"no color permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"-no-color")),": Disables colored command output. Alternatively,\n",Object(o.b)("inlineCode",{parentName:"p"},"NOMAD_CLI_NO_COLOR")," may be set.")),Object(o.b)("li",Object(t.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(t.a)({parentName:"li"},{id:"ca-cert",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(t.a)({parentName:"p"},{href:"#ca-cert","aria-label":"ca cert permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"-ca-cert=<path>")),": Path to a PEM encoded CA cert file to use to verify the\nNomad server SSL certificate. Overrides the ",Object(o.b)("inlineCode",{parentName:"p"},"NOMAD_CACERT")," environment\nvariable if set.")),Object(o.b)("li",Object(t.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(t.a)({parentName:"li"},{id:"ca-path",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(t.a)({parentName:"p"},{href:"#ca-path","aria-label":"ca path permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"-ca-path=<path>")),": Path to a directory of PEM encoded CA cert files to verify\nthe Nomad server SSL certificate. If both ",Object(o.b)("inlineCode",{parentName:"p"},"-ca-cert")," and ",Object(o.b)("inlineCode",{parentName:"p"},"-ca-path")," are\nspecified, ",Object(o.b)("inlineCode",{parentName:"p"},"-ca-cert")," is used. Overrides the ",Object(o.b)("inlineCode",{parentName:"p"},"NOMAD_CAPATH")," environment\nvariable if set.")),Object(o.b)("li",Object(t.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(t.a)({parentName:"li"},{id:"client-cert",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(t.a)({parentName:"p"},{href:"#client-cert","aria-label":"client cert permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"-client-cert=<path>")),": Path to a PEM encoded client certificate for TLS\nauthentication to the Nomad server. Must also specify ",Object(o.b)("inlineCode",{parentName:"p"},"-client-key"),". Overrides\nthe ",Object(o.b)("inlineCode",{parentName:"p"},"NOMAD_CLIENT_CERT")," environment variable if set.")),Object(o.b)("li",Object(t.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(t.a)({parentName:"li"},{id:"client-key",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(t.a)({parentName:"p"},{href:"#client-key","aria-label":"client key permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"-client-key=<path>")),": Path to an unencrypted PEM encoded private key matching\nthe client certificate from ",Object(o.b)("inlineCode",{parentName:"p"},"-client-cert"),". Overrides the ",Object(o.b)("inlineCode",{parentName:"p"},"NOMAD_CLIENT_KEY"),"\nenvironment variable if set.")),Object(o.b)("li",Object(t.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(t.a)({parentName:"li"},{id:"tls-server-name",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(t.a)({parentName:"p"},{href:"#tls-server-name","aria-label":"tls server name permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"-tls-server-name=<value>")),": The server name to use as the SNI host when connecting\nvia TLS. Overrides the ",Object(o.b)("inlineCode",{parentName:"p"},"NOMAD_TLS_SERVER_NAME")," environment variable if set.")),Object(o.b)("li",Object(t.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(t.a)({parentName:"li"},{id:"tls-skip-verify",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(t.a)({parentName:"p"},{href:"#tls-skip-verify","aria-label":"tls skip verify permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"-tls-skip-verify")),": Do not verify TLS certificate. This is highly not\nrecommended. Verification will also be skipped if ",Object(o.b)("inlineCode",{parentName:"p"},"NOMAD_SKIP_VERIFY")," is set.")),Object(o.b)("li",Object(t.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(t.a)({parentName:"li"},{id:"token",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(t.a)({parentName:"p"},{href:"#token","aria-label":"token permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"-token")),": The SecretID of an ACL token to use to authenticate API requests with.\nOverrides the ",Object(o.b)("inlineCode",{parentName:"p"},"NOMAD_TOKEN")," environment variable if set."))),Object(o.b)("h2",{className:"g-type-display-3"},Object(o.b)("a",Object(t.a)({parentName:"h2"},{className:"__permalink-h",href:"#promote-options","aria-label":"promote options permalink"}),"\xbb"),Object(o.b)("a",Object(t.a)({parentName:"h2"},{className:"__target-h",id:"promote-options","aria-hidden":""})),"Promote Options"),Object(o.b)("ul",null,Object(o.b)("li",Object(t.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(t.a)({parentName:"li"},{id:"group",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(t.a)({parentName:"p"},{href:"#group","aria-label":"group permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"-group")),": Group may be specified many times and is used to promote that\nparticular group. If no specific groups are specified, all groups are\npromoted.")),Object(o.b)("li",Object(t.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(t.a)({parentName:"li"},{id:"detach",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(t.a)({parentName:"p"},{href:"#detach","aria-label":"detach permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"-detach")),": Return immediately instead of monitoring. A new evaluation ID\nwill be output, which can be used to examine the evaluation using the\n",Object(o.b)("a",Object(t.a)({parentName:"p"},{href:"/docs/commands/eval-status"}),"eval status")," command")),Object(o.b)("li",Object(t.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(t.a)({parentName:"li"},{id:"verbose",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(t.a)({parentName:"p"},{href:"#verbose","aria-label":"verbose permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"-verbose")),": Show full information."))),Object(o.b)("h2",{className:"g-type-display-3"},Object(o.b)("a",Object(t.a)({parentName:"h2"},{className:"__permalink-h",href:"#examples","aria-label":"examples permalink"}),"\xbb"),Object(o.b)("a",Object(t.a)({parentName:"h2"},{className:"__target-h",id:"examples","aria-hidden":""})),"Examples"),Object(o.b)("p",null,"Promote canaries in all groups:"),Object(o.b)("pre",{className:"language-shell-session"},Object(o.b)("code",Object(t.a)({parentName:"pre"},{className:"language-shell-session"}),Object(o.b)("span",Object(t.a)({parentName:"code"},{className:"token output"}),"# Have two task groups waiting for promotion.\n"),Object(o.b)("span",Object(t.a)({parentName:"code"},{className:"token command"}),Object(o.b)("span",Object(t.a)({parentName:"span"},{className:"token sh important"}),"$")," ",Object(o.b)("span",Object(t.a)({parentName:"span"},{className:"token bash language-bash"}),"nomad status example")),"\n",Object(o.b)("span",Object(t.a)({parentName:"code"},{className:"token output"}),"ID            = example\nName          = example\nSubmit Date   = 07/25/17 18:35:05 UTC\nType          = service\nPriority      = 50\nDatacenters   = dc1\nStatus        = running\nPeriodic      = false\nParameterized = false\n\nSummary\nTask Group  Queued  Starting  Running  Failed  Complete  Lost\ncache       0       0         3        0       0         0\nweb         0       0         3        0       0         0\n\nLatest Deployment\nID          = 9fa81f27\nStatus      = running\nDescription = Deployment is running but requires manual promotion\n\nDeployed\nTask Group  Promoted  Desired  Canaries  Placed  Healthy  Unhealthy\nweb         false     2        1         1       0        0\ncache       false     2        1         1       0        0\n\nAllocations\nID        Node ID   Task Group  Version  Desired  Status   Created At\n091377e5  a8dcce2d  web         1        run      running  07/25/17 18:35:05 UTC\nd2b13584  a8dcce2d  cache       1        run      running  07/25/17 18:35:05 UTC\n4bb185b7  a8dcce2d  web         0        run      running  07/25/17 18:31:34 UTC\n9b6811ee  a8dcce2d  cache       0        run      running  07/25/17 18:31:34 UTC\ne0a2441b  a8dcce2d  cache       0        run      running  07/25/17 18:31:34 UTC\nf2409f7d  a8dcce2d  web         0        run      running  07/25/17 18:31:34 UTC\n\n# Promote all groups within the deployment\n"),Object(o.b)("span",Object(t.a)({parentName:"code"},{className:"token command"}),Object(o.b)("span",Object(t.a)({parentName:"span"},{className:"token sh important"}),"$")," ",Object(o.b)("span",Object(t.a)({parentName:"span"},{className:"token bash language-bash"}),"nomad deployment promote 9fa81f27")),"\n",Object(o.b)("span",Object(t.a)({parentName:"code"},{className:"token output"}),'==> Monitoring evaluation "6c6e64ae"\n    Evaluation triggered by job "example"\n    Evaluation within deployment: "9fa81f27"\n    Allocation "8fa21654" created: node "a8dcce2d", group "web"\n    Allocation "9f6727a6" created: node "a8dcce2d", group "cache"\n    Evaluation status changed: "pending" -> "complete"\n==> Evaluation "6c6e64ae" finished with status "complete"\n\n# Inspect the status and see both groups have been promoted.\n'),Object(o.b)("span",Object(t.a)({parentName:"code"},{className:"token command"}),Object(o.b)("span",Object(t.a)({parentName:"span"},{className:"token sh important"}),"$")," ",Object(o.b)("span",Object(t.a)({parentName:"span"},{className:"token bash language-bash"}),"nomad status example")),"\n",Object(o.b)("span",Object(t.a)({parentName:"code"},{className:"token output"}),"ID            = example\nName          = example\nSubmit Date   = 07/25/17 18:35:05 UTC\nType          = service\nPriority      = 50\nDatacenters   = dc1\nStatus        = running\nPeriodic      = false\nParameterized = false\n\nSummary\nTask Group  Queued  Starting  Running  Failed  Complete  Lost\ncache       0       0         2        0       2         0\nweb         0       0         2        0       2         0\n\nLatest Deployment\nID          = 9fa81f27\nStatus      = successful\nDescription = Deployment completed successfully\n\nDeployed\nTask Group  Promoted  Desired  Canaries  Placed  Healthy  Unhealthy\nweb         true      2        1         2       2        0\ncache       true      2        1         2       2        0\n\nAllocations\nID        Node ID   Task Group  Version  Desired  Status    Created At\n8fa21654  a8dcce2d  web         1        run      running   07/25/17 18:35:21 UTC\n9f6727a6  a8dcce2d  cache       1        run      running   07/25/17 18:35:21 UTC\n091377e5  a8dcce2d  web         1        run      running   07/25/17 18:35:05 UTC\nd2b13584  a8dcce2d  cache       1        run      running   07/25/17 18:35:05 UTC\n4bb185b7  a8dcce2d  web         0        stop     complete  07/25/17 18:31:34 UTC\n9b6811ee  a8dcce2d  cache       0        stop     complete  07/25/17 18:31:34 UTC\ne0a2441b  a8dcce2d  cache       0        stop     complete  07/25/17 18:31:34 UTC\nf2409f7d  a8dcce2d  web         0        stop     complete  07/25/17 18:31:34 UTC\n"))),Object(o.b)("p",null,"Promote canaries in a particular group:"),Object(o.b)("pre",{className:"language-shell-session"},Object(o.b)("code",Object(t.a)({parentName:"pre"},{className:"language-shell-session"}),Object(o.b)("span",Object(t.a)({parentName:"code"},{className:"token output"}),"# Have two task groups waiting for promotion.\n"),Object(o.b)("span",Object(t.a)({parentName:"code"},{className:"token command"}),Object(o.b)("span",Object(t.a)({parentName:"span"},{className:"token sh important"}),"$")," ",Object(o.b)("span",Object(t.a)({parentName:"span"},{className:"token bash language-bash"}),"nomad status example")),"\n",Object(o.b)("span",Object(t.a)({parentName:"code"},{className:"token output"}),"ID            = example\nName          = example\nSubmit Date   = 07/25/17 18:37:14 UTC\nType          = service\nPriority      = 50\nDatacenters   = dc1\nStatus        = running\nPeriodic      = false\nParameterized = false\n\nSummary\nTask Group  Queued  Starting  Running  Failed  Complete  Lost\ncache       0       0         3        0       0         0\nweb         0       0         3        0       0         0\n\nLatest Deployment\nID          = a6b87a6c\nStatus      = running\nDescription = Deployment is running but requires manual promotion\n\nDeployed\nTask Group  Promoted  Desired  Canaries  Placed  Healthy  Unhealthy\ncache       false     2        1         1       1        0\nweb         false     2        1         1       1        0\n\nAllocations\nID        Node ID   Task Group  Version  Desired  Status   Created At\n3071ab8f  6240eed6  web         1        run      running  07/25/17 18:37:14 UTC\neeeed13b  6240eed6  cache       1        run      running  07/25/17 18:37:14 UTC\n0ee7800c  6240eed6  cache       0        run      running  07/25/17 18:37:08 UTC\na714a926  6240eed6  cache       0        run      running  07/25/17 18:37:08 UTC\ncee52788  6240eed6  web         0        run      running  07/25/17 18:37:08 UTC\nee8f972e  6240eed6  web         0        run      running  07/25/17 18:37:08 UTC\n\n# Promote only the cache canaries\n"),Object(o.b)("span",Object(t.a)({parentName:"code"},{className:"token command"}),Object(o.b)("span",Object(t.a)({parentName:"span"},{className:"token sh important"}),"$")," ",Object(o.b)("span",Object(t.a)({parentName:"span"},{className:"token bash language-bash"}),"nomad deployment promote -group cache a6b87a6c")),"\n",Object(o.b)("span",Object(t.a)({parentName:"code"},{className:"token output"}),'==> Monitoring evaluation "37383564"\n    Evaluation triggered by job "example"\n    Evaluation within deployment: "a6b87a6c"\n    Allocation "bbddf5c3" created: node "6240eed6", group "cache"\n    Evaluation status changed: "pending" -> "complete"\n==> Evaluation "37383564" finished with status "complete"\n\n# Inspect the status and see that only the cache canaries are promoted\n'),Object(o.b)("span",Object(t.a)({parentName:"code"},{className:"token command"}),Object(o.b)("span",Object(t.a)({parentName:"span"},{className:"token sh important"}),"$")," ",Object(o.b)("span",Object(t.a)({parentName:"span"},{className:"token bash language-bash"}),"nomad status example")),"\n",Object(o.b)("span",Object(t.a)({parentName:"code"},{className:"token output"}),"ID            = example\nName          = example\nSubmit Date   = 07/25/17 18:37:14 UTC\nType          = service\nPriority      = 50\nDatacenters   = dc1\nStatus        = running\nPeriodic      = false\nParameterized = false\n\nSummary\nTask Group  Queued  Starting  Running  Failed  Complete  Lost\ncache       0       0         2        0       2         0\nweb         0       0         3        0       0         0\n\nLatest Deployment\nID          = a6b87a6c\nStatus      = running\nDescription = Deployment is running but requires manual promotion\n\nDeployed\nTask Group  Promoted  Desired  Canaries  Placed  Healthy  Unhealthy\nweb         false     2        1         1       1        0\ncache       true      2        1         2       2        0\n\nAllocations\nID        Node ID   Task Group  Version  Desired  Status    Created At\nbbddf5c3  6240eed6  cache       1        run      running   07/25/17 18:37:40 UTC\neeeed13b  6240eed6  cache       1        run      running   07/25/17 18:37:14 UTC\n3071ab8f  6240eed6  web         1        run      running   07/25/17 18:37:14 UTC\na714a926  6240eed6  cache       0        stop     complete  07/25/17 18:37:08 UTC\ncee52788  6240eed6  web         0        run      running   07/25/17 18:37:08 UTC\nee8f972e  6240eed6  web         0        run      running   07/25/17 18:37:08 UTC\n0ee7800c  6240eed6  cache       0        stop     complete  07/25/17 18:37:08 UTC\n"))))}b.isMDXComponent=!0}},[["bkky",0,1,2,4,3,5,6]]]);