(window.webpackJsonp=window.webpackJsonp||[]).push([[232],{"87EY":function(e,a,t){"use strict";t.r(a),t.d(a,"default",(function(){return N}));var n,c=t("wx14"),s=t("Ff2n"),o=t("q1tI"),p=t.n(o),b=t("7ljp"),r=t("j1un"),m=(p.a.createElement,n="Placement",function(e){return console.warn("Component "+n+" was not imported, exported, or provided by MDXProvider as global scope"),Object(b.b)("div",e)}),j={},O=Object(r.a)({layout:"docs",page_title:"expose Stanza - Job Specification",sidebar_title:"expose",description:'The "expose" stanza allows specifying options for configuring Envoy expose\npaths used in Consul Connect integration',__resourcePath:"docs/job-specification/expose.mdx",__scans:{}});function N(e){var{components:a}=e,t=Object(s.a)(e,["components"]);return Object(b.b)(O,Object(c.a)({},j,t,{components:a,mdxType:"MDXLayout"}),Object(b.b)("h1",{className:"g-type-display-2"},Object(b.b)("a",Object(c.a)({parentName:"h1"},{className:"__permalink-h",href:"#expose-stanza","aria-label":"expose stanza permalink"}),"\xbb"),Object(b.b)("a",Object(c.a)({parentName:"h1"},{className:"__target-h",id:"expose-stanza","aria-hidden":""})),Object(b.b)("inlineCode",{parentName:"h1"},"expose")," Stanza"),Object(b.b)(m,{groups:["job","group","service","connect","sidecar_service","proxy","expose"],mdxType:"Placement"}),Object(b.b)("p",null,"The ",Object(b.b)("inlineCode",{parentName:"p"},"expose")," stanza allows configuration of additional listeners for the default Envoy sidecar\nproxy managed by Nomad for ",Object(b.b)("a",Object(c.a)({parentName:"p"},{href:"/guides/integrations/consul-connect"}),"Consul Connect"),". These\nlisteners create a bypass of the Connect TLS and network namespace isolation, enabling\nnon-Connect enabled services to make requests to specific HTTP paths through the sidecar proxy."),Object(b.b)("p",null,"The ",Object(b.b)("inlineCode",{parentName:"p"},"expose")," configuration is valid within the context of a ",Object(b.b)("inlineCode",{parentName:"p"},"proxy")," stanza. Additional\ninformation about Expose Path configurations for Envoy can be found in Consul's\n",Object(b.b)("a",Object(c.a)({parentName:"p"},{href:"https://www.consul.io/docs/connect/registration/service-registration.html#expose-paths-configuration-reference"}),"Expose Paths Configuration Reference"),"."),Object(b.b)("p",null,"Service ",Object(b.b)("a",Object(c.a)({parentName:"p"},{href:"https://nomadproject.io/docs/job-specification/service/#check-parameters"}),"check"),"\nconfigurations can use their ",Object(b.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/job-specification/service#expose"}),"expose"),"\nparameter to automatically generate expose path configurations for HTTP and gRPC checks."),Object(b.b)("pre",{className:"language-hcl"},Object(b.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),"job ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"expose-check-example"')," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"datacenters")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"dc1"'),Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n\n  group ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"api"')," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"network")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"mode")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"bridge"'),"\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"service")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"name")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"count-api"'),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"port")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"9001"'),"\n\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"connect")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"sidecar_service")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"check")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"expose"),"   ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token boolean"}),"true"),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"name"),"     ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"api-health"'),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"type"),"     ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"http"'),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"path"),"     ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"/health"'),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"interval")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"10s"'),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"timeout"),"  ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"3s"'),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n    task ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"web"')," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"driver")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"docker"'),"\n\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"config")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"image")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"hashicorpnomad/counter-api:v2"'),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(b.b)("p",null,"For uses other than Consul service checks, use the ",Object(b.b)("inlineCode",{parentName:"p"},"expose")," configuration in the\n",Object(b.b)("inlineCode",{parentName:"p"},"proxy")," stanza. The example below effectively demonstrates exposing the ",Object(b.b)("inlineCode",{parentName:"p"},"/health"),"\nendpoint similar to the example above, but using the fully flexible ",Object(b.b)("inlineCode",{parentName:"p"},"expose"),"\nconfiguration."),Object(b.b)("pre",{className:"language-hcl"},Object(b.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),"job ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"expose-example"')," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"datacenters")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"dc1"'),Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n\n  group ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"api"')," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"network")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"mode")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"bridge"'),"\n\n      port ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"api_expose_healthcheck"')," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"to")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," -",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"1"),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"service")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"name")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"count-api"'),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"port")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"9001"'),"\n\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"connect")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"sidecar_service")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n          ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"proxy")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n            ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"expose")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n              ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"path")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n                ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"path"),"            ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"/health"'),"\n                ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"protocol"),"        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"http"'),"\n                ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"local_path_port")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"9001"),"\n                ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"listener_port"),"   ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"api_expose_healthcheck"'),"\n              ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n            ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n          ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"check")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"name"),"     ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"api-health"'),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"type"),"     ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"http"'),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"path"),"     ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"/health"'),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"port"),"     ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"api_expose_healthcheck"'),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"interval")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"10s"'),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"timeout"),"  ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"3s"'),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n    task ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"web"')," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"driver")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"docker"'),"\n\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"config")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"image")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"hashicorpnomad/counter-api:v2"'),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token comment"}),"# e.g. reference ${NOMAD_PORT_api_expose_healthcheck} for other uses"),"\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(b.b)("h2",{className:"g-type-display-3"},Object(b.b)("a",Object(c.a)({parentName:"h2"},{className:"__permalink-h",href:"#expose-parameters","aria-label":"expose parameters permalink"}),"\xbb"),Object(b.b)("a",Object(c.a)({parentName:"h2"},{className:"__target-h",id:"expose-parameters","aria-hidden":""})),Object(b.b)("inlineCode",{parentName:"h2"},"expose")," Parameters"),Object(b.b)("ul",null,Object(b.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(b.b)("a",Object(c.a)({parentName:"li"},{id:"path",className:"__target-lic","aria-hidden":""})),Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"#path","aria-label":"path permalink",className:"__permalink-lic"}),Object(b.b)("inlineCode",{parentName:"a"},"path"))," ",Object(b.b)("code",null,"(",Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"/docs/job-specification/expose#path-parameters",title:"Nomad Expose Path Parameters"}),"Path"),": nil)")," - A list of ",Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"/docs/job-specification/expose/#path-1"}),"Envoy Expose Path Configurations"),"\nto expose through Envoy.")),Object(b.b)("h3",{className:"g-type-display-4"},Object(b.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#path-parameters","aria-label":"path parameters permalink"}),"\xbb"),Object(b.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"path-parameters","aria-hidden":""})),Object(b.b)("inlineCode",{parentName:"h3"},"path")," Parameters"),Object(b.b)("ul",null,Object(b.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(b.b)("a",Object(c.a)({parentName:"li"},{id:"path-1",className:"__target-lic","aria-hidden":""})),Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"#path-1","aria-label":"path permalink",className:"__permalink-lic"}),Object(b.b)("inlineCode",{parentName:"a"},"path"))," ",Object(b.b)("inlineCode",{parentName:"li"},"(string: required)")," - The HTTP or gRPC path to expose. The path must be prefixed\nwith a slash."),Object(b.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(b.b)("a",Object(c.a)({parentName:"li"},{id:"protocol",className:"__target-lic","aria-hidden":""})),Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"#protocol","aria-label":"protocol permalink",className:"__permalink-lic"}),Object(b.b)("inlineCode",{parentName:"a"},"protocol"))," ",Object(b.b)("inlineCode",{parentName:"li"},"(string: required)")," - Sets the protocol of the listener. Must be\n",Object(b.b)("inlineCode",{parentName:"li"},"http")," or ",Object(b.b)("inlineCode",{parentName:"li"},"http2"),". For gRPC use ",Object(b.b)("inlineCode",{parentName:"li"},"http2"),"."),Object(b.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(b.b)("a",Object(c.a)({parentName:"li"},{id:"local_path_port",className:"__target-lic","aria-hidden":""})),Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"#local_path_port","aria-label":"local_path_port permalink",className:"__permalink-lic"}),Object(b.b)("inlineCode",{parentName:"a"},"local_path_port"))," ",Object(b.b)("inlineCode",{parentName:"li"},"(int: required)")," - The port the service is listening to for connections to\nthe configured ",Object(b.b)("inlineCode",{parentName:"li"},"path"),". Typically this will be the same as the ",Object(b.b)("inlineCode",{parentName:"li"},"service.port")," value, but\ncould be different if for example the exposed path is intended to resolve to another task\nin the task group."),Object(b.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(b.b)("a",Object(c.a)({parentName:"li"},{id:"listener_port",className:"__target-lic","aria-hidden":""})),Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"#listener_port","aria-label":"listener_port permalink",className:"__permalink-lic"}),Object(b.b)("inlineCode",{parentName:"a"},"listener_port"))," ",Object(b.b)("code",null,"(",Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"/docs/job-specification/network#port-parameters",title:"Nomad Port Parameters"}),"Port"),": required)")," - The name of the port to use\nfor the exposed listener. The port should be configured to ",Object(b.b)("a",Object(c.a)({parentName:"li"},{href:"/docs/job-specification/network#to"}),"map inside"),"\nthe task's network namespace.")),Object(b.b)("h2",{className:"g-type-display-3"},Object(b.b)("a",Object(c.a)({parentName:"h2"},{className:"__permalink-h",href:"#expose-examples","aria-label":"expose examples permalink"}),"\xbb"),Object(b.b)("a",Object(c.a)({parentName:"h2"},{className:"__target-h",id:"expose-examples","aria-hidden":""})),Object(b.b)("inlineCode",{parentName:"h2"},"expose")," Examples"),Object(b.b)("p",null,"The following example is configured to expose the ",Object(b.b)("inlineCode",{parentName:"p"},"/metrics")," endpoint of the Connect-enabled\n",Object(b.b)("inlineCode",{parentName:"p"},"count-dashboard")," service, using the ",Object(b.b)("inlineCode",{parentName:"p"},"HTTP")," protocol. ",Object(b.b)("inlineCode",{parentName:"p"},"count-dashboard")," is expected\nto listen inside its namespace to port ",Object(b.b)("inlineCode",{parentName:"p"},"9001"),", and external services will be able to\nreach its ",Object(b.b)("inlineCode",{parentName:"p"},"/metrics")," endpoint by connecting to the ",Object(b.b)("a",Object(c.a)({parentName:"p"},{href:"https://nomadproject.io/docs/configuration/client/#network_interface"}),"network interface"),"\nof the node on the allocated ",Object(b.b)("inlineCode",{parentName:"p"},"metrics")," ",Object(b.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/job-specification/network#port-parameters"}),"Port"),"."),Object(b.b)("pre",{className:"language-hcl"},Object(b.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"service")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"name")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"count-dashboard"'),"\n  ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"port")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"9001"'),"\n\n  ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"connect")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"sidecar_service")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"proxy")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"expose")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n          ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"path")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n            ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"path"),"            ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"/metrics"'),"\n            ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"protocol"),"        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"http"'),"\n            ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"local_path_port")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"9001"),"\n            ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"listener_port"),"   ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"metrics"'),"\n          ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(b.b)("h2",{className:"g-type-display-3"},Object(b.b)("a",Object(c.a)({parentName:"h2"},{className:"__permalink-h",href:"#path-examples","aria-label":"path examples permalink"}),"\xbb"),Object(b.b)("a",Object(c.a)({parentName:"h2"},{className:"__target-h",id:"path-examples","aria-hidden":""})),Object(b.b)("inlineCode",{parentName:"h2"},"path")," Examples"),Object(b.b)("p",null,"The following example is an expose configuration that exposes a ",Object(b.b)("inlineCode",{parentName:"p"},"/metrics")," endpoint\nusing the ",Object(b.b)("inlineCode",{parentName:"p"},"http2")," protocol (typical for gRPC), and an HTTP ",Object(b.b)("inlineCode",{parentName:"p"},"/v2/health")," endpoint."),Object(b.b)("pre",{className:"language-hcl"},Object(b.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"proxy")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"expose")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"path")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"path"),"            ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"/metrics"'),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"protocol"),"        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"http2"'),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"local_path_port")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"9001"),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"listener_port"),"   ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"expose"'),"\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"path")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"path"),"            ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"/v2/health"'),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"protocol"),"        ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"http"'),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"local_path_port")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"9001"),"\n      ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"listener_port"),"   ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"expose"'),"\n    ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(b.b)("h3",{className:"g-type-display-4"},Object(b.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#exposing-service-checks","aria-label":"exposing service checks permalink"}),"\xbb"),Object(b.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"exposing-service-checks","aria-hidden":""})),"Exposing Service Checks"),Object(b.b)("p",null,"A common use case for ",Object(b.b)("inlineCode",{parentName:"p"},"expose")," is for exposing endpoints used in Consul service check\ndefinitions. For these cases the ",Object(b.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/job-specification/service#expose"}),"expose"),"\nparameter in the service check stanza can be used to automatically generate the\nexpose path configuration. Configuring a port for use by the check is optional,\nas a dynamic port will be automatically generated if not provided."),Object(b.b)("pre",{className:"language-hcl"},Object(b.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"check")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"expose"),"   ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token boolean"}),"true"),"\n  ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"type"),"     ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"http"'),"\n  ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"name"),"     ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"dashboard-health"'),"\n  ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"path"),"     ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"/health"'),"\n  ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"interval")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"10s"'),"\n  ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"timeout"),"  ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"3s"'),"\n",Object(b.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")))}N.isMDXComponent=!0},"ovS+":function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/job-specification/expose",function(){return t("87EY")}])}},[["ovS+",0,1,2,4,3,5,6]]]);