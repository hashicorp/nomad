(window.webpackJsonp=window.webpackJsonp||[]).push([[242],{"/vlL":function(e,a,t){"use strict";t.r(a),t.d(a,"default",(function(){return j}));var n,c=t("wx14"),s=t("Ff2n"),b=t("q1tI"),p=t.n(b),o=t("7ljp"),r=t("j1un"),i=(p.a.createElement,n="Placement",function(e){return console.warn("Component "+n+" was not imported, exported, or provided by MDXProvider as global scope"),Object(o.b)("div",e)}),m={},l=Object(r.a)({layout:"docs",page_title:"parameterized Stanza - Job Specification",sidebar_title:"parameterized",description:"A parameterized job is used to encapsulate a set of work that can be carried\nout on various inputs much like a function definition. When the\n`parameterized` stanza is added to a job, the job acts as a function to the\ncluster as a whole.",__resourcePath:"docs/job-specification/parameterized.mdx",__scans:{}});function j(e){var{components:a}=e,t=Object(s.a)(e,["components"]);return Object(o.b)(l,Object(c.a)({},m,t,{components:a,mdxType:"MDXLayout"}),Object(o.b)("h1",{className:"g-type-display-2"},Object(o.b)("a",Object(c.a)({parentName:"h1"},{className:"__permalink-h",href:"#parameterized-stanza","aria-label":"parameterized stanza permalink"}),"\xbb"),Object(o.b)("a",Object(c.a)({parentName:"h1"},{className:"__target-h",id:"parameterized-stanza","aria-hidden":""})),Object(o.b)("inlineCode",{parentName:"h1"},"parameterized")," Stanza"),Object(o.b)(i,{groups:["job","parameterized"],mdxType:"Placement"}),Object(o.b)("p",null,"A parameterized job is used to encapsulate a set of work that can be carried out\non various inputs much like a function definition. When the ",Object(o.b)("inlineCode",{parentName:"p"},"parameterized"),"\nstanza is added to a job, the job acts as a function to the cluster as a whole."),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"parameterized")," stanza allows job operators to configure a job that carries\nout a particular action, define its resource requirements and configure how\ninputs and configuration are retrieved by the tasks within the job."),Object(o.b)("p",null,"To invoke a parameterized job, ",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/commands/job/dispatch",title:"Nomad Job Dispatch Command"}),Object(o.b)("inlineCode",{parentName:"a"},"nomad job dispatch"))," or the equivalent HTTP APIs are\nused. When dispatching against a parameterized job, an opaque payload and\nmetadata may be injected into the job. These inputs to the parameterized job act\nlike arguments to a function. The job consumes them to change its behavior,\nwithout exposing the implementation details to the caller."),Object(o.b)("p",null,"To that end, tasks within the job can add a\n",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/job-specification/dispatch_payload",title:"Nomad dispatch_payload Job Specification"}),Object(o.b)("inlineCode",{parentName:"a"},"dispatch_payload"))," stanza that\ndefines where on the filesystem this payload gets written to. An example payload\nwould be a task's JSON configuration."),Object(o.b)("p",null,"Further, certain metadata may be marked as required when dispatching a job so it\ncan be used to inject configuration directly into a task's arguments using\n",Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/runtime/interpolation",title:"Nomad Runtime Interpolation"}),"interpolation"),". An example of this would be to require a run ID key that\ncould be used to lookup the work the job is suppose to do from a management\nservice or database."),Object(o.b)("p",null,"Each time a job is dispatched, a unique job ID is generated. This allows a\ncaller to track the status of the job, much like a future or promise in some\nprogramming languages."),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),"job ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"docs"')," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"parameterized")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"payload"),"       ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"required"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"meta_required")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"dispatcher_email"'),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"meta_optional")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"pager_email"'),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("h2",{className:"g-type-display-3"},Object(o.b)("a",Object(c.a)({parentName:"h2"},{className:"__permalink-h",href:"#parameterized-requirements","aria-label":"parameterized requirements permalink"}),"\xbb"),Object(o.b)("a",Object(c.a)({parentName:"h2"},{className:"__target-h",id:"parameterized-requirements","aria-hidden":""})),Object(o.b)("inlineCode",{parentName:"h2"},"parameterized")," Requirements"),Object(o.b)("ul",null,Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),"The job's ",Object(o.b)("a",Object(c.a)({parentName:"li"},{href:"/docs/job-specification/job#type",title:"Batch scheduler type"}),"scheduler type")," must be ",Object(o.b)("inlineCode",{parentName:"li"},"batch"),".")),Object(o.b)("h2",{className:"g-type-display-3"},Object(o.b)("a",Object(c.a)({parentName:"h2"},{className:"__permalink-h",href:"#parameterized-parameters","aria-label":"parameterized parameters permalink"}),"\xbb"),Object(o.b)("a",Object(c.a)({parentName:"h2"},{className:"__target-h",id:"parameterized-parameters","aria-hidden":""})),Object(o.b)("inlineCode",{parentName:"h2"},"parameterized")," Parameters"),Object(o.b)("ul",null,Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"meta_optional",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#meta_optional","aria-label":"meta_optional permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"meta_optional"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(array<string>: nil)")," - Specifies the set of metadata keys that\nmay be provided when dispatching against the job.")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"meta_required",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#meta_required","aria-label":"meta_required permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"meta_required"))," ",Object(o.b)("inlineCode",{parentName:"p"},"(array<string>: nil)")," - Specifies the set of metadata keys that\nmust be provided when dispatching against the job.")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"payload",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#payload","aria-label":"payload permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"payload"))," ",Object(o.b)("inlineCode",{parentName:"p"},'(string: "optional")')," - Specifies the requirement of providing a\npayload when dispatching against the parameterized job. The ",Object(o.b)("strong",{parentName:"p"},"maximum size of a\n",Object(o.b)("inlineCode",{parentName:"strong"},"payload")," is 16 KiB"),". The options for this\nfield are:"),Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"optional",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#optional","aria-label":"optional permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},'"optional"'))," - A payload is optional when dispatching against the job.")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"required",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#required","aria-label":"required permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},'"required"'))," - A payload must be provided when dispatching against the job.")),Object(o.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(c.a)({parentName:"li"},{id:"forbidden",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(c.a)({parentName:"p"},{href:"#forbidden","aria-label":"forbidden permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},'"forbidden"'))," - A payload is forbidden when dispatching against the job."))))),Object(o.b)("h2",{className:"g-type-display-3"},Object(o.b)("a",Object(c.a)({parentName:"h2"},{className:"__permalink-h",href:"#parameterized-examples","aria-label":"parameterized examples permalink"}),"\xbb"),Object(o.b)("a",Object(c.a)({parentName:"h2"},{className:"__target-h",id:"parameterized-examples","aria-hidden":""})),Object(o.b)("inlineCode",{parentName:"h2"},"parameterized")," Examples"),Object(o.b)("p",null,"The following examples show non-runnable example parameterized jobs:"),Object(o.b)("h3",{className:"g-type-display-4"},Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#required-inputs","aria-label":"required inputs permalink"}),"\xbb"),Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"required-inputs","aria-hidden":""})),"Required Inputs"),Object(o.b)("p",null,"This example shows a parameterized job that requires both a payload and\nmetadata:"),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),"job ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"video-encode"')," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token comment"}),"# ..."),"\n\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"type")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"batch"'),"\n\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"parameterized")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"payload"),"       ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"required"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"meta_required")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"dispatcher_email"'),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n  group ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"encode"')," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token comment"}),"# ..."),"\n\n    task ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"ffmpeg"')," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"driver")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"exec"'),"\n\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"config")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"command")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"ffmpeg-wrapper"'),"\n\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token comment"}),"# When dispatched, the payload is written to a file that is then read by"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token comment"}),"# the created task upon startup"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"args")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"-config=',Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token interpolation"}),Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"$"),Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"{"),"NOMAD_TASK_DIR",Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"}")),'/config.json"'),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"dispatch_payload")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"file")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"config.json"'),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("h3",{className:"g-type-display-4"},Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#metadata-interpolation","aria-label":"metadata interpolation permalink"}),"\xbb"),Object(o.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"metadata-interpolation","aria-hidden":""})),"Metadata Interpolation"),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),"job ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"email-blast"')," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token comment"}),"# ..."),"\n\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"type")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"batch"'),"\n\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"parameterized")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"payload"),"       ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"forbidden"'),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"meta_required")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"CAMPAIGN_ID"'),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n  group ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"emails"')," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token comment"}),"# ..."),"\n\n    task ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"emailer"')," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"driver")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"exec"'),"\n\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"config")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"command")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"emailer"'),"\n\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token comment"}),"# The campaign ID is interpolated and injected into the task's"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token comment"}),"# arguments"),"\n        ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"args")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"-campaign=',Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token interpolation"}),Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"$"),Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"{"),"NOMAD_META_CAMPAIGN_ID",Object(o.b)("span",Object(c.a)({parentName:"span"},{className:"token punctuation"}),"}")),'"'),Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n      ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")))}j.isMDXComponent=!0},"2PYG":function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/job-specification/parameterized",function(){return t("/vlL")}])}},[["2PYG",0,1,2,4,3,5,6]]]);