{{!
  Copyright (c) HashiCorp, Inc.
  SPDX-License-Identifier: BUSL-1.1
~}}

{{#if this.nomadActions.flyoutActive}}
  <Hds::Flyout id="actions-flyout"
    @onClose={{this.nomadActions.closeFlyout}} @size="large" as |Fly|
  >
    <Fly.Header>
      Actions
      {{#if this.contextualActions.length}}
        <Hds::Dropdown class="actions-dropdown" as |dd|>
          <dd.ToggleButton @color="secondary" @text="Actions for {{if this.task "Task" "Job"}}" @size="medium" />
          {{#each this.contextualActions as |action|}}
            {{#if this.task}}
              <dd.Interactive {{on "click" (fn this.nomadActions.runAction action this.allocation.id this.job)}} @text="{{action.name}}" />
            {{else}}
              {{#if (gt action.allocations.length 1)}}
                <dd.Generic>
                  <Hds::Reveal @text={{action.name}}>
                    <dd.Interactive {{on "click" (fn this.nomadActions.runAction action null this.job)}} @text="Run on a random alloc" />
                    <dd.Interactive {{on "click" (fn this.nomadActions.runAction action "all" this.job)}} @text="Run on all {{action.allocations.length}} allocs" />
                  </Hds::Reveal>
                </dd.Generic>
              {{else}}
                <dd.Interactive {{on "click" (fn this.nomadActions.runAction action (get (object-at 0 action.allocations) "id") this.job)}} @text="{{action.name}}" />
              {{/if}}
            {{/if}}
          {{/each}}
        </Hds::Dropdown>
      {{/if}}
      {{#if this.nomadActions.runningActions.length}}
        <Hds::Button @text="Stop All" @color="critical" @size="medium" {{on "click" this.nomadActions.stopAll}} />
      {{/if}}
      {{#if this.nomadActions.finishedActions.length}}
        <Hds::Button @text="Clear Finished Actions" @color="secondary" @size="medium" {{on "click" this.nomadActions.clearFinishedActions}} />
      {{/if}}
    </Fly.Header>
    <Fly.Body>
      <ul class="actions-queue">
        {{#each this.nomadActions.actionsQueue as |instance|}}
          <ActionCard @instance={{instance}} />
        {{/each}}
      </ul>
    </Fly.Body>
  </Hds::Flyout>
{{/if}}
