(window.webpackJsonp=window.webpackJsonp||[]).push([[129],{"24/w":function(e,a,t){"use strict";t.r(a),t.d(a,"default",(function(){return O}));var n,c=t("wx14"),s=t("Ff2n"),b=t("q1tI"),r=t.n(b),l=t("7ljp"),o=t("j1un"),i=(r.a.createElement,n="EnterpriseAlert",function(e){return console.warn("Component "+n+" was not imported, exported, or provided by MDXProvider as global scope"),Object(l.b)("div",e)}),p={},m=Object(o.a)({layout:"docs",page_title:"Commands: operator snapshot agent",sidebar_title:"snapshot agent",description:"Periodically saves snapshots of Nomad server state\n",__resourcePath:"docs/commands/operator/snapshot-agent.mdx",__scans:{}});function O(e){var a=e.components,t=Object(s.a)(e,["components"]);return Object(l.b)(m,Object(c.a)({},p,t,{components:a,mdxType:"MDXLayout"}),Object(l.b)("h1",{className:"g-type-display-2"},Object(l.b)("a",Object(c.a)({parentName:"h1"},{className:"__permalink-h",href:"#command-operator-snapshot-agent","aria-label":"command operator snapshot agent permalink"}),"\xbb"),Object(l.b)("a",Object(c.a)({parentName:"h1"},{className:"__target-h",id:"command-operator-snapshot-agent","aria-hidden":""})),"Command: operator snapshot agent"),Object(l.b)(i,{mdxType:"EnterpriseAlert"}),Object(l.b)("p",null,"The snapshot agent takes snapshots of the state of the nomad servers and\nsaves them locally, or pushes them to an optional remote storage service."),Object(l.b)("p",null,"The agent can be run as a long-running daemon process or in a one-shot mode\nfrom a batch job. As a long-running daemon, the agent will perform a leader\nelection so multiple processes can be run in a highly available fashion with\nautomatic failover. In daemon mode, the agent will also register itself with\nConsul as a service, along with health checks that show the agent is alive\nand able to take snapshots."),Object(l.b)("p",null,"If ACLs are enabled, a management token must be supplied in order to perform\nsnapshot operations."),Object(l.b)("p",null,"The Config file has the following format (shown populated with default values):"),Object(l.b)("pre",{className:"language-hcl"},Object(l.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"nomad")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"address"),"         ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"http://127.0.0.1:8500"'),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"token"),"           ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'""'),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"region"),"          ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'""'),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"ca_file"),"         ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'""'),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"ca_path"),"         ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'""'),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"cert_file"),"       ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'""'),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"key_file"),"        ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'""'),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"tls_server_name")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'""'),"\n",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n\n",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"snapshot")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"interval"),"         ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"1h"'),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"retain"),"           ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"30"),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"stale"),"            ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token boolean"}),"false"),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"service"),"          ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"nomad-snapshot"'),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"deregister_after")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"72h"'),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"lock_key"),"         ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"nomad-snapshot/lock"'),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"max_failures"),"     ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"3"),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"prefix"),"           ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"nomad"'),"\n",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"log")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"level"),"           ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"INFO"'),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"enable_syslog"),"   ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token boolean"}),"false"),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"syslog_facility")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"LOCAL0"'),"\n",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"consul")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"enabled"),"         ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token boolean"}),"true"),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"http_addr"),"       ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"127.0.0.1:8500"'),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"token"),"           ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'""'),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"datacenter"),"      ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'""'),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"ca_file"),"         ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'""'),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"ca_path"),"         ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'""'),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"cert_file"),"       ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'""'),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"key_file"),"        ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'""'),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"tls_server_name")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'""'),"\n",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token comment"}),"# one storage block is required"),"\n\n",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"local_storage")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"path")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"."'),"\n",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"aws_storage")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"access_key_id"),"     ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'""'),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"secret_access_key")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'""'),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"s3_region"),"         ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'""'),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"s3_endpoint"),"       ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'""'),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"s3_bucket"),"         ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'""'),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"s3_key_prefix"),"     ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"nomad-snapshot"'),"\n",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"azure_blob_storage")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"account_name"),"   ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'""'),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"account_key"),"    ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'""'),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"container_name")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'""'),"\n",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"google_storage")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"bucket")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'""'),"\n",Object(l.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(l.b)("h2",{className:"g-type-display-3"},Object(l.b)("a",Object(c.a)({parentName:"h2"},{className:"__permalink-h",href:"#usage","aria-label":"usage permalink"}),"\xbb"),Object(l.b)("a",Object(c.a)({parentName:"h2"},{className:"__target-h",id:"usage","aria-hidden":""})),"Usage"),Object(l.b)("pre",{className:"language-plaintext"},Object(l.b)("code",Object(c.a)({parentName:"pre"},{className:"language-plaintext"}),"nomad operator snapshot agent [options] <config_file>\n")),Object(l.b)("h2",{className:"g-type-display-3"},Object(l.b)("a",Object(c.a)({parentName:"h2"},{className:"__permalink-h",href:"#general-options","aria-label":"general options permalink"}),"\xbb"),Object(l.b)("a",Object(c.a)({parentName:"h2"},{className:"__target-h",id:"general-options","aria-hidden":""})),"General Options"),Object(l.b)("ul",null,Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"address",className:"__target-lic","aria-hidden":""})),Object(l.b)("p",{parentName:"li"},Object(l.b)("a",Object(c.a)({parentName:"p"},{href:"#address","aria-label":"address permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-address=<addr>")),": The address of the Nomad server. Overrides the ",Object(l.b)("inlineCode",{parentName:"p"},"NOMAD_ADDR"),"\nenvironment variable if set. Defaults to ",Object(l.b)("inlineCode",{parentName:"p"},"http://127.0.0.1:4646"),".")),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"region",className:"__target-lic","aria-hidden":""})),Object(l.b)("p",{parentName:"li"},Object(l.b)("a",Object(c.a)({parentName:"p"},{href:"#region","aria-label":"region permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-region=<region>")),": The region of the Nomad server to forward commands to.\nOverrides the ",Object(l.b)("inlineCode",{parentName:"p"},"NOMAD_REGION")," environment variable if set. Defaults to the\nAgent's local region.")),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"namespace",className:"__target-lic","aria-hidden":""})),Object(l.b)("p",{parentName:"li"},Object(l.b)("a",Object(c.a)({parentName:"p"},{href:"#namespace","aria-label":"namespace permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-namespace=<namespace>")),": The target namespace for queries and actions bound\nto a namespace. Overrides the NOMAD_NAMESPACE environment variable if set.\nIf set to '*', job and alloc subcommands query all namespacecs authorized to\nuser. Defaults to the \"default\" namespace.")),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"no-color",className:"__target-lic","aria-hidden":""})),Object(l.b)("p",{parentName:"li"},Object(l.b)("a",Object(c.a)({parentName:"p"},{href:"#no-color","aria-label":"no color permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-no-color")),": Disables colored command output. Alternatively,\n",Object(l.b)("inlineCode",{parentName:"p"},"NOMAD_CLI_NO_COLOR")," may be set.")),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"ca-cert",className:"__target-lic","aria-hidden":""})),Object(l.b)("p",{parentName:"li"},Object(l.b)("a",Object(c.a)({parentName:"p"},{href:"#ca-cert","aria-label":"ca cert permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-ca-cert=<path>")),": Path to a PEM encoded CA cert file to use to verify the\nNomad server SSL certificate. Overrides the ",Object(l.b)("inlineCode",{parentName:"p"},"NOMAD_CACERT")," environment\nvariable if set.")),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"ca-path",className:"__target-lic","aria-hidden":""})),Object(l.b)("p",{parentName:"li"},Object(l.b)("a",Object(c.a)({parentName:"p"},{href:"#ca-path","aria-label":"ca path permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-ca-path=<path>")),": Path to a directory of PEM encoded CA cert files to verify\nthe Nomad server SSL certificate. If both ",Object(l.b)("inlineCode",{parentName:"p"},"-ca-cert")," and ",Object(l.b)("inlineCode",{parentName:"p"},"-ca-path")," are\nspecified, ",Object(l.b)("inlineCode",{parentName:"p"},"-ca-cert")," is used. Overrides the ",Object(l.b)("inlineCode",{parentName:"p"},"NOMAD_CAPATH")," environment\nvariable if set.")),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"client-cert",className:"__target-lic","aria-hidden":""})),Object(l.b)("p",{parentName:"li"},Object(l.b)("a",Object(c.a)({parentName:"p"},{href:"#client-cert","aria-label":"client cert permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-client-cert=<path>")),": Path to a PEM encoded client certificate for TLS\nauthentication to the Nomad server. Must also specify ",Object(l.b)("inlineCode",{parentName:"p"},"-client-key"),". Overrides\nthe ",Object(l.b)("inlineCode",{parentName:"p"},"NOMAD_CLIENT_CERT")," environment variable if set.")),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"client-key",className:"__target-lic","aria-hidden":""})),Object(l.b)("p",{parentName:"li"},Object(l.b)("a",Object(c.a)({parentName:"p"},{href:"#client-key","aria-label":"client key permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-client-key=<path>")),": Path to an unencrypted PEM encoded private key matching\nthe client certificate from ",Object(l.b)("inlineCode",{parentName:"p"},"-client-cert"),". Overrides the ",Object(l.b)("inlineCode",{parentName:"p"},"NOMAD_CLIENT_KEY"),"\nenvironment variable if set.")),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"tls-server-name",className:"__target-lic","aria-hidden":""})),Object(l.b)("p",{parentName:"li"},Object(l.b)("a",Object(c.a)({parentName:"p"},{href:"#tls-server-name","aria-label":"tls server name permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-tls-server-name=<value>")),": The server name to use as the SNI host when connecting\nvia TLS. Overrides the ",Object(l.b)("inlineCode",{parentName:"p"},"NOMAD_TLS_SERVER_NAME")," environment variable if set.")),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"tls-skip-verify",className:"__target-lic","aria-hidden":""})),Object(l.b)("p",{parentName:"li"},Object(l.b)("a",Object(c.a)({parentName:"p"},{href:"#tls-skip-verify","aria-label":"tls skip verify permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-tls-skip-verify")),": Do not verify TLS certificate. This is highly not\nrecommended. Verification will also be skipped if ",Object(l.b)("inlineCode",{parentName:"p"},"NOMAD_SKIP_VERIFY")," is set.")),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"token",className:"__target-lic","aria-hidden":""})),Object(l.b)("p",{parentName:"li"},Object(l.b)("a",Object(c.a)({parentName:"p"},{href:"#token","aria-label":"token permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-token")),": The SecretID of an ACL token to use to authenticate API requests with.\nOverrides the ",Object(l.b)("inlineCode",{parentName:"p"},"NOMAD_TOKEN")," environment variable if set."))),Object(l.b)("h2",{className:"g-type-display-3"},Object(l.b)("a",Object(c.a)({parentName:"h2"},{className:"__permalink-h",href:"#snapshot-agent-options","aria-label":"snapshot agent options permalink"}),"\xbb"),Object(l.b)("a",Object(c.a)({parentName:"h2"},{className:"__target-h",id:"snapshot-agent-options","aria-hidden":""})),"Snapshot agent Options"),Object(l.b)("h3",{className:"g-type-display-4"},Object(l.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#snapshot-options","aria-label":"snapshot options permalink"}),"\xbb"),Object(l.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"snapshot-options","aria-hidden":""})),"Snapshot Options"),Object(l.b)("ul",null,Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"interval",className:"__target-lic","aria-hidden":""})),Object(l.b)("a",Object(c.a)({parentName:"li"},{href:"#interval","aria-label":"interval permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-interval")),': Interval at which to perform snapshots as a time with a unit suffix, which can be "s", "m", "h" for seconds, minutes, or hours. If 0 is provided, the agent will take a single snapshot and then exit, which is useful for running snapshots via batch jobs. Defaults to "1h".'),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"lock-key",className:"__target-lic","aria-hidden":""})),Object(l.b)("a",Object(c.a)({parentName:"li"},{href:"#lock-key","aria-label":"lock key permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-lock-key")),': A prefix in Consul\'s key-value store used to coordinate between different instances of the snapshot agent in order to only have one active instance at a time. For highly available operation of the snapshot agent, simply run multiple instances. All instances must be configured with the same lock key in order to properly coordinate. Defaults to "nomad-snapshot/lock".'),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"max-failures",className:"__target-lic","aria-hidden":""})),Object(l.b)("a",Object(c.a)({parentName:"li"},{href:"#max-failures","aria-label":"max failures permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-max-failures")),": Number of snapshot failures after which the snapshot agent will give up leadership. In a highly available operation with multiple snapshot agents available, this gives another agent a chance to take over if an agent is experiencing issues, such as running out of disk space for snapshots. Defaults to 3."),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"retain",className:"__target-lic","aria-hidden":""})),Object(l.b)("a",Object(c.a)({parentName:"li"},{href:"#retain","aria-label":"retain permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-retain")),": Number of snapshots to retain. After each snapshot is taken, the oldest snapshots will start to be deleted in order to retain at most this many snapshots. If this is set to 0, the agent will not perform this and snapshots will accumulate forever. Defaults to 30.")),Object(l.b)("h3",{className:"g-type-display-4"},Object(l.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#agent-options","aria-label":"agent options permalink"}),"\xbb"),Object(l.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"agent-options","aria-hidden":""})),"Agent Options"),Object(l.b)("ul",null,Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"deregister-after",className:"__target-lic","aria-hidden":""})),Object(l.b)("a",Object(c.a)({parentName:"li"},{href:"#deregister-after","aria-label":"deregister after permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-deregister-after")),': An interval, after which if the agent is unhealthy it will be automatically deregistered from Consul service. discovery. This is a time with a unit suffix, which can be "s", "m", "h" for seconds, minutes, or hours. If 0 is provided, this will be disabled. Defaults to "72h".'),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"log-level",className:"__target-lic","aria-hidden":""})),Object(l.b)("a",Object(c.a)({parentName:"li"},{href:"#log-level","aria-label":"log level permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-log-level")),': Controls verbosity of snapshot agent logs. Valid options are "TRACE", "DEBUG", "INFO", "WARN", "ERR". Defaults to "INFO".'),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"log-json",className:"__target-lic","aria-hidden":""})),Object(l.b)("a",Object(c.a)({parentName:"li"},{href:"#log-json","aria-label":"log json permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-log-json")),": Output logs in JSON format. Defaults to false."),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"service",className:"__target-lic","aria-hidden":""})),Object(l.b)("a",Object(c.a)({parentName:"li"},{href:"#service","aria-label":"service permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-service")),': The service name to used when registering the agent with Consul. Registering helps monitor running agents and the leader registers an additional health check to monitor that snapshots are taking place. Defaults to "nomad-snapshot".'),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"syslog",className:"__target-lic","aria-hidden":""})),Object(l.b)("a",Object(c.a)({parentName:"li"},{href:"#syslog","aria-label":"syslog permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-syslog")),": This enables forwarding logs to syslog. Defaults to false."),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"syslog-facility",className:"__target-lic","aria-hidden":""})),Object(l.b)("a",Object(c.a)({parentName:"li"},{href:"#syslog-facility","aria-label":"syslog facility permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-syslog-facility")),': Sets the facility to use for forwarding logs to syslog. Defaults to "LOCAL0".')),Object(l.b)("h3",{className:"g-type-display-4"},Object(l.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#local-storage-options","aria-label":"local storage options permalink"}),"\xbb"),Object(l.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"local-storage-options","aria-hidden":""})),"Local Storage Options"),Object(l.b)("ul",null,Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"local-path",className:"__target-lic","aria-hidden":""})),Object(l.b)("a",Object(c.a)({parentName:"li"},{href:"#local-path","aria-label":"local path permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-local-path")),': Location to store snapshots locally. The default behavior of the snapshot agent is to store snapshots locally in this directory. Defaults to "." to use the current working directory. If an alternate storage option is configured, then local storage will be disabled and this option will be ignored.')),Object(l.b)("h3",{className:"g-type-display-4"},Object(l.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#s3-storage-options","aria-label":"s3 storage options permalink"}),"\xbb"),Object(l.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"s3-storage-options","aria-hidden":""})),"S3 Storage Options:"),Object(l.b)("p",null,"Note that despite the AWS references, any S3-compatible endpoint can be specified with '-aws-s3-endpoint'."),Object(l.b)("ul",null,Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"aws-access-key-id",className:"__target-lic","aria-hidden":""})),Object(l.b)("a",Object(c.a)({parentName:"li"},{href:"#aws-access-key-id","aria-label":"aws access key id permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-aws-access-key-id")),": These arguments supply authentication information for"),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"aws-secret-access-key",className:"__target-lic","aria-hidden":""})),Object(l.b)("a",Object(c.a)({parentName:"li"},{href:"#aws-secret-access-key","aria-label":"aws secret access key permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-aws-secret-access-key")),": connecting to S3. These may also be supplied using the following alternative methods:",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),"AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY environment variables"),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),"A credentials file (~/.aws/credentials or the file at the path specified by the AWS_SHARED_CREDENTIALS_FILE environment variable)"),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),"ECS task role metadata (container-specific)"),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),"EC2 instance role metadata"))),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"aws-s3-bucket",className:"__target-lic","aria-hidden":""})),Object(l.b)("a",Object(c.a)({parentName:"li"},{href:"#aws-s3-bucket","aria-label":"aws s3 bucket permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-aws-s3-bucket")),": S3 bucket to use. Required for S3 storage, and setting this disables local storage."),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"aws-s3-key-prefix",className:"__target-lic","aria-hidden":""})),Object(l.b)("a",Object(c.a)({parentName:"li"},{href:"#aws-s3-key-prefix","aria-label":"aws s3 key prefix permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-aws-s3-key-prefix")),': Prefix to use for snapshot files in S3. Defaults to "nomad-snapshot".'),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"aws-s3-region",className:"__target-lic","aria-hidden":""})),Object(l.b)("a",Object(c.a)({parentName:"li"},{href:"#aws-s3-region","aria-label":"aws s3 region permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-aws-s3-region")),": S3 region to use. Required for S3 storage."),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"aws-s3-endpoint",className:"__target-lic","aria-hidden":""})),Object(l.b)("a",Object(c.a)({parentName:"li"},{href:"#aws-s3-endpoint","aria-label":"aws s3 endpoint permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-aws-s3-endpoint")),": Optional S3 endpoint to use. Can also be specified using the AWS_S3_ENDPOINT environment variable."),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"aws-s3-server-side-encryption",className:"__target-lic","aria-hidden":""})),Object(l.b)("a",Object(c.a)({parentName:"li"},{href:"#aws-s3-server-side-encryption","aria-label":"aws s3 server side encryption permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-aws-s3-server-side-encryption")),": Enables server side encryption with AES-256, when storing snapshots to S3. Defaults to false."),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"aws-s3-static-snapshot-name",className:"__target-lic","aria-hidden":""})),Object(l.b)("a",Object(c.a)({parentName:"li"},{href:"#aws-s3-static-snapshot-name","aria-label":"aws s3 static snapshot name permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-aws-s3-static-snapshot-name")),": Static file name to use for snapshot files. If this is set, snapshots are always saved with the same name, and are not versioned or rotated."),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"aws-s3-enable-kms",className:"__target-lic","aria-hidden":""})),Object(l.b)("a",Object(c.a)({parentName:"li"},{href:"#aws-s3-enable-kms","aria-label":"aws s3 enable kms permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-aws-s3-enable-kms")),": Enables using Amazon KMS for encrypting snapshots"),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"aws-s3-kms-key",className:"__target-lic","aria-hidden":""})),Object(l.b)("a",Object(c.a)({parentName:"li"},{href:"#aws-s3-kms-key","aria-label":"aws s3 kms key permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-aws-s3-kms-key")),": Optional KMS key to use, if this is not set the default KMS key will be used.")),Object(l.b)("h3",{className:"g-type-display-4"},Object(l.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#azure-blob-storage-options","aria-label":"azure blob storage options permalink"}),"\xbb"),Object(l.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"azure-blob-storage-options","aria-hidden":""})),"Azure Blob Storage Options"),Object(l.b)("p",null,"(Note: Non-Solaris platforms only)"),Object(l.b)("ul",null,Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"azure-blob-account-name",className:"__target-lic","aria-hidden":""})),Object(l.b)("a",Object(c.a)({parentName:"li"},{href:"#azure-blob-account-name","aria-label":"azure blob account name permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-azure-blob-account-name")),": These arguments supply authentication information"),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"azure-blob-account_key",className:"__target-lic","aria-hidden":""})),Object(l.b)("a",Object(c.a)({parentName:"li"},{href:"#azure-blob-account_key","aria-label":"azure blob account_key permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-azure-blob-account_key")),": for connecting to Azure Blob storage."),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"azure-blob-container-name",className:"__target-lic","aria-hidden":""})),Object(l.b)("a",Object(c.a)({parentName:"li"},{href:"#azure-blob-container-name","aria-label":"azure blob container name permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-azure-blob-container-name")),": Container to use. Required for Azure blob storage, and setting this disables local storage."),Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"azure-blob-environment",className:"__target-lic","aria-hidden":""})),Object(l.b)("a",Object(c.a)({parentName:"li"},{href:"#azure-blob-environment","aria-label":"azure blob environment permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-azure-blob-environment")),": Environment to use. Defaults to AZUREPUBLICCLOUD. Other valid environments are AZURECHINACLOUD, AZUREGERMANCLOUD and AZUREUSGOVERNMENTCLOUD.")),Object(l.b)("h3",{className:"g-type-display-4"},Object(l.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#google-storage-options","aria-label":"google storage options permalink"}),"\xbb"),Object(l.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"google-storage-options","aria-hidden":""})),"Google Storage Options"),Object(l.b)("ul",null,Object(l.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(l.b)("a",Object(c.a)({parentName:"li"},{id:"google-bucket",className:"__target-lic","aria-hidden":""})),Object(l.b)("a",Object(c.a)({parentName:"li"},{href:"#google-bucket","aria-label":"google bucket permalink",className:"__permalink-lic"}),Object(l.b)("inlineCode",{parentName:"a"},"-google-bucket")),": The bucket to use.")))}O.isMDXComponent=!0},I1rA:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/commands/operator/snapshot-agent",function(){return t("24/w")}])}},[["I1rA",0,1,2,4,3,5,6]]]);