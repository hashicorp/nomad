(window.webpackJsonp=window.webpackJsonp||[]).push([[236],{"22dE":function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/job-specification/lifecycle",function(){return t("xWCM")}])},xWCM:function(e,a,t){"use strict";t.r(a),t.d(a,"default",(function(){return d}));var n,c=t("wx14"),s=t("Ff2n"),o=t("q1tI"),r=t.n(o),i=t("7ljp"),b=t("j1un"),l=(r.a.createElement,n="Placement",function(e){return console.warn("Component "+n+" was not imported, exported, or provided by MDXProvider as global scope"),Object(i.b)("div",e)}),p={},m=Object(b.a)({layout:"docs",page_title:"lifecycle Stanza - Job Specification",sidebar_title:"lifecycle",description:'The "lifecycle" stanza configures when a task is run within the lifecycle of a\ntask group',__resourcePath:"docs/job-specification/lifecycle.mdx",__scans:{}});function d(e){var{components:a}=e,t=Object(s.a)(e,["components"]);return Object(i.b)(m,Object(c.a)({},p,t,{components:a,mdxType:"MDXLayout"}),Object(i.b)("h1",{className:"g-type-display-2"},Object(i.b)("a",Object(c.a)({parentName:"h1"},{className:"__permalink-h",href:"#lifecycle-stanza","aria-label":"lifecycle stanza permalink"}),"\xbb"),Object(i.b)("a",Object(c.a)({parentName:"h1"},{className:"__target-h",id:"lifecycle-stanza","aria-hidden":""})),Object(i.b)("inlineCode",{parentName:"h1"},"lifecycle")," Stanza"),Object(i.b)(l,{groups:["job","group","task","lifecycle"],mdxType:"Placement"}),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"lifecycle")," stanza is used to express task dependencies in Nomad and\nconfigures when a task is run within the lifecycle of a task group."),Object(i.b)("p",null,"Main tasks are tasks that do not have a ",Object(i.b)("inlineCode",{parentName:"p"},"lifecycle")," stanza. Lifecycle task hooks\nare run in relation to the main tasks. Tasks can be run as Prestart Hooks, which\nensures the prestart task is run before the main tasks are run."),Object(i.b)("p",null,"Tasks can be run with an additional parameter to indicate that they are\nsidecars, which ensures that they are running over the duration of the whole\ntask group. This will allow you to run a long-lived task in a task group for a\nbatch job. The absence of the sidecar flag indicates that the task is ephemeral\nand the task will not be restarted if it completes successfully. This allows you\nto run an ephemeral prestart task in a task group for a service job, which can\nserve as initialization that occurs before the main services are started."),Object(i.b)("p",null,"Learn more about Nomad's task dependencies on the ",Object(i.b)("a",Object(c.a)({parentName:"p"},{href:"https://learn.hashicorp.com/nomad?track=task-deps&utm_source=WEBSITE&utm_medium=WEB_IO&utm_offer=ARTICLE_PAGE&utm_content=DOCS#task-deps"}),"HashiCorp Learn website"),"."),Object(i.b)("pre",{className:"language-hcl"},Object(i.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),"job ",Object(i.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"docs"')," ",Object(i.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  group ",Object(i.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"example"')," ",Object(i.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n\n    task ",Object(i.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"init"')," ",Object(i.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(i.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"lifecycle")," ",Object(i.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(i.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"hook"),"    ",Object(i.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"prestart"'),"\n      ",Object(i.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n      ...\n    ",Object(i.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n    task ",Object(i.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"logging"')," ",Object(i.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(i.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"lifecycle")," ",Object(i.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(i.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"hook"),"    ",Object(i.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"prestart"'),"\n        ",Object(i.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"sidecar")," ",Object(i.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(i.b)("span",Object(c.a)({parentName:"code"},{className:"token boolean"}),"true"),"\n      ",Object(i.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n      ...\n    ",Object(i.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n    task ",Object(i.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"main"')," ",Object(i.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ...\n    ",Object(i.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n  ",Object(i.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(i.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(i.b)("h2",{className:"g-type-display-3"},Object(i.b)("a",Object(c.a)({parentName:"h2"},{className:"__permalink-h",href:"#lifecycle-parameters","aria-label":"lifecycle parameters permalink"}),"\xbb"),Object(i.b)("a",Object(c.a)({parentName:"h2"},{className:"__target-h",id:"lifecycle-parameters","aria-hidden":""})),Object(i.b)("inlineCode",{parentName:"h2"},"lifecycle")," Parameters"),Object(i.b)("ul",null,Object(i.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(i.b)("a",Object(c.a)({parentName:"li"},{id:"hook",className:"__target-lic","aria-hidden":""})),Object(i.b)("p",{parentName:"li"},Object(i.b)("a",Object(c.a)({parentName:"p"},{href:"#hook","aria-label":"hook permalink",className:"__permalink-lic"}),Object(i.b)("inlineCode",{parentName:"a"},"hook"))," ",Object(i.b)("inlineCode",{parentName:"p"},'(string: "prestart")')," - Specifies when a task should be run within\nthe lifecycle of a group. Currently only Prestart Hooks are supported.")),Object(i.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(i.b)("a",Object(c.a)({parentName:"li"},{id:"sidecar",className:"__target-lic","aria-hidden":""})),Object(i.b)("p",{parentName:"li"},Object(i.b)("a",Object(c.a)({parentName:"p"},{href:"#sidecar","aria-label":"sidecar permalink",className:"__permalink-lic"}),Object(i.b)("inlineCode",{parentName:"a"},"sidecar"))," ",Object(i.b)("inlineCode",{parentName:"p"},"(bool: false)")," - Controls whether or not a task is ephemeral or\nlong-lived within the task group. If a lifecycle task is ephemeral (",Object(i.b)("inlineCode",{parentName:"p"},"sidecar =\nfalse"),"), the task will not be restarted after it completes successfully. If a\nlifecycle task is long-lived (",Object(i.b)("inlineCode",{parentName:"p"},"sidecar = true"),") and it terminates, it will be\nrestarted as long as the task group is running in its allocation."))))}d.isMDXComponent=!0}},[["22dE",0,1,2,4,3,5,6]]]);