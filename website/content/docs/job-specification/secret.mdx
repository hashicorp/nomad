---
layout: docs
page_title: secret block in the job specification
description: |-
  The `secret` block allows the task to specify that it requires a secret from a
  specified location. Nomad will automatically retrieve the secret for the task
  and provide it for variable interpretation.
---

# `secret` block in the job specification

<Placement
  groups={[
    ['job', 'secret'],
    ['job', 'group', 'secret'],
    ['job', 'group', 'task', 'secret'],
  ]}
/>

The `secret` block allows a task to specify that it requires a secret from
a specified location. Nomad will automatically retrieve the contents of the
secret which can be referenced as a variable within the task specification.
If specified at the `group` level, the secret will be available to every task
within the group. If specified at the `job` level, every task in the job will
fetch the secret and be able to interpret it within the task specification.

```hcl
job "docs" {
  group "example" {
    task "server" {
      secret "my-secret" {
        provider = "vault"
        path     = "path/to/secret"
        config   = {
          engine = "kv_v2"
        }
      }
    }
  }
}
```

Nomad will parse the key/values in a secret and make then available for variable
interpolation via a path separated by periods that is suffixed with "secret", then
the secrets name, and lastly the key that is being referenced. To use the above
task as an example, the secret would be referenced as `${secret.my-secret.foo}`
where "foo" is an existing key within the secret.

## Parameters

- `provider` `(string: "")` - Specifies the underlying implementation to use in
  order for Nomad to interact with a specific secret store. Refer below(TODO) for
  more information on builtin providers and extending the Nomad Secret block with
  custom providers.

- `path` `(string: "")` - Specifies the location of the secret within the given
  secret store.

- `config` `(block: {})` - Specifies any custom attributes used by builtin providers
  order to fetch the secret. Only available for builtin "vault" and "nomad" providers.

- `env` `(map[string]string)` - Specifies any environment variables to pass to a
  custom plugin provider. Only available for custom providers.


## Builtin Providers

- `nomad` - Query variables from Nomad. Nomad will use the tasks [Workload Identity]
  [Workload Identity] token in order to fetch the variable, so the task must have the
  necessary access via ACL's to read the variable.

  Config parameters:

  - `namespace` `(string: "default")` - Specifies the namespace where the variable is
  located.


- `vault` - Query variables from Vault. Similar to the template block, making requests
  to Vault requires a vault token, which is generated via the [vault][vault] block.

  Config parameters:

  - `engine` `(string: "kv_v2")` - Specifies what Vault storage engine to query. Options
  are "kv_v1" and "kv_v2".


## Custom Providers

Nomad extends the provider list via the use of custom providers plugins. Custom providers
must implement both the "fingerprint" and "fetch" functionality, and be placed in the subdirectory
`common_plugin_dir/secrets/`. On startup, the Nomad client will fingerprint executables in the
secrets directory by executing it with the first argument of "fingerblock".
When using a custom plugin "foo", Nomad will look for an executable "foo" and run it with
the first argument being "fetch", and the second argument being the secret's path parameter.

A Custom provider should print to stdout a fingerprint response:
```json
{
  "type": "secrets",
  "version": "0.0.1" (use appropriate version)
}
```

And a valid "fetch" response should have the form:
```json
{
  "result": {
    "key1": "value1",
    "key2": "value2"
  },
  "error": ""
}
```

[Workload Identity]: /nomad/docs/concepts/workload-identity
[vault]: /nomad/docs/job-specification/vault
[common_plugin_dir]: /nomad/docs/configuration/client#custom_plugin_dir
