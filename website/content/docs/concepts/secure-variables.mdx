---
layout: docs
page_title: Secure Variables
description: Learn about Nomad's secure variables feature
---

# Secure Variables

Most Nomad workloads need configuration or secrets. Nomad provides a `template`
block to run consul-template alongside tasks, but leaves the source of those
configuration values up to the operator. Typically you'll use [HashiCorp Vault]
as the source for secrets.

Nomad's Secure Variables feature provides the option to store secrets at
file-like paths directly in Nomad's state store. The contents of secrets are
encrypted and replicated between servers with raft. Access to secrets is
controlled by ACL policies, and tasks have implicit ACL policies that allow them
to access their own secrets. You can create, read, update, or delete secrets via
the command line or in the Nomad web UI.

Note that the Secure Variables feature is intended for small pieces of
configuration data needed by workloads. Because writing to the Nomad state store
uses resources needed by Nomad, it's not well-suited for large or fast-changing
data like batch job results. These should be stored in a separate
database. Secure Variables are also not intended to be a full replacement for
HashiCorp Vault. If you need powerful options like dynamic secrets or transit
encryption, you'll need to use Vault.

## ACL for Secure Variables

Every Secure Variable belongs to a specific Nomad namespace. ACL policies can
restrict access to Secure Variables within a namespace on a per-path basis,
using a list of `path` blocks, under the `namespace.secure_variables` block. See
the [ACL policy specification] docs for details about the syntax and structure
of an ACL policy.

Path definitions may also include wildcard symbols, also called globs, allowing
a single path policy definition to apply to a set of paths within that
namespace. For example, the policy below allows full access to secure variables
at all paths in the "dev" namespace that are prefixed with "project/", but only
read access to paths prefixed with "system/". Note that the glob can match an
empty string but all other characters are strictly matched. This policy grants
read access to paths prefixed with "system/" but not a path named "system"
(without a trailing slash).

```hcl
namespace "dev" {
  policy       = "write"
  capabilities = ["alloc-node-exec"]

  secure_variables {

    # full access to secrets in all "project" paths
    path "project/*" {
      capabilities = ["write", "read", "destroy", "list"]
    }

    # read/list access within a "system/" path belonging to administrators
    path "system/*" {
      capabilities = ["read"]
    }
  }
}
```

The available capabilities for Secure Variables are as follows:

| Capability | Notes                                                                                                                        |
|------------|------------------------------------------------------------------------------------------------------------------------------|
| write      | Create or update Secure Variables at this path. Includes the "list" capability but not the "read" or "destroy" capabilities. |
| read       | Read the decrypted contents of Secure Variables at this path. Also includes the "list" capability                            |
| list       | List the metadata but not contents of Secure Variables at this path.                                                         |
| destroy    | Delete Secure Variables at this path.                                                                                        |

## Task Access to Secure Variables

In Nomad 1.4.0 tasks can access Secure Variables only with the [`template`]
block. The [workload identity] for each task grants it automatic access to
Secure Variables found at Nomad-owned paths with the prefix `jobs/`, followed by
the namespace, job ID, task group name, and task name.

```
jobs/$job_id/$task_group/$task_name
jobs/$job_id/$task_group
jobs/$job_id
jobs
```

For example, the task created by the example job spec created with `nomad job
init -short` will automatically have access to Secure Variables at the following
paths, within its own `default` namespace:

```
jobs/example/cache/redis
jobs/example/cache
jobs/example
jobs
```

You can provide access to additional secrets by creating policies associated
with the task's workload identity. For example, to give the task above access to
set of shared secrets, you can create the following policy file:

```hcl
namespace "shared" {
  secure_variables {
    path "*" {
      capabilities = ["read"]
    }
  }
}
```

Then create the policy with `nomad acl policy apply
"_:/default/example/cache/redis" ./policy.hcl` to give the task read access to
all paths in the "shared" namespace.

See [Implicit Access to ACL Policies] for more details.

[HashiCorp Vault]: https://vaultproject.io
[ACL policy specification]: docs/other-specifications/acl-policy
[`template`]: /docs/job-specification/template
[workload identity]: /docs/concepts/workload-identity
[Implicit Access to ACL Policies]: /docs/concepts/workload-identity#implicit-access-to-acl-policies
