(window.webpackJsonp=window.webpackJsonp||[]).push([[183],{"2T20":function(e,a,t){"use strict";t.r(a),t.d(a,"default",(function(){return l}));var n=t("wx14"),c=t("Ff2n"),r=t("q1tI"),b=t.n(r),o=t("7ljp"),p=t("j1un"),s=(b.a.createElement,{}),i=Object(p.a)({layout:"docs",page_title:"Drivers: firecracker-task-driver",sidebar_title:"Firecracker driver",description:"The Firecracker task driver is used to run firecracker(https://firecracker-microvm.github.io/) microvms.",__resourcePath:"docs/drivers/external/firecracker-task-driver.mdx",__scans:{}});function l(e){var a=e.components,t=Object(c.a)(e,["components"]);return Object(o.b)(i,Object(n.a)({},s,t,{components:a,mdxType:"MDXLayout"}),Object(o.b)("h1",{className:"g-type-display-2"},Object(o.b)("a",Object(n.a)({parentName:"h1"},{className:"__permalink-h",href:"#firecracker-task-driver","aria-label":"firecracker task driver permalink"}),"\xbb"),Object(o.b)("a",Object(n.a)({parentName:"h1"},{className:"__target-h",id:"firecracker-task-driver","aria-hidden":""})),"Firecracker task Driver"),Object(o.b)("p",null,"Name: ",Object(o.b)("inlineCode",{parentName:"p"},"firecracker-task-driver")),Object(o.b)("p",null,"The Firecracker task driver provides an interface for creating Linux microvms.\nFor more detailed instructions on how to set up and use this driver, please\nrefer to the ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/cneira/firecracker-task-driver"}),"documentation"),"."),Object(o.b)("h2",{className:"g-type-display-3"},Object(o.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#task-configuration","aria-label":"task configuration permalink"}),"\xbb"),Object(o.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"task-configuration","aria-hidden":""})),"Task Configuration"),Object(o.b)("pre",{className:"language-hcl"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-hcl"}),"task ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"test01"')," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"driver")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"firecracker-task-driver"'),"\n\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"config")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"KernelImage")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"/home/build/hello-vmlinux.bin"'),"\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"Firecracker")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"/home/build/firecracker"'),"\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"Vcpus"),"       ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token number"}),"1"),"\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"Mem"),"         ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token number"}),"128"),"\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),"Network"),"     ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"default"'),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("p",null,"The firecracker task driver supports the following parameters:"),Object(o.b)("ul",null,Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(n.a)({parentName:"li"},{id:"kernelimage",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"#kernelimage","aria-label":"kernelimage permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"KernelImage"))," - (Optional) Path to the kernel image to be used on the microvm.\nDefaults to 'vmlinux' on nomad's allocation directory.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(n.a)({parentName:"li"},{id:"bootdisk",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"#bootdisk","aria-label":"bootdisk permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"BootDisk"))," - (Optional) Path to the ext4 rootfs to boot from.\nDefaults to 'rootfs.ext4' on nomad's allocation directory.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(n.a)({parentName:"li"},{id:"bootoptions",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"#bootoptions","aria-label":"bootoptions permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"BootOptions")),' - (Optional) Kernel command line options to boot the microvm.\nDefaults to "ro console=ttyS0 reboot=k panic=1 pci=off"')),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(n.a)({parentName:"li"},{id:"network",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"#network","aria-label":"network permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"Network"))," - (Optional) Network name of your container network configuration\nfile.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(n.a)({parentName:"li"},{id:"vcpus",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"#vcpus","aria-label":"vcpus permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"Vcpus"))," - (Optional) Number of CPUs to assign to microvm.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(n.a)({parentName:"li"},{id:"cputype",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"#cputype","aria-label":"cputype permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"Cputype"))," - (Optional) CPU template to use, templates available are C3 or T2.")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(n.a)({parentName:"li"},{id:"mem",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"#mem","aria-label":"mem permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"Mem"))," - (Optional) Amount of memory in Megabytes to assign to microvm.\nDefaults to 512")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(n.a)({parentName:"li"},{id:"firecracker",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"#firecracker","aria-label":"firecracker permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"Firecracker"))," Location of the firecracker binary, the option could be omitted\nif the environment variable FIRECRACKER_BIN is setup. Defaults to\n'/usr/bin/firecracker'")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(n.a)({parentName:"li"},{id:"disableht",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"#disableht","aria-label":"disableht permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"DisableHt"))," - (Optional) Disable CPU Hyperthreading. Defaults to false")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("a",Object(n.a)({parentName:"li"},{id:"log",className:"__target-lic","aria-hidden":""})),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"#log","aria-label":"log permalink",className:"__permalink-lic"}),Object(o.b)("inlineCode",{parentName:"a"},"Log"))," - (Optional) path to file where to write firecracker logs."))),Object(o.b)("h2",{className:"g-type-display-3"},Object(o.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#networking","aria-label":"networking permalink"}),"\xbb"),Object(o.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"networking","aria-hidden":""})),"Networking"),Object(o.b)("p",null,"Network configuration is setup using CNI plugins, the steps to setup firecracker\ntask driver with cni are the following:"),Object(o.b)("ul",null,Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},"Build ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/containernetworking/plugins"}),"cni plugins")," and ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/firecracker-microvm/firecracker-go-sdk/tree/master/cni"}),"tc-redirect-tap"),"\nand copy them to ",Object(o.b)("inlineCode",{parentName:"p"},"/opt/cni"),".")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},"Create a network configuration to be used by micro-vms on /etc/cni/conf.d/,\nfor example: default.conflist."))),Object(o.b)("h3",{className:"g-type-display-4"},Object(o.b)("a",Object(n.a)({parentName:"h3"},{className:"__permalink-h",href:"#example-network-configuration","aria-label":"example network configuration permalink"}),"\xbb"),Object(o.b)("a",Object(n.a)({parentName:"h3"},{className:"__target-h",id:"example-network-configuration","aria-hidden":""})),"Example network configuration"),Object(o.b)("pre",{className:"language-json"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-json"}),Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),'"name"'),Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"default"'),Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),'"cniVersion"'),Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"0.4.0"'),Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),'"plugins"'),Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"["),"\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),'"type"'),Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"ptp"'),Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n      ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),'"ipMasq"'),Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token boolean"}),"true"),Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n      ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),'"ipam"'),Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),'"type"'),Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"host-local"'),Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n        ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),'"subnet"'),Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"192.168.127.0/24"'),Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n        ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),'"resolvConf"'),Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"/etc/resolv.conf"'),"\n      ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),'"type"'),Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"firewall"'),"\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),'"type"'),Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"tc-redirect-tap"'),"\n    ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n",Object(o.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.b)("p",null,"In this example the name of this network is default and this name is the\nparameter used in Network on the task driver job spec. Also the filename must\nmatch the name of the network, and use the .conflist extension."),Object(o.b)("h2",{className:"g-type-display-3"},Object(o.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#client-requirements","aria-label":"client requirements permalink"}),"\xbb"),Object(o.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"client-requirements","aria-hidden":""})),"Client Requirements"),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"firecracker-task-driver")," requires the following:"),Object(o.b)("ul",null,Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},"Linux 4.14+ Firecracker currently supports physical Linux x86_64 and aarch64\nhosts, running kernel version 4.14 or later. However, the aarch64 support is\nnot feature complete (alpha stage)")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},"The ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/firecracker-microvm/firecracker/releases"}),"Firecracker binary"))),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},"KVM enabled in your Linux kernel, and you have read/write access to /dev/kvm")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},"tun kernel module")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},"The firecracker-task-driver binary placed in the ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/configuration#plugin_dir"}),"plugin_dir"),"\ndirectory")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},"ip6tables package")),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/containernetworking/plugins"}),"Container network plugins"))),Object(o.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/firecracker-microvm/firecracker-go-sdk/tree/master/cni"}),"tc-redirect-tap")))))}l.isMDXComponent=!0},yHAs:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/drivers/external/firecracker-task-driver",function(){return t("2T20")}])}},[["yHAs",0,1,2,4,3,5,6]]]);