(window.webpackJsonp=window.webpackJsonp||[]).push([[74],{"O/ip":function(e,a,t){"use strict";t.r(a),t.d(a,"default",(function(){return m}));var n=t("wx14"),c=t("Ff2n"),i=t("q1tI"),l=t.n(i),s=t("7ljp"),b=t("j1un"),r=(l.a.createElement,{}),o=Object(b.a)({layout:"docs",page_title:"Commands: alloc exec",sidebar_title:"exec",description:"Runs a command in a container.\n",__resourcePath:"docs/commands/alloc/exec.mdx",__scans:{}});function m(e){var{components:a}=e,t=Object(c.a)(e,["components"]);return Object(s.b)(o,Object(n.a)({},r,t,{components:a,mdxType:"MDXLayout"}),Object(s.b)("h1",{className:"g-type-display-2"},Object(s.b)("a",Object(n.a)({parentName:"h1"},{className:"__permalink-h",href:"#command-alloc-exec","aria-label":"command alloc exec permalink"}),"\xbb"),Object(s.b)("a",Object(n.a)({parentName:"h1"},{className:"__target-h",id:"command-alloc-exec","aria-hidden":""})),"Command: alloc exec"),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"Alias: ",Object(s.b)("inlineCode",{parentName:"strong"},"nomad exec"))),Object(s.b)("p",null,"The ",Object(s.b)("inlineCode",{parentName:"p"},"alloc exec")," command runs a command in a running allocation."),Object(s.b)("h2",{className:"g-type-display-3"},Object(s.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#usage","aria-label":"usage permalink"}),"\xbb"),Object(s.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"usage","aria-hidden":""})),"Usage"),Object(s.b)("pre",{className:"language-plaintext"},Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-plaintext"}),"nomad alloc exec [options] <allocation> <command> [<args>...]\n")),Object(s.b)("p",null,"The nomad exec command can be use to run commands inside a running task/allocation."),Object(s.b)("p",null,"Use cases are for inspecting container state, debugging a failed application\nwithout needing ssh access into the node that's running the allocation."),Object(s.b)("p",null,"This command executes the command in the given task in the allocation. If the\nallocation is only running a single task, the task name can be omitted.\nOptionally, the ",Object(s.b)("inlineCode",{parentName:"p"},"-job")," option may be used in which case a random allocation from\nthe given job will be chosen."),Object(s.b)("h2",{className:"g-type-display-3"},Object(s.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#general-options","aria-label":"general options permalink"}),"\xbb"),Object(s.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"general-options","aria-hidden":""})),"General Options"),Object(s.b)("ul",null,Object(s.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(s.b)("a",Object(n.a)({parentName:"li"},{id:"address",className:"__target-lic","aria-hidden":""})),Object(s.b)("p",{parentName:"li"},Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"#address","aria-label":"address permalink",className:"__permalink-lic"}),Object(s.b)("inlineCode",{parentName:"a"},"-address=<addr>")),": The address of the Nomad server. Overrides the ",Object(s.b)("inlineCode",{parentName:"p"},"NOMAD_ADDR"),"\nenvironment variable if set. Defaults to ",Object(s.b)("inlineCode",{parentName:"p"},"http://127.0.0.1:4646"),".")),Object(s.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(s.b)("a",Object(n.a)({parentName:"li"},{id:"region",className:"__target-lic","aria-hidden":""})),Object(s.b)("p",{parentName:"li"},Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"#region","aria-label":"region permalink",className:"__permalink-lic"}),Object(s.b)("inlineCode",{parentName:"a"},"-region=<region>")),": The region of the Nomad server to forward commands to.\nOverrides the ",Object(s.b)("inlineCode",{parentName:"p"},"NOMAD_REGION")," environment variable if set. Defaults to the\nAgent's local region.")),Object(s.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(s.b)("a",Object(n.a)({parentName:"li"},{id:"namespace",className:"__target-lic","aria-hidden":""})),Object(s.b)("p",{parentName:"li"},Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"#namespace","aria-label":"namespace permalink",className:"__permalink-lic"}),Object(s.b)("inlineCode",{parentName:"a"},"-namespace=<namespace>")),": The target namespace for queries and actions bound\nto a namespace. Overrides the NOMAD_NAMESPACE environment variable if set.\nIf set to '*', job and alloc subcommands query all namespacecs authorized to\nuser. Defaults to the \"default\" namespace.")),Object(s.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(s.b)("a",Object(n.a)({parentName:"li"},{id:"no-color",className:"__target-lic","aria-hidden":""})),Object(s.b)("p",{parentName:"li"},Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"#no-color","aria-label":"no color permalink",className:"__permalink-lic"}),Object(s.b)("inlineCode",{parentName:"a"},"-no-color")),": Disables colored command output. Alternatively,\n",Object(s.b)("inlineCode",{parentName:"p"},"NOMAD_CLI_NO_COLOR")," may be set.")),Object(s.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(s.b)("a",Object(n.a)({parentName:"li"},{id:"ca-cert",className:"__target-lic","aria-hidden":""})),Object(s.b)("p",{parentName:"li"},Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"#ca-cert","aria-label":"ca cert permalink",className:"__permalink-lic"}),Object(s.b)("inlineCode",{parentName:"a"},"-ca-cert=<path>")),": Path to a PEM encoded CA cert file to use to verify the\nNomad server SSL certificate. Overrides the ",Object(s.b)("inlineCode",{parentName:"p"},"NOMAD_CACERT")," environment\nvariable if set.")),Object(s.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(s.b)("a",Object(n.a)({parentName:"li"},{id:"ca-path",className:"__target-lic","aria-hidden":""})),Object(s.b)("p",{parentName:"li"},Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"#ca-path","aria-label":"ca path permalink",className:"__permalink-lic"}),Object(s.b)("inlineCode",{parentName:"a"},"-ca-path=<path>")),": Path to a directory of PEM encoded CA cert files to verify\nthe Nomad server SSL certificate. If both ",Object(s.b)("inlineCode",{parentName:"p"},"-ca-cert")," and ",Object(s.b)("inlineCode",{parentName:"p"},"-ca-path")," are\nspecified, ",Object(s.b)("inlineCode",{parentName:"p"},"-ca-cert")," is used. Overrides the ",Object(s.b)("inlineCode",{parentName:"p"},"NOMAD_CAPATH")," environment\nvariable if set.")),Object(s.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(s.b)("a",Object(n.a)({parentName:"li"},{id:"client-cert",className:"__target-lic","aria-hidden":""})),Object(s.b)("p",{parentName:"li"},Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"#client-cert","aria-label":"client cert permalink",className:"__permalink-lic"}),Object(s.b)("inlineCode",{parentName:"a"},"-client-cert=<path>")),": Path to a PEM encoded client certificate for TLS\nauthentication to the Nomad server. Must also specify ",Object(s.b)("inlineCode",{parentName:"p"},"-client-key"),". Overrides\nthe ",Object(s.b)("inlineCode",{parentName:"p"},"NOMAD_CLIENT_CERT")," environment variable if set.")),Object(s.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(s.b)("a",Object(n.a)({parentName:"li"},{id:"client-key",className:"__target-lic","aria-hidden":""})),Object(s.b)("p",{parentName:"li"},Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"#client-key","aria-label":"client key permalink",className:"__permalink-lic"}),Object(s.b)("inlineCode",{parentName:"a"},"-client-key=<path>")),": Path to an unencrypted PEM encoded private key matching\nthe client certificate from ",Object(s.b)("inlineCode",{parentName:"p"},"-client-cert"),". Overrides the ",Object(s.b)("inlineCode",{parentName:"p"},"NOMAD_CLIENT_KEY"),"\nenvironment variable if set.")),Object(s.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(s.b)("a",Object(n.a)({parentName:"li"},{id:"tls-server-name",className:"__target-lic","aria-hidden":""})),Object(s.b)("p",{parentName:"li"},Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"#tls-server-name","aria-label":"tls server name permalink",className:"__permalink-lic"}),Object(s.b)("inlineCode",{parentName:"a"},"-tls-server-name=<value>")),": The server name to use as the SNI host when connecting\nvia TLS. Overrides the ",Object(s.b)("inlineCode",{parentName:"p"},"NOMAD_TLS_SERVER_NAME")," environment variable if set.")),Object(s.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(s.b)("a",Object(n.a)({parentName:"li"},{id:"tls-skip-verify",className:"__target-lic","aria-hidden":""})),Object(s.b)("p",{parentName:"li"},Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"#tls-skip-verify","aria-label":"tls skip verify permalink",className:"__permalink-lic"}),Object(s.b)("inlineCode",{parentName:"a"},"-tls-skip-verify")),": Do not verify TLS certificate. This is highly not\nrecommended. Verification will also be skipped if ",Object(s.b)("inlineCode",{parentName:"p"},"NOMAD_SKIP_VERIFY")," is set.")),Object(s.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(s.b)("a",Object(n.a)({parentName:"li"},{id:"token",className:"__target-lic","aria-hidden":""})),Object(s.b)("p",{parentName:"li"},Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"#token","aria-label":"token permalink",className:"__permalink-lic"}),Object(s.b)("inlineCode",{parentName:"a"},"-token")),": The SecretID of an ACL token to use to authenticate API requests with.\nOverrides the ",Object(s.b)("inlineCode",{parentName:"p"},"NOMAD_TOKEN")," environment variable if set."))),Object(s.b)("h2",{className:"g-type-display-3"},Object(s.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#exec-options","aria-label":"exec options permalink"}),"\xbb"),Object(s.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"exec-options","aria-hidden":""})),"Exec Options"),Object(s.b)("ul",null,Object(s.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(s.b)("a",Object(n.a)({parentName:"li"},{id:"task",className:"__target-lic","aria-hidden":""})),Object(s.b)("p",{parentName:"li"},Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"#task","aria-label":"task permalink",className:"__permalink-lic"}),Object(s.b)("inlineCode",{parentName:"a"},"-task")),": Sets the task to exec command in.")),Object(s.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(s.b)("a",Object(n.a)({parentName:"li"},{id:"job",className:"__target-lic","aria-hidden":""})),Object(s.b)("p",{parentName:"li"},Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"#job","aria-label":"job permalink",className:"__permalink-lic"}),Object(s.b)("inlineCode",{parentName:"a"},"-job")),": Use a random allocation from the specified job ID.")),Object(s.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(s.b)("a",Object(n.a)({parentName:"li"},{id:"i",className:"__target-lic","aria-hidden":""})),Object(s.b)("p",{parentName:"li"},Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"#i","aria-label":"i permalink",className:"__permalink-lic"}),Object(s.b)("inlineCode",{parentName:"a"},"-i")),": Pass stdin to the container, defaults to true. Pass ",Object(s.b)("inlineCode",{parentName:"p"},"-i=false")," to\ndisable explicitly.")),Object(s.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(s.b)("a",Object(n.a)({parentName:"li"},{id:"t",className:"__target-lic","aria-hidden":""})),Object(s.b)("p",{parentName:"li"},Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"#t","aria-label":"t permalink",className:"__permalink-lic"}),Object(s.b)("inlineCode",{parentName:"a"},"-t")),": Allocate a pseudo-tty, defaults to true if stdin is detected to be a tty\nsession. Pass ",Object(s.b)("inlineCode",{parentName:"p"},"-t=false")," to disable explicitly.")),Object(s.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(s.b)("a",Object(n.a)({parentName:"li"},{id:"e",className:"__target-lic","aria-hidden":""})),Object(s.b)("p",{parentName:"li"},Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"#e","aria-label":"e permalink",className:"__permalink-lic"}),Object(s.b)("inlineCode",{parentName:"a"},"-e"))," <escape_char>: Sets the escape character for sessions with a pty\n(default: '~'). The escape character is only recognized at the beginning of a\nline. The escape character followed by a dot ('.') closes the connection.\nSetting the character to 'none' disables any escapes and makes the session\nfully transparent."))),Object(s.b)("h2",{className:"g-type-display-3"},Object(s.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#examples","aria-label":"examples permalink"}),"\xbb"),Object(s.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"examples","aria-hidden":""})),"Examples"),Object(s.b)("p",null,"To start an interactive debugging session in a particular alloc, invoke exec\ncommand with your desired shell available inside the task:"),Object(s.b)("pre",{className:"language-shell-session"},Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell-session"}),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token command"}),Object(s.b)("span",Object(n.a)({parentName:"span"},{className:"token sh important"}),"$")," ",Object(s.b)("span",Object(n.a)({parentName:"span"},{className:"token bash language-bash"}),"nomad alloc ",Object(s.b)("span",Object(n.a)({parentName:"span"},{className:"token builtin class-name"}),"exec")," eb17e557 /bin/bash")),"\n",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token output"}),"root@eb17e557:/data# # now run any debugging commands inside container\nroot@eb17e557:/data# # ps -ef\n"))),Object(s.b)("p",null,"To run a command and stream results without starting an interactive shell, you\ncan pass the command and its arguments to exec directly:"),Object(s.b)("pre",{className:"language-shell-session#"},Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell-session#",metastring:"run commands without starting an interactive session",run:!0,commands:!0,without:!0,starting:!0,an:!0,interactive:!0,session:!0}),"$ nomad alloc exec eb17e557 cat /etc/resolv.conf\n...\n")),Object(s.b)("p",null,"When passing command arguments to be evaluated in task, you may need to ensure\nthat your host shell doesn't interpolate values before invoking ",Object(s.b)("inlineCode",{parentName:"p"},"exec")," command.\nFor example, the following command would return the environment variable on\noperator shell rather than task containers:"),Object(s.b)("pre",{className:"language-shell-session"},Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell-session"}),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token command"}),Object(s.b)("span",Object(n.a)({parentName:"span"},{className:"token sh important"}),"$")," ",Object(s.b)("span",Object(n.a)({parentName:"span"},{className:"token bash language-bash"}),"nomad alloc ",Object(s.b)("span",Object(n.a)({parentName:"span"},{className:"token builtin class-name"}),"exec")," eb17e557 ",Object(s.b)("span",Object(n.a)({parentName:"span"},{className:"token builtin class-name"}),"echo")," ",Object(s.b)("span",Object(n.a)({parentName:"span"},{className:"token variable"}),"$NOMAD_ALLOC_ID")," ",Object(s.b)("span",Object(n.a)({parentName:"span"},{className:"token comment"}),"# wrong"))),"\n",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token output"}),"...\n"))),Object(s.b)("p",null,"Here, we must start a shell in task to interpolate ",Object(s.b)("inlineCode",{parentName:"p"},"$NOMAD_ALLOC_ID"),", and quote\ncommand or use the ",Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"http://tldp.org/LDP/abs/html/here-docs.html"}),"heredoc syntax")),Object(s.b)("pre",{className:"language-shell-session#"},Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell-session#",metastring:"by quoting argument",by:!0,quoting:!0,argument:!0}),"$ nomad alloc exec eb17e557 /bin/sh -c 'echo $NOMAD_ALLOC_ID'\neb17e557-443e-4c51-c049-5bba7a9850bc\n\n$ # by using heredoc and passing command in stdin\n$ nomad alloc exec eb17e557 /bin/sh <<'EOF'\n> echo $NOMAD_ALLOC_ID\n> EOF\neb17e557-443e-4c51-c049-5bba7a9850bc\n")),Object(s.b)("p",null,"This technique applies when aiming to run a shell pipeline without streaming\nintermediate command output across the network:"),Object(s.b)("pre",{className:"language-shell-session#"},Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell-session#",metastring:"e.g. find top appearing lines in some output","e.g.":!0,find:!0,top:!0,appearing:!0,lines:!0,in:!0,some:!0,output:!0}),"$ nomad alloc exec eb17e557 /bin/sh -c 'cat /output | sort | uniq -c | sort -rn | head -n 5'\n...\n")),Object(s.b)("h2",{className:"g-type-display-3"},Object(s.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#using-job-id-instead-of-allocation-id","aria-label":"using job id instead of allocation id permalink"}),"\xbb"),Object(s.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"using-job-id-instead-of-allocation-id","aria-hidden":""})),"Using Job ID instead of Allocation ID"),Object(s.b)("p",null,"Setting the ",Object(s.b)("inlineCode",{parentName:"p"},"-job")," flag causes a random allocation of the specified job to be\nselected."),Object(s.b)("pre",{className:"language-plaintext"},Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-plaintext"}),"nomad alloc exec -job <job-id> <command> [<args>...]\n")),Object(s.b)("p",null,"Choosing a specific allocation is useful for debugging issues with a specific\ninstance of a service. For other operations using the ",Object(s.b)("inlineCode",{parentName:"p"},"-job")," flag may be more\nconvenient than looking up an allocation ID to use."),Object(s.b)("h2",{className:"g-type-display-3"},Object(s.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#disabling-remote-execution","aria-label":"disabling remote execution permalink"}),"\xbb"),Object(s.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"disabling-remote-execution","aria-hidden":""})),"Disabling remote execution"),Object(s.b)("p",null,Object(s.b)("inlineCode",{parentName:"p"},"alloc exec")," is enabled by default to aid with debugging. Operators can disable\nthe feature by setting ",Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/configuration/client#disable_remote_exec"}),Object(s.b)("inlineCode",{parentName:"a"},"disable_remote_exec")," client config\noption")," on all clients, or a subset of clients that\nrun sensitive workloads."),Object(s.b)("h2",{className:"g-type-display-3"},Object(s.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#exec-targeting-a-specific-task","aria-label":"exec targeting a specific task permalink"}),"\xbb"),Object(s.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"exec-targeting-a-specific-task","aria-hidden":""})),"Exec targeting a specific task"),Object(s.b)("p",null,"When trying to ",Object(s.b)("inlineCode",{parentName:"p"},"alloc exec")," for a job that has more than one task associated\nwith it, you may want to target a specific task."),Object(s.b)("pre",{className:"language-shell-session"},Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell-session"}),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token output"}),"# open a shell session in one of your allocation's tasks\n"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token command"}),Object(s.b)("span",Object(n.a)({parentName:"span"},{className:"token sh important"}),"$")," ",Object(s.b)("span",Object(n.a)({parentName:"span"},{className:"token bash language-bash"}),"nomad alloc ",Object(s.b)("span",Object(n.a)({parentName:"span"},{className:"token builtin class-name"}),"exec")," -i -t -task mytask a1827f93 /bin/bash")),"\n",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token output"}),"a1827f93$\n"))))}m.isMDXComponent=!0},gPlc:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/commands/alloc/exec",function(){return t("O/ip")}])}},[["gPlc",0,1,2,4,3,5,6]]]);