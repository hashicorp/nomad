(window.webpackJsonp=window.webpackJsonp||[]).push([[201],{"3pIU":function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/install/production/requirements",function(){return t("LpHz")}])},LpHz:function(e,a,t){"use strict";t.r(a),t.d(a,"default",(function(){return p}));var n=t("wx14"),s=t("Ff2n"),r=t("q1tI"),o=t.n(r),c=t("7ljp"),i=t("j1un"),l=(o.a.createElement,{}),b=Object(i.a)({layout:"docs",page_title:"Hardware Requirements",sidebar_title:"Hardware Requirements",description:"Learn about Nomad client and server requirements such as memory and CPU\nrecommendations, network topologies, and more.",__resourcePath:"docs/install/production/requirements.mdx",__scans:{}});function p(e){var{components:a}=e,t=Object(s.a)(e,["components"]);return Object(c.b)(b,Object(n.a)({},l,t,{components:a,mdxType:"MDXLayout"}),Object(c.b)("h1",{className:"g-type-display-2"},Object(c.b)("a",Object(n.a)({parentName:"h1"},{className:"__permalink-h",href:"#hardware-requirements","aria-label":"hardware requirements permalink"}),"\xbb"),Object(c.b)("a",Object(n.a)({parentName:"h1"},{className:"__target-h",id:"hardware-requirements","aria-hidden":""})),"Hardware Requirements"),Object(c.b)("h2",{className:"g-type-display-3"},Object(c.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#resources-ram-cpu-etc","aria-label":"resources ram cpu etc permalink"}),"\xbb"),Object(c.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"resources-ram-cpu-etc","aria-hidden":""})),"Resources (RAM, CPU, etc.)"),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Nomad servers")," may need to be run on large machine instances. We suggest\nhaving between 4-8+ cores, 16-32 GB+ of memory, 40-80 GB+ of ",Object(c.b)("strong",{parentName:"p"},"fast")," disk and\nsignificant network bandwidth. The core count and network recommendations are to\nensure high throughput as Nomad heavily relies on network communication and as\nthe Servers are managing all the nodes in the region and performing scheduling.\nThe memory and disk requirements are due to the fact that Nomad stores all state\nin memory and will store two snapshots of this data onto disk, which causes high IO in busy clusters with lots of writes. Thus disk should\nbe at least 2 times the memory available to the server when deploying a high\nload cluster. When running on AWS prefer NVME or Provisioned IOPS SSD storage for data dir."),Object(c.b)("p",null,"These recommendations are guidelines and operators should always monitor the\nresource usage of Nomad to determine if the machines are under or over-sized."),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Nomad clients")," support reserving resources on the node that should not be\nused by Nomad. This should be used to target a specific resource utilization per\nnode and to reserve resources for applications running outside of Nomad's\nsupervision such as Consul and the operating system itself."),Object(c.b)("p",null,"Please see the ",Object(c.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/configuration/client#reserved"}),"reservation configuration")," for\nmore detail."),Object(c.b)("h2",{className:"g-type-display-3"},Object(c.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#network-topology","aria-label":"network topology permalink"}),"\xbb"),Object(c.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"network-topology","aria-hidden":""})),"Network Topology"),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Nomad servers")," are expected to have sub 10 millisecond network latencies\nbetween each other to ensure liveness and high throughput scheduling. Nomad\nservers can be spread across multiple datacenters if they have low latency\nconnections between them to achieve high availability."),Object(c.b)("p",null,"For example, on AWS every region comprises of multiple zones which have very low\nlatency links between them, so every zone can be modeled as a Nomad datacenter\nand every Zone can have a single Nomad server which could be connected to form a\nquorum and a region."),Object(c.b)("p",null,"Nomad servers uses Raft for state replication and Raft being highly consistent\nneeds a quorum of servers to function, therefore we recommend running an odd\nnumber of Nomad servers in a region. Usually running 3-5 servers in a region is\nrecommended. The cluster can withstand a failure of one server in a cluster of\nthree servers and two failures in a cluster of five servers. Adding more servers\nto the quorum adds more time to replicate state and hence throughput decreases\nso we don't recommend having more than seven servers in a region."),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Nomad clients"),' do not have the same latency requirements as servers since they\nare not participating in Raft. Thus clients can have 100+ millisecond latency to\ntheir servers. This allows having a set of Nomad servers that service clients\nthat can be spread geographically over a continent or even the world in the case\nof having a single "global" region and many datacenter.'),Object(c.b)("h2",{className:"g-type-display-3"},Object(c.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#ports-used","aria-label":"ports used permalink"}),"\xbb"),Object(c.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"ports-used","aria-hidden":""})),"Ports Used"),Object(c.b)("p",null,"Nomad requires 3 different ports to work properly on servers and 2 on clients,\nsome on TCP, UDP, or both protocols. Below we document the requirements for each\nport."),Object(c.b)("ul",null,Object(c.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(c.b)("p",{parentName:"li"},"HTTP API (Default 4646). This is used by clients and servers to serve the HTTP\nAPI. TCP only.")),Object(c.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(c.b)("p",{parentName:"li"},"RPC (Default 4647). This is used for internal RPC communication between client\nagents and servers, and for inter-server traffic. TCP only.")),Object(c.b)("li",Object(n.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(c.b)("p",{parentName:"li"},"Serf WAN (Default 4648). This is used by servers to gossip both over the LAN and\nWAN to other servers. It isn't required that Nomad clients can reach this address.\nTCP and UDP."))),Object(c.b)("p",null,"When tasks ask for dynamic ports, they are allocated out of the port range\nbetween 20,000 and 32,000. This is well under the ephemeral port range suggested\nby the ",Object(c.b)("a",Object(n.a)({parentName:"p"},{href:"https://en.wikipedia.org/wiki/Ephemeral_port"}),"IANA"),". If your operating\nsystem's default ephemeral port range overlaps with Nomad's dynamic port range,\nyou should tune the OS to avoid this overlap."),Object(c.b)("p",null,"On Linux this can be checked and set as follows:"),Object(c.b)("pre",{className:"language-shell-session"},Object(c.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell-session"}),Object(c.b)("span",Object(n.a)({parentName:"code"},{className:"token command"}),Object(c.b)("span",Object(n.a)({parentName:"span"},{className:"token sh important"}),"$")," ",Object(c.b)("span",Object(n.a)({parentName:"span"},{className:"token bash language-bash"}),Object(c.b)("span",Object(n.a)({parentName:"span"},{className:"token function"}),"cat")," /proc/sys/net/ipv4/ip_local_port_range")),"\n",Object(c.b)("span",Object(n.a)({parentName:"code"},{className:"token output"}),"32768   60999\n"),Object(c.b)("span",Object(n.a)({parentName:"code"},{className:"token command"}),Object(c.b)("span",Object(n.a)({parentName:"span"},{className:"token sh important"}),"$")," ",Object(c.b)("span",Object(n.a)({parentName:"span"},{className:"token bash language-bash"}),Object(c.b)("span",Object(n.a)({parentName:"span"},{className:"token builtin class-name"}),"echo")," ",Object(c.b)("span",Object(n.a)({parentName:"span"},{className:"token string"}),'"49152 65535"')," ",Object(c.b)("span",Object(n.a)({parentName:"span"},{className:"token operator"}),">")," /proc/sys/net/ipv4/ip_local_port_range")),"\n")),Object(c.b)("h2",{className:"g-type-display-3"},Object(c.b)("a",Object(n.a)({parentName:"h2"},{className:"__permalink-h",href:"#bridge-networking-and-iptables","aria-label":"bridge networking and iptables permalink"}),"\xbb"),Object(c.b)("a",Object(n.a)({parentName:"h2"},{className:"__target-h",id:"bridge-networking-and-iptables","aria-hidden":""})),"Bridge Networking and ",Object(c.b)("inlineCode",{parentName:"h2"},"iptables")),Object(c.b)("p",null,'Nomad\'s task group networks and Consul Connect integration use bridge networking and iptables to send traffic between containers. The Linux kernel bridge module has three "tunables" that control whether traffic crossing the bridge are processed by iptables. Some operating systems (RedHat, CentOS, and Fedora in particular) configure these tunables to optimize for VM workloads where iptables rules might not be correctly configured for guest traffic.'),Object(c.b)("p",null,"These tunables can be set to allow iptables processing for the bridge network as follows:"),Object(c.b)("pre",{className:"language-shell-session"},Object(c.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell-session"}),Object(c.b)("span",Object(n.a)({parentName:"code"},{className:"token command"}),Object(c.b)("span",Object(n.a)({parentName:"span"},{className:"token sh important"}),"$")," ",Object(c.b)("span",Object(n.a)({parentName:"span"},{className:"token bash language-bash"}),Object(c.b)("span",Object(n.a)({parentName:"span"},{className:"token builtin class-name"}),"echo")," ",Object(c.b)("span",Object(n.a)({parentName:"span"},{className:"token number"}),"1")," ",Object(c.b)("span",Object(n.a)({parentName:"span"},{className:"token operator"}),">")," /proc/sys/net/bridge/bridge-nf-call-arptables")),"\n",Object(c.b)("span",Object(n.a)({parentName:"code"},{className:"token command"}),Object(c.b)("span",Object(n.a)({parentName:"span"},{className:"token sh important"}),"$")," ",Object(c.b)("span",Object(n.a)({parentName:"span"},{className:"token bash language-bash"}),Object(c.b)("span",Object(n.a)({parentName:"span"},{className:"token builtin class-name"}),"echo")," ",Object(c.b)("span",Object(n.a)({parentName:"span"},{className:"token number"}),"1")," ",Object(c.b)("span",Object(n.a)({parentName:"span"},{className:"token operator"}),">")," /proc/sys/net/bridge/bridge-nf-call-ip6tables")),"\n",Object(c.b)("span",Object(n.a)({parentName:"code"},{className:"token command"}),Object(c.b)("span",Object(n.a)({parentName:"span"},{className:"token sh important"}),"$")," ",Object(c.b)("span",Object(n.a)({parentName:"span"},{className:"token bash language-bash"}),Object(c.b)("span",Object(n.a)({parentName:"span"},{className:"token builtin class-name"}),"echo")," ",Object(c.b)("span",Object(n.a)({parentName:"span"},{className:"token number"}),"1")," ",Object(c.b)("span",Object(n.a)({parentName:"span"},{className:"token operator"}),">")," /proc/sys/net/bridge/bridge-nf-call-iptables")),"\n")),Object(c.b)("p",null,"To preserve these settings on startup of a client node, add a file including the following to ",Object(c.b)("inlineCode",{parentName:"p"},"/etc/sysctl.d/")," or remove the file your Linux distribution puts in that directory."),Object(c.b)("pre",{className:"language-text"},Object(c.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"net.bridge.bridge-nf-call-arptables = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\n")))}p.isMDXComponent=!0}},[["3pIU",0,1,2,4,3,5,6]]]);