{{#let this.currentEvalDetail as |evaluation|}}
  <Portal @target="eval-detail-portal">
    <div
      data-test-eval-detail
      data-test-eval-detail-is-open={{this.isSideBarOpen}}
      class="sidebar {{if this.isSideBarOpen "pib"}}"
      {{on-click-outside
        @fns.closeSidebar
        capture=true
        exceptSelector="tr[data-eval-row]"
      }}
    >
      {{#if this.isLoading}}
        <div data-test-eval-loading>
          Loading!
        </div>
      {{/if}}
      {{#if this.error}}
        <div
          data-test-eval-detail-header
          style="display: flex; justify-content: space-between"
        >
          <button
            data-test-eval-sidebar-x
            class="button is-borderless"
            type="button"
            {{on "click" this.closeSidebar}}
          >
            {{x-icon "cancel"}}
          </button>
        </div>
        <h2 data-test-eval-error>
          ERROR!
        </h2>
      {{/if}}
      {{#if this.isSuccess}}
        <div
          data-test-eval-detail-header
          style="display: flex; justify-content: space-between"
        >
          <h1 data-test-title class="title">
            {{evaluation.shortId}}
            <span class="bumper-left tag is-primary">
              Complete
            </span>
          </h1>
          <button
            data-test-eval-sidebar-x
            class="button is-borderless"
            type="button"
            {{on "click" this.closeSidebar}}
          >
            {{x-icon "cancel"}}
          </button>
        </div>
        <div class="boxed-section is-small">
          <div
            class="boxed-section-body inline-definitions"
            style="display: flex;"
          >
            <span class="label" style="width: 6.125rem;">
              Evaluation Details
            </span>
            <div style="display: flex; flex-direction: column">
              <span class="pair" data-test-job-stat="type">
                <span class="term">
                  Job
                </span>
                <LinkTo
                  data-test-evaluation-job
                  @model="example@default"
                  @route="jobs.job"
                >
                  example
                </LinkTo>
              </span>
              <span class="pair" data-test-job-stat="type">
                <span class="term">
                  Triggered By
                </span>
                job-register
              </span>
            </div>
            <div style="display: flex; flex-direction: column">
              <span class="pair" data-test-job-stat="priority">
                <span class="term">
                  Priority
                </span>
                10
              </span>
            </div>
            <div style="display: flex; flex-direction: column">
              <span class="pair" data-test-job-stat="type">
                <span class="term">
                  Created
                </span>
                Some Type
              </span>
              <span class="pair" data-test-job-stat="priority">
                <span class="term">
                  Placement Failure
                </span>
                No
              </span>
            </div>
          </div>
        </div>
        {{! Start Related Evaluation}}
        <div
          style="max-width: 600px; overflow-x: scroll; overflow-y: hidden"
          data-test-eval-container
        >
          <div
            style="display: flex; position: relative;"
            {{on-resize this.handleResize}}
          >
            {{#if (and this.width this.height)}}
              <Providers::ActorsRelationships as |actors|>
                <svg
                  width={{this.width}}
                  height={{this.height}}
                  style="z-index: 10; inset: 0; position: absolute; pointer-events: none"
                  {{did-update actors.fns.recalcCurves this.width}}
                >
                  {{#each actors.data.relationships as |d|}}
                    <path
                      d={{d}}
                      stroke="#7E8FA8"
                      strokeWidth="1"
                      fill="none"
                    ></path>
                  {{/each}}
                </svg>
              </Providers::ActorsRelationships>
            {{/if}}
            <div>
              <EvaluationSidebar::EvaluationActor
                @eval={{this.parentEvaluation}}
                @onClick={{fn @fns.handleEvaluationClick this.parentEvaluation}}
              />
            </div>
            {{#each this.descendentsMap as |evals|}}
              <div
                data-test-eval-descendents-container
                style="display: flex; flex-direction: column; justify-content: space-evenly;"
              >
                {{#each evals as |eval|}}
                  <EvaluationSidebar::EvaluationActor
                    @eval={{eval.data}}
                    @onClick={{fn @fns.handleEvaluationClick eval.data}}
                  />
                {{/each}}
              </div>
            {{/each}}
          </div>
        </div>
        {{! End Related Evaluations}}
        <div
          class="boxed-section
            {{if evaluation.failedTGAllocs "is-warning" "is-primary"}}"
          data-test-dry-run-message
        >
          <div class="boxed-section-head" data-test-dry-run-title>
            Placement Failures
          </div>
          <div class="boxed-section-body" data-test-dry-run-body>
            {{#if evaluation.failedTGAllocs}}
              {{#each evaluation.failedTGAllocs as |placementFailure|}}
                <PlacementFailure @failedTGAlloc={{placementFailure}} />
              {{/each}}
            {{else}}
              All tasks successfully allocated.
            {{/if}}
          </div>
        </div>
        <JsonViewer @json={{evaluation}} />
      {{/if}}
    </div>
  </Portal>
{{/let}}