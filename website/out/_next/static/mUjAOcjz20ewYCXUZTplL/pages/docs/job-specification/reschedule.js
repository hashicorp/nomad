(window.webpackJsonp=window.webpackJsonp||[]).push([[246],{"0rv8":function(e,a,t){"use strict";t.r(a),t.d(a,"default",(function(){return d}));var n,c=t("wx14"),s=t("Ff2n"),b=t("q1tI"),l=t.n(b),p=t("7ljp"),r=t("j1un"),i=(l.a.createElement,n="Placement",function(e){return console.warn("Component "+n+" was not imported, exported, or provided by MDXProvider as global scope"),Object(p.b)("div",e)}),o={},m=Object(r.a)({layout:"docs",page_title:"reschedule Stanza - Job Specification",sidebar_title:"reschedule",description:'The "reschedule" stanza specifies the group\'s rescheduling strategy upon\nallocation failures. Nomad will only attempt to reschedule failed allocations on\nto another node only after any local [restarts](docs/job-specification/restart)\nhave been exceeded.',__resourcePath:"docs/job-specification/reschedule.mdx",__scans:{}});function d(e){var a=e.components,t=Object(s.a)(e,["components"]);return Object(p.b)(m,Object(c.a)({},o,t,{components:a,mdxType:"MDXLayout"}),Object(p.b)("h1",{className:"g-type-display-2"},Object(p.b)("a",Object(c.a)({parentName:"h1"},{className:"__permalink-h",href:"#reschedule-stanza","aria-label":"reschedule stanza permalink"}),"\xbb"),Object(p.b)("a",Object(c.a)({parentName:"h1"},{className:"__target-h",id:"reschedule-stanza","aria-hidden":""})),Object(p.b)("inlineCode",{parentName:"h1"},"reschedule")," Stanza"),Object(p.b)(i,{groups:[["job","reschedule"],["job","group","reschedule"]],mdxType:"Placement"}),Object(p.b)("p",null,"The ",Object(p.b)("inlineCode",{parentName:"p"},"reschedule")," stanza specifies the group's rescheduling strategy. If specified at the job\nlevel, the configuration will apply to all groups within the job. If the\nreschedule stanza is present on both the job and the group, they are merged with\nthe group stanza taking the highest precedence and then the job."),Object(p.b)("p",null,'Nomad will attempt to schedule the task on another node if any of its allocation\nstatuses become "failed". It prefers to create a replacement allocation on a node\nthat hasn\'t previously been used.'),Object(p.b)("pre",{className:"language-hcl"},Object(p.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),"job ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"docs"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  group ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"example"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"reschedule")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"attempts"),"       ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"15"),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"interval"),"       ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"1h"'),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"delay"),"          ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"30s"'),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"delay_function")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"exponential"'),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"max_delay"),"      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"120s"'),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"unlimited"),"      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token boolean"}),"false"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(p.b)("div",{className:"alert alert-warning g-type-body",role:"alert"},Object(p.b)("p",{parentName:"div"},"The reschedule stanza does not apply to ",Object(p.b)("inlineCode",{parentName:"p"},"system")," jobs because they run on\nevery node.")),Object(p.b)("h2",{className:"g-type-display-3"},Object(p.b)("a",Object(c.a)({parentName:"h2"},{className:"__permalink-h",href:"#reschedule-parameters","aria-label":"reschedule parameters permalink"}),"\xbb"),Object(p.b)("a",Object(c.a)({parentName:"h2"},{className:"__target-h",id:"reschedule-parameters","aria-hidden":""})),Object(p.b)("inlineCode",{parentName:"h2"},"reschedule")," Parameters"),Object(p.b)("ul",null,Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"attempts",className:"__target-lic","aria-hidden":""})),Object(p.b)("p",{parentName:"li"},Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"#attempts","aria-label":"attempts permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},"attempts"))," ",Object(p.b)("inlineCode",{parentName:"p"},"(int: <varies>)")," - Specifies the number of reschedule attempts\nallowed in the configured interval. Defaults vary by job type, see below\nfor more information.")),Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"interval",className:"__target-lic","aria-hidden":""})),Object(p.b)("p",{parentName:"li"},Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"#interval","aria-label":"interval permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},"interval"))," ",Object(p.b)("inlineCode",{parentName:"p"},"(string: <varies>)")," - Specifies the sliding window which begins\nwhen the first reschedule attempt starts and ensures that only ",Object(p.b)("inlineCode",{parentName:"p"},"attempts"),"\nnumber of reschedule happen within it. If more than ",Object(p.b)("inlineCode",{parentName:"p"},"attempts")," number of\nfailures happen with this interval, Nomad will not reschedule any more.")),Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"delay",className:"__target-lic","aria-hidden":""})),Object(p.b)("p",{parentName:"li"},Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"#delay","aria-label":"delay permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},"delay"))," ",Object(p.b)("inlineCode",{parentName:"p"},"(string: <varies>)"),' - Specifies the duration to wait before attempting\nto reschedule a failed task. This is specified using a label suffix like "30s" or "1h".\nDelay cannot be less than 5 seconds.')),Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"delay_function",className:"__target-lic","aria-hidden":""})),Object(p.b)("p",{parentName:"li"},Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"#delay_function","aria-label":"delay_function permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},"delay_function"))," ",Object(p.b)("inlineCode",{parentName:"p"},"(string: <varies>)")," - Specifies the function that is used to\ncalculate subsequent reschedule delays. The initial delay is specified by the delay parameter.\n",Object(p.b)("inlineCode",{parentName:"p"},"delay_function")," has three possible values which are described below."),Object(p.b)("ul",{parentName:"li"},Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"constant",className:"__target-lic","aria-hidden":""})),Object(p.b)("a",Object(c.a)({parentName:"li"},{href:"#constant","aria-label":"constant permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},"constant"))," - The delay between reschedule attempts stays constant at the ",Object(p.b)("inlineCode",{parentName:"li"},"delay")," value."),Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"exponential",className:"__target-lic","aria-hidden":""})),Object(p.b)("a",Object(c.a)({parentName:"li"},{href:"#exponential","aria-label":"exponential permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},"exponential"))," - The delay between reschedule attempts doubles."),Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"fibonacci",className:"__target-lic","aria-hidden":""})),Object(p.b)("a",Object(c.a)({parentName:"li"},{href:"#fibonacci","aria-label":"fibonacci permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},"fibonacci"))," - The delay between reschedule attempts is calculated by adding the two most recent\ndelays applied. For example if ",Object(p.b)("inlineCode",{parentName:"li"},"delay")," is set to 5 seconds, the next five reschedule attempts will be\ndelayed by 5 seconds, 5 seconds, 10 seconds, 15 seconds, and 25 seconds respectively."))),Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"max_delay",className:"__target-lic","aria-hidden":""})),Object(p.b)("p",{parentName:"li"},Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"#max_delay","aria-label":"max_delay permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},"max_delay"))," ",Object(p.b)("inlineCode",{parentName:"p"},"(string: <varies>)")," - is an upper bound on the delay beyond which it will not increase. This parameter\nis used when ",Object(p.b)("inlineCode",{parentName:"p"},"delay_function")," is ",Object(p.b)("inlineCode",{parentName:"p"},"exponential")," or ",Object(p.b)("inlineCode",{parentName:"p"},"fibonacci"),", and is ignored when ",Object(p.b)("inlineCode",{parentName:"p"},"constant")," delay is used.")),Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"unlimited",className:"__target-lic","aria-hidden":""})),Object(p.b)("p",{parentName:"li"},Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"#unlimited","aria-label":"unlimited permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},"unlimited"))," ",Object(p.b)("inlineCode",{parentName:"p"},"(boolean:<varies>)")," - ",Object(p.b)("inlineCode",{parentName:"p"},"unlimited")," enables unlimited reschedule attempts. If this is set to true\nthe ",Object(p.b)("inlineCode",{parentName:"p"},"attempts")," and ",Object(p.b)("inlineCode",{parentName:"p"},"interval")," fields are not used."))),Object(p.b)("p",null,"Information about reschedule attempts are displayed in the CLI and API for\nallocations. Rescheduling is enabled by default for service and batch jobs\nwith the options shown below."),Object(p.b)("h3",{className:"g-type-display-4"},Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#reschedule-parameter-defaults","aria-label":"reschedule parameter defaults permalink"}),"\xbb"),Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"reschedule-parameter-defaults","aria-hidden":""})),Object(p.b)("inlineCode",{parentName:"h3"},"reschedule")," Parameter Defaults"),Object(p.b)("p",null,"The values for the ",Object(p.b)("inlineCode",{parentName:"p"},"reschedule")," parameters vary by job type. Below are the\ndefaults by job type:"),Object(p.b)("ul",null,Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("p",{parentName:"li"},"The Default Batch Reschedule Policy is:"),Object(p.b)("pre",Object(c.a)({parentName:"li"},{className:"language-hcl"}),Object(p.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"reschedule")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"attempts"),"       ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"1"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"interval"),"       ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"24h"'),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"unlimited"),"      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token boolean"}),"false"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"delay"),"          ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"5s"'),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"delay_function")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"constant"'),"\n",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n"))),Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("p",{parentName:"li"},"The Default Service Reschedule Policy is:"),Object(p.b)("pre",Object(c.a)({parentName:"li"},{className:"language-hcl"}),Object(p.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"reschedule")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"delay"),"          ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"30s"'),"\n ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"delay_function")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"exponential"'),"\n ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"max_delay"),"      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"1h"'),"\n ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"unlimited"),"      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token boolean"}),"true"),"\n",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")))),Object(p.b)("h3",{className:"g-type-display-4"},Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#disabling-rescheduling","aria-label":"disabling rescheduling permalink"}),"\xbb"),Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"disabling-rescheduling","aria-hidden":""})),"Disabling rescheduling"),Object(p.b)("p",null,"To disable rescheduling, set the ",Object(p.b)("inlineCode",{parentName:"p"},"attempts")," parameter to zero and ",Object(p.b)("inlineCode",{parentName:"p"},"unlimited")," to false."),Object(p.b)("pre",{className:"language-hcl"},Object(p.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),"job ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"docs"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  group ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"example"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"reschedule")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"attempts"),"  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"0"),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"unlimited")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token boolean"}),"false"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")))}d.isMDXComponent=!0},kFpH:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/job-specification/reschedule",function(){return t("0rv8")}])}},[["kFpH",0,1,2,4,3,5,6]]]);