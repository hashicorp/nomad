(window.webpackJsonp=window.webpackJsonp||[]).push([[242],{OSUI:function(e,a,t){"use strict";t.r(a),t.d(a,"default",(function(){return O}));var n,c=t("wx14"),o=t("Ff2n"),s=t("q1tI"),b=t.n(s),p=t("7ljp"),r=t("j1un"),i=(b.a.createElement,n="Placement",function(e){return console.warn("Component "+n+" was not imported, exported, or provided by MDXProvider as global scope"),Object(p.b)("div",e)}),l={},m=Object(r.a)({layout:"docs",page_title:"network Stanza - Job Specification",sidebar_title:"network",description:'The "network" stanza specifies the networking requirements for the task group,\nincluding networking mode and port allocations. ',__resourcePath:"docs/job-specification/network.mdx",__scans:{}});function O(e){var a=e.components,t=Object(o.a)(e,["components"]);return Object(p.b)(m,Object(c.a)({},l,t,{components:a,mdxType:"MDXLayout"}),Object(p.b)("h1",{className:"g-type-display-2"},Object(p.b)("a",Object(c.a)({parentName:"h1"},{className:"__permalink-h",href:"#network-stanza","aria-label":"network stanza permalink"}),"\xbb"),Object(p.b)("a",Object(c.a)({parentName:"h1"},{className:"__target-h",id:"network-stanza","aria-hidden":""})),Object(p.b)("inlineCode",{parentName:"h1"},"network")," Stanza"),Object(p.b)(i,{groups:[["job","group","network"]],mdxType:"Placement"}),Object(p.b)("p",null,"The ",Object(p.b)("inlineCode",{parentName:"p"},"network")," stanza specifies the networking requirements for the task group,\nincluding the network mode and port allocations. When scheduling jobs in\nNomad they are provisioned across your fleet of machines along with other jobs\nand services. Because you don't know in advance what host your job will be\nprovisioned on, Nomad will provide your tasks with network configuration when\nthey start up."),Object(p.b)("p",null,"When the ",Object(p.b)("inlineCode",{parentName:"p"},"network")," stanza is defined with ",Object(p.b)("inlineCode",{parentName:"p"},"bridge")," as the networking mode,\nall tasks in the task group share the same network namespace. This is a prerequisite for\n",Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/integrations/consul-connect"}),"Consul Connect"),". Tasks running within a\nnetwork namespace are not visible to applications outside the namespace on the same host.\nThis allows ",Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/job-specification/connect",title:"Nomad Consul Connect Integration"}),"Connect")," enabled applications to bind only to localhost within the shared network stack,\nand use the proxy for ingress and egress traffic."),Object(p.b)("p",null,"Note that this document only applies to services that want to ",Object(p.b)("em",{parentName:"p"},"listen")," on a\nport. Batch jobs or services that only make outbound connections do not need to\nallocate ports, since they will use any available interface to make an outbound\nconnection."),Object(p.b)("pre",{className:"language-hcl"},Object(p.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),"job ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"docs"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  group ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"example"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"network")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      port ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"http"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n      port ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"https"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n      port ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"lb"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"static")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"8889"),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(p.b)("h2",{className:"g-type-display-3"},Object(p.b)("a",Object(c.a)({parentName:"h2"},{className:"__permalink-h",href:"#network-parameters","aria-label":"network parameters permalink"}),"\xbb"),Object(p.b)("a",Object(c.a)({parentName:"h2"},{className:"__target-h",id:"network-parameters","aria-hidden":""})),Object(p.b)("inlineCode",{parentName:"h2"},"network")," Parameters"),Object(p.b)("ul",null,Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"mbits",className:"__target-lic","aria-hidden":""})),Object(p.b)("p",{parentName:"li"},Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"#mbits","aria-label":"mbits permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},"mbits"))," ",Object(p.b)("code",null,"(",Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/upgrade/upgrade-specific#nomad-0-12-0"}),Object(p.b)("em",{parentName:"a"},"deprecated"))," int: 10)")," - Specifies the bandwidth required in MBits.")),Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"port",className:"__target-lic","aria-hidden":""})),Object(p.b)("p",{parentName:"li"},Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"#port","aria-label":"port permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},"port"))," ",Object(p.b)("code",null,"(",Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"#port-parameters"}),"Port"),": nil)")," - Specifies a TCP/UDP port\nallocation and can be used to specify both dynamic ports and reserved ports.")),Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"mode",className:"__target-lic","aria-hidden":""})),Object(p.b)("p",{parentName:"li"},Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"#mode","aria-label":"mode permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},"mode"))," ",Object(p.b)("inlineCode",{parentName:"p"},'(string: "host")')," - Mode of the network. The following modes are available:"),Object(p.b)("ul",{parentName:"li"},Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"none",className:"__target-lic","aria-hidden":""})),Object(p.b)("a",Object(c.a)({parentName:"li"},{href:"#none","aria-label":"none permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},"none"))," - Task group will have an isolated network without any network interfaces."),Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"bridge",className:"__target-lic","aria-hidden":""})),Object(p.b)("a",Object(c.a)({parentName:"li"},{href:"#bridge","aria-label":"bridge permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},"bridge"))," - Task group will have an isolated network namespace with an interface\nthat is bridged with the host. Note that bridge networking is only\ncurrently supported for the ",Object(p.b)("inlineCode",{parentName:"li"},"docker"),", ",Object(p.b)("inlineCode",{parentName:"li"},"exec"),", ",Object(p.b)("inlineCode",{parentName:"li"},"raw_exec"),", and ",Object(p.b)("inlineCode",{parentName:"li"},"java")," task\ndrivers."),Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"host",className:"__target-lic","aria-hidden":""})),Object(p.b)("a",Object(c.a)({parentName:"li"},{href:"#host","aria-label":"host permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},"host"))," - Each task will join the host network namespace and a shared network\nnamespace is not created. This matches the current behavior in Nomad 0.9."),Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"cni",className:"__target-lic","aria-hidden":""})),Object(p.b)("a",Object(c.a)({parentName:"li"},{href:"#cni","aria-label":"cni permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},"cni/<cni network name>"))," - Task group will have an isolated network namespace\nwith the network configured by CNI."))),Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"dns",className:"__target-lic","aria-hidden":""})),Object(p.b)("p",{parentName:"li"},Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"#dns","aria-label":"dns permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},"dns"))," ",Object(p.b)("code",null,"(",Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"#dns-parameters"}),"DNSConfig"),": nil)")," - Sets the DNS configuration\nfor the allocations. By default all DNS configuration is inherited from the client host.\nDNS configuration is only supported on Linux clients at this time."))),Object(p.b)("h3",{className:"g-type-display-4"},Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#port-parameters","aria-label":"port parameters permalink"}),"\xbb"),Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"port-parameters","aria-hidden":""})),Object(p.b)("inlineCode",{parentName:"h3"},"port")," Parameters"),Object(p.b)("ul",null,Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"static",className:"__target-lic","aria-hidden":""})),Object(p.b)("a",Object(c.a)({parentName:"li"},{href:"#static","aria-label":"static permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},"static"))," ",Object(p.b)("inlineCode",{parentName:"li"},"(int: nil)")," - Specifies the static TCP/UDP port to allocate. If omitted, a\ndynamic port is chosen. We ",Object(p.b)("strong",{parentName:"li"},"do not recommend")," using static ports, except\nfor ",Object(p.b)("inlineCode",{parentName:"li"},"system")," or specialized jobs like load balancers."),Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"to",className:"__target-lic","aria-hidden":""})),Object(p.b)("a",Object(c.a)({parentName:"li"},{href:"#to","aria-label":"to permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},"to"))," ",Object(p.b)("inlineCode",{parentName:"li"},"(string:nil)"),' - Applicable when using "bridge" mode to configure port\nto map to inside the task\'s network namespace. ',Object(p.b)("inlineCode",{parentName:"li"},"-1")," sets the mapped port equal to the\ndynamic port allocated by the scheduler. The ",Object(p.b)("inlineCode",{parentName:"li"},"NOMAD_PORT_<label>")," environment variable\nwill contain the ",Object(p.b)("inlineCode",{parentName:"li"},"to")," value."),Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"host_network",className:"__target-lic","aria-hidden":""})),Object(p.b)("a",Object(c.a)({parentName:"li"},{href:"#host_network","aria-label":"host_network permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},"host_network"))," ",Object(p.b)("inlineCode",{parentName:"li"},"(string:nil)")," - Designates the host network name to use when allocating\nthe port. When port mapping the host port will only forward traffic to the matched host\nnetwork address.")),Object(p.b)("p",null,"The label assigned to the port is used to identify the port in service\ndiscovery, and used in the name of the environment variable that indicates\nwhich port your application should bind to. For example:"),Object(p.b)("pre",{className:"language-hcl"},Object(p.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),"port ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"foo"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(p.b)("p",null,"When the task starts, it will be passed the following environment variables:"),Object(p.b)("ul",null,Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("tt",null,"NOMAD_IP_foo")," - The IP to bind on for the given port label."),Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("tt",null,"NOMAD_PORT_foo")," - The port value for the given port label."),Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("tt",null,"NOMAD_ADDR_foo")," - A combined",Object(p.b)("tt",null,"ip:port")," that can be used for convenience.")),Object(p.b)("p",null,"The label of the port is just text - it has no special meaning to Nomad."),Object(p.b)("h2",{className:"g-type-display-3"},Object(p.b)("a",Object(c.a)({parentName:"h2"},{className:"__permalink-h",href:"#dns-parameters","aria-label":"dns parameters permalink"}),"\xbb"),Object(p.b)("a",Object(c.a)({parentName:"h2"},{className:"__target-h",id:"dns-parameters","aria-hidden":""})),Object(p.b)("inlineCode",{parentName:"h2"},"dns")," Parameters"),Object(p.b)("ul",null,Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"servers",className:"__target-lic","aria-hidden":""})),Object(p.b)("a",Object(c.a)({parentName:"li"},{href:"#servers","aria-label":"servers permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},"servers"))," ",Object(p.b)("inlineCode",{parentName:"li"},"(array<string>: nil)")," - Sets the DNS nameservers the allocation uses for name resolution."),Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"searches",className:"__target-lic","aria-hidden":""})),Object(p.b)("a",Object(c.a)({parentName:"li"},{href:"#searches","aria-label":"searches permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},"searches"))," ",Object(p.b)("inlineCode",{parentName:"li"},"(array<string>: nil)")," - Sets the search list for hostname lookup"),Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),Object(p.b)("a",Object(c.a)({parentName:"li"},{id:"options",className:"__target-lic","aria-hidden":""})),Object(p.b)("a",Object(c.a)({parentName:"li"},{href:"#options","aria-label":"options permalink",className:"__permalink-lic"}),Object(p.b)("inlineCode",{parentName:"a"},"options"))," ",Object(p.b)("inlineCode",{parentName:"li"},"(array<string>: nil)")," - Sets internal resolver variables.")),Object(p.b)("h2",{className:"g-type-display-3"},Object(p.b)("a",Object(c.a)({parentName:"h2"},{className:"__permalink-h",href:"#network-examples","aria-label":"network examples permalink"}),"\xbb"),Object(p.b)("a",Object(c.a)({parentName:"h2"},{className:"__target-h",id:"network-examples","aria-hidden":""})),Object(p.b)("inlineCode",{parentName:"h2"},"network")," Examples"),Object(p.b)("p",null,"The following examples only show the ",Object(p.b)("inlineCode",{parentName:"p"},"network")," stanzas. Remember that the\n",Object(p.b)("inlineCode",{parentName:"p"},"network")," stanza is only valid in the placements listed above."),Object(p.b)("h3",{className:"g-type-display-4"},Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#dynamic-ports","aria-label":"dynamic ports permalink"}),"\xbb"),Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"dynamic-ports","aria-hidden":""})),"Dynamic Ports"),Object(p.b)("p",null,'This example specifies a dynamic port allocation for the port labeled "http".\nDynamic ports are allocated in a range from ',Object(p.b)("inlineCode",{parentName:"p"},"20000")," to ",Object(p.b)("inlineCode",{parentName:"p"},"32000"),"."),Object(p.b)("p",null,"Most services run in your cluster should use dynamic ports. This means that the\nport will be allocated dynamically by the scheduler, and your service will have\nto read an environment variable to know which port to bind to at startup."),Object(p.b)("pre",{className:"language-hcl"},Object(p.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),"group ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"example"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"network")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    port ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"http"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    port ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"https"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(p.b)("pre",{className:"language-hcl"},Object(p.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"network")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  port ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"http"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(p.b)("h3",{className:"g-type-display-4"},Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#static-ports","aria-label":"static ports permalink"}),"\xbb"),Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"static-ports","aria-hidden":""})),"Static Ports"),Object(p.b)("p",null,'This example specifies a static port allocation for the port labeled "lb". Static\nports bind your job to a specific port on the host they\' are placed on. Since\nmultiple services cannot share a port, the port must be open in order to place\nyour task.'),Object(p.b)("pre",{className:"language-hcl"},Object(p.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"network")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  port ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"lb"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"static")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"6539"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(p.b)("h3",{className:"g-type-display-4"},Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#mapped-ports","aria-label":"mapped ports permalink"}),"\xbb"),Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"mapped-ports","aria-hidden":""})),"Mapped Ports"),Object(p.b)("p",null,"Some drivers (such as ",Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/drivers/docker",title:"Nomad Docker Driver"}),"Docker")," and ",Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"/docs/drivers/qemu",title:"Nomad QEMU Driver"}),"QEMU"),") allow you\nto map ports. A mapped port means that your application can listen on a fixed\nport (it does not need to read the environment variable) and the dynamic port\nwill be mapped to the port in your container or virtual machine."),Object(p.b)("pre",{className:"language-hcl"},Object(p.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),"group ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"app"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"network")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    port ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"http"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n  task ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"example"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"driver")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"docker"'),"\n\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"config")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"port_map")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"http")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"8080"),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(p.b)("p",null,"The above example is for the Docker driver. The service is listening on port\n",Object(p.b)("inlineCode",{parentName:"p"},"8080")," inside the container. The driver will automatically map the dynamic port\nto this service."),Object(p.b)("p",null,"When the task is started, it is passed an additional environment variable named\n",Object(p.b)("inlineCode",{parentName:"p"},"NOMAD_HOST_PORT_http")," which indicates the host port that the HTTP service is\nbound to."),Object(p.b)("h3",{className:"g-type-display-4"},Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#bridge-mode","aria-label":"bridge mode permalink"}),"\xbb"),Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"bridge-mode","aria-hidden":""})),"Bridge Mode"),Object(p.b)("p",null,"Bridge mode allows compatible tasks to share a networking stack and interfaces. Nomad\ncan then do port mapping without relying on individual task drivers to implement port\nmapping configuration."),Object(p.b)("p",null,"The following example is a group level network stanza that uses bridge mode\nand port mapping."),Object(p.b)("pre",{className:"language-hcl"},Object(p.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"network")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"mode")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"bridge"'),"\n    port ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"http"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"static")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"9002"),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"to"),"     ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"9002"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(p.b)("h3",{className:"g-type-display-4"},Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#dns-1","aria-label":"dns permalink"}),"\xbb"),Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"dns-1","aria-hidden":""})),"DNS"),Object(p.b)("p",null,"The following example configures the allocation to use Google's DNS resolvers 8.8.8.8 and 8.8.4.4."),Object(p.b)("pre",{className:"language-hcl"},Object(p.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"network")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"dns")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"servers")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"8.8.8.8"'),", ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"8.8.4.4"'),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(p.b)("h3",{className:"g-type-display-4"},Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#container-network-interface-cni","aria-label":"container network interface cni permalink"}),"\xbb"),Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"container-network-interface-cni","aria-hidden":""})),"Container Network Interface (CNI)"),Object(p.b)("p",null,"Nomad supports CNI by fingerprinting each node for ",Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"https://github.com/containernetworking/cni/blob/v0.8.0/SPEC.md#network-configuration"}),"CNI network configurations"),".\nThese are associated to the node by the ",Object(p.b)("inlineCode",{parentName:"p"},"name")," field of the CNI configuration.\nThe ",Object(p.b)("inlineCode",{parentName:"p"},"name")," can then be used when setting the network ",Object(p.b)("inlineCode",{parentName:"p"},"mode")," field in the form of ",Object(p.b)("inlineCode",{parentName:"p"},"cni/<name>"),"."),Object(p.b)("p",null,"As an example if the following CNI configuration was on a node the proceeding network stanza could be used."),Object(p.b)("pre",{className:"language-json"},Object(p.b)("code",Object(c.a)({parentName:"pre"},{className:"language-json"}),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),'"cniVersion"'),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"0.3.1"'),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),","),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),'"name"'),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"mynet"'),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),","),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),'"plugins"'),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"["),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),'"type"'),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"ptp"'),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),","),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),'"ipMasq"'),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token boolean"}),"true"),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),","),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),'"ipam"'),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),'"type"'),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"host-local"'),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),","),"\n        ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),'"subnet"'),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"172.16.30.0/24"'),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),","),"\n        ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),'"routes"'),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"["),"\n          ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n            ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),'"dst"'),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"0.0.0.0/0"'),"\n          ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n        ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),","),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),'"type"'),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"portmap"'),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),","),"\n      ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),'"capabilities"'),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),'"portMappings"'),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token boolean"}),"true"),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),","),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(p.b)("pre",{className:"language-hcl"},Object(p.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"network")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"mode")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"cni/mynet"'),"\n  port ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"http"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"to")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"8080"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(p.b)("p",null,"The Nomad client will build the correct ",Object(p.b)("a",Object(c.a)({parentName:"p"},{href:"https://github.com/containernetworking/cni/blob/v0.8.0/CONVENTIONS.md#well-known-capabilities"}),"capabilities arguments")," for the portmap plugin based on the defined port stanzas."),Object(p.b)("h3",{className:"g-type-display-4"},Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#host-networks","aria-label":"host networks permalink"}),"\xbb"),Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"host-networks","aria-hidden":""})),"Host Networks"),Object(p.b)("p",null,"In some cases a port should only be allocated to a specific interface or address on the host.\nThe ",Object(p.b)("inlineCode",{parentName:"p"},"host_network")," field of a port will constrain port allocation to a single named host network.\nIf ",Object(p.b)("inlineCode",{parentName:"p"},"host_network")," is set for a port, Nomad will schedule the allocations on a node which has defined a ",Object(p.b)("inlineCode",{parentName:"p"},"host_network"),' with the given name.\nIf not set the "default" host network is used which is commonly the address with a default route associated with it.'),Object(p.b)("p",null,"When Nomad does port mapping for ports with a defined ",Object(p.b)("inlineCode",{parentName:"p"},"host_network"),", the port mapping rule will use the host address as the destination address."),Object(p.b)("p",null,"*Host networks does not currently support task based mapped ports such as the Docker driver's ",Object(p.b)("inlineCode",{parentName:"p"},"port_map")," configuration."),Object(p.b)("pre",{className:"language-hcl"},Object(p.b)("code",Object(c.a)({parentName:"pre"},{className:"language-hcl"}),Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token keyword"}),"network")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"mode")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"bridge"'),"\n  \n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token comment"}),"# define a port to use for public https traffic"),"\n  port ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"https"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"static"),"       ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"443"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"to"),"           ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"8080"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"host_network")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"public"'),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token comment"}),"# define a port that is only exposed to private traffic"),"\n  port ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"admin"')," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"to"),"           ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token number"}),"9000"),"\n    ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token property"}),"host_network")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"=")," ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token string"}),'"private"'),"\n  ",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(p.b)("span",Object(c.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(p.b)("h3",{className:"g-type-display-4"},Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__permalink-h",href:"#limitations","aria-label":"limitations permalink"}),"\xbb"),Object(p.b)("a",Object(c.a)({parentName:"h3"},{className:"__target-h",id:"limitations","aria-hidden":""})),"Limitations"),Object(p.b)("ul",null,Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),"Only one ",Object(p.b)("inlineCode",{parentName:"li"},"network")," stanza can be specified, when it is defined at the task group level."),Object(p.b)("li",Object(c.a)({parentName:"ul"},{className:"g-type-long-body"}),"Only the ",Object(p.b)("inlineCode",{parentName:"li"},"NOMAD_PORT_<label>")," and ",Object(p.b)("inlineCode",{parentName:"li"},"NOMAD_HOST_PORT_<label>")," environment\nvariables are set for group network ports.")))}O.isMDXComponent=!0},hFCf:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/job-specification/network",function(){return t("OSUI")}])}},[["hFCf",0,1,2,4,3,5,6]]]);